var currentCityObject;var cache=[];var cachefilter=[];var selectedCategoryTab;var selectedEntityId;var openMediaId;var viatorActivityDestId;var showBelow=true;var panelFlag='';var explorePanelMode='';cacheDetailEntityData='';var btnFlag=false;var hotelStartRating=4;var pastTrip=false;var reviewEvaluation=1;var surfMode="Plan";var recommendsubcat="";var allfriends="";var eventfilterdate="";var eventTabCategoryListing="";var bhotellist="";var hotellist="";var ActivityList="";var bactivitylist="";var pactivitylist="";var reviewsectionRefresh=false;var cityZoomLevel={};var PanelVisited="";var attraction_init=true;var restaurant_init=false;var nightlife_init=false;var quickNavTripId=0;var isSharePanel=false;var isCityDropDownOnChangeEvent=false;var PlanHotelCityCount=0;var PlanhotelPageNum=0;var defaultImage=new Array();defaultImage[1]='/images/attraction_default.gif';defaultImage[3]='/images/restaurant_default.gif';defaultImage[4]='/images/nightlife_default.gif';defaultImage[6]='/images/Shoping_Default.png';var PlanStarRatingArray=new Array('0','0','0','0','0');var minStarRating='0|0|0|0|0';var searchRadius='0.5';var amenities='';var price_range=100000;var sortval='PRICE';var price_sort_order=0;var quality_sort_order=0;var globalItemId=0;var alreadyloadingHotels=true;var activeExploreTab;var activeBookTab='Flight';var viatorbookprice_sort_order='0';var viatorbookrating_sort_order='0';var viatorSelectedCategory=0;var selectedTripType='';var objMap=null;var weatherDetailsforPlan=new Array('0','0','0','0');var activityTabWelcome=false;var loadScriptCalledOnceViaWelcome=false;var tripDataLoadedOnceViaWelcome=false;var ipPushPinLoaded=false;var ipPushpinTimeOut;var selectedCountry='';var selectedCityname='';var whetherSorted=false,whetherFiltered=false,whetherAmenitiesSel=false;var selectedAmenitiesArray=new Array();var weatherXhr=null;var newsCallFromPlan=null;if($(document).width()<1024||(typeof FBAPP!='undefined'&&FBAPP==1)){showBelow=true;}
function bookFromPlan(mode){$('#back-to-map').hide();switch(mode){case'hotel':BookFromPlanStep2();break;case'hostel':$('#planHostelBookingAvailability').hide();$('#bookTab').trigger('click');$('#bhostel').trigger('click');$("#searchFilters").fadeIn();submitBookingRequestFromPlan(id);break;}}
function addCommas(nStr)
{nStr+='';x=nStr.split('.');x1=x[0];x2=x.length>1?'.'+x[1]:'';var rgx=/(\d+)(\d{3})/;while(rgx.test(x1)){x1=x1.replace(rgx,'$1'+','+'$2');}
return x1+x2;}
function loadBookPanels(pagename,content){url='index/'+pagename+'.phtml';$.get(url,function(fsdata){$(content).html(fsdata)});}
var bactivityCacheData;function searchActivityForm(destinationId,pnl){if(typeof pnl=='undefined'){var pnl='';}
var url='/html5/viator/getfiltersfordestination/destId/'+destinationId+'/panel/'+pnl+'/sid/'+Math.random();hotelAlreadyLoad=$.get(url,function(result){if(pnl=="welcome"){$("#wViator_category").html(result);if(document.getElementById("viator_category")){$("#viator_category").html(result);}}else{$("#viator_category").html(result);}});}
function searchBookingActivity(sortType){var sortFlag='0';if(sortType=='price'){sortFlag='1'
viatorbookrating_sort_order='0';$("#activity_star_sort").attr('class','');if(viatorbookprice_sort_order=='0'){sortOrder='PRICE_FROM_A';$("#activity_price_sort").attr('class','');$("#activity_price_sort").addClass('active desc');viatorbookprice_sort_order='1'}else{sortOrder='PRICE_FROM_D';$("#activity_price_sort").attr('class','');$("#activity_price_sort").addClass('active asc');viatorbookprice_sort_order='0';}}else if(sortType=='rating'){sortFlag='1'
$("#activity_price_sort").attr('class','');viatorbookprice_sort_order='0';if(viatorbookrating_sort_order=='0'){sortOrder='REVIEW_AVG_RATING_D';$("#activity_star_sort").attr('class','');$("#activity_star_sort").addClass('active asc');viatorbookrating_sort_order='1'}else{sortOrder='REVIEW_AVG_RATING_A';$("#activity_star_sort").attr('class','');$("#activity_star_sort").addClass('active desc');viatorbookrating_sort_order='0';}}else if(typeof sortType=='undefined'){sortOrder='TOP_SELLERS';$("#activity_price_sort").attr('class','');$("#activity_star_sort").attr('class','');viatorbookrating_sort_order='0';viatorbookprice_sort_order='0';}
if(typeof sortType=='undefined'){if($("#activity_location").val()==''||$("#activity_location").val()=="Select a Location"){notifyme("Please select a Location","error");return false;}
if(activityFlag==false){activityFlag=true;}
if(document.getElementById("datelessAct").checked){var sDate=document.getElementById('viator_startDate').value;var tDate=document.getElementById('viator_endDate').value;var mon1=sDate.substring(0,2);var dt1=sDate.substring(3,5);var yr1=sDate.substring(6,10);var mon2=tDate.substring(0,2);var dt2=tDate.substring(3,5);var yr2=tDate.substring(6,10);var dateValid=validationDate(sDate,tDate);if(dateValid==0){return false;}
sDate=sDate.split('-');tDate=tDate.split('-');var startDate=sDate[2]+'-'+sDate[0]+'-'+sDate[1];var endDate=tDate[2]+'-'+tDate[0]+'-'+tDate[1];var newstartDate=sDate[0]+'-'+sDate[1]+'-'+sDate[2];var newendDate=tDate[0]+'-'+tDate[1]+'-'+tDate[2];}else{var startDate='';var endDate='';}
$('#activitySearch').hide();$('#activitySearchResults').html(panelloaderDiv);$('#activitySearchResults').show();$(".bActivitiesBtnBTR").show();$("#ActivitysortBy").show();$(".bActivitiesBtnBTR").click(function(){$(".bActivitiesBtnBTR").hide();$(".bActivitiesBtnBackToGrid").hide();$("#result-detail_activity").hide();$("#ActivitysortBy").hide();$('#activitySearchResults').hide();$('#activityDetailCont').hide();$("#searchBarViator").hide();$('#activitySearch').show();if($("#geofarelitab").hasClass("active")==true){hashPushState("Fare-Search/Activities","Georama - Fare Search | Activities");}else{activeBookTab='Activity';createHashURLTitle("Book","Activity");hashPushState(hashLocationString,hashPageTitle);}});if(document.getElementById("viator_catId")){var category=document.getElementById("viator_catId").value;}else{var category=0;}
var viatorCity=$("#activity_location").val();$('#searchActivityDetailCity').html(viatorCity);if(typeof newstartDate!='undefined'&&typeof newendDate!='undefined'){$('#searchActivityDetailCheckin').html(ddmmyyyyToMonDayYear(newstartDate));$('#searchActivityDetailCheckout').html(ddmmyyyyToMonDayYear(newendDate));}
$("#result-detail_activity").show();if(!startDate){$("#activity_from_date").hide();$('#searchActivityDetailCheckin').hide();$('#searchActivityDetailCheckout').hide();$("#activity_to_date").hide();}else{$("#activity_from_date").show();$('#searchActivityDetailCheckin').show();$('#searchActivityDetailCheckout').show();$("#activity_to_date").show();}}
city=document.getElementById('hdnCity').value;var cityId=document.getElementById('hdnCityId').value;var cacheKey="activity_"+cityId+"_0";$("#book-activities").show();$("#contBookActivity").show();if(typeof(sortType)=='undefined'){updateTripInfoForAllPlaces('D');}
else{document.getElementById("activitySearchResults").innerHTML='<div style="padding:40px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';}
if(sortType=='rating'||sortType=='price'){$("#clearActivityBookFilterA").addClass('filter_enabled');$("#clearActivityBookFilterA").removeClass('filter_disabled');}
if(viatorActivityDestId==0){$("#result-detail_activity").hide();$(".bActivitiesBtnBTR").show();$("#ActivitysortBy").hide();$("#activitySearchResults").html('<article class="info padding align-center font_18">Sorry, we did not find any results that match your criteria. Please update your search and try again.</article>');ResetBrowserScrollAfterDataLoaded();}else{$.post("/html5/viator/searchthingstodo",{startDate:startDate,endDate:endDate,sortOrder:sortOrder,topX:"1-200",destId:viatorActivityDestId,currencyCode:"USD",catId:category,subCatId:0,dealsOnly:false,sortFlag:sortFlag},function(fsdata){if(fsdata=='0'){$("#result-detail_activity").hide();$("#ActivitysortBy").hide();$("#activitySearchResults").html('<article class="info padding align-center font_18">Sorry, we did not find any results that match your criteria. Please update your search and try again.</article>');}else{if($("#geofarelitab").hasClass("active")==true){hashPushState("Fare-Search/Activities/Results","Georama - Fare Search | Activities");}else{hashPushState("Explore/Book/Activities/Results","Georama - Explore | Book - Activities");}
bactivityCacheData=fsdata;cache[cacheKey]=fsdata;renderBookingActivity(fsdata);ResetBrowserScrollAfterDataLoaded();if(isLiveServer==true){if(sortType=='rating'||sortType=='price'){pushGAEventTags('Book','Activity');}}}});}}
function openBookingActivityDetail(reference,currencyCode,counter,title,calledFrom){var detailText='';$('#activitySearchResults').hide();$('#activityDetailCont').show();$("#ActivitysortBy").hide();$('#activitySearchResults').hide();$("#searchBarViator").hide();$("#result-detail_activity").hide();$('.bActivitiesBtnBackToGrid').show();$(".bActivitiesBtnBTR").hide();$('.bActivitiesBtnBackToGrid').click(function(){$(this).hide();$(".bActivitiesBtnBTR").show();$("#ActivitysortBy").show();$('#activitySearchResults').show();$("#searchBarViator").hide();$('#activitySearchResults').show();$('#activityDetailCont').hide();$('#result-detail_activity').show();if($("#geofareitab").hasClass("active")==true){hashPushState("Fare-Search/Activities/Results","Georama - Fare Search | Activities");}else{hashPushState("Explore/Book/Activities/Results","Georama - Explore | Book - Activities");}});if(typeof calledFrom=='undefined'){detailText+='<a class="scrollup" href="javascript://">&nbsp;</a>';detailText+='<div class="pnlScrollCont">';detailText+='<div class="leftList vscroll-item">'+bactivitylist+'</div>';detailText+='</div>';detailText+='<a class="scrolldown" href="javascript://">&nbsp;</a>';$('#bActivityList').show().html(detailText);}
$('#bactivityDetails').html(preloadDiv);$("#bActivityList .vscroll-item section").removeClass('selected');$('#activitybook_'+reference).addClass('hotelList selected');if(typeof calledFrom=='undefined')
if($('#bActivityList .pnlScrollCont').height()<$('#activitybook_'+reference).position().top){if($("#bActivityList .vscroll-item").height()-$('#activitybook_'+reference).position().top<$('#bActivityList .pnlScrollCont').height()){$("#bActivityList .vscroll-item").css('top',$('#bActivityList .pnlScrollCont').height()-$('#bActivityList .vscroll-item').height());$('#bActivityList .scrollup').css('visibility','visible');$('#bActivityList .scrolldown').css('visibility','hidden');}else{$("#bActivityList .vscroll-item").css('top',-1*Number($('#activitybook_'+reference).position().top));$('#bActivityList .scrollup').css('visibility','visible');}}
if($("#bActivityList .vscroll-item").hasClass('scrolling')){}else{$("#bActivityList .vscroll-item").addClass('scrolling');scrollDiv('bActivityList');}
if($("#geofarelitab").hasClass("active")==true){hashPushState("Fare-Search/Activity/"+reference+'/'+counter+'/'+title,"Georama - Fare Search | Activity -"+title);}else{hashPushState("Explore/Book/Activity/"+reference+'/'+counter+'/'+title,"Georama - Book | Activity -"+title);}
var url='/html5/viator/getcodeproducts/productCodes/'+reference+'/currencyCode/'+currencyCode+'/tab/book/sid/'+Math.random();$.get(url,function(fsdata){$('#bactivityDetails').html(fsdata);$('#ActivitybookMap .scrollbar_wrapper').tinyscrollbar({sizethumb:25});searchActivityAvailability();});}
function imgScroller(){$(".items img").click(function(){if($(this).hasClass("active")){return;}
var url=$(this).attr("alt");var wrap=$("#image_wrap");var img=new Image();img.onload=function(){wrap.fadeTo("fast",1);wrap.find("img").attr("src",url);};img.src=url;$(".items img").removeClass("active");$(this).addClass("active");}).filter(":first").click();}
function starRateHotel(rating){if(rating<1)rating=1;if(rating>5)rating=5;var ctr=1;var trans=Math.floor(rating);if(typeof rating!='undefined'||rating!=''){var result='<artcile class="fr">';for(var i=1;i<=trans;i++){result+='<span class="hotel_staring"></span>';ctr++;}
if(trans!=rating){result+='<span class="hotel_staring_half"></span>';ctr++}
for(var i=ctr;i<=5;i++){result+='<span class="hotel_staring_empty"></span>';}
result+='</artcile>';return result;}}
function submitenter(elm,e,widget){var keycode;if(window.event)keycode=window.event.keyCode;else if(e)keycode=e.which;else return true;if(keycode==13){switch(widget){case'attraction':if(recommendsubcat=="yelp"){var catId=document.getElementById("hdnattractcat").value}else{var catId=1;}
openAttrRecommendation(catId,'attractionList',elm.value,'enter');break;case'activity':if(elm.value==''||elm.value=='Keyword'){openPlanViatorActivity();}else{openPlanViatorActivity('','','',elm.value);}
break;case'restaurant':if(recommendsubcat=="yelp"){var catId=document.getElementById("hdnrestaurantcat").value}else{var catId=3;}
openRestRecommendation(catId,'attractionList',elm.value,'enter');break;case'nightlife':if(recommendsubcat=="yelp"){var catId=document.getElementById("hdnnightlifecat").value}else{var catId=4;}
openNightRecommendation(catId,'attractionList',elm.value,'enter');break;case'shopping':if(recommendsubcat=="yelp"){var catId=document.getElementById("hdnshoppingcat").value}else{var catId=6;}
openShopRecommendation(catId,'attractionList',elm.value,'enter');break;case'hotel':if(elm.value==''||elm.value=='Keyword'){filterPlanHotelSearchResult();}else{filterPlanHotelSearchResult('updateSearch','');}
break;case'events':openEvents('',elm.value);break;case'deals':openDeals('',elm.value,'enter');break;case'viatorBook':FreeTextSearch(elm.value);break;case'hotelBook':filterBookHotelSearchResult('updateSearch','');break;}
return false;}
else
return true;}
var cityInfoTopItemCalled=false;function openPanelWithDetail(bucketName,id){selectedEntityId=id;switch(bucketName){case'attraction':if(openPanelFromMyTrip==true){openPanelFromMyTrip=false;}else{cityInfoTopItemCalled=true;}
$("#cattraction").trigger('click');break;case'activity':$("#cactivities").trigger('click');break;case'restaurants':if(openPanelFromMyTrip==true){openPanelFromMyTrip=false;}else{cityInfoTopItemCalled=true;}
$("#crestaurant").trigger('click');break;case'nightlife':if(openPanelFromMyTrip==true){openPanelFromMyTrip=false;}else{cityInfoTopItemCalled=true;}
$("#cnightlife").trigger('click');break;case'Shopping':if(openPanelFromMyTrip==true){openPanelFromMyTrip=false;}else{cityInfoTopItemCalled=true;}
$("#cshopping").trigger('click');break;case'event':$("#cevents").trigger('click');break;case'Hotels':if(openPanelFromMyTrip==true){openPanelFromMyTrip=false;}else{cityInfoTopItemCalled=true;}
$("#chotel").trigger('click');break;case'friend':}}
PlanHotelSearch=new Object();PlanHotelSearch.getSortString=function(){$_this=$('#hotel #searchFilters .sorting .options a.active');return_str='sortBy=';if($_this.html()!=null){sortBy=$_this.html().toLowerCase()=='price'?'PRICE':'QUALITY';dir='';if(sortBy=='PRICE'&&$_this.hasClass('asc')){dir='_REVERSE';}else if(sortBy=='QUALITY'&&$_this.hasClass('asc')){dir='_REVERSE';}
return_str='sortval='+sortBy+dir;}
return return_str;}
$('#hotel #searchFilters .sorting .options a').live('click',function(){PlanhotelPageNum=1;$(this).siblings().removeClass('active');if($(this).attr('id')=='plan_hotel_price_filter'){$(this).siblings().removeClass('asc').addClass('desc');}else{$(this).siblings().removeClass('desc').addClass('asc');}
$(this).addClass('active');if($(this).hasClass('asc')){$(this).removeClass('asc').addClass('desc');}else{$(this).removeClass('desc').addClass('asc');}
whetherSorted=true;$("#ClearPlanHotelFiltersA").addClass('filter_enabled');$("#ClearPlanHotelFiltersA").removeClass('filter_disabled');filterPlanHotelSearchResult('updateSearch','');});PlanHotelSearch.getFilterString=function(){keyword=$('#searchFilters #Hotelkeyword').val();minVal='';maxVal='';if($("#searchFilters .starFilters .hb_star").hasClass('active')){minVal=$("#searchFilters .starFilters .hb_star.active:first").attr('id').replace('starrate','');maxVal=$("#searchFilters .starFilters .hb_star.active:last").attr('id').replace('starrate','');}
return'hotelkeyword='+keyword+'&minVal='+minVal+'&maxVal='+maxVal;}
planStarCount=function(){return $("#hotel #searchFilters .starFilters .hb_star.active");}
$("#hotel #searchFilters .starFilters .hb_star").live('click',function(){PlanhotelPageNum=1;$_this=$(this);PlanStarCnt=planStarCount().length;if(PlanStarCnt==5){$("#hotel #searchFilters .starFilters .hb_star").removeClass('active');$_this.addClass('active');}else{if($_this.hasClass('active')){$_this.removeClass('active')}else{$_this.addClass('active');}
if(planStarCount().length==0){$("#hotel #searchFilters .starFilters .hb_star").addClass('active');}
minVal=$("#hotel #searchFilters .starFilters .hb_star.active:first").attr('id').replace('starrate','');maxVal=$("#hotel #searchFilters .starFilters .hb_star.active:last").attr('id').replace('starrate','');for(i=minVal;i<=maxVal;i++){$('#hotel #searchFilters .starFilters #starrate'+i).addClass('active');}}
whetherFiltered=true;filterPlanHotelSearchResult('updateSearch','');$("#ClearPlanHotelFiltersA").addClass('filter_enabled');$("#ClearPlanHotelFiltersA").removeClass('filter_disabled');})
function getGAtitleString(mode,panel){var $_this='',$_str='';switch(mode){case"sort":if(panel=='Book'){$_this=hotelSearch.getSortString();$_this=$_this.substr(7);}
else{$_this=PlanHotelSearch.getSortString();$_this=$_this.substr(8);}
switch($_this){case"QUALITY":$_str="Sort By Star";break;case"QUALITY_REVERSE":$_str="Sort By Star - Desc";break;case"PRICE":$_str="Sort By Price";break;case"PRICE_REVERSE":$_str="Sort By Price - Desc";break;default:$_str="default";}
break;case"filter":var star1,star2;if(panel=='Book'){star1=$("#bSearchFilters .starFilters .hb_star.active:first").attr('id').replace('starrate','');star2=$("#bSearchFilters .starFilters .hb_star.active:last").attr('id').replace('starrate','');}
else{star1=$("#searchFilters .starFilters .hb_star.active:first").attr('id').replace('starrate','');star2=$("#searchFilters .starFilters .hb_star.active:last").attr('id').replace('starrate','');}
if(star1!=star2){$_str=star1+":"+star2;}
else{$_str=star1+" Star";}
break;}
return $_str;}
function pushRecoGAEventTrackingTags(tagvaluesArr){var InterestTitle=new Array();InterestTitle[1]="HTML5 - Welcome- No - Adventure";InterestTitle[2]="HTML5 - Welcome- No - Architecture";InterestTitle[3]="HTML5 - Welcome- No - Arts";InterestTitle[4]="HTML5 - Welcome- No - Beach";InterestTitle[6]="HTML5 - Welcome- No - Culinary (Correct)";InterestTitle[7]="HTML5 - Welcome- No - Culture (Correct)";InterestTitle[8]="HTML5 - Welcome- No - Eco Friendly (Correct)";InterestTitle[9]="HTML5 - Welcome- No - Entertainment (Correct)";InterestTitle[10]="HTML5 - Welcome- No - Family (Correct)";InterestTitle[11]="HTML5 - Welcome- No - Golf (Correct)";InterestTitle[12]="HTML5 - Welcome- No - History (Correct)";InterestTitle[13]="HTML5 - Welcome- No - Honeymoon (Correct)";InterestTitle[14]="HTML5 - Welcome- No - Luxury (Correct)";InterestTitle[15]="HTML5 - Welcome- No - Nightlife (Correct)";InterestTitle[16]="HTML5 - Welcome- No - Relaxation (Correct)";InterestTitle[17]="HTML5 - Welcome- No - Romantic (Correct)";InterestTitle[18]="HTML5 - Welcome- No - Shopping (Correct)";InterestTitle[19]="HTML5 - Welcome- No - Ski (Correct)";InterestTitle[20]="HTML5 - Welcome- No - Summer (Correct)";InterestTitle[21]="HTML5 - Welcome- No - Weekend (Correct)";for(var i=1;i<=21;i++){var tagArrValues=tagvaluesArr.split(',');var index=contains(tagArrValues,i);if(index!=-1){var gaCategoryTitle='HTML5 - Welcome- No - '+InterestTitle[i];_gaq.push(["_trackEvent",gaCategoryTitle,"Clicked"]);}}}
function pushGAEventTags(panel,subtab){var gaCategoryTitle='';if(whetherSorted){if(getGAtitleString('sort',panel)!='default'){gaCategoryTitle='HTML5 - '+panel+' - Hotels - '+getGAtitleString('sort',panel);_gaq.push(["_trackEvent",gaCategoryTitle,"Clicked"]);whetherSorted=false;}}
if(whetherFiltered){gaCategoryTitle='HTML5 - '+panel+' - Hotels - Filter by Stars -  '+getGAtitleString('filter',panel);_gaq.push(["_trackEvent",gaCategoryTitle,"Clicked"]);whetherFiltered=false;}
if(whetherAmenitiesSel){getAmenitiesValue(selectedAmenitiesArray,panel,'push');whetherAmenitiesSel=false;}
switch(subtab){case'Activity':if(panel=='Plan'){if($("#activity_price_sort_plan").hasClass('active asc')){gaCategoryTitle="HTML5 - Plan - Activities - Sort By Price - Desc";}
else if($("#activity_price_sort_plan").hasClass('active desc')){gaCategoryTitle="HTML5 - Plan - Activities - Sort By Price";}
if($("#activity_star_sort_plan").hasClass('active asc')){gaCategoryTitle="HTML5 - Plan - Activities - Sort By Rating - Desc";}
else if($("#activity_star_sort_plan").hasClass('active desc')){gaCategoryTitle="HTML5 - Plan - Activities - Sort By Rating";}}
else if(panel=='Book'){if($("#activity_price_sort").hasClass('active asc')){gaCategoryTitle="HTML5 - Book - Activity - Sort By Price - Desc";}
else if($("#activity_price_sort").hasClass('active desc')){gaCategoryTitle="HTML5 - Book - Activity - Sort By Price";}
if($("#activity_star_sort").hasClass('active asc')){gaCategoryTitle="HTML5 - Book - Activity - Sort By Rating - Desc";}
else if($("#activity_star_sort").hasClass('active desc')){gaCategoryTitle="HTML5 - Book - Activity - Sort By Rating";}}
_gaq.push(["_trackEvent",gaCategoryTitle,"Clicked"]);break;case'Hostel':if(panel=='Plan'){if($("#plan-hostel_star_sort").hasClass('active asc')){gaCategoryTitle="HTML5 - Plan - Hostels - Sort By Rating - Desc";}
else if($("#plan-hostel_star_sort").hasClass('active desc')){gaCategoryTitle="HTML5 - Plan - Hostels - Sort By Rating";}}
else if(panel=='Book'){if($("#hostel_price_sort").hasClass('active asc')){gaCategoryTitle="HTML5 - Book - Hostel - Sort By Price - Desc";}
else if($("#hostel_price_sort").hasClass('active desc')){gaCategoryTitle="HTML5 - Book - Hostel - Sort By Price";}
if($("#hostel_star_sort").hasClass('active asc')){gaCategoryTitle="HTML5 - Book - Hostel - Sort By Rating - Desc";}
else if($("#hostel_star_sort").hasClass('active desc')){gaCategoryTitle="HTML5 - Book - Hostel - Sort By Rating";}}
_gaq.push(["_trackEvent",gaCategoryTitle,"Clicked"]);break;}}
function filterPlanHotelSearchResult(hotelfiltertype,fvalue){activeExploreTab='Hotels';tripitembycategory(11);$("#hotelbuttonInfo").hide();$("#hotelInfo").show();$("#hotelDetails").hide();$("#hotel .list").hide();$("#hotel .btnBTR").hide();if(hotelFlag==false){hotelFlag=true;}
showBing();document.getElementById('hotelInfo').innerHTML='<div align="center" style="padding:20px 0 150px 0;">Loading..<br><img src="/images/panel-loader.gif"></div>';city=document.getElementById('hdnCity').value;cityId=document.getElementById('hdnCityId').value;if(document.getElementById('HotelPlanLocation')!=undefined&&document.getElementById('HotelPlanLocation').value!='Location'){Hotel_PlanLocation=document.getElementById('HotelPlanLocation').value;}else{Hotel_PlanLocation=city;}
if(document.getElementById('Hotelkeyword')!=undefined&&document.getElementById('Hotelkeyword').value!='Keyword'){Hotel_keyword=document.getElementById('Hotelkeyword').value;}else{Hotel_keyword='';}
if(document.getElementById('txtpHotelPriceFilterPlan')!=undefined&&document.getElementById('txtpHotelPriceFilterPlan').value!=''){price_range=document.getElementById('txtpHotelPriceFilterPlan').value;}else{price_range=100000;}
var amenitiesValues='';if(typeof hotelfiltertype!='undefined'){var amenities=new Array();i=0;$('#lstPlanHotelAmenities input:checked').each(function(){if(i==0){var number=$(this).val();$("#HotelPlanAmenities").text(hotelAmenityArray[Math.pow(2,number)]);}
amenities[i]=$(this).val();i++;})
amenitiesValues=amenities.join(',');selectedAmenitiesArray=amenitiesValues;whetherAmenitiesSel=true;if(Hotel_keyword||whetherAmenitiesSel){$("#ClearPlanHotelFiltersA").addClass('filter_enabled');$("#ClearPlanHotelFiltersA").removeClass('filter_disabled');}}
url='/ean/hotelslocalsfilter/city/'+city+'/cityId/'+cityId+'?searchType='+hotelfiltertype+'&HotelPanelLocation='+Hotel_PlanLocation+'&'+PlanHotelSearch.getFilterString()+'&'+PlanHotelSearch.getSortString()+'&amenities='+amenitiesValues+'&randnum='+Math.floor((Math.random()*100)+1);if(parseInt(PlanhotelPageNum)>1){var Offset=PlanhotelPageNum*51-51;url+='&offset='+Offset;}else{url+='&offset=0';}
var cacheKey="ht_"+cityId+"_0";if(typeof(hotelfiltertype)=='undefined'){if(cache[cacheKey+'_filter']==1){cache[cacheKey]='';}
resetHotelPlanFilterBlock();}
if(typeof hotelfiltertype=='undefined'){cache[cacheKey+'_filter']=0;}else{cache[cacheKey+'_filter']=1;}
if(cache[cacheKey]&&typeof hotelfiltertype=='undefined'){$("#filter_plan_hotel_amenities").hide();hotelCacheData=cache[cacheKey];renderHotels(hotelCacheData);ResetBrowserScrollAfterDataLoaded();}else{$.getJSON(url,function(fsdata){if(typeof fsdata.hotelList!='undefined'&&fsdata.hotelList.length!=0){hotelCacheData=fsdata;cache[cacheKey]=fsdata;if(typeof fsdata.hotelCount!='undefined'&&fsdata.hotelCount!=0){PlanHotelCityCount=fsdata.hotelCount;PlanHotelCityCount=PlanHotelCityCount-51;PlanhotelPageNum=1;}
if(amenitiesValues!=''){renderHotels(fsdata,amenitiesValues);}else{$("#filter_plan_hotel_amenities").hide();renderHotels(fsdata);ResetBrowserScrollAfterDataLoaded();}}else{abortAjax();visibleMap='bing';showVectorMap();$("#filter_plan_hotel_amenities").html('<label style="width: 180px;" id="HotelBookAmenities" class="book_filter_hotel_amenity">Filter by Amenities</label><ul id="lstBookHotelAmenities" class="dropdown" style="min-height: auto; width: auto; padding: 5px; margin-top: 6px; min-width: 160px; border-width: 0px medium medium; border-style: none solid solid; border-color: -moz-use-text-color rgb(218, 218, 218) rgb(218, 218, 218); -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-image: none; display: none;"><li style="border-bottom:1px solid #DADADA; padding:2px 2px;"><label title="No Amenities available">No Amenities available</label></li></ul>');if(typeof hotelfiltertype=='undefined'){$("#filter_plan_hotel_amenities").hide();$("#searchFilters").hide();$("#hotelInfo").html('<article class="info padding align-center font_18">Sorry, we do not currently have any Hotels available for this city.</article>');$("#mapOverlay").hide();}else{$("#hotelInfo").html('<article class="info padding align-center font_18">Sorry, your filter did not match any results. Please update your criteria and try again.</article>');$("#mapOverlay").hide();}}});if(isLiveServer==true){if(hotelfiltertype=='updateSearch'){pushGAEventTags('Plan');}}}}
function ResetBrowserScrollAfterDataLoaded(){window.scrollTo(0,175);}
function ClearPlanHotelFilters(){if($("#hotelClearFiltersA").hasClass('filter_disabled')){return false;}
else{resetHotelPlanFilterBlock();if(isLiveServer==true){var gaTitleString="HTML5 - Plan - Hotels - Clear SortingFilter";_gaq.push(['_trackEvent',gaTitleString,'Clicked']);}
city=document.getElementById('hdnCity').value;var cityId=document.getElementById('hdnCityId').value;var cacheKey="ht_"+cityId+"_0";cache[cacheKey]='';filterPlanHotelSearchResult();}}
function resetHotelPlanFilterBlock(){$('#Hotelkeyword').val('Keyword');for(i=0;i<=4;i++){PlanStarRatingArray[i]=0;}
$('.starFilters span').addClass('active');$('#hotel #searchFilters .sorting .options a').removeClass('active');$("#ClearPlanHotelFiltersA").removeClass('filter_enabled');$("#ClearPlanHotelFiltersA").addClass('filter_disabled');}
var hotelCacheData;var hotellist="";function renderHotels(data,amenitiesValues){var sText='';var addToTripText=explorePanelMode=='friend'?'Recommend':'Add to Trip';var removeFromTripText=explorePanelMode=='friend'?'Recommended':'Remove';var addToTripFlag=explorePanelMode=='friend'?'friend':'grid';var sourceIds=$("#tripItemSourceIds").val();var userSourceIds=$("#userItemSourceIds").val();var sourceIdArray=sourceIds.split(',');var userSourceIdArray=userSourceIds.split(',');clearAmenitiesArray('Plan');var j=0;var cCtr=1;var gCtr=1;hotellist='';var openEntityRequestId=false;hotellist="";$('#hotelInfo').html(preloadDiv);if(typeof data.amenities!='undefined'){getPlanAmenities(data.amenities);}
$.each(data.hotelList,function(i,hotel){if(cCtr>HotelChkHCol){cCtr=1;gCtr++;}
if(selectedEntityId){if(hotel.HotelID==selectedEntityId){openEntityRequestId=i;selectedEntityId=false;}}
if(toString(hotel.Name).length>22){hotelName=hotel.Name.substring(0,22)+'...';}else{hotelName=hotel.Name;}
hotel.hotelRating=hotel.PropertyRating;hotellist+='<section class="hotelList" id="lstHotel'+hotel.HotelID+'" onClick="openHotelDetail('+hotel.HotelID+', '+i+',1)">';hotellist+='<img class="lazyloading fl marginR10" src="'+hotel.default_img+'" width="70" height="70" onError="this.src=\''+'/images/hotel_grid_default.gif'+'\'" />';hotellist+='<p><a href="javascript:void(0);"><strong>'+hotelName+'</strong></a><br>'
if(hotel.hotelRating!=null&&hotel.hotelRating!=0)
hotellist+='<span>'+hotel.hotelRating+' Star</span><br>';hotellist+='</p></section>';var detailText='';detailText+='<article class="content">';detailText+='<a href="javascript://;" onClick="openHotelDetail('+hotel.HotelID+', '+i+')" class="grid_thumb_link"  ><img class="thumb lazyloading" src="'+hotel.default_img+'" style="float:left; border:none; margin-right:10px; height: 100%; width: 100%;" onError="this.src=\''+'/images/hotel_grid_default.gif'+'\'" /></a>';detailText+='<p><strong><span class="attrName"><a href="javascript://;" onClick="openHotelDetail('+hotel.HotelID+', '+i+')">'+hotelName+'<br /></a></span></strong>';detailText+='<span class="grey_borderbottom">';if(hotel.PropertyRating!=null&&hotel.PropertyRating!=''&&hotel.PropertyRating!=0)
detailText+='<span class="fl hotel_star"><span class="font_18 inline-block paddingL10">'+hotel.PropertyRating+'</span> Stars</span>';var formattedAddress=getFormattedAddress(hotel.Address1,hotel.City,hotel.StateProvince,'');detailText+='</span><span class="grey_borderbottom">'+formattedAddress+'</span>';if(hotel.LowRate!=null&&hotel.LowRate>0){detailText+='<span class="grey_borderbottom bg_gray strong">Starting from: '+hotel.LowRate+'  USD</span>';}
detailText+='</p> <br clear="all" />';detailText+='</article>';detailText+='<article class="actionbuttons">';if(!(pastTrip&&explorePanelMode=='friend')){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,hotel.HotelID);if(itemExist!=-1&&itemsStatusArray[itemExist]=='yes_11'&&explorePanelMode=='friend'){gridId=replaceString(hotel.HotelID);detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Already added to trip</span>';}else if(sourceIdArray!=''||userSourceIdArray!=''){var isExists=inArrayJS(parseInt(hotel.HotelID)+'_11',sourceIdArray);if(isExists==true){if(explorePanelMode=='friend'){var foruserExist=inArrayJS(parseInt(hotel.HotelID)+'_11',userSourceIdArray);gridId=replaceString(hotel.HotelID);if(foruserExist==true){detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended by friends and You</span>';}else{detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended by friends</span>';detailText+='<span id="gridBtn_frnd_'+gridId+'" class="fl"><a class="btnIconAdd blue_link" onClick="assignTripItemData(\'hotel\', '+i+'); addItemToTrip(\'11\', \'6\', \''+hotel.HotelID+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" href="javascript:void(0);">I Recommend</a></span>';}}else{gridId=replaceString(hotel.HotelID);detailText+='<span id="gridBtn_'+gridId+'" class="fl"><a href="javascript://" onClick="removeFromTrip(\'11\', \'6\', \''+hotel.HotelID+'\', \''+addToTripFlag+'\',\''+i+'\')" class="btnIconRemove font_13">'+removeFromTripText+'</a></span>';}}else{if(explorePanelMode=='friend'){var foruserExist=inArrayJS(parseInt(hotel.HotelID)+'_11',userSourceIdArray);gridId=replaceString(hotel.HotelID);if(foruserExist==true){detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended</span></p>';}
else{detailText+='<span id="gridBtn_'+gridId+'" class="fl"><a href="javascript://" onClick="assignTripItemData(\'hotel\', '+i+'); addItemToTrip(\'11\', \'6\', \''+hotel.HotelID+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link">'+addToTripText+'</a></span>';}}
else{gridId=replaceString(hotel.HotelID);detailText+='<span id="gridBtn_'+gridId+'" class="fl"><a href="javascript://" onClick="assignTripItemData(\'hotel\', '+i+'); addItemToTrip(\'11\', \'6\', \''+hotel.HotelID+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link">'+addToTripText+'</a></span>';}}
detailText+='&nbsp;&nbsp;&nbsp;&nbsp;<button class="book_now fr" onclick="openHotelDetail('+hotel.HotelID+', '+i+')">View More</button>';}else{gridId=replaceString(hotel.HotelID);detailText+='<span id="gridBtn_'+gridId+'" class="fl"><a href="javascript://" onClick="assignTripItemData(\'hotel\', '+i+'); addItemToTrip(\'11\', \'6\', \''+hotel.HotelID+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link">'+addToTripText+'</a></span>';detailText+='&nbsp;&nbsp;&nbsp;&nbsp;<button class="book_now fr" onclick="openHotelDetail('+hotel.HotelID+', '+i+')">View More</button>';}}
detailText+='<div class="clearfloat" /></article>';sText+='<section class="pHotelG'+gCtr+'">'+detailText+'</section>';cCtr++;});document.getElementById('hotelInfo').innerHTML='<div class="top25">'+sText+'</div><div class="clearfloat font_13 bg_gray marginB20"><a id="planPanelGridPrev" style="display:none" href="javascript:getPreviousHotelGridList(\'plan\');" class="fl btn_black">&laquo; Previous</a><a id="planPanelGridNext" href="javascript:getNextHotelGridList(\'plan\');" class="fr btn_black">Next &raquo;</a><br class="clearfloat" /></div>';if(typeof amenitiesValues!='undefined'){amenitiesblock=getAmenitiesValue(amenitiesValues,'Plan');$("#filter_plan_hotel_amenities").html(amenitiesblock);$("#HotelPlanAmenities").text(amenityPlanLabelGlobal);}else{amenitiesblock=getAmenitiesValue('','Plan');$("#filter_plan_hotel_amenities").html(amenitiesblock);}
if(parseInt(PlanhotelPageNum)>1){$("#planPanelGridPrev").show();$("#planPanelGridNext").show();}else{$("#planPanelGridPrev").hide();}
if(parseInt(PlanHotelCityCount)<=0){$("#planPanelGridNext").hide();}
$("#filter_plan_hotel_amenities").show();for(i=1;i<=gCtr;i++){$('.pHotelG'+i).equalizeHeights();if($('.pHotelG'+i).height()==0)
{hotelCityId='';}}
$("#searchFilters").fadeIn();hotelPlaces=data;if(surfMode=='Plan'){if($('#chotel').hasClass('current')){plotHotelDataOnBingMap(data);}}
$("img.lazyloading").lazyload({placeholder:"/images/media-load.gif",effect:"fadeIn",threshold:400,imgonerror:"/images/hotel_grid_default.gif"});if(openEntityRequestId!==false){openHotelDetail(hashVenueId,openEntityRequestId);}}
function getTripAdvisorStars(r){var tripAdvirsorRatings=Math.floor(r);remainder=0;var remainder=r%2;stars="";halfStar=false;for(i=0;i<5;i++){if(i<=tripAdvirsorRatings)
stars+='<span class="ratingfull"></span>';else if(remainder!=0&&halfStar==false){stars+='<span class="ratinghalf"></span>';halfStar=true;}else{stars+='<span class="ratingempty"></span>';}}
return stars;}
var activeTripLeavingDate2='',activeTripLeavingDate1='';var hotelArrayIndex='';function openHotelDetail(id,arrayIndex,calledFrom){hotelArrayIndex=arrayIndex;btnFlag=true;$('#cityInfoScreen').show();$("#hotelBtnBTR").show();$("#hotelInfo").hide();$("#hotelDetails").show();$("#hotelDetails").html(preloadDiv);$("#hotel .list").show();$("#searchFilters").hide();$("#hotelbuttonInfo").show();$("#reviewFooterHotel").show();$("#bing_attraction_info").hide('fade',500);planHotelRoomCount=1;planhotelChildCount=[0,0,0,0,0,0,0,0,0];var sText='';var url='/ean/details/h/'+id;opnion_html_text='';if(typeof calledFrom=='undefined'){hotelList='<a class="scrollup" href="javascript://">&nbsp;</a>';hotelList+='<div class="pnlScrollCont">';hotelList+='<ul class="leftList vscroll-item">'+hotellist+'</li>';hotelList+='</div>';hotelList+='<a class="scrolldown" href="javascript://">&nbsp;</a>';$("#hotelInfoList").html(hotelList);}
if($("#hotelInfoList .vscroll-item").hasClass('scrolling')){}else{$("#hotelInfoList .vscroll-item").addClass('scrolling');scrollDiv('hotelInfoList');}
$("#hotelInfoList .vscroll-item section").removeClass('selected');$("#lstHotel"+id).addClass('selected');if(typeof calledFrom=='undefined'){if($('#hotelInfoList .pnlScrollCont').height()<$("#lstHotel"+id).position().top){if($("#hotelInfoList .vscroll-item").height()-$("#lstHotel"+id).position().top<$('#hotelInfoList .pnlScrollCont').height()){$("#hotelInfoList .vscroll-item").css('top',$('#hotelInfoList .pnlScrollCont').height()-$('#hotelInfoList .vscroll-item').height());$('#hotelInfoList .scrollup').css('visibility','visible');$('#hotelInfoList .scrolldown').css('visibility','hidden');}else{$("#hotelInfoList .vscroll-item").css('top',-1*Number($("#lstHotel"+id).position().top));$('#hotelInfoList .scrollup').css('visibility','visible');}}}
var detailText='';$.getJSON(url,function(hotel){if(hotel.HotelInformationResponse.EanWsError){detailText='<article class="info padding align-center font_18">Sorry, we currently do not have any details available for this hotel. Please try another hotel.</article>';$('#hotelDetails').html(detailText);}
else{hashHotelName=arrayIndex+'/'+id+'/'+hotel.HotelInformationResponse.HotelSummary.name;hashHotelName=hashHotelName.replace(/,/g,"");hashHotelName=hashHotelName.replace(/ - /g," ");createHashURLTitle('11',hashHotelName);hashPushState(hashLocationString,hashPageTitle);detailText+='<div style="width:875px;">';detailText+='<div><h2 class="mainHotelName">'+hotel.HotelInformationResponse.HotelSummary.name+'</h2></div>';if(typeof hotel.HotelInformationResponse.HotelDetails.vTourFlag!='undefined'&&hotel.HotelInformationResponse.HotelDetails.vTourFlag==1){var virtualTourUrl="http://travel.ian.com/hotel/tours/"+id+"?cid=40";}
detailText+='<div><article class="fl"><span class="add_to_trip_button" id="detail_top_btn_'+id+'"></span></article>';detailText+='<article class="fr">';if(typeof virtualTourUrl!='undefined'){detailText+='<a class="virtualTour" href="javascript://" onclick="overlayForVtour(\''+virtualTourUrl+'\');">View Virtual Tour  <img src="/images/icon_open_in_lightBox.png" alt="" /></a>';}
if(hotel.HotelInformationResponse.HotelSummary.hotelRating!=0){detailText+='<span class="marginL20 fr font_12 shadow_inside_left" style="margin-top:-3%"><div class="hotel_star"><span class="font_18">'+hotel.HotelInformationResponse.HotelSummary.hotelRating+'</span> Stars</div></span>';}else{detailText+='<span class="marginL20 fr font_12 shadow_inside_left" style="margin-top:-3%"><div style="height: 45px;line-height: 50px; padding-left: 20px;"></div></span>';}
detailText+='</article></div>';detailText+='<div style="clear:right; height:7px;">&nbsp;</div>';if(explorePanelMode=='friend'){getRecommandButtonCode(11,id);}else{getAddToTripButtonCode(11,id);}
detailText+='<div class="hotelImg">';detailText+='<div class="" id="planhotelHeroImg" style="width:415px; height:265px;"><img id="planHotelDetailImage_'+id+'" src="/images/clear.gif" width="415" height="260" class="lazyloading" onError="this.src=\''+'/images/hotel_grid_default.gif'+'\'"></div>';detailText+='<div id="planHotelThumbs" class="hotelImgThumb detailslist  position-rel"><a class="scrollleft" href="javascript://">&nbsp;</a>';detailText+='<div class=""><ul class="content" style="width: auto; overflow-y: hidden; overflow-x: auto;">';if(typeof hotel.HotelInformationResponse.HotelImages.HotelImage!='undefined'){var arrhImages=hotel.HotelInformationResponse.HotelImages.HotelImage;for(i=0;i<arrhImages.length;i++){detailText+='<li id="hotelphotos'+i+'"><a href="javascript://" onclick="changeFilmstripImg(\'planhotelHeroImg\',\''+hotel.HotelInformationResponse.HotelImages.HotelImage[i].url+'\');"><img src="'+hotel.HotelInformationResponse.HotelImages.HotelImage[i].thumbnailUrl+'" width="80" height="80" onError="$(\'#hotelphotos'+i+'\').remove();"/></a></li>';}}
detailText+='</ul><div class="clearfloat">&nbsp;</div></div>';detailText+='<a class="scrollright" href="javascript://">&nbsp;</a></div>';detailText+='</div>';detailText+='<div class="hotelMap">';detailText+='<div id="hotelMap"></div>';detailText+='<p class="hotelAddress">';if(typeof hotel.HotelInformationResponse.HotelDetails.checkInTime!="undefined"){detailText+='<span class="checkins">Checkin<br /><strong>'+hotel.HotelInformationResponse.HotelDetails.checkInTime+'</strong>';}
else{detailText+='<span class="checkins"><br /><strong></strong>';}
if(typeof hotel.HotelInformationResponse.HotelDetails.checkOutTime!="undefined"){detailText+='<br />Checkout <br /><strong>'+hotel.HotelInformationResponse.HotelDetails.checkOutTime+'</strong></span>';}
else{detailText+='<br /> <br /><strong></strong></span>';}
if(typeof(hotel.HotelInformationResponse.HotelSummary.stateProvinceCode)!="undefined"){detailText+=hotel.HotelInformationResponse.HotelSummary.locationDescription+'<br />'+hotel.HotelInformationResponse.HotelSummary.address1+'<br />'+hotel.HotelInformationResponse.HotelSummary.city+', '+hotel.HotelInformationResponse.HotelSummary.stateProvinceCode+' - '+hotel.HotelInformationResponse.HotelSummary.postalCode;}else{detailText+=hotel.HotelInformationResponse.HotelSummary.locationDescription+'<br />'+hotel.HotelInformationResponse.HotelSummary.address1+'<br />'+hotel.HotelInformationResponse.HotelSummary.city+' - '+hotel.HotelInformationResponse.HotelSummary.postalCode;}
detailText+='</p></div></div>';detailText+='<small style="display:table-row;float:left;margin-bottom:10px;width:84%"><strong>Note: </strong>It is the responsibility of the hotel chain and/or the individual property to ensure the accuracy of the photos displayed. "Georama Inc." is not responsible for any inaccuracies in the photos.</small>';detailText+='<form id="hotelplandetail_view"><section class="show_my_trip shadow_top_inside fl" style="display:table-row;margin-bottom:10px;"><h3 class="mtop_5">Room Booking</h3><article class="hotel_detail font_13 light_grey_text form_wrapper">';detailText+=' <div class="fl" >Check-in:<br /><input tabindex="2" readonly="readonly" id="DetailsHotelCheckInnDate" name="planHotelCheckInnDate" type="text" class="input_h31 b_radius_3 calendar mright5 hasdatepicker"  /></div>';detailText+=' <div class="fl">Check-out:<br /><input tabindex="2" readonly="readonly" id="DetailsHotelCheckOutDate" name="planHotelCheckOutDate" type="text" class="input_h31 b_radius_3 calendar mright5 hasdatepicker"  /></div>';detailText+=' <div class="fl">Rooms<br /><div class="stylize-select hotel-rac marginR5"><select tabindex="2" id="numberOfBedRooms" name="plannumberOfBedRooms" class="hotelDetailSelect"  onchange="addHotelRooms(this.options[this.selectedIndex].value, \'plan\');"><option>1</option><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option><option>8</option></select></div></div>';detailText+=' <div class="clearfloat"></div>';detailText+='</article>';detailText+='</section><div class="clearfloat"></div>';detailText+='<section id="planselect_hotel_rooms" class="hotel_detail font_13 light_grey_text form_wrapper">';detailText+='<div id="planhotelRoomsLabels" class="marginB5" style="overflow:hidden; margin-left:70px;">';detailText+='<div class="fl marginR10"><label class="reset"> Adults: </label><small class="semi-light">(age 18+)</small></div> ';detailText+='<div class="fl marginR10""><label class="reset"> Children: </label><small class="semi-light">(age 0-17)</small></div>';detailText+='<div class="childLabel1 fl marginR10 marginL5 hide"><label class="reset"> Child 1 </label><small class="semi-light">(age)</small></div>';detailText+='<div class="childLabel2 fl marginR10 marginL10 hide"><label class="reset"> Child 2 </label><small class="semi-light">(age)</small></div>';detailText+='<div class="childLabel3 fl marginR10 marginL10 hide"><label class="reset"> Child 3 </label><small class="semi-light">(age)</small></div>';detailText+='</div>';detailText+='<div id="plantable_room_1">';detailText+='<label class="fl marginR10">Room #1: </label>';detailText+='<div class="fl marginR10">';detailText+='<div class="stylize-select hotel-rac">';detailText+='<select tabindex="3" name="planroom-1-adult-total" onchange="" id="planHotel_room1Adult">';detailText+='<option value="1">1</option>';detailText+='<option value="2" selected="selected">2</option>';detailText+='<option value="3">3</option>';detailText+='<option value="4">4</option>';detailText+='</select>';detailText+='</div>   ';detailText+='</div>';detailText+='<div class="fl marginR10">';detailText+='<div class="stylize-select hotel-rac">';detailText+='<select tabindex="3" id="planHotel_room1Child" name="planroom-1-child-total" onchange="addHotelChilds(1, this.options[this.selectedIndex].value, \'plan\')">';detailText+='<option value="0" selected="">0</option>';detailText+='<option value="1">1</option>';detailText+='<option value="2">2</option>';detailText+='<option value="3">3</option>';detailText+='</select>';detailText+='</div>    ';detailText+='</div>';detailText+='</div>';detailText+='<div class="clearfloat"></div>';detailText+='</section>'
detailText+='<div><input tabindex="4" type="button" onclick="checkHotelAvailability('+id+',\'plan\'); $(\'#HotelRoomBooking\').html(cntPreload);" value="Check Availability" class="book_now chk_avail mtop_5"></div>';detailText+='</form>';detailText+='<section id="planHotelRoomBooking" class="fl" style="display:none; width:100%;max-width:815px;">';detailText+='<article class="grey_border_all padding_all_0">';detailText+=' <a href="javascript://" onclick="$(\'#gridRoomBooking\').fadeOut();" class="smallClose">x</a>';detailText+=' <div class="scrollbar_wrapper font_16">';detailText+='  <div class="scrollbar">';detailText+='   <div class="thumb"></div>';detailText+='  </div>';detailText+='  <div class="viewport bg_gray" style="height:296px;">';detailText+='   <div class="overview" style="width:auto; margin:10px;">';detailText+='    <section class="padding_all_5 grey_box">'
detailText+='     <div class="fl width_40">Room Booking</div>';detailText+='     <div class="fl width_30">$160</div>';detailText+='     <div class="fl width_30">';detailText+='      <input type="button" value="Book Now" class="book_now">';detailText+='     </div>';detailText+='     <div class="clearfloat"></div>';detailText+='    </section>';detailText+='   </div>';detailText+='  </div>';detailText+=' </div>';detailText+='</article>';detailText+='</section>';detailText+='<div style="display:table-row;">&nbsp;</div>';detailText+='<div class="shadow_top_inside fl marginT10" style="display:table-row;"></div>';hotelDescription=hotel.HotelInformationResponse.HotelDetails.propertyDescription;var strposition=hotelDescription.lastIndexOf("<strong>Notifications and Fees:");if(strposition!='-1'){hotelDescription=hotelDescription.substring(0,strposition);}
hotelDescription.replace("&lt;p&gt;","<p>");hotelDescription.replace("&lt;/p&gt;",">");if(hotelDescription!=''){detailText+='<div class="HotelDescripition clear" style="width:930px; float:none"><h3>About</h3>'+hotelDescription+'</div>';}
detailText+='<div class="marginT30">';if(typeof hotel.HotelInformationResponse.PropertyAmenities!='undefined'){var arrAmentities=hotel.HotelInformationResponse.PropertyAmenities.PropertyAmenity;detailText+='<div class="hotelAmenities marginR15"><h3 style="font-size:1.8em">Amenities</h3>';detailText+='<div><ul>';if(arrAmentities.length>20){var topAmenities=20;}else{var topAmenities=arrAmentities.length;}
for(i=0;i<topAmenities;i++){if(typeof arrAmentities[i]!='undefined'){var ammenityText=trim(arrAmentities[i].amenity);var ammenitylength=ammenityText.length;if(ammenitylength<=30){ammenityText=ammenityText;}else{ammenityText=ammenityText.substring(0,30)+"...";}
detailText+='<li title="'+trim(arrAmentities[i].amenity)+'">'+ammenityText+'</li>';}}
detailText+='</ul></div>';detailText+='<div id="more_amenities_hotel" class="hide"><ul>';if(arrAmentities.length>20){for(j=20;j<arrAmentities.length;j++){if(typeof arrAmentities[j].amenity!='undefined'){var ammenityText=trim(arrAmentities[j].amenity);var ammenitylength=ammenityText.length;if(ammenitylength<=30){ammenityText=ammenityText;}else{ammenityText=ammenityText.substring(0,30)+"...";}
detailText+='<li title="'+trim(arrAmentities[j].amenity)+'">'+ammenityText+'</li>';}}}
detailText+='</ul></div>';if(arrAmentities.length>20)
detailText+='<br class="clearfloat"/><center><div class="marginT10"><a class="blue_link font_13 strong curHandPointer" onclick="$(\'#more_amenities_hotel\').show();$(this).hide();">See more amenities...</a></div></center>';detailText+='</ul></div>';}else{detailText+='<div class="hotelAmenities marginR15"><h3 style="font-size:1.8em">Amenities</h3>';detailText+='<div><br/>';detailText+='<span class="font_13">No Amenities available</span>';detailText+='</div></div>';}
detailText+='<div class="ADescripition review-deatil width_50">';detailText+='<h3 style="font-size:1.8em"><a onclick="getReviewsFromUser('+id+',\''+id+'\',\'11\',\'plan\'); " id="myTripUserReviews_11">Reviews</a></h3><br/>';detailText+='<section class="comments_wrapper">';detailText+='<div id="plan_'+id+'_reviews_11" class="font_13"></div>';detailText+='<div class="user_review_panel margint20"><br /><br /><h4>Friends Reviews</h4>';detailText+='<article class="grey_box mtop_10 b_radius_5 hotel_smileys"> <a href="#"><span class="smiley smiley_like_med">&nbsp;</span> 50 <span class="font_12">like it</span></a> <a href="#"><span class="smiley smiley_ok_med">&nbsp;</span> 10 <span class="font_12">say It\'s ok</span></a> <a href="#"><span class="smiley smiley_d_lile_med">&nbsp;</span> 15 <span class="font_12">don\'t like it</span></a> </article>';detailText+='</div>';detailText+='</div>';detailText+='</section>';detailText+='<div class="clearfloat">&nbsp;</div>';detailText+='</div>';sText=detailText;$('#hotelDetails').html(sText);$('#planHotelDetailImage_'+id).attr('src',hotel.HotelInformationResponse.HotelImages.HotelImage[0].url);$("#planHotelThumbs .content").mCustomScrollbar({advanced:{autoExpandHorizontalScroll:true,updateOnContentResize:true},horizontalScroll:true});$("#DetailsHotelCheckInnDate").datepicker({inline:false,minDate:0,maxDate:'+1y -1d',yearRange:'2012:2014',dateFormat:'mm-dd-yy',defaultDate:'+1m',onSelect:function(dateText,inst){getNextDate(dateText,'#DetailsHotelCheckOutDate',false);}});$("#DetailsHotelCheckOutDate").datepicker({inline:false,minDate:'+1d',maxDate:'+1y',yearRange:'2012:2014',dateFormat:'mm-dd-yy',defaultDate:'+1m +1d',onSelect:function(dateText,inst){var flag=ValidateReservationDates("#DetailsHotelCheckInnDate","#DetailsHotelCheckOutDate");if(!flag){setPreDefDate(dateText,'#DetailsHotelCheckInnDate');}}});$("#DetailsHotelCheckInnDate").datepicker('setDate','+1m');$("#DetailsHotelCheckOutDate").datepicker('setDate','+1m 1d');getReviewsFromUser(id,id,11,'plan');$("img.lazyloading").lazyload({placeholder:"/images/media-load.gif",effect:"fadeIn",threshold:400,imgonerror:"/images/hotel_grid_default.gif"});centerAndZoom(hotel.HotelInformationResponse.HotelSummary.latitude,hotel.HotelInformationResponse.HotelSummary.longitude,hotel.HotelInformationResponse.HotelSummary.hotelId,'/images/hotel-bing01-active.png');objMap=new Microsoft.Maps.Map(document.getElementById('hotelMap'),{credentials:'AhJQ5JAtgnPi_omSWBrBll1mzwDZTtRktFgfeXNlUiR-i3bRuMc2inL0nAbGkRGE',width:415,height:240,enableClickableLogo:false,enableSearchLogo:false,showDashboard:false,showScalebar:false,zoom:16,mapTypeId:'auto',center:new Microsoft.Maps.Location(hotel.HotelInformationResponse.HotelSummary.latitude,hotel.HotelInformationResponse.HotelSummary.longitude)});var placePin=new Microsoft.Maps.Pushpin(objMap.getCenter(),null);objMap.entities.push(placePin);}});$("#review_content").html='';$("#searchFilters").hide();}
var roomRecords=0;function checkHotelAvailability(hotelID,panel){$("#"+panel+"HotelRoomBooking").html('<div style="padding:20px 0 150px 0; font-size:14px;" align="center">Please wait while we find you the best rates...<br /><img src="/images/preloader.gif" alt="Loading..." class="marginT5"/></div>');$("#"+panel+"HotelRoomBooking").show();$.ajax({type:"POST",url:"/html5/hotelbook/checkplanbookavailability/h/"+hotelID+"/tab/"+panel,data:$("#hotel"+panel+"detail_view").serialize(),success:function(fsdata,status){document.getElementById(panel+'HotelRoomBooking').innerHTML=fsdata;},error:function(jqXHR,textStatus,errorThrown){alert(textStatus);}});}
function closeAvailability(){$('#HotelRoomBooking').hide();$('#hotelMap').show();$('#hotelAddress').show();}
var eventsCacheData;var eventsCacheDatafilter;var cacheEventFilterData='';var eventListData='';function openEvents(category,query){tripitembycategory(12);var count=0;$("#eventsInfo").show();$("#eventsDetails").hide();$("#eventsBtnBTR").hide();eventListData='';var addToTripText=explorePanelMode=='friend'?'Recommend':'Add to Trip';var removeFromTripText=explorePanelMode=='friend'?'Recommended':'Remove';var addToTripFlag=explorePanelMode=='friend'?'friend':'grid';if(document.getElementById('searchBar12')!=undefined&&document.getElementById('searchBar12').value!='Keyword'&&document.getElementById('searchBar12').value!='keyword'){query=document.getElementById('searchBar12').value;}
document.getElementById('eventsInfo').innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';city=document.getElementById('hdnCity').value;cityId=document.getElementById('hdnCityId').value;var url='';if(eventfilterdate){url='/api/events/city/'+city+'/cityId/'+cityId+'/date/'+eventfilterdate+'/format/json';}else if(typeof category!='undefined'){url='/api/events/city/'+city+'/cityId/'+cityId+'/category/'+category+'/format/json';}else{url='/api/events/city/'+city+'/cityId/'+cityId+'/date/Future/format/json';}
if(typeof query!='undefined'){url+='/q/'+query;}
var cacheKey='';if(eventfilterdate){cacheKey="ev_"+cityId+"_0"+eventfilterdate;}else{cacheKey="ev_"+cityId+"_0";}
if(cacheKey!=''&&cache[cacheKey]&&typeof query=='undefined'&&typeof category=='undefined'){if(eventfilterdate){eventsCacheDatafilter=cache[cacheKey];}else{eventsCacheData=cache[cacheKey];}
eventsCache=cache[cacheKey];var openEntityRequestId=false;$("#pevent_filter").show();renderEvents(eventsCache,openEntityRequestId);}else{$.getJSON(url,function(fsdata){$("#pevent_filter").show();var openEntityRequestId=false;if(fsdata==null||fsdata.events.event==null){abortAjax();visibleMap='bing';showVectorMap();if(typeof query=='undefined'&&typeof category=='undefined'){$("#eventSubCategory").hide();$("#pevent_filter").hide();$("#eventsInfo").html('<article class="info padding align-center font_18">Sorry, We do not currently have any Events available for this city.</article>');$("#mapOverlay").hide();}else{$("#eventSubCategory").show();$("#pevent_filter").hide();if(typeof query!='undefined'){$('#pevent_filter').show();$("#eventsInfo").html('<article class="info padding align-center font_18">Sorry, We did not find any Event for above search criteria.</article>');}else{$("#EventClearFilterLink").show();$("#pevent_filter").show();$("#eventsInfo").html('<article class="info padding align-center font_18">Sorry, We do not currently have any Events available for this filter.</article>');}
$("#mapOverlay").hide();}}else{if(typeof query=='undefined'&&typeof category=='undefined'){cache[cacheKey]=fsdata;}
if(eventfilterdate){eventsCacheDatafilter=fsdata;}else{eventsCacheData=fsdata;}
renderEvents(fsdata,openEntityRequestId);}
ResetBrowserScrollAfterDataLoaded();});}}
var eventIndex='';function openEventDetail(i,calledFrom){btnFlag=true;eventIndex=i;$('#cityInfoScreen').show();$("#events .list").show();$("#pevent_filter").hide();$("#reviewFooterEvent").show();$("#events .list li").removeClass('current');$('#liev_'+i).addClass('current');$('#logoevents').hide();if($("#eventList .vscroll-item").hasClass('scrolling')){}else{$("#eventList .vscroll-item").addClass('scrolling');scrollDiv('eventList');}
var scrolDvHeight=$("#eventList .pnlScrollCont").height();var AChildPos=$('#liev_'+i).position();var leftListHeight=$("#eventList .vscroll-item").height();if(typeof calledFrom=='undefined')
if(scrolDvHeight<AChildPos.top){if(leftListHeight-AChildPos.top<scrolDvHeight){$("#eventList .vscroll-item").css('top',scrolDvHeight-leftListHeight);$('#eventList .scrollup').css('visibility','visible');$('#eventList .scrolldown').css('visibility','hidden');}else{$("#eventList .vscroll-item").css('top',-1*Number(AChildPos.top));$('#eventList .scrollup').css('visibility','visible');}}
$("#bing_attraction_info").hide('fade',500);$("#eventsInfo").hide();$("#searchBar12").hide();$("#eventsDetails").show();$("#eventsBtnBTR").show().click(function(){$("#eventsInfo").show();$("#searchBar12").show();$("#eventsDetails").hide();$("#eventsBtnBTR").hide();$("#events .list").hide();$("#events .list .vscroll-item").css('top','0px');});var formattedeventdate;if(eventfilterdate){if(eventsCacheDatafilter.total_items==1){var event=eventsCacheDatafilter.events.event;}else{var event=eventsCacheDatafilter.events.event[i];}
formattedeventdate=formatEventDate(event.start_time);cacheDetailEntityData=event;var oldImageUrl='';var detailText='';var j;createHashURLTitle('12',i+'/'+event['@attributes'].id+'/'+event.title);hashPushState(hashLocationString,hashPageTitle);detailText+='<div class="eventsDetailsCont">';if(typeof(event)!='undefined')
{var NewImageUrl='';oldImageUrl='';if(typeof(event.image.medium)!='undefined'){oldImageUrl=event.image.medium.url;NewImageUrl=oldImageUrl.replace("medium","large");}
detailText+='<div class="image_and_detail_cont">';if(NewImageUrl!=null||NewImageUrl!="undefined")
{detailText+='<article class="eventImage">';detailText+='<div class="poi_Image imageDisplay fl">';detailText+='<div class="itemPic">';if(NewImageUrl!=''){detailText+='<img id="itemPicEvent'+i+'" src="'+NewImageUrl+'"  onError="this.addClass("defaultImg130");this.src=\''+'/images/no-image-event.png'+'\'"/>';}else{detailText+='<img id="itemPicEvent'+i+'" class="defaultImg130" src="images/no-image-event.png"  />';}
detailText+='</div>';detailText+='</div></article>';}}
detailText+='<article class="eventDetail">';detailText+='<div>';var eid=event['@attributes'].id;detailText+='<div class="infoText infoTextW"><span class="attrName">'+event.title+'</span>';detailText+='<div class="connectComunity">';detailText+='<span class="add_to_trip_button" id="detail_top_btn_'+replaceString(eid)+'"></span>';if(explorePanelMode=='friend'){getRecommandButtonCode(12,eid);}else{getAddToTripButtonCode(12,eid);}
detailText+='</div></div>';detailText+='<div class="fr semi-light font_11"><img src="/images/brandings/eventful.gif" alt="Local Events, Concerts, Tickets"><p><a href="http://eventful.com/" class="semi-light" target="_blank">Events</a> by Eventful</p></div>';detailText+='</div>';detailText+='<div class="shadow_top_inside" style="padding:0px; min-height:15px;"></div>';detailText+='<p class="eventAddress" style="margin:2px 0px;padding:3px 6px">';detailText+='<span class ="font_16 block"><strong class="font_14">Starts at: </strong>'+formattedeventdate+'</span><br />';detailText+='<span class="block"><strong>Venue:</strong> '+event.venue_name+'</span>';if(event.venue_address!='[object Object]'){detailText+='<span class="block">'+event.venue_address+'</span>';}
if(event.performers.performer!=null&&event.performers.performer!="undefined"&&event.performers.performer!='[object Object]'){detailText+='<span class="block"><strong>Performers:</strong> ';for(c=0;c<event.performers.performer.length;c++){detailText+=' <nobr>&#8226; '+event.performers.performer[c].name+'</nobr>';}}
detailText+='</span>'
detailText+='</p>';detailText+='<div class="shadow_bottom_inside marginB5" style="padding:0"></div>';detailText+='<div class="cityMap"><div id="eventInfoMap" class="detailMap" style="height:190px;border:1px solid #ddd;width:400px"></div></div>';detailText+='</div>';detailText+='</article>';if(event.description!=null&&event.description!="undefined"&&event.description!='[object Object]'&&event.description!=''&&event.description.length>15){detailText+='<div class="marginT10">';detailText+='<div class="Descripition justifywrap marginR30 marginL15"><h3>About Event</h3><div class="font_13">  '+event.description+'</div></div>';detailText+='</div>';}
detailText+='</div>';detailText+='</div>';detailText+='</div>';if($("#itemPic").width()>300)
$("#itemPic").width(300);document.getElementById("eventsDetails").innerHTML=detailText;if(NewImageUrl!=null||NewImageUrl!="undefined")
{$('#itemPicEvent'+i).attr('src',NewImageUrl);}
centerAndZoom(event.latitude,event.longitude,i,"/images/events_active.png");objMap=new Microsoft.Maps.Map(document.getElementById("eventInfoMap"),{credentials:'AhJQ5JAtgnPi_omSWBrBll1mzwDZTtRktFgfeXNlUiR-i3bRuMc2inL0nAbGkRGE',width:"auto",height:180,enableClickableLogo:false,enableSearchLogo:false,showDashboard:false,showScalebar:false,zoom:16,mapTypeId:'auto',center:new Microsoft.Maps.Location(event.latitude,event.longitude)});var placePin=new Microsoft.Maps.Pushpin(objMap.getCenter(),null);objMap.entities.push(placePin);}
else{if(eventsCacheData.total_items==1){var event=eventsCacheData.events.event;}else{var event=eventsCacheData.events.event[i];}
formattedeventdate=formatEventDate(event.start_time);cacheDetailEntityData=event;var oldImageUrl='';var detailText='';var j;createHashURLTitle('12',i+'/'+event['@attributes'].id+'/'+event.title);hashPushState(hashLocationString,hashPageTitle);detailText+='<div class="eventsDetailsCont">';if(typeof(event)!='undefined')
{var NewImageUrl='';oldImageUrl='';if(typeof(event.image.medium)!='undefined'){oldImageUrl=event.image.medium.url;NewImageUrl=oldImageUrl.replace("medium","large");}
detailText+='<div class="image_and_detail_cont">';if(NewImageUrl!=null||NewImageUrl!="undefined")
{detailText+='<article class="eventImage">';detailText+='<div class="poi_Image imageDisplay">';detailText+='<div class="itemPic">';if(NewImageUrl!=''){detailText+='<img id="itemPicEvent'+i+'" src="'+NewImageUrl+'"  onError="this.addClass("defaultImg130");this.src=\''+'/images/no-image-event.png'+'\'"/>';}else{detailText+='<img id="itemPicEvent'+i+'" class="defaultImg130" src="images/no-image-event.png"  />';}
detailText+='</div>';detailText+='</div></article>';}}
detailText+='<article class="eventDetail">';detailText+='<div>';var eid=event['@attributes'].id;detailText+='<div class="infoText infoTextW"><span class="attrName">'+event.title+'</span>';detailText+='<div class="connectComunity">';detailText+='<span class="add_to_trip_button" id="detail_top_btn_'+replaceString(eid)+'"></span>';if(explorePanelMode=='friend'){getRecommandButtonCode(12,eid);}else{getAddToTripButtonCode(12,eid);}
detailText+='</div></div>';detailText+='<div class="fr semi-light font_11"><img src="/images/brandings/eventful.gif" alt="Local Events, Concerts, Tickets"><p><a href="http://eventful.com/" class="semi-light" target="_blank">Events</a> by Eventful</p></div>';detailText+='</div>';detailText+='<div class="shadow_top_inside" style="padding:0px; min-height: 15px;"></div>';detailText+='<p class="eventAddress" style="margin:2px 0px;padding:3px 6px">';detailText+='<span class ="font_16 block"><strong class="font_14">Starts at: </strong>'+formattedeventdate+'</span><br />';detailText+='<span class="block"><strong>Venue:</strong> '+event.venue_name+'</span>';if(event.venue_address!='[object Object]'){detailText+='<span class="block">'+event.venue_address+'</span>';}
if(event.performers.performer!=null&&event.performers.performer!="undefined"&&event.performers.performer!='[object Object]'){detailText+='<span class="block"><strong>Performers:</strong> ';for(c=0;c<event.performers.performer.length;c++){detailText+=' <nobr>&#8226; '+event.performers.performer[c].name+'</nobr>';}}
detailText+='</span>'
detailText+='</p>';detailText+='<div class="shadow_bottom_inside marginB5" style="padding:0"></div>';detailText+='<div class="cityMap"><div id="eventInfoMap" class="detailMap" style="height:190px;border:1px solid #ddd;width:400px"></div></div>';detailText+='</div>';detailText+='</article>';if(event.description!=null&&event.description!="undefined"&&event.description!='[object Object]'&&event.description!=''&&event.description.length>10){detailText+='<div class="marginT10">';detailText+='<div class="Descripition justifywrap marginR30 marginL15"><h3>About Event</h3><div class="font_13">'+event.description+'</div></div>';detailText+='</div>';}
detailText+='</div></div>';detailText+='</div>';detailText+='</div>';if($("#itemPic").width()>300)
$("#itemPic").width(300);document.getElementById("eventsDetails").innerHTML=detailText;centerAndZoom(event.latitude,event.longitude,i,"/images/events_active.png");objMap=new Microsoft.Maps.Map(document.getElementById("eventInfoMap"),{credentials:'AhJQ5JAtgnPi_omSWBrBll1mzwDZTtRktFgfeXNlUiR-i3bRuMc2inL0nAbGkRGE',width:"auto",height:180,enableClickableLogo:false,enableSearchLogo:false,showDashboard:false,showScalebar:false,zoom:16,mapTypeId:'auto',center:new Microsoft.Maps.Location(event.latitude,event.longitude)});var placePin=new Microsoft.Maps.Pushpin(objMap.getCenter(),null);objMap.entities.push(placePin);}
$('#itemPicEvent'+i,'#eventsDetails').error(function(){$(this).attr('src','/images/clear.gif').width(415).height(365).css('background','url(/images/no-image-event.png) no-repeat center center');});}
function getEventAddToTripButtonCode(i){addToTripButton='<div class="addTrip" ><a class="btnIconAdd font_13" onclick="addtoAttraction(\'foursquare\',\''+i+'\',\''+addslashes(planDataCache[i].name)+'\',\''+addslashes(planDataCache[i].address1)+'\',\''+planDataCache[i].website+'\',\''+planDataCache[i].formattedPhone+'\')"> Add to Trip</button></div>';return addToTripButton;}
var dealsCacheData;function openDeals(donotrefresh,query,method){$("#dealsBtnBTR").hide();$("#dealbuttonInfo").hide();$("#dealInfoList").hide();activeExploreTab='Deals';$("#dealsInfo").html('<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>').show();$("#dealsDetails").hide();if(typeof donotrefresh=='undefined'){document.getElementById('dealsInfo').innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';$("#dealInfoList").html(preloadDiv);$("#deals .list").hide();}
if(dealFlag==false){dealFlag=true;}
showBing();city=document.getElementById('hdnCity').value;cityId=document.getElementById('hdnCityId').value;var cacheKey="dl_"+cityId+"_0";var url='/savelikelocals/deals/city/'+city+'/cityId/'+cityId;if(typeof donotrefresh!='undefined'){if(donotrefresh==0){url+='/travel/'+1;cacheKey+=1;}else{url+='/cat/'+donotrefresh;cacheKey+=donotrefresh;}}
if(typeof query!='undefined'){url+='/q/'+query;}
if(cache[cacheKey]&&typeof query=='undefined'){dealsCacheData=cache[cacheKey];renderDeal(dealsCacheData);}else{$.getJSON(url,function(fsdata){if((fsdata.nav.number_of_results!=0)){dealsCacheData=fsdata;cache[cacheKey]=fsdata;$("#searchBar13").show();$("#dealsCategory").show();renderDeal(fsdata);}else{abortAjax();visibleMap='bing';showVectorMap();$("#dealsInfo").html('<article class="info padding align-center font_18">Sorry, we do not currently have any Deals available for this city.</article>');if($('#dealbuttonInfo').is(':visible')){$("#dealbuttonInfo").hide();}
if(typeof method=='undefined'){$("#searchBar13").hide();$("#dealsCategory").hide();}
$("#mapOverlay").hide();}});}}
function renderDeal(data){tripitembycategory(13);var sText='';var gCtr=1;var cCtr=1;var openEntityRequestId=false;var sourceIds=$("#tripItemSourceIds").val();var userSourceIds=$("#userItemSourceIds").val();var sourceIdArray=sourceIds.split(',');var userSourceIdArray=userSourceIds.split(',');var addToTripText=explorePanelMode=='friend'?'Recommend':'Add to Trip';var removeFromTripText=explorePanelMode=='friend'?'Recommended':'Remove';var addToTripFlag=explorePanelMode=='friend'?'friend':'grid';document.getElementById('dealsInfo').className="top25";var listText='<ul class="leftList">';$.each(data.results,function(i,deal){if(cCtr>chkCol){cCtr=1;gCtr++;}
if(selectedEntityId){if(deal.product_id==selectedEntityId){openEntityRequestId=i;selectedEntityId=false;}}
var detailText='';detailText+='<article class="content">';detailText+='<a class="relative" href="javascript://;" onClick="javascript:openDealInfo('+i+')"><img class="lazyloading" src="'+deal.image_url+'" width="100%" height="135" onError="this.src=\''+'/images/deals_default.gif'+'\'"/><span class="attrName absolute black-overlay">'+deal.title_short_50+'</span></a>';detailText+='<p>';detailText+=deal.address+'</p>';detailText+='<article class="font_13 bg_lightblue dealPriceInfo"><span class="no-border"><img src="'+deal.provider_logo+'" height="40" /></span><span>Value: <br /><strong><strike> '+dealsCacheData.results[i].currency_symbol+dealsCacheData.results[i].actual_price+'</strike></strong></span>';detailText+='<span>Price:<br /><strong>'+dealsCacheData.results[i].currency_symbol+dealsCacheData.results[i].deal_price+'</strong></span><span class="no-border">You Save:<br /><strong>'+dealsCacheData.results[i].currency_symbol+dealsCacheData.results[i].savings_amount+'</strong></span>';detailText+='</article>';if(deal.js_deal_end_date!=null){}
detailText+='</article>';detailText+='</article>';detailText+='<article class="actionbuttons">';if(!(pastTrip&&explorePanelMode=='friend')){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,deal.product_id);if(itemExist!=-1&&itemsStatusArray[itemExist]=='yes_13'&&explorePanelMode=='friend'){detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Already added to trip</span>';}else if(sourceIdArray!=''||userSourceIdArray!=''){var isExists=inArrayJS(parseInt(deal.product_id)+'_13',sourceIdArray);if(isExists==true){gridId=replaceString(deal.product_id);if(explorePanelMode=='friend'){var foruserExist=inArrayJS(parseInt(deal.product_id)+'_13',userSourceIdArray);gridId=replaceString(deal.product_id);if(foruserExist==true){detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended by friends and You</span>';}
else{detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended by friends</span>';detailText+='<span id="gridBtn_frnd_'+gridId+'" class="fl"><a class="btnIconAdd blue_link" onClick="assignTripItemData(\'deal\', '+i+'); addItemToTrip(\'13\', \'4\', \''+deal.product_id+'\', \''+addToTripFlag+'\', \'\', '+i+')" href="javascript:void(0);">I Recommend</a></span>';}}else{detailText+='<span id="gridBtn_'+gridId+'" class="fl"><a href="javascript://" onClick="removeFromTrip(\'13\', \'4\', \''+deal.product_id+'\', \''+addToTripFlag+'\',\''+i+'\')" class="btnIconRemove font_13"> '+removeFromTripText+'</a></span>';}}else{if(explorePanelMode=='friend'){var foruserExist=inArrayJS(parseInt(deal.product_id)+'_13',userSourceIdArray);gridId=replaceString(deal.product_id);if(foruserExist==true){detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended</span></p>';}
else{detailText+='<span id="gridBtn_'+gridId+'" class="fl"><a href="javascript://" onClick="assignTripItemData(\'deal\', '+i+'); addItemToTrip(\'13\', \'4\', \''+deal.product_id+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link"> '+addToTripText+' </a></span>';}}else{gridId=replaceString(deal.product_id);detailText+='<span id="gridBtn_'+gridId+'" class="fl"><a href="javascript://" onClick="assignTripItemData(\'deal\', '+i+'); addItemToTrip(\'13\', \'4\', \''+deal.product_id+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link"> '+addToTripText+' </a></span>';}}}else{gridId=replaceString(deal.product_id);detailText+='<span id="gridBtn_'+gridId+'" class="fl"><a href="javascript://" onClick="assignTripItemData(\'deal\', '+i+'); addItemToTrip(\'13\', \'4\', \''+deal.product_id+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link"> '+addToTripText+' </a></span>';}}
detailText+='<a class="book_now font_13 mtop_5 mleft10 fr"  href="'+deal.deep_link+'" target="_blank">Buy Now</a>';detailText+='<div class="clearfloat"/></article>';sText+='<section class="deals_row'+gCtr+'">'+detailText+'</section>';listText+='<li id="dealList'+i+'" onclick="javascript:openDealInfo('+i+',1)" ><a href="javascript://" ><img src="'+deal.image_url+'" width="30" onError="this.src=\''+'/images/deals_default.gif'+'\'" /> '+deal.title_short_50+'</a></li>';cCtr++;});listText+='</ul>';dealList='<a class="scrollup" href="javascript://">&nbsp;</a>';dealList+='<div class="pnlScrollCont">';dealList+='<ul class="leftList vscroll-item">'+listText+'</li>';dealList+='</div>';dealList+='<a class="scrolldown" href="javascript://">&nbsp;</a>';$("#dealInfoList").html(dealList);document.getElementById('dealsInfo').innerHTML=sText;for(i=1;i<=gCtr;i++)
{$('.deals_row'+i).equalizeHeights();if($('.deals_row'+i).height()==0)
{dealsCityId='';}}
dealsPlaces=dealsCacheData;plotDealDataOnBingMap(dealsCacheData);$("img.lazyloading").lazyload({placeholder:"/images/html5/img-lazy-loading.gif",effect:"fadeIn",threshold:400});if(openEntityRequestId!==false){openDealInfo(openEntityRequestId);}}
function openDealInfo(i,calledFrom){$('#cityInfoScreen').show();$("#dealInfoList").show();btnFlag=true;cacheDetailEntityData=dealsCacheData.results[i];$("#dealsInfo").hide();$("#dealsDetails").show();$("#deals .list").show();$("#deals .list li").removeClass("current");$("#dealList"+i).addClass("current");$("#searchBar13").hide();$("#dealsCategory").hide();if($("#dealInfoList .vscroll-item").hasClass('scrolling')){}else{$("#dealInfoList .vscroll-item").addClass('scrolling');scrollDiv('dealInfoList');}
var scrolDvHeight=$("#dealInfoList .pnlScrollCont").height();var AChildPos=$("#dealList"+i).position();var leftListHeight=$("#dealInfoList .vscroll-item").height();if(typeof calledFrom=='undefined')
if(scrolDvHeight<AChildPos.top){if(leftListHeight-AChildPos.top<scrolDvHeight){$("#dealInfoList .vscroll-item").css('top',scrolDvHeight-leftListHeight);}else{$("#dealInfoList .vscroll-item").css('top',-1*Number(AChildPos.top));}}
$("#dealsBtnBTR").show();$("#dealsBtnBTR").click(function(){$("#dealsCategory").show();});$("#reviewFooterDeals").show();if($.trim(dealsCacheData.results[i].merchant)==''){hashDealInfo=i+'/'+dealsCacheData.results[i].product_id}
else{hashDealInfo=i+'/'+dealsCacheData.results[i].product_id+'/'+dealsCacheData.results[i].merchant;}
createHashURLTitle('13',hashDealInfo);hashPushState(hashLocationString,hashPageTitle);var mapbucket="map"+dealsCacheData.results[i].product_id;document.getElementById('dealsDetails').innerHTML=preloadDiv;var detailText='';detailText+='<article class="" style="display:table-row;">';detailText+='<div class="infoText" style="width:auto;"><span class="attrName">'+dealsCacheData.results[i].title_short_100+'</span>';detailText+='<div class="connectComunity">';detailText+='<span class="add_to_trip_button" id="detail_top_btn_'+dealsCacheData.results[i].product_id+'"></span>';if(explorePanelMode=='friend'){getRecommandButtonCode(13,dealsCacheData.results[i].product_id);}else{getAddToTripButtonCode(13,dealsCacheData.results[i].product_id);}
detailText+='</div></article>';detailText+='<article  style="display:table-row; "><div class="poi_Image"><div style="max-height:350px; overflow:hidden; width:415px ; border: 1px solid #E2E2E2;"><img id="itemPic" class="lazyloading" src="'+dealsCacheData.results[i].image_url+'" width="415" onError="this.src=\''+'/images/deals_default.gif'+'\'"/></div></div>';detailText+='<article class="fl"><div class="cityMap"><div id="'+mapbucket+'" class="detailMap"></div></div>';detailText+='<div class="dealAddress marginT10" style="margin-top:265px;">'+dealsCacheData.results[i].address+'</div>';if($("#itemPic").width()>300)
$("#itemPic").width(300);detailText+='</article>';detailText+='</article>';detailText+='<article class="font_13 bg_lightblue dealPriceInfo"  style="padding:5px; display:table-row;"><span class="no-border fl"><img src="'+dealsCacheData.results[i].provider_logo+'" width="80" /></span><span>Value: <br /><strong><strike> '+dealsCacheData.results[i].currency_symbol+dealsCacheData.results[i].actual_price+'</strike></strong></span>';detailText+='<span>Price:<br /><strong>'+dealsCacheData.results[i].currency_symbol+dealsCacheData.results[i].deal_price+'</strong></span><span>You Save:<br /><strong>'+dealsCacheData.results[i].currency_symbol+dealsCacheData.results[i].savings_amount+'</strong></span><span class="no-border"><a class="book_now fr font_13 mleft10" href="'+dealsCacheData.results[i].deep_link+'" target="_blank">Buy Now</a></span>';detailText+='</article>';detailText+='<article class="font_13" style="display:table-row;" ><br /><span><strong>Deal Ends at: '+dateFormat(dealsCacheData.results[i].deal_end_date)+'</strong></span></article>'
detailText+='<p class="font_13 marginT10 fl">'+dealsCacheData.results[i].description+'</p>';detailText+='</div>';document.getElementById('dealsDetails').innerHTML=detailText;objMap=new Microsoft.Maps.Map(document.getElementById(mapbucket),{credentials:'AhJQ5JAtgnPi_omSWBrBll1mzwDZTtRktFgfeXNlUiR-i3bRuMc2inL0nAbGkRGE',width:"auto",height:180,enableClickableLogo:false,enableSearchLogo:false,showDashboard:false,showScalebar:false,zoom:16,mapTypeId:'auto',center:new Microsoft.Maps.Location(dealsCacheData.results[i].latitude,dealsCacheData.results[i].longitude)});var placePin=new Microsoft.Maps.Pushpin(objMap.getCenter(),null);objMap.entities.push(placePin);$("img.lazyloading").lazyload({placeholder:"/images/html5/img-lazy-loading.gif",effect:"fadeIn",threshold:400});}
function addScrollng(id,nxt,prv,d){$("#"+id).carouFredSel({direction:d,circular:false,infinite:false,height:550,width:"auto",prev:prv,next:nxt,auto:false});}
function resetPanelFlags(){attractionCityId='';phostelCityId='';infoCityId='';weatherCityId='';hotelCityId='';activitiesCityId='';restaurantCityId='';nightlifeCityId='';shoppingCityId='';eventsCityId='';friendsCityId='';dealsCityId='';newsCityId='';mediaCityId='';shareCityId='';}
function ChangeTripId(tid,text,cities){quickNavTripId=tid;global_trip_id=tid;resetPanelFlags();if(isSharePanel==true){$("#shareTab").trigger('click');}else{$(".geoItinerary").hide("fade",500);}
document.getElementById("tripPlaceId").value=tid;var tripName=text;var tripNameLen=text.length;if(tripNameLen>13){var name=tripName.substring(0,11)+'..';}else{var name=text;}
document.getElementById("tripPlaceName").innerHTML=name;$('#tripPlaceName').attr('title',text);$('#trip_name_nav').attr('title',text);if(visibleMap=='bing'){zoomTo100();}
if($('#my_trip_wrapper').is(':visible')){tripNameClick(text,tid);loadTripInfo(tid);}else{showTripPushPin(tid);}
if(document.getElementById("PlanBookComponent").style.display=="block"){$("#explore").addClass("active");$("#geofarelitab").removeClass("active");$("#myTripsId").removeClass("active");$("#cityInfoScreen").hide("fade",500);$("#PlanBookComponent").hide("fade",500);restorPanel();if(visibleMap=='bing'){$("#zoom_to_first_level").trigger('click');visibleMap='jvector';}}
if(tid!=0){getTripItem('');}}
function changeCityTab(id,tot){tripId=document.getElementById("tripPlaceId").value;url='/html5/geo/buildgeo/tripId/'+tripId+'/cityId/'+id+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){document.getElementById("geoInformation").innerHTML=data;});}
function openGeoItInfo(){popup_flag="geoInformation";var tripId;resetView()
$("#topNav li").removeClass("active");$("#geolitab").addClass("active");$("#geoInformation").show();$("#OutrContainer").hide();$("#my_trip_wrapper").hide();if(document.getElementById("topNavItems").style.display=="block"){$("#topNavItems").hide();$("#geoInformation").show();}
showVectorMap();$("#cityInfoScreen").hide("fade",500);$("#PlanBookComponent").hide("fade",500);$(".welcomeBox").hide();tripId=document.getElementById("tripPlaceId").value;url='/html5/geo/buildgeo/tripId/'+tripId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){document.getElementById("geoInformation").innerHTML=data;});}
function removePreviousDynamicTxtBox(counter){for(i=counter;i>=1;i--){var spanId="addMoreBlock"+i;if(spanId!=null){$("#addMoreBlock"+i).remove();}}
if(destination_counter){destination_counter=0;}}
function updateTripCities(cityid,triptype){tripid=document.getElementById("tripPlaceId").value;url='/html5/mytrip/update-tripupdateTripInfo-route/tripId/'+tripid+'/cityId/'+cityid+'/tripType/'+triptype+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){if($("#mytripslitab").hasClass('active')){updateTripRouteList(tripid,triptype);}});}
function updateTripInfo(cityid,triptype,cityData){if(document.getElementById("add_edit_trip").style.display!="none"){if(global_trip_id!=''){loadTripInfo(global_trip_id);}}
tripid=$("#tripPlaceId").val();var url='/html5/trip/updatetripinfo/tripId/'+tripid+'/cityId/'+cityid+'/tripType/'+triptype+'/rand/'+parseInt(Math.random()*99999999);if((typeof(cityData)!='undefined')&&(cityData!='')){url='/html5/mytrip/update-trip-route/tripId/'+tripid+'/cityId/'+cityid+'/tripType/'+triptype+'/rand/'+parseInt(Math.random()*99999999);}
$.get(url,function(data){if($("#mytripslitab").hasClass('active')){updateTripRouteList(tripid,triptype);}
if((typeof(cityData)=='undefined')||(cityData=='')){global_trip_part_id=data;setTripPartContext(cityid,'',data);document.getElementById("tripPartId").value=data;}});}
function showTripInfoFor(id,cnt,tid,text,cities,city,date){global_trip_id=id;if(document.getElementById("tripInfo"+id).style.display=='none'||document.getElementById("tripInfo"+id).style.display=='')
{if(document.getElementById("hdate").value!='Jan 1, 1970'&&document.getElementById("hdid").value!='')
{hdid=document.getElementById("hdid").value;hdate=document.getElementById("hdate").value;document.getElementById("planBook"+hdid).innerHTML=hdate;}
$(".tripInfor").hide();$("#tripInfo"+id).slideDown("fast");if(city!='')
{document.getElementById("hdid").value=id;document.getElementById("hdate").value=date;strcon='<a href="javascript://" onclick="openCityDetails(\''+city+'\',508,57,\'plan\');">Plan</a> |  <a href="javascript://" onclick="openCityDetails(\''+city+'\',508,57,\'book\')">Book</a>';document.getElementById("planBook"+id).innerHTML=strcon;}}
else
{if(document.getElementById("hdate").value!='Jan 1, 1970'&&document.getElementById("hdid").value!='')
{hdid=document.getElementById("hdid").value;hdate=document.getElementById("hdate").value;document.getElementById("planBook"+hdid).innerHTML=hdate;}
if(date!="Jan 1, 1970")
{document.getElementById("planBook"+id).innerHTML=date;document.getElementById("hdid").value=id;document.getElementById("hdate").value=date;}
$("#tripInfo"+id).hide();$(".lnkTripName span").show();}
document.getElementById("tripPlaceName").innerHTML=text;$('#tripPlaceName').attr('title',text);document.getElementById("tripPlaceId").value=tid;try{$('#rootvectormap').vectorMap('set','hideAllPin',1);}
catch(err){}
if(cities!=0&&cities!='')
{url='/html5/trip/getmultiplecitypushpin/cityId/'+cities+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){var obj=jQuery.parseJSON(data);$.each(obj.data,function(i,value){try{$('#rootvectormap').vectorMap('set','label',{"n":value.name,"c":value.ccode.toLowerCase(),"d":value.description,"lat":value.lat,"lon":value.lon,"pin":1,"pcolor":"white","key":value.id,"l":1});}
catch(err){}});});}}
function openGeoPlaces(){resetView();$("#OutrContainer").hide();$(".welcomeBox").hide();$("#my_trip_wrapper").hide();$("#topNav li").removeClass("active");$("#geoPlacesTab").addClass("active");$(".rightPanel").show();}
function showRestaurantMenu(){if($("#listRestaurantCategory").is(":visible")==true){$("#listRestaurantCategory").slideUp("fast");return;}else{var list=$("#listRestaurantCategory").html();if(!list||list=='undefined'){}else{$("#listRestaurantCategory").slideDown("fast");}}}
function showMain(){$("#planInformation").show();$("#planInformation .list").show();}
function hideShowSubLi(cat,cnt){if($("#main_item_TR"+cat).hasClass('collapsed')==true){for(i=1;i<cnt;i++){if("#pn_sub_item_"+cat+"_"+i){$("#pn_sub_item_"+cat+"_"+i).show();}}
$("#main_item_TR"+cat).removeClass("collapsed");$("#main_item_TR"+cat).addClass("expanded");}else{for(i=1;i<cnt;i++){if("#pn_sub_item_"+cat+"_"+i){$("#pn_sub_item_"+cat+"_"+i).hide();}}
$("#main_item_TR"+cat).removeClass("expanded");$("#main_item_TR"+cat).addClass("collapsed");}}
function showAttractionMenu(){if($("#listAttractionCategory").is(":visible")==true){$("#listAttractionCategory").slideUp("fast");return;}else{var list=$("#listAttractionCategory").html();if(!list||list=='undefined'){}else{$("#listAttractionCategory").slideDown("fast");}}}
function showShoppingMenu(){if($("#listShoppingCategory").is(":visible")==true){$("#listShoppingCategory").slideUp("fast");return;}else{var list=$("#listShoppingCategory").html();if(!list||list=='undefined'){}else{$("#listShoppingCategory").slideDown("fast");}}}
function showDealMenu(){$("#listDealsCategory").slideDown("fast");}
function setCityNameForTripItems(optionVal,city){abortAjax();$(".reviewFooter").hide();$(".btnBTR").hide();tripPartId=optionVal.split(',');document.getElementById('hdnCityId').value=tripPartId[0];global_trip_part_id=tripPartId[1];document.getElementById("tripPartId").value=tripPartId[1];if($.trim(activeExploreTab)=="")activeExploreTab="Info";if(anonymousUser==false){isTripSectionMode=true;}
else{isTripSectionMode=false;}
isCityDropDownOnChangeEvent=true;openCityTabsPanel(tripPartId[0],activeExploreTab);isCityDropDownOnChangeEvent=false;getTripItem('');}
function fillCity(){var url="/mytrip/getalldestination/t/"+global_trip_id;$("#exploter_panel_city").children().remove();$.getJSON(url,function(fsdata){if(typeof fsdata.data[0]=='undefined'){$("#Drop_Explore").hide();return;}else{$.each(fsdata.data,function(i,city){optionVal=city.cityId+','+city.id;if(activeTripPart.cityId==city.cityId){$("#exploter_panel_city").append(new Option(city.name,optionVal,true,true));}
else{$("#exploter_panel_city").append(new Option(city.name,optionVal));}});}});}
function backToTrip(){$("#PlanBookComponent").hide();if(friendTripFlag){$("#friend_trip_wrapper").show();}
else{$("#my_trip_wrapper").show();}
var tripPartId=parseInt(document.getElementById("tripPartId").value);loadWidgets(global_trip_id,tripPartId);showVectorMap();}
var activityListDetail=new Array();var attractionListDetails=new Array();function openAttractionCategory(cat,name,radius_filter,page){activeExploreTab='Attractions';$("#attractionDetails").hide();$("#attraction .list").hide();$("#attractionInfo").show();$("#attractionBtnBTR").hide();businessId="active";if(attractionFlag==false){attractionFlag=true;}
showBing();city=document.getElementById("hdnCity").value;if(cat!=''){document.getElementById("hdnattractcat").value=cat;}
if(radius_filter!=''){document.getElementById("hdnattractfilter").value=radius_filter;}
if(name!=''){document.getElementById("hdnattractname").value=name;}
cat=document.getElementById("hdnattractcat").value
radius_filter=document.getElementById("hdnattractfilter").value
name=document.getElementById("hdnattractname").value;if(typeof radius_filter=='undefined'){radius_filter=0;}
if(typeof page=='undefined'){page=0;}
url='/html5/plan/buildattractionlist/city/'+city+'/cat/'+cat+'/radius_filter/'+radius_filter+'/page/'+page+'/rand/'+parseInt(Math.random()*99999999);$("#weather").hide();document.getElementById("displayAttractionItem").innerHTML='<a href="javascript:;"> '+name+'</a>';$(".primaryColRight").css("marginLeft","0");document.getElementById("attractionList").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt=""/></div>';if(attractionListDetails[city]){arrdata=attractionListDetails[city].split("|||");businessId=arrdata[0];document.getElementById("attractionList").innerHTML=arrdata[1];if(name=="Top Recommendations"){$("#attbuttonInfo").hide();getFoursquareCategories(1);recommendsubcat="";openAttrRecommendation('1','attractionList');}else{$("#att_button_info").show();$("#attbuttonInfo").show();document.getElementById("attractionInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt=""/></div>';recommendsubcat="yelp";openAttrRecommendation(cat,'attractionList');}
if(!showBelow){$(this).resizepanels(420);$("#attScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#prevAttract",downID:"#nextAtt",scrollerID:"#attInnerWrapper"});$("#attrScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#attrScrollPrev",downID:"#attrScroll",scrollerID:"#attrContent"});}}else{if(name=="Top Recommendations"){getFoursquareCategories(1);topRecommendation=true;recommendsubcat="";openAttrRecommendation('1','attractionList');}else{topRecommendation=false;recommendsubcat="yelp";openAttrRecommendation(cat,'attractionList');}
if(!showBelow){$(this).resizepanels(420);$("#attScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#prevAttract",downID:"#nextAtt",scrollerID:"#attInnerWrapper"});$("#attrScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#attrScrollPrev",downID:"#attrScroll",scrollerID:"#attrContent"});}}
$("#listAttractionCategory").slideUp("fast");}
function openYelpInfo(url,id1,id2){$.get(url,function(data){attractionListDetails[city]=data;arrdata=data.split("|||");businessId=arrdata[0];document.getElementById(id1).innerHTML=arrdata[1];document.getElementById(id2).innerHTML=arrdata[3];openAttractionInfo(businessId);$(".list").show();});}
function openYelpInfoForActivity(url,id1,id2){$.get(url,function(data){activityListDetails[city]=data;arrdata=data.split("|||");businessId=arrdata[0];document.getElementById(id1).innerHTML=arrdata[1];document.getElementById(id2).innerHTML=arrdata[3];openActivityInfo(businessId);$(".list").show();});}
function openYelpInfoForRestaurant(url,id1,id2){$.get(url,function(data){attractionListDetails[city]=data;arrdata=data.split("|||");businessId=arrdata[0];document.getElementById(id1).innerHTML=arrdata[1];document.getElementById(id2).innerHTML=arrdata[3];openRestaurantInfo(businessId);$(".list").show();});}
function openYelpInfoForNightLife(url,id1,id2){$.get(url,function(data){attractionListDetails[city]=data;arrdata=data.split("|||");businessId=arrdata[0];document.getElementById(id1).innerHTML=arrdata[1];document.getElementById(id2).innerHTML=arrdata[3];openNightlifeInfo(businessId);$("#nightlife .list").show();});}
function openAttractionInfo(id){$("#attraction .list li").removeClass('current');$('#liat_'+divMap[bucketId]+id).addClass('current');city=document.getElementById("hdnCity").value;tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
document.getElementById("attractionInfo").innerHTML='<div style="padding:150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';url='/html5/plan/buildattractioninfo/source/1/id/'+id+'/tripPartId/'+tripPartId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){attractionInfoDetails[city]=data;arrdata=data.split("|||");document.getElementById("attractionInfo").innerHTML=arrdata[0];document.getElementById("attbuttonInfo").innerHTML=arrdata[3];if(!showBelow){$(this).resizepanels(420);$("#attrPanelScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#attPanelScrollPrev",downID:"#attPanelScrollNext",scrollerID:"#attrPanelContent"});}
try{getAttractionMap(arrdata[1],arrdata[2]);}
catch(err){}});}
var planDataCache=false;var divMap=Array();divMap[1]='attraction';divMap[3]='restaurant';divMap[4]='nightlife';divMap[6]='shopping';divMap[8]='activities';divMap[11]='hotels'
divMap[12]='event';divMap[13]='deals';divMap[16]='hostel'
var divSliderMap=Array();divSliderMap[1]='listAttractionCategory';divSliderMap[3]='restaurant';divSliderMap[4]='nightlife';divSliderMap[8]='activity';var recommandAddbtn=Array();recommandAddbtn[1]='att';recommandAddbtn[8]='activity';recommandAddbtn[3]='res';recommandAddbtn[4]='night';recommandAddbtn[6]='shopping';recommandAddbtn[12]='event';recommandAddbtn[13]='deal';recommandAddbtn[11]='hotel';recommandAddbtn[16]='hostel';function openAttrRecommendation(bucketId,divName,query,method){var url='';var panel_trip_id='';$("#attbuttonInfo").hide();$("#"+divMap[bucketId]+"BtnBTR").hide();if(global_trip_id!=''){panel_trip_id=global_trip_id;}else{panel_trip_id=$("#tripPlaceId").val();}
$("#listAttractionCategory").slideUp("fast");cityId=document.getElementById("hdnCityId").value;var cacheKey="tr_"+cityId+"_"+bucketId;if(recommendsubcat=="yelp"){url='/html5/plan/places/city/'+cityId+'/bucket/1/catId/'+bucketId;bucketId=1;}else{var recommand=0;var tripId=document.getElementById("tripPlaceId").value;if(typeof tripId=='undefined'){tripId=global_trip_id;}
if(explorePanelMode=='friend'){recommand=1;}
url='/html5/plan/places/city/'+cityId+'/bucket/'+bucketId;url+='/recommand/'+recommand+'/ti/'+tripId;}
if(typeof query!='undefined'){url+='/q/'+query;}
var strReturn='';document.getElementById("attractionList").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt=""/></div>';document.getElementById("attractionInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';strReturn+='<a href="javascript://" class="scrollup">&nbsp;</a><div id="attScrollDiv" class="pnlScrollCont"><ul id="lstAttract" class="leftList vscroll-item">';if(cache[cacheKey]&&typeof query=='undefined'&&recommendsubcat!='yelp'&&global_city_panel_id!=panel_trip_id){planDataCache=cache[cacheKey];$.each(planDataCache,function(i,record){strReturn+='<li id="liat_'+divMap[bucketId]+i+'" onClick="javascript:openInfoDetail('+i+', '+bucketId+' ,1)"><a href="javascript:;" >'+record.name+'</a></li>';});strReturn+='</ul></div><a href="javascript://" class="scrolldown">&nbsp;</a> ';document.getElementById('attractionList').innerHTML=strReturn;openInfo(0,bucketId);ResetBrowserScrollAfterDataLoaded();}else{$.getJSON(url,function(result){var fsdata=result.panelData;if(typeof fsdata=='undefined'||fsdata==''||fsdata==null){visibleMap='bing';showVectorMap();$("#attractionList").html('');if(typeof method=='undefined'){if(recommendsubcat!="yelp"){$("#attractionCategory").hide();$("#searchBar1").hide();}}
$("#"+divMap[bucketId]+'buttonInfo').hide();$("#attractionInfo").html('<article class="info padding align-center font_18">Sorry, we do not currently have any Attractions available for this city.</article>');$("#mapOverlay").hide();}else{$("#searchBar1").show();$("#attractionCategory").show();planDataCache=fsdata;if(recommendsubcat!='yelp'){if(typeof query=='undefined'){cache[cacheKey]=fsdata;}}
$.each(fsdata,function(i,record){strReturn+='<li id="liat_'+divMap[bucketId]+i+'" onClick="javascript:openInfoDetail('+i+', '+bucketId+',1 )"><a href="javascript:;" >'+record.name+'</a></li>';});strReturn+='</ul></div><a href="javascript://" class="scrolldown">&nbsp;</a> ';document.getElementById('attractionList').innerHTML=strReturn;openInfo(0,bucketId);ResetBrowserScrollAfterDataLoaded();}});}}
function openPlanActivity(bucketId,divName,query){$("#listAttractionCategory").slideUp("fast");cityId=document.getElementById("hdnCityId").value;var cacheKey="tr_"+cityId+"_"+bucketId;var url='/html5/plan/places/city/'+cityId+'/bucket/'+bucketId;if(typeof query!='undefined'){url+='/q/'+query;}
var strReturn='';document.getElementById("activityList").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/preloader.gif" /></div>';document.getElementById("activitiesInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';strReturn+='<a href="javascript://" class="scrollup" id="prevAttract">&nbsp;</a><div id="attScrollDiv" class="pnlScrollCont"><ul id="lstActivity" class="leftList vscroll-item">';if(cache[cacheKey]&&typeof query=='undefined'){planDataCache=cache[cacheKey];$.each(planDataCache,function(i,record){strReturn+='<li id="liat_'+divMap[bucketId]+i+'"><a href="javascript:;" onClick="javascript:openInfoDetail('+i+', '+bucketId+' ,1)">'+record.name+'</a></li>';});strReturn+='</ul></div><a href="javascript://" class="scrolldown" >&nbsp;</a> ';document.getElementById('activityList').innerHTML=strReturn;openInfo(0,bucketId);}
else{$.getJSON(url,function(fsdata){fsdata=fsdata.panelData;if(typeof fsdata[0]=='undefined'||fsdata==''||fsdata==null||fsdata=='[]'){$("#activitiesInfo").html('<article class="info padding align-center font_18">Sorry, No record found for Activity!</article>');$("#mapOverlay").hide();return;}else{planDataCache=fsdata;if(typeof query=='undefined'){cache[cacheKey]=fsdata;}
$.each(fsdata,function(i,record){strReturn+='<li id="liat_'+divMap[bucketId]+i+'"><a href="javascript:;" onClick="javascript:openInfoDetail('+i+', '+bucketId+' ,1)">'+record.name+'</a></li>';});strReturn+='</ul></div><a href="javascript://" class="scrolldown">&nbsp;</a> ';document.getElementById('activityList').innerHTML=strReturn;openInfo(0,bucketId);}});}}
function getTripItem(bucketId){var tripId=document.getElementById("tripPlaceId").value;var tripPartId=document.getElementById("tripPartId").value;var recommand=0;if(typeof tripId=='undefined'){tripId=global_trip_id;}
if(tripId){if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
if(explorePanelMode=='friend'){recommand=1;}
if(typeof tripId=='undefined'){tripId=global_trip_id;}
var itemUrl='/html5/mytrip/gettripitemlist/ti/'+tripId+'/bucket/'+bucketId+'/recommand/'+recommand+'/rand/'+parseInt(Math.random()*99999999);$.getJSON(itemUrl,function(result){$("#tripItemIds").val(result.data.id);$("#tripItemSourceIds").val(result.data.sourceId);});}}
function openActRecommendation(bucketId,divName,query){$("#listActivityCategory").slideUp("fast");cityId=document.getElementById("hdnCityId").value;var cacheKey="tr_"+cityId+"_"+bucketId;var url='/html5/plan/places/city/'+cityId+'/bucket/'+bucketId;if(typeof query!='undefined'){url+='/q/'+query;}
var strReturn='';document.getElementById("activityList").innerHTML='<div style="padding:150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt=""/></div>';document.getElementById("activitiesInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';strReturn+='<a href="javascript://" class="prev-list" id="prevAttract">&nbsp;</a><div id="attScrollDiv" class="pnlScrollCont"><div id="attInnerWrapper"><ul id="lstAttract" class="leftList">';if(cache[cacheKey]&&typeof query=='undefined'){planDataCache=cache[cacheKey];$.each(planDataCache,function(i,record){strReturn+='<li id="liat_'+divMap[bucketId]+i+'"><a href="javascript:;" onClick="javascript:openInfoDetail('+i+', '+bucketId+' ,1)">'+record.name+'</a></li>';});strReturn+='</ul></div></div><a href="javascript://" class="next-list" id="nextAtt">&nbsp;</a> ';document.getElementById('activityList').innerHTML=strReturn;openInfo(0,bucketId);}
else{$.getJSON(url,function(fsdata){fsdata=fsdata.panelData
if(typeof fsdata[0]=='undefined'){alert("No matching activity found");return;}
planDataCache=fsdata;if(typeof query=='undefined'){cache[cacheKey]=fsdata;}
$.each(fsdata,function(i,record){strReturn+='<li id="liat_'+divMap[bucketId]+i+'"><a href="javascript:;" onClick="javascript:openInfoDetail('+i+', '+bucketId+' ,1)">'+record.name+'</a></li>';});strReturn+='</ul></div></div><a href="javascript://" class="next-list" id="nextAtt">&nbsp;</a> ';document.getElementById('activityList').innerHTML=strReturn;openInfo(0,bucketId);});}}
function openRestRecommendation(bucketId,divName,query,method){var panel_trip_id='';var url='';$("#resbuttonInfo").hide();$("#"+divMap[bucketId]+"BtnBTR").hide();if(global_trip_id!=''){panel_trip_id=global_trip_id;}else{panel_trip_id=$("#tripPlaceId").val();}
$("#listRestaurantCategory").slideUp("fast");cityId=document.getElementById("hdnCityId").value;$("#searchBar"+bucketId).show();var cacheKey="tr_"+cityId+"_"+bucketId;if(recommendsubcat=="yelp"){url='/html5/plan/places/city/'+cityId+'/bucket/3/catId/'+bucketId;bucketId=3;}else{url='/html5/plan/places/city/'+cityId+'/bucket/'+bucketId;}
if(typeof query!='undefined'){url+='/q/'+query;}
var strReturn='';document.getElementById("restaurantList").innerHTML='<div style="padding:150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt=""/></div>';document.getElementById("restaurantInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';strReturn+='<a href="javascript://" class="scrollup">&nbsp;</a><div class="pnlScrollCont"><ul id="restList" class="leftList vscroll-item">';if(cache[cacheKey]&&typeof query=='undefined'&&recommendsubcat!='yelp'&&global_city_panel_id!=panel_trip_id){planDataCache=cache[cacheKey];$.each(planDataCache,function(i,record){strReturn+='<li id="liat_'+divMap[bucketId]+i+'" onClick="javascript:openInfoDetail('+i+', '+bucketId+', 1)"><a href="javascript:;" >'+record.name+'</a></li>';});strReturn+='</ul></div></div><a href="javascript://" class="scrolldown">&nbsp;</a> ';document.getElementById('restaurantList').innerHTML=strReturn;openInfo(0,bucketId);ResetBrowserScrollAfterDataLoaded();}else{$.getJSON(url,function(result){var fsdata=result.panelData;if(typeof fsdata=='undefined'||fsdata==''||fsdata==null){visibleMap='bing';showVectorMap();$("#restaurantList").html('');if(typeof method=='undefined'){if(recommendsubcat!="yelp"){$("#restaurantSearchPanel").hide();$("#restaurantCategory").hide();}}
$("#restaurantInfo").html('<article class="info padding align-center font_18">Sorry, we do not currently have any Restaurants available for this city.</article>');$("#mapOverlay").hide();return;}else{$("#restaurantSearchPanel").show();$("#restaurantCategory").show();planDataCache=fsdata;if(recommendsubcat!='yelp'){if(typeof query=='undefined'){cache[cacheKey]=fsdata;}}
$.each(fsdata,function(i,record){strReturn+='<li id="liat_'+divMap[bucketId]+i+'" onClick="javascript:openInfoDetail('+i+', '+bucketId+',1 )"><a href="javascript:;" >'+record.name+'</a></li>';});strReturn+='</ul></div><a href="javascript://" class="scrolldown">&nbsp;</a> ';document.getElementById('restaurantList').innerHTML=strReturn;openInfo(0,bucketId);ResetBrowserScrollAfterDataLoaded();}});}}
function openNightRecommendation(bucketId,divName,query,method){var panel_trip_id='';var url='';$("#nightbuttonInfo").hide();$("#"+divMap[bucketId]+"BtnBTR").hide();if(global_trip_id!=''){panel_trip_id=global_trip_id;}else{panel_trip_id=$("#tripPlaceId").val();}
$("#listNightlifeCategory").slideUp("fast");cityId=document.getElementById("hdnCityId").value;var cacheKey="tr_"+cityId+"_"+bucketId;if(recommendsubcat=="yelp"){url='/html5/plan/places/city/'+cityId+'/bucket/4/catId/'+bucketId;bucketId=4;}else{url='/html5/plan/places/city/'+cityId+'/bucket/'+bucketId;}
if(typeof query!='undefined'){url+='/q/'+query;}
var strReturn='';document.getElementById("nightlifeList").innerHTML='<div style="padding:150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt=""/></div>';document.getElementById("nightlifeInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';strReturn+='<a href="javascript://" class="scrollup">&nbsp;</a><div class="pnlScrollCont"><ul id="lstNight" class="leftList vscroll-item">';if(cache[cacheKey]&&typeof query=='undefined'&&global_city_panel_id!=panel_trip_id){planDataCache=cache[cacheKey];$.each(planDataCache,function(i,record){strReturn+='<li id="liat_'+divMap[bucketId]+i+'" onClick="javascript:openInfoDetail('+i+', '+bucketId+',1 )"><a href="javascript:;" >'+record.name+'</a></li>';});strReturn+='</ul></div><a href="javascript://" class="scrolldown">&nbsp;</a> ';document.getElementById('nightlifeList').innerHTML=strReturn;openInfo(0,bucketId);ResetBrowserScrollAfterDataLoaded();}else{$.getJSON(url,function(result){var fsdata=result.panelData;if(typeof fsdata=='undefined'||fsdata==''||fsdata==null){visibleMap='bing';showVectorMap();$("#nightlifeList").html('');if(typeof method=='undefined'){if(recommendsubcat!="yelp"){$("#nightlifeSearchPanel").hide();$("#nightlifeCategory").hide();}}
$("#nightlifeInfo").html('<article class="info padding align-center font_18">Sorry, we do not currently have any Nightlife available for this city.</article>');$("#mapOverlay").hide();return;}
$("#nightlifeSearchPanel").show();$("#nightlifeCategory").show();planDataCache=fsdata;if(recommendsubcat!='yelp'){if(typeof query=='undefined'){cache[cacheKey]=fsdata;}}
$.each(fsdata,function(i,record){strReturn+='<li id="liat_'+divMap[bucketId]+i+'" onClick="javascript:openInfoDetail('+i+', '+bucketId+' ,1)"><a href="javascript:;" >'+record.name+'</a></li>';});strReturn+='</ul></div><a href="javascript://" class="scrolldown">&nbsp;</a> ';document.getElementById('nightlifeList').innerHTML=strReturn;openInfo(0,bucketId);ResetBrowserScrollAfterDataLoaded();});}}
function openInfo(i,bucketId){var sourceIds=$("#tripItemSourceIds").val();var userSourceIds=$("#userItemSourceIds").val();var sourceIdArray=sourceIds.split(',');var userSourceIdArray=userSourceIds.split(',');switch(divMap[bucketId]){case"attraction":attractionPlaces=planDataCache;attractionbucketId=bucketId;break;case"restaurant":restaurantPlaces=planDataCache;restaurantbucketId=bucketId;break;case"activities":activitiesPlaces=planDataCache;activitiesbucketId=bucketId;break;case"nightlife":nightlifePlaces=planDataCache;nightlifebucketId=bucketId;break;case"shopping":shoppingPlaces=planDataCache;shoppingbucketId=bucketId;break;}
$("#"+divMap[bucketId]+'Info').show();$("#"+divMap[bucketId]+"Details").hide();stext='';openEntityRequestId=false;var cCtr=1;var gCtr=1;var addToTripText=explorePanelMode=='friend'?'Recommend':'Add to Trip';var removeFromTripText=explorePanelMode=='friend'?'Recommended':'Remove';var addToTripFlag=explorePanelMode=='friend'?'friend':'grid';tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
var recordExist=false;$.each(planDataCache,function(i,record){if((record.name==null)||(record.name=='')){return;}else{recordExist=true;}
if(cCtr>chkCol){cCtr=1;gCtr++;}
if(selectedEntityId){if(record.id==selectedEntityId){openEntityRequestId=i;selectedEntityId=false;}}
var detailText="";if(record.smallPhotoUrl==null||record.smallPhotoUrl==""){return true;}
detailText+='<article class="content" style="min-height:100px">';detailText+='<a href="javascript:;" onClick="javascript:openInfoDetail('+i+', '+bucketId+' )"><img src="'+record.smallPhotoUrl+'" class="thumb lazyloading" width="100" height="100" onError="this.src=\''+defaultImage[bucketId]+'\'"  /></a>';var poinamelen='';var showTitle=false;record.name=record.name.toString();if(record.name.length>16){poinamelen=record.name.substring(0,16)+"...";showTitle=true;}else{poinamelen=record.name;showTitle=false;}
var blockId='grid_'+i+'_'+bucketId;if(showTitle){detailText+='<p id="'+blockId+'"><span class="attrName"><a href="javascript:;" onClick="javascript:openInfoDetail('+i+', '+bucketId+' )" title="'+record.name+'">'+poinamelen+'</a></span>';}else{detailText+='<p id="'+blockId+'"><span class="attrName"><a href="javascript:;" onClick="javascript:openInfoDetail('+i+', '+bucketId+' )">'+poinamelen+'</a></span>';}
if(record.address1!=null){detailText+='<span>'+record.address1;}
if(record.address2!=null){if(record.address1!=null){detailText+=', '+record.address2;}else{detailText+=record.address2;}}
if(record.postalCode!=null){detailText+=', '+record.postalCode;}
detailText+='</span>';if(record.formattedPhone!=null){detailText+='<span>'+record.formattedPhone+'</span>';}
if(record.website!=null){}
var chkCount=0;if(record.checkinCount){chkCount=addCommas(record.checkinCount);}
var tipCount=0;if(record.tipCount){tipCount=addCommas(record.tipCount);}
if(tipCount=='1'||tipCount=='0'){detailText+='<span class="bg_gray rounded marginT10"><nobr><a href="http://foursquare.com/" target="_blank"><img src="/images/poweredByFoursquare_16x16.png" align="absmiddle" /></a> '+chkCount+' Checkins &bull; '+tipCount+' Tip</nobr></span>';}
else{detailText+='<span class="bg_gray rounded marginT10"><nobr><a href="http://foursquare.com/" target="_blank"><img src="/images/poweredByFoursquare_16x16.png" align="absmiddle" /></a> '+chkCount+' Checkins &bull; '+tipCount+' Tips</nobr></span>';}
detailText+='</article>';detailText+='<article class="actionbuttons">';if(!(pastTrip&&explorePanelMode=='friend')){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,record.originId);if(itemExist!=-1&&itemsStatusArray[itemExist]=='yes_'+bucketId&&explorePanelMode=='friend'){gridId=replaceString(record.originId)+'_'+bucketId;detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Already added to trip</span>';detailText+='</p>';}else if(sourceIdArray!=''||userSourceIdArray!=''){var isExists=inArrayJS(record.originId+'_'+bucketId,sourceIdArray);if(isExists==true){if(explorePanelMode=='friend'){var foruserExist=inArrayJS(record.originId+'_'+bucketId,userSourceIdArray);gridId=replaceString(record.originId)+'_'+bucketId;if(foruserExist==true){detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended by friends and You</span>';}else{detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended by friends</span>';detailText+='<span id="gridBtn_frnd_'+gridId+'" class="fl"><a class="btnIconAdd blue_link" onClick="assignTripItemData(\'poi\', '+i+'); addItemToTrip('+bucketId+', \'3\', \''+record.originId+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" href="javascript:void(0);">I Recommend</a></span>';}}else{gridId=replaceString(record.originId)+'_'+bucketId;detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="removeFromTrip('+bucketId+', \'3\', \''+record.originId+'\', \''+addToTripFlag+'\',\''+i+'\')" class="btnIconRemove font_13">'+removeFromTripText+'</a></span>';}}else{if(explorePanelMode=='friend'){var foruserExist=inArrayJS(record.originId+'_'+bucketId,userSourceIdArray);gridId=replaceString(record.originId)+'_'+bucketId;if(foruserExist==true){detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended</span></p>';}else{detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="assignTripItemData(\'poi\', '+i+'); addItemToTrip('+bucketId+', \'3\', \''+record.originId+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link">'+addToTripText+'</a></span>';}}else{gridId=replaceString(record.originId)+'_'+bucketId;detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="assignTripItemData(\'poi\', '+i+'); addItemToTrip('+bucketId+', \'3\', \''+record.originId+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link">'+addToTripText+'</a></span>';}}}else{gridId=replaceString(record.originId)+'_'+bucketId;detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="assignTripItemData(\'poi\', '+i+'); addItemToTrip('+bucketId+', \'3\', \''+record.originId+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link">'+addToTripText+'</a></span>';}}
detailText+='<div class="clearfloat" /></article>';stext+='<section class="'+divMap[bucketId]+'g'+gCtr+'">'+detailText+'</section>';cCtr++;});if(recordExist==true){if($('#cattraction').hasClass('current')&&bucketId==1){plotRecommendedDataOnBingMap(planDataCache,bucketId);}else if($('#crestaurant').hasClass('current')&&bucketId==3){plotRecommendedDataOnBingMap(planDataCache,bucketId);}else if($('#cnightlife').hasClass('current')&&bucketId==4){plotRecommendedDataOnBingMap(planDataCache,bucketId);}else if($('#cshopping').hasClass('current')&&bucketId==6){plotRecommendedDataOnBingMap(planDataCache,bucketId);}
document.getElementById(divMap[bucketId]+'Info').innerHTML='<div class="top25">'+stext+'</div>';}else{visibleMap='bing';showVectorMap();$("#"+divMap[bucketId]+"Category").hide();$("#searchBar"+bucketId).hide();$("#"+divMap[bucketId]+'buttonInfo').hide();$("#"+divMap[bucketId]+"Info").html('<article class="info padding align-center font_18">Sorry, we do not currently have any '+getPanelByBucketId(bucketId)+' available for this city.</article>');$("#mapOverlay").hide();}
for(i=1;i<=gCtr;i++){$('.'+divMap[bucketId]+'g'+i).equalizeHeights();}
$("img.lazyloading").lazyload({placeholder:"/images/media-load.gif",effect:"fadeIn",threshold:400,imgonerror:defaultImage[bucketId]});if(openEntityRequestId!==false){openInfoDetail(openEntityRequestId,bucketId);}}
$.fn.equalizeHeights=function(){var maxHeight=this.map(function(i,e){if($('.content',e).height()!=0){return $('.content',e).height();}else{return $('.content',e).actual('height');}}).get();return $('.content',this).height(Math.max.apply(this,maxHeight));};$.fn.equalizeBRHeights=function(){var maxHeight=this.map(function(i,e){if($(e).height()!=0){return $(e).height();}else{return $(e).actual('height');}}).get();return $(this).height(Math.max.apply(this,maxHeight));};function bingAddToTrip(i,bucketId){var source="3";tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/html5/trip/checkexistance/source/'+source+'/tripPartId/'+tripPartId+'/sourceId/'+planDataCache[i].originId+'/categoryId/'+bucketId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){strButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="assignTripItemData(\'poi\', '+i+');addItemToTrip(\''+bucketId+'\', '+source+', \''+planDataCache[i].originId+'\', \'bing\',\'\',\''+i+'\')"> Add to Trip</a>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}else{strButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="removeFromTrip(\''+bucketId+'\', '+source+', \''+planDataCache[i].originId+'\', \'bing\',\''+i+'\')"> Remove</a>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}});}
function bingRecommendThisTrip(i,bucketId){var sourceIds=$("#tripItemSourceIds").val();var userSourceIds=$("#userItemSourceIds").val();var sourceIdArray=sourceIds.split(',');var userSourceIdArray=userSourceIds.split(',');tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
if(topRecommendation==true){var source="3";var sourceId=planDataCache[i].originId;}
else{var source="1";var sourceId=planDataCache[i].originId;}
url='/html5/trip/checkexistance/source/'+source+'/tripPartId/'+tripPartId+'/sourceId/'+sourceId+'/categoryId/'+bucketId+'/recommend/1/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,sourceId);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_'+bucketId){strButton='<a class="btnIconAdd font_13" onclick="assignTripItemData(\'poi\', '+i+');addItemToTrip(\''+planDataCache[i].categoryId+'\', '+source+', \''+sourceId+'\', \'bing\',\'\',\''+i+'\')">Recommend</a>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}
else{strButton='<span class="font_11 highlight fl">Already added to trip</span>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}}else{var isExists=inArrayJS(sourceId+'_'+bucketId,sourceIdArray);var foruserExist=inArrayJS(sourceId+'_'+bucketId,userSourceIdArray);if(isExists==true&&foruserExist==true){strButton='<span class="font_11 highlight fl">Recommended by friends and You</span>';}else if(isExists==true){strButton='<span id="bing_friend_button" class="fl"><input class="view" type="button" value="I Recommend" onclick="assignTripItemData(\'poi\', '+i+');addItemToTrip(\''+planDataCache[i].categoryId+'\', '+source+', \''+sourceId+'\', \'bing\',\'\',\''+i+'\')"/>';strButton+='<br/><span class="font_11 highlight fl">Recommended by friends</span></span>';}else{strButton='<span class="font_11 highlight fl">Recommended</span>';}
document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}});}
function bingRemoveFromTrip(i,bucketId){switch(bucketId){case 1:case 3:case 4:case 6:case 8:if(topRecommendation==true){var source="foursquare";}else{var source="yelp";}
removetoBingMapAttraction(source,planDataCache[i].id,addslashes(planDataCache[i].name),addslashes(planDataCache[i].address1),planDataCache[i].website,planDataCache[i].formattedPhone);break;}}
function bingRecommendThisEvent(i){var sourceIds=$("#tripItemSourceIds").val();var userSourceIds=$("#userItemSourceIds").val();var sourceIdArray=sourceIds.split(',');var userSourceIdArray=userSourceIds.split(',');if(eventfilterdate){cacheDetailEntityData=eventsCacheDatafilter;if(cacheDetailEntityData.total_items==1){var event=eventsCacheDatafilter.events.event;}else{var event=eventsCacheDatafilter.events.event[i];}}else{cacheDetailEntityData=eventsCacheData;if(cacheDetailEntityData.total_items==1){var event=eventsCacheData.events.event;}else{var event=eventsCacheData.events.event[i];}}
var eid=event['@attributes'].id;if(typeof(event.image.medium)!='undefined'){oldImageUrl=event.image.medium.url;var NewImageUrl=oldImageUrl.replace("medium","large");}
tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
if(topRecommendation==true){var source="5";}else{var source="5";}
url='/html5/trip/checkeventexistance/source/'+source+'/tripPartId/'+tripPartId+'/apiId/'+eid+'/recommend/1/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){document.getElementById('bing_map_add_to_trip').innerHTML='';$("#trip_part_response").val(result);if(result==1){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,eid);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_12'){strButton='<a class="btnIconAdd font_13" onclick="assignTripItemData(\'event\', '+i+');addItemToTrip(12,5,\''+eid+'\', \'bing\',\'\',\''+i+'\')">Recommend </a>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}else{strButton='<span class="font_11 highlight fl">Already added to trip</span>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}}else{var isExists=inArrayJS(eid+'_12',sourceIdArray);var foruserExist=inArrayJS(eid+'_12',userSourceIdArray);if(isExists==true&&foruserExist==true){strButton='<span class="font_11 highlight fl">Recommended by friends and You</span>';}else if(isExists==true){strButton='<span id="bing_friend_button" class="fl"><input class="view" type="button" value="I Recommend" onclick="assignTripItemData(\'event\', '+i+');addItemToTrip(\'12\', \'5\',\''+eid+'\', \'bing\',\'\',\''+i+'\')"/>';strButton+='<br/><span class="font_11 highlight fl">Recommended by friends</span></span>';}else{strButton='<span class="font_11 highlight fl">Recommended</span>';}
document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}});}
function bingAddToTripEvent(i){if(eventfilterdate){cacheDetailEntityData=eventsCacheDatafilter;if(cacheDetailEntityData.total_items==1){var event=eventsCacheDatafilter.events.event;}else{var event=eventsCacheDatafilter.events.event[i];}}else{cacheDetailEntityData=eventsCacheData;if(cacheDetailEntityData.total_items==1){var event=eventsCacheData.events.event;}else{var event=eventsCacheData.events.event[i];}}
var eid=event['@attributes'].id;if(typeof(event.image.medium)!='undefined'){oldImageUrl=event.image.medium.url;var NewImageUrl=oldImageUrl.replace("medium","large");}
tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
if(topRecommendation==true){var source="5";}else{var source="5";}
url='/html5/trip/checkeventexistance/source/'+source+'/tripPartId/'+tripPartId+'/apiId/'+eid+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){document.getElementById('bing_map_add_to_trip').innerHTML='';$("#trip_part_response").val(result);if(result==1){strButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="assignTripItemData(\'event\', '+i+');addItemToTrip(12,5,\''+eid+'\', \'bing\', \'\', '+i+')"> Add to Trip</a>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}else{strButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="removeFromTrip(12,5,\''+eid+'\', \'bing\', '+i+')"> Remove</a>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}});}
function bingRecommendHotel(i,hotelId){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
if(topRecommendation==true){var source="6";}else{var source="6";}
url='/html5/trip/checkeventexistance/source/'+source+'/tripPartId/'+tripPartId+'/apiId/'+hotelId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){document.getElementById('bing_map_add_to_trip').innerHTML='';$("#trip_part_response").val(result);if(result==1){strButton='<input class="btnIconAdd font_13" onclick="assignTripItemData(\'hotel\', '+i+');addItemToTrip(11,6,\''+hotelId+'\', \'bing\',\'\',\''+i+'\')">Recommend </a>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}else{strButton='<span class="font_11">Recommended</span>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}});}
function bingAddToTripHotel(i,hotelId){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
if(topRecommendation==true){var source="6";}else{var source="6";}
url='/html5/trip/checkexistance/source/'+source+'/tripPartId/'+tripPartId+'/sourceId/'+hotelId+'/categoryId/11/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){document.getElementById('bing_map_add_to_trip').innerHTML='';$("#trip_part_response").val(result);if(result==1){strButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="assignTripItemData(\'hotel\', '+i+');addItemToTrip(11,6,\''+hotelId+'\', \'bing\',\'\',\''+i+'\')"> Add to Trip</a>'
document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}else{strButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="removeFromTrip(11,6,\''+hotelId+'\', \'bing\',\''+i+'\')"> Remove</a>'
document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}});}
function bingAddToTripHostel(i,hostelId){var sourceIds=$("#tripItemSourceIds").val();var userSourceIds=$("#userItemSourceIds").val();var sourceIdArray=sourceIds.split(',');var userSourceIdArray=userSourceIds.split(',');tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
if(topRecommendation==true){var source="7";}else{var source="7";}
if(explorePanelMode!='friend'){url='/html5/trip/checkexistance/source/'+source+'/tripPartId/'+tripPartId+'/sourceId/'+hostelId+'/categoryId/16/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){document.getElementById('bing_map_add_to_trip').innerHTML='';$("#trip_part_response").val(result);if(result==1){strButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="assignTripItemData(\'hostel\', '+i+');addItemToTrip(16,7,\''+hostelId+'\', \'bing\',\'\',\''+i+'\')"> Add to Trip</a>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}
else{strButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="removeFromTrip(16,7,\''+hostelId+'\', \'bing\',\''+i+'\')"> Remove</a>'
document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}});}
else{url='/html5/trip/checkexistance/source/'+source+'/tripPartId/'+tripPartId+'/sourceId/'+hostelId+'/categoryId/16/recommend/1/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){document.getElementById('bing_map_add_to_trip').innerHTML='';$("#trip_part_response").val(result);if(result==1){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,hostelId);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_16'){strButton='<a class="btnIconAdd font_13" onclick="assignTripItemData(\'hostel\', '+i+');addItemToTrip(16,7,\''+hostelId+'\', \'bing\',\'\',\''+i+'\')">Recommend </a>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}else{strButton='<span class="font_11 highlight fl">Already added to trip</span>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}}
else{var isExists=inArrayJS(hostelId+'_16',sourceIdArray);var foruserExist=inArrayJS(hostelId+'_16',userSourceIdArray);if(isExists==true&&foruserExist==true){strButton='<span class="font_11 highlight fl">Recommended by friends and You</span>';}else if(isExists==true){strButton='<span id="bing_friend_button" class="fl"><input class="view" type="button" value="I Recommend" onclick="assignTripItemData(\'hostel\', '+i+');addItemToTrip(\'16\', '+source+', \''+hostelId+'\', \'bing\',\'\',\''+i+'\')"/>';strButton+='<span class="font_11 highlight fl">Recommended by friends</span></span>';}else{strButton='<span class="font_11 highlight fl">Recommended</span>';}
document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}});}}
function bingRecommendThisHotel(i,hotelId){var sourceIds=$("#tripItemSourceIds").val();var userSourceIds=$("#userItemSourceIds").val();var sourceIdArray=sourceIds.split(',');var userSourceIdArray=userSourceIds.split(',');tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
if(topRecommendation==true){var source="6";}else{var source="6";}
url='/html5/trip/checkexistance/source/'+source+'/tripPartId/'+tripPartId+'/sourceId/'+hotelId+'/categoryId/11/recommend/1/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){document.getElementById('bing_map_add_to_trip').innerHTML='';$("#trip_part_response").val(result);if(result==1){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,hotelId);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_11'){strButton='<a class="btnIconAdd font_13" onclick="assignTripItemData(\'hotel\', '+i+');addItemToTrip(11,6,\''+hotelId+'\', \'bing\',\'\',\''+i+'\')">Recommend</a>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}else{strButton='<span class="font_11 highlight fl">Already added to trip</span>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}}else{var isExists=inArrayJS(hotelId+'_11',sourceIdArray);var foruserExist=inArrayJS(hotelId+'_11',userSourceIdArray);if(isExists==true&&foruserExist==true){strButton='<span class="font_11 highlight fl">Recommended by friends and You</span>';}else if(isExists==true){strButton='<span id="bing_friend_button" class="fl"><input class="view" type="button" value="I Recommend" onclick="assignTripItemData(\'hotel\', '+i+');addItemToTrip(\'11\', '+source+', \''+hotelId+'\', \'bing\',\'\',\''+i+'\')"/>';strButton+='<br/><span class="font_11 highlight fl">Recommended by friends</span></span>';}else{strButton='<span class="font_11 highlight fl">Recommended</span>';}
document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}});}
function bingRecommendThisDeal(i,productId){var sourceIds=$("#tripItemSourceIds").val();var userSourceIds=$("#userItemSourceIds").val();var sourceIdArray=sourceIds.split(',');var userSourceIdArray=userSourceIds.split(',');tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
if(topRecommendation==true){var source="4";}else{var source="4";}
url='/html5/trip/checkeventexistance/source/'+source+'/tripPartId/'+tripPartId+'/apiId/'+productId+'/recommend/1/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){document.getElementById('bing_map_add_to_trip').innerHTML='';$("#trip_part_response").val(result);if(result==1){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,productId);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_13'){strButton='<a class="btnIconAdd font_13" onclick="assignTripItemData(\'deal\', '+i+');addItemToTrip(13,4,\''+productId+'\', \'bing\',\'\',\''+i+'\')">Recommend</a>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}else{strButton='<span class="font_11 highlight fl">Already added to trip</span>';document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}}else{var isExists=inArrayJS(productId+'_13',sourceIdArray);var foruserExist=inArrayJS(productId+'_13',userSourceIdArray);if(isExists==true&&foruserExist==true){strButton='<span class="font_11 highlight fl">Recommended by friends and You</span>';}else if(isExists==true){strButton='<span id="bing_friend_button" class="fl"><input class="view" type="button" value="I Recommend" onclick="assignTripItemData(\'deal\', '+i+');addItemToTrip(\'13\', '+source+', \''+productId+'\', \'bing\',\'\',\''+i+'\')"/>';strButton+='<br/><span class="font_11 highlight fl">Recommended by friends</span></span>';}else{strButton='<span class="font_11 highlight fl">Recommended</span>';}
document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}});}
function bingAddToTripDeal(i,productId){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
if(topRecommendation==true){var source="4";}else{var source="4";}
url='/html5/trip/checkeventexistance/source/'+source+'/tripPartId/'+tripPartId+'/apiId/'+productId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){document.getElementById('bing_map_add_to_trip').innerHTML='';$("#trip_part_response").val(result);if(result==1){strButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="assignTripItemData(\'deal\', '+i+');addItemToTrip(13,4,\''+productId+'\', \'bing\',\'\',\''+i+'\')"> Add to Trip</a>'
document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}else{strButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="removeFromTrip(13,4,\''+productId+'\', \'bing\',\'\',\''+i+'\')"> Remove</a>'
document.getElementById('bing_map_add_to_trip').innerHTML=strButton;}});}
function addtoBingMapEvent(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/html5/trip/addevent/tripPartId/'+tripPartId+'/apiid/'+apiid+'/source/'+source+'/title/'+title+'/address/'+address+'/imgurl/'+imgurl+'/phone/'+phone+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){alert(data);return false;});strButton='<input class="view" style="cursor:pointer;" type="button" value="Remove" onclick="removetoBingMapEvent(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+addslashes(address)+'\',\''+imgurl+'\',\''+phone+'\')"/>';document.getElementById("bing_map_add_to_trip_event").innerHTML=strButton;}
function removetoBingMapEvent(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/html5/trip/removeevent/tripPartId/'+tripPartId+'/apiid/'+apiid+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){(data);return false;});strButton='<input class="view" style="cursor:pointer;" type="button" value="Add to Trip" onclick="addtoBingMapEvent(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+addslashes(address)+'\',\''+imgurl+'\',\''+phone+'\')"/>';document.getElementById("bing_map_add_to_trip_event").innerHTML=strButton;}
function backToGrid(bucketId){if(bucketId!=''){switch(bucketId){case 1:openInfo(0,bucketId);$("#searchBar"+bucketId).show();$('#logo'+divMap[bucketId]).show();$("#"+divMap[bucketId]+"Info").show();reEqualize(divMap[bucketId]);$("#"+divMap[bucketId]+"Details").hide();$("#"+divMap[bucketId]+" .list").hide();$("#"+divMap[bucketId]+"BtnBTR").hide();$("#"+divMap[bucketId]+" .list .vscroll-item").css('top','0px');$("#"+recommandAddbtn[bucketId]+"buttonInfo").hide();createHashURLTitle("Plan",activeExploreTab);hashPushState(hashLocationString,hashPageTitle);break;case 3:openInfo(0,bucketId);$("#searchBar"+bucketId).show();$('#logo'+divMap[bucketId]).show();$("#"+divMap[bucketId]+"Info").show();reEqualize(divMap[bucketId]);$("#"+divMap[bucketId]+"Details").hide();$("#"+divMap[bucketId]+" .list").hide();$("#"+divMap[bucketId]+"BtnBTR").hide();$("#"+divMap[bucketId]+" .list .vscroll-item").css('top','0px');$("#"+recommandAddbtn[bucketId]+"buttonInfo").hide();createHashURLTitle("Plan",activeExploreTab);hashPushState(hashLocationString,hashPageTitle);break;case 4:openInfo(0,bucketId);$("#searchBar"+bucketId).show();$('#logo'+divMap[bucketId]).show();$("#"+divMap[bucketId]+"Info").show();reEqualize(divMap[bucketId]);$("#"+divMap[bucketId]+"Details").hide();$("#"+divMap[bucketId]+" .list").hide();$("#"+divMap[bucketId]+"BtnBTR").hide();$("#"+divMap[bucketId]+" .list .vscroll-item").css('top','0px');$("#"+recommandAddbtn[bucketId]+"buttonInfo").hide();createHashURLTitle("Plan",activeExploreTab);hashPushState(hashLocationString,hashPageTitle);break;case 6:openInfo(0,bucketId);$("#searchBar"+bucketId).show();$('#logo'+divMap[bucketId]).show();$("#"+divMap[bucketId]+"Info").show();reEqualize(divMap[bucketId]);$("#"+divMap[bucketId]+"Details").hide();$("#"+divMap[bucketId]+" .list").hide();$("#"+divMap[bucketId]+"BtnBTR").hide();$("#"+divMap[bucketId]+" .list .vscroll-item").css('top','0px');$("#"+recommandAddbtn[bucketId]+"buttonInfo").hide();createHashURLTitle("Plan",activeExploreTab);hashPushState(hashLocationString,hashPageTitle);break;case 8:$("#searchBar"+bucketId).show();$("#"+divMap[bucketId]+"Info").show();reEqualize(divMap[bucketId]);$("#"+divMap[bucketId]+"Details").hide();$("#"+divMap[bucketId]+" .list").hide();$("#"+divMap[bucketId]+"BtnBTR").hide();$("#"+divMap[bucketId]+" .list .vscroll-item").css('top','0px');$("#"+recommandAddbtn[bucketId]+"buttonInfo").hide();createHashURLTitle("Plan",activeExploreTab);hashPushState(hashLocationString,hashPageTitle);break;case 12:if(eventfilterdate==""){category=document.getElementById("hdneventcat").value;categoryN=document.getElementById("hdneventname").value;if(category==''){openEventTabCategory('','Top Recommendations');}else{openEventTabCategory(category,categoryN);}}else{openEventTabCategory('','Top Recommendations',eventfilterdate);}
$("#eventbuttonInfo").hide();$('#logoevents').show();$('#filterEvents').css("margin-left","17px");$("#pevent_filter").show();createHashURLTitle("Plan",activeExploreTab);hashPushState(hashLocationString,hashPageTitle);break;case 13:$("#dealsInfo").show();reEqualize('dealsInfo');$("#searchBar13").show();$("#dealsDetails").hide();$("#deals .list").hide();$("#dealsBtnBTR").hide();$("#deals .list .vscroll-item").css('top','0px');$("#dealbuttonInfo").hide();plotDealDataOnBingMap(dealsPlaces);createHashURLTitle("Plan",activeExploreTab);hashPushState(hashLocationString,hashPageTitle);break;case 11:$("#hotelInfo").show();reEqualize('hotelInfo');$("#hotelDetails").hide();$("#hotel .list").hide();$("#hotelBtnBTR").hide();$("#searchFilters").show();$("#hotel .list .vscroll-item").css('top','0px');$("#hotelBtnBTR").hide();$("#hotelbuttonInfo").hide();plotHotelDataOnBingMap(hotelPlaces);createHashURLTitle("Plan",activeExploreTab);hashPushState(hashLocationString,hashPageTitle);break;case 16:$("#hostelInfo").show();$("#plan-hostelSorting").show();reEqualize('hostelInfo');$("#hostelDetails").hide();$("#planHostelBtnBTR").hide();$("#phostel .list").hide();$("#phostel .list .vscroll-item").css('top','0px');$("#hostelbuttonInfo").hide();plotHostelDataOnBingMapNew(phostelPlaces);createHashURLTitle("Plan",activeExploreTab);hashPushState(hashLocationString,hashPageTitle);break;}}}
var arraypoi=new Array();arraypoi[1]='';arraypoi[3]='';arraypoi[4]='';arraypoi[6]='';function openInfoDetail(i,bucketId,calledFrom){cityInfoTopItemCalled=false;arraypoi[bucketId]=i;if(bucketId==6){$("#shoppingList").show();}
if(bucketId==4){$(".reviewFooter").show();}
btnFlag=true;$('#cityInfoScreen').show();$('#logo'+divMap[bucketId]).hide();cacheDetailEntityData=planDataCache[i];$("#"+divMap[bucketId]+" .list").show();if($("#"+divMap[bucketId]+" .list .vscroll-item").hasClass('scrolling')){}else{$("#"+divMap[bucketId]+" .list .vscroll-item").addClass('scrolling');scrollDiv(divMap[bucketId]+" .list");}
$("#"+divMap[bucketId]+"BtnBTR").show();$("#searchBar"+bucketId).hide();$("#"+divMap[bucketId]+"img.itemPic").attr('src','/images/loading.gif');$("#"+divMap[bucketId]+" .list li").removeClass('current');$('#liat_'+divMap[bucketId]+i).addClass('current');var scrolDvHeight=$("#"+divMap[bucketId]+" .pnlScrollCont").height();var AChildPos=$('#liat_'+divMap[bucketId]+i).position();var leftListHeight=$("#"+divMap[bucketId]+" .vscroll-item").height();if(typeof calledFrom=='undefined'){if(AChildPos){if(scrolDvHeight<AChildPos.top){if(leftListHeight-AChildPos.top<scrolDvHeight){$("#"+divMap[bucketId]+" .vscroll-item").css('top',scrolDvHeight-leftListHeight);$("#"+divMap[bucketId]+" .scrollup").css('visibility','visible');$("#"+divMap[bucketId]+" .scrolldown").css('visibility','hidden');}else{$("#"+divMap[bucketId]+" .vscroll-item").css('top',-1*Number(AChildPos.top));$("#"+divMap[bucketId]+" .scrollup").css('visibility','visible');}}}}
$("#"+divMap[bucketId]+"Info").hide();$("#"+divMap[bucketId]+"Details").show();$("#bing_attraction_info").hide('fade',500);var chkCount=0;var mapbucket="map"+bucketId;if(planDataCache.length>i)
if(planDataCache[i]!='undefined')
if(planDataCache[i].checkinCount!='undefined')
chkCount=addCommas(planDataCache[i].checkinCount);hashVenueId=i+'/'+planDataCache[i].id;hashVenueDetail=hashVenueId+"/"+planDataCache[i].name;createHashURLTitle(bucketId,hashVenueDetail);hashPushState(hashLocationString,hashPageTitle);detailText=''
detailText+='<div class="itemDetails"><div style="display:table-row;">';detailText+='<div style="margin-bottom:20px;">';detailText+='<article class="fr font_12 shadow_inside_left" style="display:inline-block; width:46%">';chkCount=0;var categories=planDataCache[i].categories.split(",");if(planDataCache.length>i)
if(planDataCache[i]!='undefined')
if(planDataCache[i].checkinCount!='undefined')
chkCount=addCommas(planDataCache[i].checkinCount);if(planDataCache[i].tipCount=='1'||planDataCache[i].tipCount=='0'){detailText+='<div style="display:inline-block; width:100%;"><span class="bg_gray fr" style="padding-bottom: 10px;"><div class="fl">'+chkCount+' Checkins &bull; '+planDataCache[i].tipCount+' Tip </div><img class="fr marginL10" width="16" height="16" src="/images/poweredByFoursquare_16x16.png"></span></div>';}
else{detailText+='<div style="display:inline-block; width:100%;"><span class="bg_gray fr" style="padding-bottom: 10px;"><div class="fl">'+chkCount+' Checkins &bull; '+planDataCache[i].tipCount+' Tips </div><img class="fr marginL10" width="16" height="16" src="/images/poweredByFoursquare_16x16.png"></span></div>';}
if(planDataCache[i].categories!='undefined'&&planDataCache[i].categories!=""&&planDataCache[i].categories!=null){detailText+='<br/><span  class="fr" style="display:inline-block;">';for(var categoryloop=0;categoryloop<categories.length;categoryloop++){detailText+='<strong style="color:#5487BA; font-size:11px;"  class="item-categoryName fr">&nbsp;'+categories[categoryloop]+'&nbsp;</strong>';}
detailText+='</span>';}
detailText+='</article>';detailText+='<div class="infoText"><span class="attrName">'+planDataCache[i].name+'</span><br>';detailText+='<div id="yelprating_'+bucketId+'"></div>';detailText+='<div class="connectComunity">';detailText+='</div>';detailText+='<span class="add_to_trip_button" id="detail_top_btn_'+planDataCache[i].originId+'_'+bucketId+'"></span></div>';detailText+='</div>';detailText+='<div style="margin-bottom:20px;">';detailText+='<div style="width:415px; float:left; margin-right:20px;">';detailText+='<div id="filmstripHeroImg" class="attractionImg"><img id="itemPicID'+planDataCache[i].originId+'" style="background:none;" class="itemPic" src="/images/clear.gif" onError="this.src=\''+defaultImage[bucketId]+'\'"/></div>';detailText+='<div style="width:415px; position:relative; margin-left:0px; float:left" class="imageScrollerContARNS">';detailText+='<div class="hotelImgThumb detailslist thumbImgs loading_42x42">';detailText+='<div class="pnlScrollCont"><ul class="vscroll-item">';detailText+='</ul><div class="clearfloat"></div></div>';detailText+='</div>';detailText+='</div>';detailText+='</div>';detailText+='<div class="cityMap"><div id="'+mapbucket+'" class="detailMap"></div>';if(explorePanelMode=='friend'){getRecommandButtonCode(bucketId,i);}else{getAddToTripButtonCode(bucketId,i);globalItemId=i;}
detailText+='<div class="attractionAddress fl">';detailText+='<ul><li>';if(planDataCache[i].address1!=null)
{detailText+=planDataCache[i].address1;}
if(planDataCache[i].address2!=null)
{if(planDataCache[i].address1!=null){detailText+=', '+planDataCache[i].address2;}
else{detailText+=planDataCache[i].address2;}}
if(planDataCache[i].postalCode!=null)
{if(planDataCache[i].address1!=null||planDataCache[i].address2!=null){detailText+=', '+planDataCache[i].postalCode;}else{detailText+=planDataCache[i].postalCode;}}
detailText+='</li></ul>';detailText+='<br /><div id="contact_details" style="color:#72adda; word-break:break-all;">';if(planDataCache[i].formattedPhone!=null)
{detailText+='<span class="marginR10">'+planDataCache[i].formattedPhone+'</span>'}
if(planDataCache[i].twitterHandle){detailText+='<span class="marginR10"><a style="color:#72adda" href="http://twitter.com/'+planDataCache[i].twitterHandle+'" target="_blank">@'+planDataCache[i].twitterHandle+'</a></span>';}
if(planDataCache[i].website){detailText+='<span><a style="color:#72adda" href="'+planDataCache[i].website+'" target="_blank">'+planDataCache[i].website.substring(11)+'</a></span>';}
detailText+='</div></div></div>';detailText+='</div>';detailText+='</div>';detailText+='<div style="display:table-row;" class="shadow_top_inside fl padding_all_5 marginT20">';if(planDataCache[i].description==null){detailText+='<div class="marginT10 font_13" style="margin-right:15%;"><p></p></div>';}
if(planDataCache[i].description!='')
detailText+='<div class="marginT10 font_13" style="margin-right:15%;"><p>'+planDataCache[i].description+'</p></div>';detailText+='<div class="ADescripition">';detailText+='<section class="comments_tabs clearR"><h3>Foursquare Tips</h3></section>';detailText+='<div id="trip_poi_feedback" class="font_13 trip_poi_feedback"></div>';detailText+='</div>';detailText+='<div class="ADescripition review-deatil">';detailText+='<section class="comments_tabs clearR"><h3><a onclick="getReviewsFromUser('+planDataCache[i].id+',\''+planDataCache[i].originId+'\',\''+planDataCache[i].categoryId+'\',\'plan\'); " id="myTripUserReviews_'+bucketId+'" >Reviews</a></h3></section>';detailText+='<section class="comments_wrapper">';detailText+='<div id="plan_'+planDataCache[i].id+'_reviews_'+bucketId+'" class="font_13"></div>';detailText+='<div class="user_review_panel margint20"><br /><br /><h4>Friends Reviews</h4>';detailText+='<article class="grey_box mtop_10 b_radius_5 hotel_smileys"> <a href="#"><span class="smiley smiley_like_med">&nbsp;</span> 50 <span class="font_12">like it</span></a> <a href="#"><span class="smiley smiley_ok_med">&nbsp;</span> 10 <span class="font_12">say It\'s ok</span></a> <a href="#"><span class="smiley smiley_d_lile_med">&nbsp;</span> 15 <span class="font_12">don\'t like it</span></a> </article>';detailText+='</div>';detailText+='</div>';detailText+='</section>';detailText+='<div class="clearfloat"></div></div>';detailText+='</div></div>';document.getElementById(divMap[bucketId]+"Details").innerHTML=detailText;$('#itemPicID'+planDataCache[i].originId).attr('src',planDataCache[i].largPhotoUrl);fourSquarePics(planDataCache[i].id,bucketId,"#"+divMap[bucketId]+"Details");$('.itemPic').mouseover(function(){$('#itemPicBigger').fadeIn();});$('.itemPicBigger').mouseout(function(){$(this).fadeOut();});getForesquareTipsForItem(planDataCache[i].id,"#"+divMap[bucketId]+"Details");getReviewsFromUser(planDataCache[i].id,planDataCache[i].originId,bucketId,'plan');$("#"+divMap[bucketId]+"Details img.itemPic").attr("src",planDataCache[i].largPhotoUrl);var selectedPinImage="";var buckId=parseInt(bucketId);if(buckId){switch(buckId){case 1:selectedPinImage="/images/poi_01_active.png";break;case 3:selectedPinImage="/images/restaurant_01_active.png";break;case 4:selectedPinImage="/images/nightlife_01_active.png";break;case 6:selectedPinImage="/images/bing-shopping-pushpin-active.png";break;case 8:selectedPinImage="/images/activity_01_active.png";break;case 12:selectedPinImage="/images/events_active.png";break;case 13:selectedPinImage="/images/deals_01_active.png";break;}}
$("#yelprating_"+bucketId).html('<img src="/images/loader_10x10.gif" />');$.getJSON('/api/yelpupdate/businessName/'+planDataCache[i].name+'/businessCity/'+planDataCache[i].cityId,function(result){if(result==null){$("#yelprating_"+bucketId).html('');}
else{if(typeof result.businesses!='undefined'&&typeof result.businesses[0]!='undefined'&&result.businesses[0].review_count==0){$("#yelprating_"+bucketId).html('<img src="'+result.businesses[0].rating_img_url+'" align="absmiddle" />'+'<a style="color:#72ADDA;font-weight:bold;" target="_blank" href="'+result.businesses[0].url+'" onclick=""> <span style="text-decoration:underline;"></span> </a><img width="38" height="22" src="/images/html5/icons/yelp.png">');}
else{if(typeof result.businesses!='undefined'&&typeof result.businesses[0]!='undefined'){$("#yelprating_"+bucketId).html('<img src="'+result.businesses[0].rating_img_url+'" align="absmiddle" />'+'<a style="color:#72ADDA;font-weight:bold;" target="_blank" href="'+result.businesses[0].url+'" onclick=""> <span style="text-decoration:underline;">('+result.businesses[0].review_count+' reviews)</span> </a><img width="38" height="22" src="/images/html5/icons/yelp.png">');}
else{$("#yelprating_"+bucketId).html('');}}}});centerAndZoom(planDataCache[i].lat,planDataCache[i].lng,planDataCache[i].id,selectedPinImage);objMap=new Microsoft.Maps.Map(document.getElementById(mapbucket),{credentials:'AhJQ5JAtgnPi_omSWBrBll1mzwDZTtRktFgfeXNlUiR-i3bRuMc2inL0nAbGkRGE',width:"auto",height:180,enableClickableLogo:false,enableSearchLogo:false,showDashboard:false,showScalebar:false,zoom:16,mapTypeId:'auto',center:new Microsoft.Maps.Location(planDataCache[i].lat,planDataCache[i].lng)});var placePin=new Microsoft.Maps.Pushpin(objMap.getCenter(),null);objMap.entities.push(placePin);}
function fourSquarePics(id,catid,panelId){if(xhr!=null){xhr.abort();xhr=null;}
var fourSquareImgsurl='';fourSquareImgsurl='/html5/mytrip/getitemphotos/i/'+id+'/c/'+catid;xhr=$.ajax({type:"GET",url:fourSquareImgsurl,success:function(fsImgData){var ctr=0;if(fsImgData.data==""){$(panelId+' .thumbImgs').removeClass('loading_42x42');$(".attractionImg").css("height","326px");$(".imageScrollerContARNS").css("display","none");}else{var fsStrip='<div class="pnlScrollCont"><ul class="vscroll-item">';$.each(fsImgData.data,function(fsi,record){fsStrip+='<li><a href="javascript://" alt="'+record.largeUrl+'" onclick="changeimage(\''+record.largeUrl+'\',\''+panelId+'\');" class="block fl"><img src="'+record.thumbUrl+'" width="80" height="80" onError="this.src=\''+defaultImage[catid]+'\'"/></a></li>';});$(panelId+' .thumbImgs').removeClass('loading_42x42');if(ctr<4)fsStrip+='</div>';fsStrip+='</ul><div class="clearfloat"></div></div></div>';$(panelId+' .thumbImgs').html(fsStrip);}}});}
function changeimage(imgurl,panelId){$(panelId+' #filmstripHeroImg').addClass('filmstripLoader');$(panelId+' #filmstripHeroImg img').hide();$(panelId+' #filmstripHeroImg img .itemPic').css('background-color','none');$(panelId+' #filmstripHeroImg img').attr('src',imgurl);$(panelId+' #filmstripHeroImg img').load(function(){$(panelId+' #filmstripHeroImg').removeClass('filmstripLoader');$(panelId+' #filmstripHeroImg img').show();});}
function getReviewsFromUser(itemID,sourceId,categoryId,tab){var tipDivId='';var reviewdivid='';if(tab=='MT'||tab=='FT'){if(tab=='MT'){tipDivId='#myTripFourSquareTips';reviewdivid='#myTripUserReviews';}else if(tab=='FT'){tipDivId='#friendTripFourSquareTips';reviewdivid='#friendUserReviews';}
if($(reviewdivid).is('[disabled=disabled]')){return false;}}
var userdata='';var flag='';var entityId='';var articleType='';if(categoryId==1){entityId='5';articleType='3';}else if(categoryId==3){entityId='3';articleType='3';}
else if(categoryId==4){entityId='4';articleType='3';}else if(categoryId==6){entityId='9';articleType='3';}else if(categoryId==11){entityId='1';articleType='6';}else if(categoryId==16){entityId='2';articleType='7';}
returnReviews='';var userId=document.getElementById("userId").value;if(userId!=0){userReview='';friendReview='<h4 class="marginT10"><span id="'+tab+'_'+itemID+'_friendhead_'+categoryId+'" style="display:none">Friends Reviews</span></h4>';returnReviews+='<article class="fl adjustarticle"><div class="font_13">';returnReviews+=userReview;returnReviews+='<div id="'+tab+'_'+itemID+'_review_'+categoryId+'"><div style="padding:50px 0;" align="center"><img src="/images/loading.gif" /><br />Loading...</div></div>';returnReviews+='<div id="'+tab+'_'+itemID+'_placeAttributes_'+categoryId+'"></div>';returnReviews+='<section class="width_100 marginT10 fl review-says">';returnReviews+='<article class="review-result marginR15 fl">';returnReviews+='<div id="'+tab+'_'+itemID+'_rateuser_'+categoryId+'"></div>';returnReviews+='</article></section>';returnReviews+='<div class="clearfloat"></div>';returnReviews+=friendReview;returnReviews+='<div id="'+tab+'_'+itemID+'_friendreview_'+categoryId+'" style="display:none"><div style="padding:50px 0;" align="center"><img src="/images/loading.gif" /><br />Loading...</div></div>';url='/html5/mytrip/getuserreviewratings/articleId/'+sourceId+'/itemId/'+itemID+'/entityId/'+entityId+'/tab/'+tab+'/articleType/'+articleType+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){arrdata=data.split("|||");var userdata=arrdata[0];var putdata=arrdata[1];var evaluation=arrdata[2];var tripType=arrdata[3];flag=arrdata[4];if(flag==1){$("#"+tab+"_"+itemID+"_review_"+categoryId).html(userdata);$("#"+tab+"_"+itemID+"_placeAttributes_"+categoryId).html(putdata);$("#"+tab+"_"+itemID+"_rateuser_"+categoryId).append(evaluation);$("#"+tab+"_"+itemID+"_rateuser_"+categoryId).append(tripType);}else{getReviewForm(entityId,sourceId,itemID,articleType,categoryId,tab);}
$("#"+tab+"_"+itemID+"_friendreview_"+categoryId).show();$("#"+tab+"_"+itemID+"_friendhead_"+categoryId).show();surl='/html5/mytrip/getfriendreviewratings/articleId/'+sourceId+'/entityId/'+entityId+'/articleType/'+articleType+'/rand/'+parseInt(Math.random()*99999999);$.get(surl,function(fsdata){$("#"+tab+"_"+itemID+"_friendreview_"+categoryId).html(fsdata);});});returnReviews+='</div></article>';}else{reviewsectionRefresh=true;returnReviews+='<div class="overflow info mtop_5 "><center class="marginTB10">Please login to add and view reviews<br><br><a id="a_loginFromReviews" onclick="member_login_header();" href="javascript://" class="marginL15 header-facebook"><img src="/images/facebook-sign-in.gif"></a></center></div>';}
$("#"+tab+"_"+itemID+"_reviews_"+categoryId).html(returnReviews);if(tab=='MT'||tab=='FT'){$(reviewdivid).attr("disabled","true");if($(tipDivId).is('[disabled=disabled]')){$(tipDivId).attr("disabled","false");}}}
function getHotelHostelReviewsFromUser(itemID,articleType){var hostelReviews='';hostelReviews+='<div id="'+itemID+'_hostelreviewForm" class="user_review_panel form_wrapper add_review fl" >';hostelReviews+='<ul class="myReviewSmily"><li><a onclick="swapRadioSmiliey(this.id, 1);" id="ok" class="smilies active" href="javascript://">&nbsp;</a></li> <li><a onclick="swapRadioSmiliey(this.id, 2);" id="soso" class="smilies" href="javascript://">&nbsp;</a></li><li><a onclick="swapRadioSmiliey(this.id, 3);" id="notok" class="smilies" href="javascript://">&nbsp;</a></li> <li>Overall<span class="myRev">I Like It!</span></li></ul>';hostelReviews+='<div class="mtop_10 form_wrapper"><textarea class="" cols="25" rows="4" name="reviewText" id="reviewText" ></textarea><button  id="user_review_btn" onclick="saveUserReview(\''+itemID+'\', \''+articleType+'\');" class="btn_light">Post Review</button></div><div class="mtop_10 black_text" style="display:none;">How do you rate specifically on different services of this hostel.<br /><a class="blue_link" href="#">Review Hostel Services</a></div>';hostelReviews+='</div>';var returnReviews='';returnReviews+='<div id="'+itemID+'_hostelreview"><div style="padding:50px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt=""/></div></div>';url='/html5/mytrip/getuserreview/articleId/'+itemID+'/articleType/'+articleType+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){arrdata=data.split("|||");userdata=arrdata[0];flag=arrdata[1];if(flag==1){$("#"+itemID+"_hostelreview").html(userdata);returnReviews+='<a href>Edit</a>';}
else{$("#"+itemID+"_hostelreview").html(hostelReviews);$("#"+itemID+"_hostelreviewForm").show();}});$("#"+itemID+"_hostelreviews").html(returnReviews);}
function swapRadioSmiliey(id,val){reviewEvaluation=val;$('.myReviewSmily a.smilies').removeClass("active");$('.myReviewSmily a#'+id).addClass("active");if(val==1){$('#smiledesc').html('I Like It!');}else if(val==2){$('#smiledesc').html('It is Ok!');}else if(val==3){$('#smiledesc').html('I Dislike It!');}}
function tripPoiPreLoader(){$(".trip_poi_feedback").html('<div style="padding:50px 0;" align="center">Loading..<br /><img src="/images/loading.gif" /></div>');}
function getUserReviewsForItem(articleId,panelId){tripPoiPreLoader();url='/html5/mytrip/getfriendreview/articleId/'+articleId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){$(panelId+' .trip_poi_feedback').html(data);$('.comments_tabs a').removeClass('current');$(panelId+' .myTripUserReviews').addClass('current');});}
function getFriendCommentForItem(articleId){tripPoiPreLoader();url='/html5/mytrip/getfriendcomments/articleId/'+articleId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){$("#trip_poi_feedback").html(data);$('.comments_tabs a').removeClass('current');$('#myTripfacebookComments').addClass('current');});}
function getForesquareTipsForItem(articleId,panelId,tab){var tipDivId='';var reviewdivId='';if(typeof tab!='undefined'&&(tab=='MT'||tab=='FT')){if(tab=='MT'){tipDivId='#myTripFourSquareTips';reviewdivid='#myTripUserReviews';}else if(tab=='FT'){tipDivId='#friendTripFourSquareTips';reviewdivid='#friendUserReviews';}
if($(tipDivId).is('[disabled=disabled]')){return false;}}
tripPoiPreLoader();var url='/html5/mytrip/getfoursquaretips/articleId/'+articleId+'/rand/'+parseInt(Math.random()*99999999);loadFtTipswidgetreq=$.get(url,function(data){$(panelId+' .trip_poi_feedback').html(data);$('.comments_tabs a').removeClass('current');if(tipDivId!=''){$(panelId+tipDivId).addClass('current');$(tipDivId).attr("disabled","true");if($(reviewdivid).is('[disabled=disabled]')){$(reviewdivid).attr("disabled","false");}}});}
function checkTripExistance(source,tripPartId,apiId){url='/html5/trip/checkexistance/source/'+source+'/tripPartId/'+tripPartId+'/apiId/'+apiId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);});}
function assignTripItemData(whichEntity,arrayIndex){cacheDetailEntityData=false;;switch(whichEntity){case'hotel':recommendsubcat='';cacheDetailEntityData=hotelCacheData.hotelList[arrayIndex];break;case'deal':recommendsubcat='';if(typeof dealsCacheData[arrayIndex]!='undefined'){cacheDetailEntityData=dealsCacheData[arrayIndex];}else{cacheDetailEntityData=dealsCacheData.results[arrayIndex];}
break;case'event':recommendsubcat='';if(eventfilterdate){if(eventsCacheDatafilter.total_items==1){cacheDetailEntityData=eventsCacheDatafilter.events.event;}else{cacheDetailEntityData=eventsCacheDatafilter.events.event[arrayIndex];}
break;}else{if(eventsCacheData.total_items==1){cacheDetailEntityData=eventsCacheData.events.event;}else{cacheDetailEntityData=eventsCacheData.events.event[arrayIndex];}
break;}
case'poi':cacheDetailEntityData=planDataCache[arrayIndex];break;case'viator':recommendsubcat='';cacheDetailEntityData=pactivityCacheData[arrayIndex];break;case'hostel':recommendsubcat='';cacheDetailEntityData=hostelCacheData[arrayIndex];break;}}
function displayLoadingImage(id,location,categoryId){switch(location){case'grid':if(categoryId==1||categoryId==3||categoryId==4||categoryId==6){var id="#gridBtn_"+id+"_"+categoryId;}else{var id="#gridBtn_"+id;}
$(id).html('<img height="22" style="padding-left:50px;" src="/images/preloader.gif"/>');break;case'friend':if(categoryId==1||categoryId==3||categoryId==4||categoryId==6){var id="#gridBtn_"+id+"_"+categoryId;}else{var id="#gridBtn_"+id;}
$(id).html('<img height="22" style="padding-left:50px;" src="/images/preloader.gif"/>');break;case'bing':$('#bing_map_add_to_trip').html('<img height="22" style="padding-left:50px;" src="/images/preloader.gif"/>');break;case'true':if(categoryId==1||categoryId==3||categoryId==4||categoryId==6){$("#detail_top_btn_"+id+"_"+categoryId).html('<img height="22" style="padding-left:50px;" src="/images/preloader.gif"/>');$("#detail_bottom_btn_"+id+"_"+categoryId).html('<img height="22" style="padding-left:50px;" src="/images/preloader.gif"/>');}else{$("#detail_top_btn_"+id).html('<img height="22" style="padding-left:50px;" src="/images/preloader.gif"/>');$("#detail_bottom_btn_"+id).html('<img height="22" style="padding-left:50px;" src="/images/preloader.gif"/>');}
break;case'recommend_detail':if(categoryId==1||categoryId==3||categoryId==4||categoryId==6){$("#detail_top_btn_"+id+"_"+categoryId).html('<img height="22" style="padding-left:50px;" src="/images/preloader.gif"/>');$("#detail_bottom_btn_"+id+"_"+categoryId).html('<img height="22" style="padding-left:50px;" src="/images/preloader.gif"/>');}else{$("#detail_top_btn_"+id).html('<img height="22" style="padding-left:50px;" src="/images/preloader.gif"/>');$("#detail_bottom_btn_"+id).html('<img height="22" style="padding-left:50px;" src="/images/preloader.gif"/>');}
break;}}
function addItemToTrip(categoryId,source,sourceId,itemFlag,cityFlag,i){if(cacheDetailEntityData==false)return;tripPartId=activeTripPart.tripPartId;var scat=0;if(typeof tripPartId=="undefined"||tripPartId==''||tripPartId==0||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
if((explorePanelMode=='friend'&&itemFlag=='bing')||(explorePanelMode=='friend'&&itemFlag=='recommend_detail')){itemFlg='friend';}else{itemFlg=itemFlag;}
if(recommendsubcat=='yelp'){scat=1;}
var cityId=TryParseInt(cityFlag,0);if(cityId!=0){cityId=cityFlag;}else{cityId=0;}
if(anonymousUser==false){displayLoadingImage(sourceId,itemFlag,categoryId);}
$.post("/mytrip/additembyjson",{tp:tripPartId,c:categoryId,s:source,si:sourceId,subcat:scat,cityFlag:cityId,mode:itemFlg,jsn:JSON.stringify(cacheDetailEntityData)},function(data){if(data.attempt=='fail'){var cityId=$("#hdnCityId").val();var cookieData=cityId+'|'+categoryId+'|'+source+'|'+sourceId+'|'+itemFlag;setCookieForItem("tripItems",cookieData,2);georamaSignIn();}else{if(itemFlg=='friend'){notifyme("Item recommended successfully to your friend's trip","success");$('#notifyme').css('top','37px');if(isLiveServer==true){var gaTitleCategory="HTML5 - Plan - "+selectedCityname+" - "+getPanelByBucketId(categoryId)+" - Recommend To Trip";_gaq.push(["_trackEvent",gaTitleCategory,"Clicked"]);}}else{if(categoryId){notifyme(getPanelByBucketId(categoryId)+" added successfully to your trip","success");$('#notifyme').css('top','67px');if(isLiveServer==true){var gaTitleCategory="HTML5 - Plan - "+selectedCityname+" - "+getPanelByBucketId(categoryId)+" - Add to Trip";_gaq.push(["_trackEvent",gaTitleCategory,"Clicked"]);}}}
if(itemFlag=='true'){var gridId='';if(categoryId=='6'||categoryId=='4'||categoryId=='3'||categoryId=='1'){gridId=replaceString(sourceId)+'_'+categoryId;}else{gridId=replaceString(sourceId);}
if(typeof i!='undefined'){function_name='removeFromTrip(\''+categoryId+'\' , \''+source+'\', \''+sourceId+'\',\'true\',\''+i+'\')';}else{function_name='removeFromTrip(\''+categoryId+'\' , \''+source+'\', \''+sourceId+'\')';}
var addToTripButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="'+function_name+'"> Remove</a>';$("#add_to_trip_button").html('');$("#detail_top_btn_"+gridId).html(addToTripButton);$("#gridBtn_"+gridId).html(addToTripButton);strButton='<div class="addTrip" id="detail_bottom_btn_'+gridId+'"><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="'+function_name+'"> Remove</a></div>';document.getElementById(recommandAddbtn[categoryId]+'buttonInfo').innerHTML=strButton;var id=sourceId+"_"+categoryId;assignSourceId(id);}
if(itemFlag=='bing'){var gridId='';if(categoryId=='6'||categoryId=='4'||categoryId=='3'||categoryId=='1'){gridId=replaceString(sourceId)+'_'+categoryId;}else{gridId=replaceString(sourceId);}
if(explorePanelMode=='friend'){if(document.getElementById("bing_friend_button")){strButton='<span class="highlight fl font_11"> Recommended by Friends and You </span>';strButton_grid='<span class="highlight"> Recommended by Friends and You </span>';strButtonDetailBottom='<span class="highlight">Recommended by friends and You</span>';$("#gridBtn_frnd_"+gridId).html('');}else{strButton_grid='<span class="highlight"> Recommended </span>';strButton='<span class="highlight fl font_11"> Recommended </span>';strButtonDetailBottom='<span class="font_13 highlight">Recommended</span>';}}else{if(typeof i!='undefined'){function_name='removeFromTrip(\''+categoryId+'\' , \''+source+'\', \''+sourceId+'\',\'bing\',\''+i+'\')';function_name_grid='removeFromTrip(\''+categoryId+'\' , \''+source+'\', \''+sourceId+'\',\'grid\',\''+i+'\')';}
else{function_name='removeFromTrip(\''+categoryId+'\' , \''+source+'\', \''+sourceId+'\' ,\'bing\')';function_name_grid='removeFromTrip(\''+categoryId+'\' , \''+source+'\', \''+sourceId+'\',\'grid\')';}
strButton='<a href="javascript://" style="top: 0px;" onClick="'+function_name+'" class="btnIconRemove font_13"> Remove </a>';strButton_grid='<a href="javascript://" style="top: 0px;" onClick="'+function_name_grid+'" class="btnIconRemove font_13"> Remove </a>';strButtonDetailBottom='<div class="addTrip"><a onClick="'+function_name_grid+'" href="javascript:void(0);" class="btnIconRemove font_13"> Remove</a></div>';}
document.getElementById("bing_map_add_to_trip").innerHTML=strButton;$("#gridBtn_"+gridId).html(strButton_grid);$("#detail_top_btn_"+gridId).html(strButton_grid);$("#detail_bottom_btn_"+gridId).html(strButtonDetailBottom);if(categoryId=='6'||categoryId=='4'||categoryId=='3'||categoryId=='1'){var id=replaceString(sourceId)+'_'+categoryId;}else{var id=sourceId+'_'+categoryId;}
assignSourceId(id);}
if(itemFlag=='friend'){if(categoryId=='6'||categoryId=='4'||categoryId=='3'||categoryId=='1'){var gridId=replaceString(sourceId)+'_'+categoryId;}
else{var gridId=replaceString(sourceId);}
if(document.getElementById("gridBtn_frnd_"+gridId)){strButton='Recommended by friends and You';$("#gridBtn_frnd_"+gridId).html('');}else{strButton='Recommended';}
$("#gridBtn_"+gridId).addClass("highlight fl");$("#gridBtn_"+gridId).html(strButton);assignSourceId(sourceId+"_"+categoryId);}
if(itemFlag=='recommend_detail'){if(categoryId=='6'||categoryId=='4'||categoryId=='3'||categoryId=='1'){var gridId=replaceString(sourceId)+'_'+categoryId;}else{var gridId=replaceString(sourceId);}
if(document.getElementById('recommend_detail_friend')||document.getElementById('recommend_detail_friend1')){var addToTripButton='<a class="font_13 highlight" href="javascript:void(0);" onClick=""> Recommended by friends and You</a>';strButton='<div class="addTrip" ><span class="highlight">Recommended by friends and You</span></div>';strButton_grid='<span class="highlight fl"> Recommended by Friends and You </span>';$("#gridBtn_frnd_"+gridId).html('');}else{var addToTripButton='<a class="font_13 highlight" href="javascript:void(0);" onClick=""> Recommended</a>';strButton='<div class="addTrip" ><a class="font_13 highlight" onclick="">Recommended</a></div>';strButton_grid='<span class="highlight fl"> Recommended</span>';}
$("#gridBtn_"+gridId).html(strButton_grid);$("#add_to_trip_button").html('');$("#detail_top_btn_"+gridId).html(addToTripButton);document.getElementById(recommandAddbtn[categoryId]+'buttonInfo').innerHTML=strButton;assignSourceId(sourceId+"_"+categoryId);}
if(itemFlag=='grid'){if(typeof i!='undefined'){function_name='removeFromTrip(\''+categoryId+'\' , \''+source+'\', \''+sourceId+'\',\''+itemFlag+'\',\''+i+'\')';}else{function_name='removeFromTrip(\''+categoryId+'\' , \''+source+'\', \''+sourceId+'\' ,\''+itemFlag+'\')';}
strButton='<a href="javascript://" onClick="'+function_name+'" class="btnIconRemove font_13"> Remove </a>';if(categoryId=='6'||categoryId=='4'||categoryId=='3'||categoryId=='1'){var gridId=replaceString(sourceId)+'_'+categoryId;}else{var gridId=replaceString(sourceId);}
$("#gridBtn_"+gridId).html(strButton);var id=sourceId+"_"+categoryId;assignSourceId(id);}}});}
function replaceString(str){return str.replace("@","-");}
function setCookieForItem(cookieName,info){setCookie(cookieName,info,2);}
function assignSourceId(sourceId){if(explorePanelMode=='friend'){var sourceIds=$("#userItemSourceIds").val();}else{var sourceIds=$("#tripItemSourceIds").val();}
if(sourceIds!=''){var newVal=sourceIds+','+sourceId;}else{var newVal=sourceId;}
if(explorePanelMode=='friend'){$("#userItemSourceIds").val(newVal);}else{$("#tripItemSourceIds").val(newVal);}}
function getAddTripFunction(bucketId,i){switch(bucketId){case 1:addToTripButton='addtoAttraction(\'foursquare\',\''+planDataCache[i].id+'\',\''+addslashes(planDataCache[i].name)+'\',\''+addslashes(planDataCache[i].address1)+'\',\''+planDataCache[i].website+'\',\''+planDataCache[i].formattedPhone+'\')';return addToTripButton;break;case 3:addToTripButton='addtoRestaurant(\'foursquare\',\''+planDataCache[i].id+'\',\''+addslashes(planDataCache[i].name)+'\',\''+addslashes(planDataCache[i].address1)+'\',\''+planDataCache[i].website+'\',\''+planDataCache[i].formattedPhone+'\')';return addToTripButton;break;case 4:addToTripButton='addtoNightlife(\'foursquare\',\''+planDataCache[i].id+'\',\''+addslashes(planDataCache[i].name)+'\',\''+addslashes(planDataCache[i].address1)+'\',\''+planDataCache[i].website+'\',\''+planDataCache[i].formattedPhone+'\')';return addToTripButton;break;case 6:addToTripButton='addtoShopping(\'foursquare\',\''+planDataCache[i].id+'\',\''+addslashes(planDataCache[i].name)+'\',\''+addslashes(planDataCache[i].address1)+'\',\''+planDataCache[i].website+'\',\''+planDataCache[i].formattedPhone+'\')';return addToTripButton;break;case 8:addToTripButton='addtoActivity(\'foursquare\',\''+planDataCache[i].id+'\',\''+addslashes(planDataCache[i].name)+'\',\''+addslashes(planDataCache[i].address1)+'\',\''+planDataCache[i].website+'\',\''+planDataCache[i].formattedPhone+'\')';return addToTripButton;break;}}
function getAddToTripButtonCode(bucketId,i){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
switch(parseInt(bucketId)){case 1:url='/html5/trip/checkexistance/source/3/tripPartId/'+tripPartId+'/sourceId/'+planDataCache[i].originId+'/categoryId/'+bucketId+'/recommend/0/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){function_name='assignTripItemData(\'poi\', \''+i+'\');addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'true\',\'\',\''+i+'\')';addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Add to Trip</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><a class="btnIconAdd font_13" value="Add to Trip" onclick="assignTripItemData(\'poi\', \''+i+'\');addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'true\',\'\',\''+i+'\')"> Add to Trip</a></div>';document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
$("#attraction .add_to_trip_button").show();document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}else{function_name='removeFromTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\',\'\',\''+i+'\');';addToTripButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="'+function_name+'"> Remove</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removeFromTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\',\'\',\''+i+'\');"> Remove</a></div>';document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
gridButton='<a href="javascript://" onClick="removeFromTrip('+bucketId+', \'3\', \''+planDataCache[i].originId+'\',"grid",\''+i+'\')" class="btnIconRemove font_13">Remove</a>';gridId=replaceString(planDataCache[i].originId);$("#gridBtn_"+gridId).html(gridButton);document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
if(btnFlag){$('#attraction .add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;case 3:url='/html5/trip/checkexistance/source/3/tripPartId/'+tripPartId+'/sourceId/'+planDataCache[i].originId+'/categoryId/'+bucketId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){function_name='assignTripItemData(\'poi\', \''+i+'\');addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'true\',\'\',\''+i+'\')';addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Add to Trip</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><a class="btnIconAdd font_13" type="button" onclick="assignTripItemData(\'poi\', \''+i+'\');addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'true\',\'\',\''+i+'\')"> Add to Trip</a></div>';document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}else{function_name='removeFromTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\',\'\',\''+i+'\');';addToTripButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="'+function_name+'"> Remove</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removeFromTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\',\'\',\''+i+'\');"> Remove</a></div>';document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
if(btnFlag){$('#restaurant .add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;case 4:url='/html5/trip/checkexistance/source/3/tripPartId/'+tripPartId+'/sourceId/'+planDataCache[i].originId+'/categoryId/'+bucketId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){function_name='assignTripItemData(\'poi\', \''+i+'\');addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'true\',\'\',\''+i+'\')';addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Add to Trip</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><a class="btnIconAdd font_13" onclick="assignTripItemData(\'poi\', \''+i+'\');addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'true\',\'\',\''+i+'\')"> Add to Trip</a></div>';document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
else{function_name='removeFromTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\',\'\',\''+i+'\');';addToTripButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="'+function_name+'"> Remove</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'" ><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removeFromTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\',\'\',\''+i+'\');"> Remove</a></div>';document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
if(btnFlag){$('#nightlife .add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;case 6:url='/html5/trip/checkexistance/source/3/tripPartId/'+tripPartId+'/sourceId/'+planDataCache[i].originId+'/categoryId/'+bucketId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){function_name='assignTripItemData(\'poi\', \''+i+'\');addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'true\',\'\',\''+i+'\')';addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Add to Trip</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><a class="btnIconAdd font_13" onclick="assignTripItemData(\'poi\', \''+i+'\');addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'true\',\'\',\''+i+'\')"> Add to Trip</a></div>';document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}else{function_name='removeFromTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\',\'\',\''+i+'\');';addToTripButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="'+function_name+'"> Remove</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'" ><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removeFromTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\',\'\',\''+i+'\');"> Remove</a></div>';document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
if(btnFlag){$('#shopping .add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;case 8:url='/html5/trip/checkexistance/source/8/tripPartId/'+tripPartId+'/sourceId/'+i+'/categoryId/'+bucketId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){function_name='assignTripItemData(\'viator\', \''+activityIndex+'\');addItemToTrip(\''+bucketId+'\', \'8\', \''+i+'\', \'true\')';var addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Add to Trip</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'" ><a class="btnIconAdd font_13" onclick="assignTripItemData(\'viator\', \''+activityIndex+'\');addItemToTrip(\''+bucketId+'\', \'8\', \''+i+'\', \'true\',\'\',\''+activityIndex+'\')"> Add to Trip</a></div>';document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}else{function_name='removeFromTrip(\''+bucketId+'\', \'8\', \''+i+'\',\'\',\''+activityIndex+'\');';var addToTripButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="'+function_name+'"> Remove</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'" ><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removeFromTrip(\''+bucketId+'\', \'8\', \''+i+'\',\'\',\''+activityIndex+'\');"> Remove</a></div>';document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
if(btnFlag){$('#planactivities .add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;case 11:url='/html5/trip/checkexistance/source/6/tripPartId/'+tripPartId+'/sourceId/'+i+'/categoryId/'+bucketId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){var hotel='hotel';function_name='assignTripItemData(\''+hotel+'\', \''+hotelArrayIndex+'\');addItemToTrip(\''+bucketId+'\', \'6\', \''+i+'\', \'true\',\'\',\''+hotelArrayIndex+'\')';var addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Add to Trip</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a class="btnIconAdd font_13" onclick="assignTripItemData(\'hotel\', \''+hotelArrayIndex+'\');addItemToTrip(\''+bucketId+'\', \'6\', \''+i+'\', \'true\',\'\',\''+hotelArrayIndex+'\')"> Add to Trip</a></div>';document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}else{function_name='removeFromTrip(\''+bucketId+'\', \'6\', \''+i+'\',\'\',\''+hotelArrayIndex+'\')';var addToTripButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="'+function_name+'">Remove</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removeFromTrip('+bucketId+', \'6\', \''+i+'\',\'\',\''+hotelArrayIndex+'\');"> Remove</a></div>';document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
if(btnFlag){$('#hotelDetails .add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;case 12:url='/html5/trip/checkexistance/source/5/tripPartId/'+tripPartId+'/sourceId/'+i+'/categoryId/'+bucketId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);var eventId=replaceString(i);if(result==1){function_name='assignTripItemData(\'event\', \''+eventIndex+'\');addItemToTrip(\''+bucketId+'\', \'5\', \''+i+'\', \'true\',\'\',\''+eventIndex+'\')';var addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Add to Trip</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+eventId+'" ><a class="btnIconAdd font_13" onclick="assignTripItemData(\'event\', \''+eventIndex+'\');addItemToTrip(\''+bucketId+'\', \'5\', \''+i+'\', \'true\',\'\',\''+eventIndex+'\')"> Add to Trip</a></div>';document.getElementById("eventbuttonInfo").innerHTML=strButton;document.getElementById("eventbuttonInfo").style.display="block";}
else{function_name='removeFromTrip(\''+bucketId+'\', \'5\', \''+i+'\',\'\',\''+eventIndex+'\')';var addToTripButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="'+function_name+'">Remove</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+eventId+'"><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removeFromTrip(\''+bucketId+'\', 5, \''+i+'\',\'\',\''+eventIndex+'\');"> Remove</a></div>';document.getElementById("eventbuttonInfo").innerHTML=strButton;document.getElementById("eventbuttonInfo").style.display="block";}
if(btnFlag){$('#events .add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;case 13:$('#add_to_trip_button').html('');url='/html5/trip/checkexistance/source/4/tripPartId/'+tripPartId+'/sourceId/'+i+'/categoryId/'+bucketId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){function_name='addItemToTrip(\''+bucketId+'\', \'4\', \''+i+'\', \'true\',\'\',\''+dealIndex+'\')';var addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Add to Trip</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'" ><a class="btnIconAdd font_13" onclick="addItemToTrip(\''+bucketId+'\', 4, \''+i+'\', \'true\',\'\',\''+dealIndex+'\')"> Add to Trip</a></div>';document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}else{function_name='removeFromTrip(\''+bucketId+'\', \'4\', \''+i+'\', \'true\',\'\',\''+dealIndex+'\')';var addToTripButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="'+function_name+'">Remove</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removeFromTrip(\''+bucketId+'\', \'4\', \''+i+'\');"> Remove</a></div>';document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
if(btnFlag){$('#deals .add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;case 16:$('#add_to_trip_button').html('');url='/html5/trip/checkexistance/source/7/tripPartId/'+tripPartId+'/sourceId/'+i+'/categoryId/'+bucketId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){function_name='assignTripItemData(\'hostel\', \''+hostelArrayIndex+'\');addItemToTrip(\''+bucketId+'\', \'7\', \''+i+'\', \'true\',\'\',\''+hostelArrayIndex+'\')';var addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Add to Trip</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a class="btnIconAdd font_13" onclick="assignTripItemData(\'hostel\', \''+hostelArrayIndex+'\');addItemToTrip(\''+bucketId+'\', 7, \''+i+'\', \'true\',\'\',\''+hostelArrayIndex+'\')"> Add to Trip</a></div>';$("#hostelbuttonInfo").html(strButton);$("#hostelbuttonInfo").show();$("#reviewFooterHostel").show();}else{function_name='removeFromTrip(\''+bucketId+'\', \'7\', \''+i+'\', \'true\',\'\',\''+hostelArrayIndex+'\')';var addToTripButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="'+function_name+'">Remove</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removeFromTrip(\''+bucketId+'\', \'7\', \''+i+'\',\'\',\''+hostelArrayIndex+'\');"> Remove</a></div>';$("#hostelbuttonInfo").html(strButton);$("#hostelbuttonInfo").show();$("#reviewFooterHostel").show();}
if(btnFlag){$('#detail_top_btn_'+i).html(addToTripButton);btnFlag=false;}});break;}}
function getRecommandButtonCode(bucketId,i){var sourceIds=$("#tripItemSourceIds").val();var userSourceIds=$("#userItemSourceIds").val();var sourceIdArray=sourceIds.split(',');var userSourceIdArray=userSourceIds.split(',');tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
switch(parseInt(bucketId)){case 1:url='/html5/trip/checkexistance/source/3/tripPartId/'+tripPartId+'/sourceId/'+planDataCache[i].originId+'/recommend/1/categoryId/'+bucketId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,planDataCache[i].originId);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_'+bucketId){function_name='assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')';addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Recommend</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'" ><a class="btnIconAdd font_13" onclick="assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')"> Recommend</a></div>';}else{addToTripButton='<span class="font_13 highlight">Already added to trip</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><a class="font_13 highlight" onclick="">Already added to trip</a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}else{function_name='removeFromTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\',\'friend\',\''+arraypoi[bucketId]+'\');';var isExists=inArrayJS(planDataCache[i].originId+'_'+bucketId,sourceIdArray);var foruserExist=inArrayJS(planDataCache[i].originId+'_'+bucketId,userSourceIdArray);if(isExists==true&&foruserExist==true){addToTripButton='<span class="font_13 highlight">Recommended by friends and You</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><span class="highlight">Recommended by friends and You</span></div>';}else if(isExists==true){addToTripButton='<span id="recommend_detail_friend"><span class="font_13 highlight">Recommended by friends</span>';addToTripButton+='&nbsp;&nbsp;&nbsp;<a href="javascript:void(0);" class="btnIconAdd blue_link" onclick="assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')">I Recommend</a></span>';strButton='<span id="recommend_detail_friend1"><div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><span class="highlight font_13">Recommended by friends</span>&nbsp;&nbsp;<a class="btnIconAdd blue_link" onclick="assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')">I Recommend</a> </div></span>';}else{addToTripButton='<span class="font_13 highlight">Recommended</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><a class="font_13 highlight onclick="">Recommended </a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
if(btnFlag){$('.add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;case 3:url='/html5/trip/checkexistance/source/3/tripPartId/'+tripPartId+'/sourceId/'+planDataCache[i].originId+'/recommend/1/categoryId/'+bucketId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,planDataCache[i].originId);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_'+bucketId){function_name='assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')';addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Recommend</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><a class="btnIconAdd font_13" onclick="assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')"> Recommend</a></div>';}
else{addToTripButton='<span class="font_13 highlight">Already added to trip</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><a class="font_13 highlight" onclick="">Already added to trip</a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}else{function_name='removeFromTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\',\'\',\''+arraypoi[bucketId]+'\');';var isExists=inArrayJS(planDataCache[i].originId+'_'+bucketId,sourceIdArray);var foruserExist=inArrayJS(planDataCache[i].originId+'_'+bucketId,userSourceIdArray);if(isExists==true&&foruserExist==true){addToTripButton='<span class="font_13 highlight">Recommended by friends and You</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'"><span class="highlight">Recommended by friends and You </span></div>';}else if(isExists==true){addToTripButton='<span id="recommend_detail_friend"><span class="font_13 highlight">Recommended by friends</span>';addToTripButton+='&nbsp;&nbsp;&nbsp;<a href="javascript:void(0);" class="btnIconAdd blue_link" onclick="assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')">I Recommend</a></span>';strButton='<span id="recommend_detail_friend1"><div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'" ><span class="highlight font_13">Recommended by friends</span>&nbsp;&nbsp;<a class="btnIconAdd blue_link" onclick="assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')">I Recommend</a> </div></span>';}else{addToTripButton='<span class="font_13 highlight">Recommended</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'" ><a class="font_13 highlight" onclick="">Recommended </a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
if(btnFlag){$('.add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;case 4:url='/html5/trip/checkexistance/source/3/tripPartId/'+tripPartId+'/sourceId/'+planDataCache[i].originId+'/recommend/1/categoryId/'+bucketId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,planDataCache[i].originId);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_'+bucketId){function_name='assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')';addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Recommend</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'" ><a class="btnIconAdd font_13" onclick="assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')"> Recommend</a></div>';}
else{addToTripButton='<span class="font_13 highlight">Already added to trip</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><a class="font_13 highlight" onclick="">Already added to trip</a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}else{function_name='removeFromTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\''+arraypoi[bucketId]+'\');';var isExists=inArrayJS(planDataCache[i].originId+'_'+bucketId,sourceIdArray);var foruserExist=inArrayJS(planDataCache[i].originId+'_'+bucketId,userSourceIdArray);if(isExists==true&&foruserExist==true){addToTripButton='<span class="font_13 highlight">Recommended by friends and You</span>';strButton='<div class="addTrip" ><span class="highlight">Recommended by friends and You </span></div>';}
else if(isExists==true){addToTripButton='<span id="recommend_detail_friend"><span class="font_13 highlight">Recommended by friends</span>';addToTripButton+='&nbsp;&nbsp;&nbsp;<a href="javascript:void(0);" class="btnIconAdd blue_link" onclick="assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')">I Recommend</a></span>';strButton='<span id="recommend_detail_friend1"><div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><span class="highlight font_13">Recommended by friends</span>&nbsp;&nbsp;<a class="btnIconAdd blue_link" onclick="assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')">I Recommend</a> </div></span>';}else{addToTripButton='<span class="font_13 highlight">Recommended</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><a class="font_13 highlight" onclick="">Recommended </a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
if(btnFlag){$('.add_to_trip_button').append(addToTripButton);btnFlag=false;}});break;case 6:url='/html5/trip/checkexistance/source/3/tripPartId/'+tripPartId+'/sourceId/'+planDataCache[i].originId+'/recommend/1/categoryId/'+bucketId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,planDataCache[i].originId);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_'+bucketId){function_name='assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')';addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Recommend</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'" ><a class="btnIconAdd font_13" onclick="assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')"> Recommend</a></div>';}else{addToTripButton='<span class="font_13 highlight">Already added to trip</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><a class="font_13 highlight" onclick="">Already added to trip</a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}else{function_name='removeFromTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\''+arraypoi[bucketId]+'\');';var isExists=inArrayJS(planDataCache[i].originId+'_'+bucketId,sourceIdArray);var foruserExist=inArrayJS(planDataCache[i].originId+'_'+bucketId,userSourceIdArray);if(isExists==true&&foruserExist==true){addToTripButton='<span class="font_13 highlight">Recommended by friends and You</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><span class="highlight">Recommended by friends and You </span></div>';}else if(isExists==true){addToTripButton='<span id="recommend_detail_friend"><span class="font_13 highlight">Recommended by friends</span>';addToTripButton+='&nbsp;&nbsp;&nbsp;<a href="javascript:void(0);" class="btnIconAdd blue_link" onclick="assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')">I Recommend</a></span>';strButton='<span id="recommend_detail_friend1"><div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><span class="highlight font_13">Recommended by friends</span>&nbsp;&nbsp;<a class="btnIconAdd blue_link" onclick="assignTripItemData(\'poi\', \''+arraypoi[bucketId]+'\'); addItemToTrip(\''+bucketId+'\', \'3\', \''+planDataCache[i].originId+'\', \'recommend_detail\',\'\',\''+arraypoi[bucketId]+'\')">I Recommend</a> </div></span>';}else{addToTripButton='<span class="font_13 highlight">Recommended</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+planDataCache[i].originId+'_'+bucketId+'"><a class="font_13 highlight" onclick="">Recommended </a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
if(btnFlag){$('.add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;case 8:url='/html5/trip/checkexistance/source/8/tripPartId/'+tripPartId+'/sourceId/'+i+'/recommend/1/categoryId/'+bucketId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,i);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_'+bucketId){function_name='assignTripItemData(\'viator\', \''+activityIndex+'\');addItemToTrip(\''+bucketId+'\', \'8\', \''+i+'\', \'recommend_detail\',\'\',\''+activityIndex+'\')';var addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Recommend</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a class="btnIconAdd font_13" onclick="assignTripItemData(\'viator\', \''+activityIndex+'\');addItemToTrip(\''+bucketId+'\', \'8\', \''+i+'\', \'recommend_detail\',\'\',\''+activityIndex+'\')"> Recommend</a></div>';}else{addToTripButton='<span class="font_13 highlight">Already added to trip</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a class="font_13 highlight" onclick="">Already added to trip</a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}else{function_name='removeFromTrip(\'8\', \'8\', \''+i+'\',\'recommend_detail\',\''+activityIndex+'\');';var isExists=inArrayJS(i+'_'+bucketId,sourceIdArray);var foruserExist=inArrayJS(i+'_'+bucketId,userSourceIdArray);if(isExists==true&&foruserExist==true){addToTripButton='<span class="font_13 highlight">Recommended by friends and You</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><span class="highlight">Recommended by friends and You </span></div>';}else if(isExists==true){addToTripButton='<span id="recommend_detail_friend"><span class="font_13 highlight">Recommended by friends</span>';addToTripButton+='&nbsp;&nbsp;&nbsp;<a href="javascript:void(0);" class="btnIconAdd blue_link" onclick="assignTripItemData(\'viator\', \''+activityIndex+'\');addItemToTrip(\''+bucketId+'\', \'8\', \''+i+'\', \'recommend_detail\')">I Recommend</a></span>';strButton='<span id="recommend_detail_friend1"><div class="addTrip" id="detail_bottom_btn_'+i+'"><span class="highlight font_13">Recommended by friends</span>&nbsp;&nbsp;<a class="btnIconAdd blue_link" onclick="assignTripItemData(\'viator\', \''+activityIndex+'\');addItemToTrip(\''+bucketId+'\', \'8\', \''+i+'\', \'recommend_detail\',\'\',\''+activityIndex+'\')">I Recommend</a></div></span>';}else{addToTripButton='<span class="font_13 highlight">Recommended</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a class="font_13 highlight" onclick="">Recommended </a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;if(recommandAddbtn[bucketId]+'buttonInfo'=="attbuttonInfo"){$("#att_button_info").show();}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
if(btnFlag){$('.add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;case 11:url='/html5/trip/checkexistance/source/6/tripPartId/'+tripPartId+'/sourceId/'+i+'/categoryId/'+bucketId+'/recommend/1/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,i);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_'+bucketId){function_name='assignTripItemData(\'hotel\', \''+hotelArrayIndex+'\');addItemToTrip(\''+bucketId+'\', \'6\', \''+i+'\', \'recommend_detail\',\'\',\''+hotelArrayIndex+'\')';var addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Recommend</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a class="btnIconAdd font_13" onclick="assignTripItemData(\'hotel\', \''+hotelArrayIndex+'\');addItemToTrip(\''+bucketId+'\', \'6\', \''+i+'\', \'recommend_detail\',\'\',\''+hotelArrayIndex+'\')"> Recommend</a></div>';}else{addToTripButton='<span class="font_13 highlight">Already added to trip</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a class="font_13 highlight" onclick="">Already added to trip</a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}else{function_name='removeFromTrip(\''+bucketId+'\', \'6\', \''+i+'\', \'friend\',\''+hotelArrayIndex+'\')';var isExists=inArrayJS(i+'_'+bucketId,sourceIdArray);var foruserExist=inArrayJS(i+'_'+bucketId,userSourceIdArray);if(isExists==true&&foruserExist==true){addToTripButton='<span class="font_13 highlight">Recommended by friends and You</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><span class="highlight">Recommended by friends and You</span></div>';}else if(isExists==true){addToTripButton='<span id="recommend_detail_friend"><span class="font_13 highlight">Recommended by friends</span>';addToTripButton+='&nbsp;&nbsp;&nbsp;<a href="javascript:void(0);" class="btnIconAdd blue_link" onclick="assignTripItemData(\'hotel\', \''+hotelArrayIndex+'\');addItemToTrip(\''+bucketId+'\', \'6\', \''+i+'\', \'recommend_detail\',\'\',\''+hotelArrayIndex+'\')">I Recommend</a></span>';strButton='<span id="recommend_detail_friend1"><div class="addTrip" id="detail_bottom_btn_'+i+'"><span class="highlight font_13">Recommended by friends</span>&nbsp;&nbsp;<a class="btnIconAdd blue_link" onclick="assignTripItemData(\'hotel\', \''+hotelArrayIndex+'\');addItemToTrip(\''+bucketId+'\', \'6\', \''+i+'\', \'recommend_detail\',\'\',\''+hotelArrayIndex+'\')">I Recommend</a></div></span>';}else{addToTripButton='<span class="font_13 highlight">Recommended</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a class="font_13 highlight" onclick="">Recommended </a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
if(btnFlag){$('.add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;case 12:url='/html5/trip/checkexistance/source/5/tripPartId/'+tripPartId+'/sourceId/'+i+'/categoryId/'+bucketId+'/recommend/1/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,i);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_'+bucketId){function_name='addItemToTrip(\''+bucketId+'\', \'5\', \''+i+'\', \'recommend_detail\',\'\',\''+eventIndex+'\')';var addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Recommend</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+replaceString(i)+'" ><a class="btnIconAdd font_13" onclick="addItemToTrip(\''+bucketId+'\', \'5\', \''+i+'\', \'recommend_detail\',\'\',\''+eventIndex+'\')"> Recommend</a></div>';}else{addToTripButton='<span class="font_13 highlight">Already added to trip</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+replaceString(i)+'"><a class="font_13 highlight" onclick="">Already added to trip</a></div>';}
document.getElementById("eventbuttonInfo").innerHTML=strButton;document.getElementById("eventbuttonInfo").style.display="block";}else{function_name='removeFromTrip(\''+bucketId+'\', \'5\', \''+i+'\', \'friend\',\''+eventIndex+'\')';var isExists=inArrayJS(i+'_'+bucketId,sourceIdArray);var foruserExist=inArrayJS(i+'_'+bucketId,userSourceIdArray);if(isExists==true&&foruserExist==true){addToTripButton='<span class="font_13 highlight">Recommended by friends and You</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+replaceString(i)+'"><span class="highlight">Recommended by friends and You</span></div>';}else if(isExists==true){addToTripButton='<span id="recommend_detail_friend"><span class="font_13 highlight">Recommended by friends</span>';addToTripButton+='&nbsp;&nbsp;&nbsp;<a href="javascript:void(0);" class="btnIconAdd blue_link" onclick="addItemToTrip(\''+bucketId+'\', \'5\', \''+i+'\', \'recommend_detail\',\'\',\''+eventIndex+'\')">I Recommend</a></span>';strButton='<span id="recommend_detail_friend1"><div class="addTrip" id="detail_bottom_btn_'+replaceString(i)+'"><span class="highlight font_13">Recommended by friends</span>&nbsp;&nbsp;<a class="btnIconAdd blue_link" onclick="addItemToTrip(\''+bucketId+'\', \'5\', \''+i+'\', \'recommend_detail\',\'\',\''+eventIndex+'\')">I Recommend</a></div></span>';}else{addToTripButton='<span class="font_13 highlight">Recommended</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a class="font_13 highlight" onclick="">Recommended </a></div>';}
document.getElementById("eventbuttonInfo").innerHTML=strButton;document.getElementById("eventbuttonInfo").style.display="block";}
if(btnFlag){$('.add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;case 13:$('#add_to_trip_button').html('');url='/html5/trip/checkexistance/source/4/tripPartId/'+tripPartId+'/sourceId/'+i+'/categoryId/'+bucketId+'/recommend/1'+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,i);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_'+bucketId){function_name='addItemToTrip(\''+bucketId+'\', 4, \''+i+'\', \'recommend_detail\',\'\',\''+dealIndex+'\')';var addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+function_name+'"> Recommend</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a class="btnIconAdd font_13" onclick="addItemToTrip(\''+bucketId+'\', \'4\', \''+i+'\', \'recommend_detail\',\'\',\''+dealIndex+'\')"> Recommend</a></div>';}else{addToTripButton='<span class="font_13 highlight">Already added to trip</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a class="font_13 highlight" onclick="">Already added to trip</a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}else{function_name='removeFromTrip(\''+bucketId+'\', \'4\', \''+i+'\', \'true\',\''+dealIndex+'\')';var isExists=inArrayJS(i+'_'+bucketId,sourceIdArray);var foruserExist=inArrayJS(i+'_'+bucketId,userSourceIdArray);if(isExists==true&&foruserExist==true){addToTripButton='<span class="font_13 highlight">Recommended by friends and You</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><span class="highlight">Recommended by friends and You</span></div>';}else if(isExists==true){addToTripButton='<span id="recommend_detail_friend"><span class="font_13 highlight">Recommended by friends</span>';addToTripButton+='&nbsp;&nbsp;&nbsp;<a href="javascript:void(0);" class="btnIconAdd blue_link" onclick="addItemToTrip(\''+bucketId+'\', \'4\', \''+i+'\', \'recommend_detail\',\'\',\''+dealIndex+'\')">I Recommend</a></span>';strButton='<span id="recommend_detail_friend1"><div class="addTrip" id="detail_bottom_btn_'+i+'" ><span class="highlight font_13">Recommended by friends</span>&nbsp;&nbsp;<a class="btnIconAdd blue_link" onclick="addItemToTrip(\''+bucketId+'\', \'4\', \''+i+'\', \'recommend_detail\',\'\',\''+dealIndex+'\')">I Recommend</a></div></span>';}else{addToTripButton='<span class="font_13 highlight">Recommended</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a class="font_13 highlight" onclick="">Recommended </a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
if(btnFlag){$('.add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;case 16:$('#add_to_trip_button').html('');url='/html5/trip/checkexistance/source/7/tripPartId/'+tripPartId+'/sourceId/'+i+'/categoryId/'+bucketId+'/recommend/1'+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,i);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_'+bucketId){function_name='addItemToTrip(\''+bucketId+'\', 7, \''+i+'\', \'recommend_detail\',\'\',\''+hostelArrayIndex+'\')';var addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="assignTripItemData(\'hostel\', \''+hostelArrayIndex+'\');'+function_name+'"> Recommend</a>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a class="btnIconAdd font_13" onclick="assignTripItemData(\'hostel\', \''+hostelArrayIndex+'\'); addItemToTrip(\''+bucketId+'\', \'7\', \''+i+'\', \'recommend_detail\',\'\',\''+hostelArrayIndex+'\')"> Recommend</a></div>';}else{addToTripButton='<span class="font_13 highlight">Already added to trip</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a class="font_13 highlight" onclick="">Already added to trip</a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}else{function_name='removeFromTrip(\''+bucketId+'\', \'7\', \''+i+'\', \'true\',\''+hostelArrayIndex+'\')';var isExists=inArrayJS(i+'_'+bucketId,sourceIdArray);var foruserExist=inArrayJS(i+'_'+bucketId,userSourceIdArray);if(isExists==true&&foruserExist==true){addToTripButton='<span class="font_13 highlight">Recommended by friends and You</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><span class="highlight">Recommended by friends and You </span></div>';}else if(isExists==true){addToTripButton='<span id="recommend_detail_friend"><span class="font_13 highlight">Recommended by friends</span>';addToTripButton+='&nbsp;&nbsp;&nbsp;<a href="javascript:void(0);" class="btnIconAdd blue_link" onclick="assignTripItemData(\'hostel\', \''+hostelArrayIndex+'\'); addItemToTrip(\''+bucketId+'\', \'7\', \''+i+'\', \'recommend_detail\',\'\',\''+hostelArrayIndex+'\')">Recommend Also</a></span>';strButton='<span id="recommend_detail_friend1"><div class="addTrip" id="detail_bottom_btn_'+i+'"><span class="highlight font_13">Recommended by friends</span>&nbsp;&nbsp;<a class="btnIconAdd blue_link" onclick="assignTripItemData(\'hostel\', \''+hostelArrayIndex+'\'); addItemToTrip(\''+bucketId+'\', \'7\', \''+i+'\', \'recommend_detail\',\'\',\''+hostelArrayIndex+'\')">I Recommend</a></div></span>';}else{addToTripButton='<span class="font_13 highlight">Recommended</span>';strButton='<div class="addTrip" id="detail_bottom_btn_'+i+'"><a class="font_13 highlight" onclick="">Recommended </a></div>';}
document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').innerHTML=strButton;document.getElementById(recommandAddbtn[bucketId]+'buttonInfo').style.display="block";}
if(btnFlag){$('.add_to_trip_button').html(addToTripButton);btnFlag=false;}});break;}}
function removeFromTrip(categoryId,source,sourceId,itemFlag,i){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
$('#notifyme').css('top','67px');displayLoadingImage(sourceId,itemFlag,categoryId);var functionAssign='';switch(categoryId){case'1':functionAssign='assignTripItemData(\'poi\',\''+i+'\');';break;case'3':functionAssign='assignTripItemData(\'poi\',\''+i+'\');';break;case'4':functionAssign='assignTripItemData(\'poi\',\''+i+'\');';break;case'6':functionAssign='assignTripItemData(\'poi\',\''+i+'\');';break;case'8':functionAssign='assignTripItemData(\'viator\',\''+i+'\');';break;case'11':functionAssign='assignTripItemData(\'hotel\',\''+i+'\');';break;case'12':functionAssign='assignTripItemData(\'event\',\''+i+'\');';break;case'16':functionAssign='assignTripItemData(\'hostel\',\''+i+'\');';break;default:functionAssign='';}
url='/self/removepoiplaces/source/'+source+'/tripPartId/'+tripPartId+'/apiid/'+sourceId;$.get(url,function(result){notifyme(getPanelByBucketId(categoryId)+" removed from trip successfully","error");$('#notifyme').css('top','67px');if(isLiveServer==true){var gaTitleCategory="HTML5 - Plan - "+selectedCityname+" - "+getPanelByBucketId(categoryId)+" - Remove From Trip";_gaq.push(["_trackEvent",gaTitleCategory,"Clicked"]);}
if(itemFlag=='bing'){if(explorePanelMode=='friend'){strButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+functionAssign+'addItemToTrip(\''+categoryId+'\', \''+source+'\', \''+sourceId+'\', \'bing\',\'\',\''+i+'\')"> Add to Trip</a>'}else{strButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+functionAssign+'addItemToTrip(\''+categoryId+'\', \''+source+'\', \''+sourceId+'\', \'bing\',\'\',\''+i+'\')"> Add to Trip</a>'
strButtonDetailBottom='<div class="addTrip"><a onClick="'+functionAssign+'addItemToTrip(\''+categoryId+'\', \''+source+'\', \''+sourceId+'\', \'bing\',\'\',\''+i+'\')" class="btnIconAdd font_13"> Add to Trip</a></div>';}
document.getElementById("bing_map_add_to_trip").innerHTML=strButton;if(categoryId=='6'||categoryId=='4'||categoryId=='3'||categoryId=='1'){var gridId=replaceString(sourceId)+'_'+categoryId;}else{var gridId=replaceString(sourceId);}
if(categoryId=='6'||categoryId=='4'||categoryId=='3'||categoryId=='1'){var gridId=replaceString(sourceId)+'_'+categoryId;}else{var gridId=replaceString(sourceId);}
$('#gridBtn_'+gridId).html(strButton);$("#detail_top_btn_"+gridId).html(strButton);$("#detail_bottom_btn_"+gridId).html(strButtonDetailBottom);var id=sourceId+"_"+categoryId;updateItemSourceList(id);}else if(itemFlag=='grid'){strButton='<a href="javascript://" onClick="'+functionAssign+'addItemToTrip(\''+categoryId+'\', \''+source+'\', \''+sourceId+'\', \''+itemFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link"> Add to Trip </a>';if(categoryId=='6'||categoryId=='4'||categoryId=='3'||categoryId=='1'){var gridId=replaceString(sourceId)+'_'+categoryId;}else{var gridId=replaceString(sourceId);}
$('#gridBtn_'+gridId).html(strButton);var id=sourceId+"_"+categoryId;updateItemSourceList(id);}else if(itemFlag=='friend'){strButton='<a href="javascript://" onClick="'+functionAssign+'addItemToTrip(\''+categoryId+'\', \''+source+'\', \''+sourceId+'\', \''+itemFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link"> Recommend </a>';if(categoryId=='6'||categoryId=='4'||categoryId=='3'||categoryId=='1'){var gridId=replaceString(sourceId)+'_'+categoryId;}else{var gridId=replaceString(sourceId);}
$('#gridBtn_'+gridId).html(strButton);function_name='addItemToTrip(\''+categoryId+'\' , \''+source+'\', \''+sourceId+'\', \''+itemFlag+'\',\'\',\''+i+'\')';var addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+functionAssign+' '+function_name+'"> Recommend</a>';$("#add_to_trip_button").html('');$('.add_to_trip_button').html(addToTripButton);strButton='<div class="addTrip" ><a class="btnIconAdd font_13" onclick="'+functionAssign+'addItemToTrip(\''+categoryId+'\', \''+source+'\', \''+sourceId+'\', \''+itemFlag+'\',\'\',\''+i+'\')"> Recommend</a></div>';document.getElementById(recommandAddbtn[categoryId]+'buttonInfo').innerHTML=strButton;updateItemSourceList(sourceId+"_"+categoryId);}else{if(categoryId=='6'||categoryId=='4'||categoryId=='3'||categoryId=='1'){var gridId=replaceString(sourceId)+'_'+categoryId;}else{var gridId=replaceString(sourceId);}
function_name='addItemToTrip(\''+categoryId+'\' , \''+source+'\', \''+sourceId+'\', \'true\',\'\',\''+i+'\')';var addToTripButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+functionAssign+' '+function_name+'"> Add to Trip</a>';strButtonGrid='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="'+functionAssign+'addItemToTrip(\''+categoryId+'\', \''+source+'\', \''+sourceId+'\', \'true\',\'\',\''+i+'\')"> Add to Trip</a>'
strButton='<a class="btnIconAdd font_13" onclick="'+functionAssign+'addItemToTrip(\''+categoryId+'\', \''+source+'\', \''+sourceId+'\', \'true\',\'\',\''+i+'\')"> Add to Trip</a>';$('#gridBtn_'+gridId).html(strButtonGrid);$("#detail_top_btn_"+gridId).html(addToTripButton);$("#detail_bottom_btn_"+gridId).html(strButton);var id=sourceId+"_"+categoryId;updateItemSourceList(id);}});}
function updateItemSourceList(sourceId){if(explorePanelMode=='friend'){var sourceIds=$("#userItemSourceIds").val();}else{var sourceIds=$("#tripItemSourceIds").val();}
var newVal='';if(sourceIds!=''){var sourceIdArray=sourceIds.split(',');var idx=sourceIdArray.indexOf(sourceId);if(idx!=-1){newVal=sourceIdArray.splice(idx,1);newVal=sourceIdArray;}}
if(explorePanelMode=='friend'){$("#userItemSourceIds").val(newVal);}else{$("#tripItemSourceIds").val(newVal);}}
function getNewSourceIdList(list,value){for(var i=0;i<list.length;i++){if(list[i]==value){vlist.splice(i,1);return list.join(",");}}
return list;}
function updateSourceIdList(what,flag){var newList=new Array();var oldList=$("#tripItemSourceIds").val();var a=false;if(oldList!=''){for(var i=0;i<oldList.length;i++){if(what!=oldList[i])
{if(flag==true)
{newList[i]=oldList[i];}
else{}}}}
else{}
$("#tripItemSourceIds").val(newList);}
function getAddToTripButtonCodeForEvent(bucketId,i){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
switch(bucketId){case 12:url='/html5/trip/checkexistance/source/3/tripPartId/'+tripPartId+'/sourceId/'+planDataCache[i].id+'/categoryId/'+bucketId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(result){$("#trip_part_response").val(result);if(result==1){strButton='<div class="addTrip" ><a class="btnIconAdd font_13" onclick="addItemToTrip(\''+i+'\', 3, '+planDataCache[i].id+', true)"> Add to Trip</a></div>';document.getElementById("eventbuttonInfo").innerHTML=strButton;document.getElementById("eventbuttonInfo").style.display="block";}else{strButton='<div class="addTrip" ><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removeFromTrip('+planDataCache[i].categoryId+', 3, '+planDataCache[i].id+');"> Remove</a></div>';document.getElementById("eventbuttonInfo").innerHTML=strButton;document.getElementById("eventbuttonInfo").style.display="block";}});break;}}
function getRemoveToTripButtonCode(bucketId,i){switch(bucketId){case 1:removeToTripButton='<div class="addTrip" ><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="addtoAttraction(\'foursquare\',\''+planDataCache[i].id+'\',\''+addslashes(planDataCache[i].name)+'\',\''+addslashes(planDataCache[i].address1)+'\',\''+planDataCache[i].website+'\',\''+planDataCache[i].formattedPhone+'\')"> Remove</a></div>';return removeToTripButton;break;case 3:removeToTripButton='<div class="addTrip" ><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="addtoRestaurant(\'foursquare\',\''+planDataCache[i].id+'\',\''+addslashes(planDataCache[i].name)+'\',\''+addslashes(planDataCache[i].address1)+'\',\''+planDataCache[i].website+'\',\''+planDataCache[i].formattedPhone+'\')"> Remove</a></div>';return removeToTripButton;break;case 4:removeToTripButton='<div class="addTrip" ><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="addtoNightlife(\'foursquare\',\''+planDataCache[i].id+'\',\''+addslashes(planDataCache[i].name)+'\',\''+addslashes(planDataCache[i].address1)+'\',\''+planDataCache[i].website+'\',\''+planDataCache[i].formattedPhone+'\')"> Remove</a></div>';return removeToTripButton;break;case 6:removeToTripButton='<div class="addTrip" ><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="addtoShopping(\'foursquare\',\''+planDataCache[i].id+'\',\''+addslashes(planDataCache[i].name)+'\',\''+addslashes(planDataCache[i].address1)+'\',\''+planDataCache[i].website+'\',\''+planDataCache[i].formattedPhone+'\')"> Remove</a></div>';return removeToTripButton;break;case 8:removeToTripButton='<div class="addTrip" ><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="addtoActivity(\'foursquare\',\''+planDataCache[i].id+'\',\''+addslashes(planDataCache[i].name)+'\',\''+addslashes(planDataCache[i].address1)+'\',\''+planDataCache[i].website+'\',\''+planDataCache[i].formattedPhone+'\')"> Remove</a></div>';return removeToTripButton;break;}}
function capitaliseFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1);}
function openAttractionRecommendationInfo(id,name,address,lat,lng)
{$("#attraction .list li").removeClass('current');$('#liat_'+divMap[bucketId]+id).addClass('current');city=document.getElementById("hdnCity").value;tripPartId=document.getElementById("tripPartId").value;document.getElementById("attractionInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';url='/html5/plan/buildattractioninfo/source/yelp/id/'+id+'/name/'+name+'/address/'+address+'/lat/'+lat+'/lng/'+lng+'/tripPartId/'+tripPartId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){arrdata=data.split("|||");document.getElementById("attractionInfo").innerHTML=arrdata[0];document.getElementById("attbuttonInfo").innerHTML=arrdata[3];if(!showBelow){$(this).resizepanels(420);$("#attrPanelScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#attPanelScrollPrev",downID:"#attPanelScrollNext",scrollerID:"#attrPanelContent"});}
try{getAttractionMap(arrdata[1],arrdata[2]);}
catch(err){}});}
var activityListDetails=new Array();function openActivityCategory(cat,name,radius_filter,page){$("#add_to_trip_button").html('');activeExploreTab='Activities';if(activityFlag==false){activityFlag=true;showBing();}
businessId="active";city=document.getElementById("hdnCity").value;if(cat!='')
document.getElementById("hdnactivitycat").value=cat;if(radius_filter!='')
document.getElementById("hdnactivityfilter").value=radius_filter;if(name!='')
document.getElementById("hdnactivityname").value=name;cat=document.getElementById("hdnactivitycat").value
radius_filter=document.getElementById("hdnactivityfilter").value
name=document.getElementById("hdnactivityname").value;if(typeof radius_filter=='undefined')
radius_filter=0;if(typeof page=='undefined')
page=0;url='/html5/plan/buildactivitylist/city/'+city+'/cat/'+cat+'/radius_filter/'+radius_filter+'/page/'+page+'/rand/'+parseInt(Math.random()*99999999);$("#weather").hide();document.getElementById("displayActivityItem").innerHTML='<a href="javascript:;"> '+name+'</a>';document.getElementById("activityList").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';if(activityListDetails[city]){arrdata=activityListDetails[city].split("|||");businessId=arrdata[0];document.getElementById("activityList").innerHTML=arrdata[1];if(name=="Top Recommendations"){topRecommendation=true;$("#activitybuttonInfo").hide();$("#add_to_trip_button").hide();$("#activities .list").hide();openActRecommendation(8,'activityList');}else{topRecommendation=false;openYelpInfoForActivity(url,'activityList','neiActivity')
$("#activities .list").show();$("#add_to_trip_button").show();$("#activitybuttonInfo").show();$("#attbuttonInfo").hide();}
$(this).resizepanels(420);$("#attScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#prevAttract",downID:"#nextAtt",scrollerID:"#attInnerWrapper"});$("#attrScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#attrScrollPrev",downID:"#attrScroll",scrollerID:"#attrContent"});}else{if(name=="Top Recommendations"){topRecommendation=true;$("#add_to_trip_button").hide();$("#activitybuttonInfo").hide();openActRecommendation(8,'activityList');}else{topRecommendation=false;openYelpInfoForActivity(url,'activityList','neiActivity')
$("#activities .list").show();$("#add_to_trip_button").show();$("#activitybuttonInfo").show();$("#attbuttonInfo").hide();}
if(!showBelow){$(this).resizepanels(420);$("#actScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#prevActivity",downID:"#nextActivity",scrollerID:"#actInnerWrapper"});$("#acctScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#activityScrollDiv",downID:"#activityScroll",scrollerID:"#acctContent"});}}
$("#listActivityCategory").slideUp("fast");}
function openGeoramaActivity(cat,name,radius_filter,page){activeExploreTab='Activities';$("#activitiesDetails").hide();$("#activities .list").hide();$("#activitiesInfo").show();businessId="active";if(activityFlag==false){activityFlag=true;showBing();}
city=document.getElementById("hdnCity").value;if(cat!='')
document.getElementById("hdnactivitycat").value=cat;if(radius_filter!='')
document.getElementById("hdnactivityfilter").value=radius_filter;if(name!='')
document.getElementById("hdnactivityname").value=name;cat=document.getElementById("hdnactivitycat").value
radius_filter=document.getElementById("hdnactivityfilter").value
name=document.getElementById("hdnactivityname").value;if(typeof radius_filter=='undefined')
radius_filter=0;if(typeof page=='undefined')
page=0;url='/html5/plan/buildactivitylistS/city/'+city+'/cat/'+cat+'/radius_filter/'+radius_filter+'/page/'+page+'/rand/'+parseInt(Math.random()*99999999);$("#weather").hide();document.getElementById("displayActivityItem").innerHTML='<a href="javascript:;"> '+name+'</a>';$(".primaryColRight").css("marginLeft","0");document.getElementById("activityList").innerHTML='<div style="padding:150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt=""/></div>';if(activityListDetail[city]){arrdata=activityListDetail[city].split("|||");businessId=arrdata[0];document.getElementById("activityList").innerHTML=arrdata[1];if(name=="Top Recommendations"){$("#activitybuttonInfo").hide();recommendsubcat='';openPlanActivity('8','activityList')}else{$("#activitybuttonInfo").show();$("#activity_button_info").show();document.getElementById("activitiesInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';openYelpInfo(url,'activityList','neiActivity');}
if(!showBelow){$(this).resizepanels(420);$("#attScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#prevAttract",downID:"#nextAtt",scrollerID:"#attInnerWrapper"});$("#attrScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#attrScrollPrev",downID:"#attrScroll",scrollerID:"#attrContent"});}}else{if(name=="Top Recommendations"){topRecommendation=true;openPlanActivity('8','activityList')}else{topRecommendation=false;openYelpInfo(url,'activityList','neiActivity');}
if(!showBelow){$(this).resizepanels(420);$("#actScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#prevActivity",downID:"#nextActivity",scrollerID:"#actInnerWrapper"});$("#acctScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#activityScrollDiv",downID:"#activityScroll",scrollerID:"#acctContent"});}}
$("#listActivityCategory").slideUp("fast");}
function openActivityInfo(id){$("#activities .list li").removeClass('current');$('#liac_'+id).addClass('current');city=document.getElementById("hdnCity").value;tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
document.getElementById("activitiesInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';url='/html5/plan/buildactivityinfo/source/yelp/id/'+id+'/tripartid/'+tripPartId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){arrdata=data.split("|||");document.getElementById("activitiesInfo").innerHTML=arrdata[0];document.getElementById("activitybuttonInfo").innerHTML=arrdata[3];if(!showBelow){$(this).resizepanels(420);$("#acctPanelScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#actPanelScrollPrev",downID:"#actPanelScrollNext",scrollerID:"#acctPanelContent"});}
try{getActivityMap(arrdata[1],arrdata[2]);}
catch(err){}});}
function openActivityRecommendation(cat,name){city=document.getElementById("hdnCity").value;url='/html5/plan/fetchcitylatlong/city/'+city+'/rand/'+parseInt(Math.random()*99999999);document.getElementById("displayActivityItem").innerHTML='<a href="javascript:;"> '+name+'</a>';var strReturn='';document.getElementById("activityList").innerHTML='<div style="padding:150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>';$.get(url,function(data)
{urlfs='/foursquare/recommendedvenues/ll/'+data+'/cat//rand/'+parseInt(Math.random()*99999999);$.get(urlfs,function(fsdata){strReturn+='<a href="javascript://" class="prev-list" id="prevActivity">&nbsp;</a><div id="actScrollDiv" class="pnlScrollCont"><div id="actInnerWrapper"><ul id="lstActivity" class="leftList">';$.each(fsdata.response.groups,function(i,value){k=0;$.each(value.items,function(j,val){if(k==0)
{id=val.venue.id;name=val.venue.name;address2=val.venue.location.address+', '+val.venue.location.city+', '+val.venue.location.state;;lat=val.venue.location.lat;lng=val.venue.location.lng;}
address=val.venue.location.address+', '+val.venue.location.city+', '+val.venue.location.state;strReturn+='<li id="liac_'+val.venue.id+'"><a href="javascript:;" onClick="javascript:openActivityRecommendationInfo(\''+val.venue.id+'\',\''+val.venue.name+'\',\''+address+'\',\''+val.venue.location.lat+'\',\''+val.venue.location.lng+'\')">'+val.venue.name+'</a></li>';k++;});});strReturn+='</ul></div></div><a href="javascript://" class="next-list" id="nextActivity">&nbsp;</a> ';document.getElementById("activityList").innerHTML=strReturn;openActivityRecommendationInfo(id,name,address2,lat,lng);});});$("#listAttractionCategory").slideUp("fast");}
function openActivityRecommendationInfo(id,name,address,lat,lng)
{$("li").removeClass('current');$('#liac_'+id).addClass('current');city=document.getElementById("hdnCity").value;tripPartId=document.getElementById("tripPartId").value;document.getElementById("activitiesInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';url='/html5/plan/buildactivityinfo/source/yelp/id/'+id+'/name/'+name+'/address/'+address+'/lat/'+lat+'/lng/'+lng+'/tripPartId/'+tripPartId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){arrdata=data.split("|||");document.getElementById("activitiesInfo").innerHTML=arrdata[0];document.getElementById("activitybuttonInfo").innerHTML=arrdata[3];if(!showBelow){$(this).resizepanels(420);$("#acctPanelScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#actPanelScrollPrev",downID:"#actPanelScrollNext",scrollerID:"#acctPanelContent"});}
try{getActivityMap(arrdata[1],arrdata[2]);}
catch(err){}});}
function openRestaurantRecommendation(cat,name)
{city=document.getElementById("hdnCity").value;url='/html5/plan/fetchcitylatlong/city/'+city+'/rand/'+parseInt(Math.random()*99999999);document.getElementById("displayRestaurantItem").innerHTML='<a href="javascript:;"> '+name+'</a>';var strReturn='';document.getElementById("restaurantList").innerHTML='<div style="padding:150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>';$.get(url,function(data)
{urlfs='/foursquare/recommendedvenues/ll/'+data+'/cat//rand/'+parseInt(Math.random()*99999999);$.get(urlfs,function(fsdata){strReturn+='<a href="javascript://" class="prev-list" id="prevRest">&nbsp;</a><div id="restScrollDiv" class="pnlScrollCont"><div id="restInnerWrapper"><ul id="restList" class="leftList">';$.each(fsdata.response.groups,function(i,value){k=0;$.each(value.items,function(j,val){if(k==0)
{id=val.venue.id;name=val.venue.name;address2=val.venue.location.address+', '+val.venue.location.city+', '+val.venue.location.state;;lat=val.venue.location.lat;lng=val.venue.location.lng;}
address=val.venue.location.address+', '+val.venue.location.city+', '+val.venue.location.state;strReturn+='<li id="liat_'+divMap[bucketId]+val.venue.id+'"><a href="javascript:;" onClick="javascript:opeRestaurantRecommendationInfo(\''+val.venue.id+'\',\''+val.venue.name+'\',\''+address+'\',\''+val.venue.location.lat+'\',\''+val.venue.location.lng+'\')">'+val.venue.name+'</a></li>';k++;});});strReturn+='</ul></div></div><a href="javascript://" class="next-list" id="nextRest">&nbsp;</a> ';document.getElementById("restaurantList").innerHTML=strReturn;opeRestaurantRecommendationInfo(id,name,address2,lat,lng);});});$("#listRestaurantCategory").slideUp("fast");}
function opeRestaurantRecommendationInfo(id,name,address,lat,lng)
{$("li").removeClass('current');$('#lirs_'+id).addClass('current');city=document.getElementById("hdnCity").value;tripPartId=document.getElementById("tripPartId").value;document.getElementById("restaurantInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';url='/html5/plan/buildrestaurantinfo/source/yelp/id/'+id+'/name/'+name+'/address/'+address+'/lat/'+lat+'/lng/'+lng+'/tripPartId/'+tripPartId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){arrdata=data.split("|||");document.getElementById("restaurantInfo").innerHTML=arrdata[0];document.getElementById("resbuttonInfo").innerHTML=arrdata[3];if(!showBelow){$(this).resizepanels(420);$("#restPanelScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#restPanelScrollPrev",downID:"#restPanelScrollNext",scrollerID:"#restPanelContent"});}
try{getRestaurantMap(arrdata[1],arrdata[2]);}
catch(err){}});}
function openNightlifeRecommendation(cat,name)
{city=document.getElementById("hdnCity").value;url='/html5/plan/fetchcitylatlong/city/'+city+'/rand/'+parseInt(Math.random()*99999999);document.getElementById("displayNightlifeItem").innerHTML='<a href="javascript:;"> '+name+'</a>';var strReturn='';document.getElementById("nightlifeList").innerHTML='<div style="padding:150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>';$.get(url,function(data)
{urlfs='/foursquare/recommendedvenues/ll/'+data+'/cat//rand/'+parseInt(Math.random()*99999999);$.get(urlfs,function(fsdata){strReturn+='<a href="javascript://" class="prev-list" id="prevNight">&nbsp;</a><div id="scrollDiv" class="pnlScrollCont"><div id="innerWrapper"><ul id="lstNight" class="leftList">';$.each(fsdata.response.groups,function(i,value){k=0;$.each(value.items,function(j,val){if(k==0)
{id=val.venue.id;name=val.venue.name;address2=val.venue.location.address+', '+val.venue.location.city+', '+val.venue.location.state;;lat=val.venue.location.lat;lng=val.venue.location.lng;}
address=val.venue.location.address+', '+val.venue.location.city+', '+val.venue.location.state;strReturn+='<li id="liat_'+divMap[bucketId]+val.venue.id+'"><a href="javascript:;" onClick="javascript:opeNightlifeRecommendationInfo(\''+val.venue.id+'\',\''+val.venue.name+'\',\''+address+'\',\''+val.venue.location.lat+'\',\''+val.venue.location.lng+'\')">'+val.venue.name+'</a></li>';k++;});});strReturn+='</ul></div></div><a href="javascript://" class="next-list" id="nextNight">&nbsp;</a> ';document.getElementById("nightlifeList").innerHTML=strReturn;opeNightlifeRecommendationInfo(id,name,address2,lat,lng);});});$("#listNightlifeCategory").slideUp("fast");}
function opeNightlifeRecommendationInfo(id,name,address,lat,lng)
{$("li").removeClass('current');$('#lini_'+id).addClass('current');city=document.getElementById("hdnCity").value;tripPartId=document.getElementById("tripPartId").value;document.getElementById("nightlifeInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';url='/html5/plan/buildnightlifeinfo/source/yelp/id/'+id+'/name/'+name+'/address/'+address+'/lat/'+lat+'/lng/'+lng+'/tripPartId/'+tripPartId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){arrdata=data.split("|||");document.getElementById("nightlifeInfo").innerHTML=arrdata[0];document.getElementById("nightbuttonInfo").innerHTML=arrdata[3];if(!showBelow){$(this).resizepanels(420);$("#nightPanelScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#nightPanelScrollPrev",downID:"#nightPanelScrollNext",scrollerID:"#nightPanelContent"});}
try{getNightlifeMap(arrdata[1],arrdata[2]);}
catch(err){}});}
var restaurantListDetails=new Array();function openRestaurantCategory(cat,name,radius_filter,page){activeExploreTab='Restaurants';$("#searchBar"+cat).show();$("#restaurantDetails").hide();$("#restaurantInfo").show();$("#restaurant .list").hide();$("#restaurantBtnBTR").hide();if(restaurantFlag==false){restaurantFlag=true;}
showBing();businessId="afghani";city=document.getElementById("hdnCity").value;document.getElementById("hdnrestaurantcat").value=cat;if(cat!=''){document.getElementById("hdnrestaurantcat").value=cat;}
if(radius_filter!=''){document.getElementById("hdnrestaurantfilter").value=radius_filter;}
if(name!=''){document.getElementById("hdnrestaurantname").value=name;}
cat=document.getElementById("hdnrestaurantcat").value
radius_filter=document.getElementById("hdnrestaurantfilter").value
name=document.getElementById("hdnrestaurantname").value;if(typeof radius_filter=='undefined'){radius_filter=0;}
if(typeof page=='undefined'){page=0;}
document.getElementById("displayRestaurantItem").innerHTML='<a href="javascript:;"> '+name+'</a>';document.getElementById("restaurantList").innerHTML='<div style="padding:150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>';url='/html5/plan/buildattractionlist/city/'+city+'/cat/'+cat+'/radius_filter/'+radius_filter+'/page/'+page+'/rand/'+parseInt(Math.random()*99999999);if(restaurantListDetails[city]){arrdata=restaurantListDetails[city].split("|||");businessId=arrdata[0];document.getElementById("restaurantList").innerHTML=arrdata[1];if(name=="Top Recommendations"){$("#resbuttonInfo").hide();$("#attbuttonInfo").hide();getFoursquareCategories(3);recommendsubcat="";topRecommendation=true;openRestRecommendation('3','restaurantList');}else{$("#resbuttonInfo").show();topRecommendation=false;document.getElementById("restaurantInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';recommendsubcat="yelp";openRestRecommendation(cat,'restaurantList');}
$(this).resizepanels(420);}else{if(name=="Top Recommendations"){$("#resbuttonInfo").hide();$("#attbuttonInfo").hide();recommendsubcat="";topRecommendation=true;openRestRecommendation('3','restaurantList');}else{topRecommendation=false;document.getElementById("restaurantInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';recommendsubcat="yelp";openRestRecommendation(cat,'restaurantList');}
if(!showBelow){$(this).resizepanels(420);}}}
var restaurantInfoDetails=new Array();function openRestaurantInfo(id){$('#lirs_'+id).addClass('current');city=document.getElementById("hdnCity").value;document.getElementById("restaurantInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';tripPartId=document.getElementById("tripPartId").value;url='/html5/plan/buildrestaurantinfo/source/yelp/id/'+id+'/tripPartId/'+tripPartId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){restaurantInfoDetails[city]=data;arrdata=data.split("|||");document.getElementById("restaurantInfo").innerHTML=arrdata[0];document.getElementById("resbuttonInfo").innerHTML=arrdata[3];if(!showBelow){$(this).resizepanels(420);$("#restPanelScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#restPanelScrollPrev",downID:"#restPanelScrollNext",scrollerID:"#restPanelContent"});}
try{getRestaurantMap(arrdata[1],arrdata[2]);}
catch(err){}});}
var nightlifeListDetails=new Array();function openNightlifeCategory(cat,name,radius_filter,page){activeExploreTab='Nightlife';$("#nightlifeDetails").hide();$("#nightlifeInfo").show();$("#nightlife .list").hide();$("#nightlifeBtnBTR").hide();$(".reviewFooter").hide();showBing();businessId="active";city=document.getElementById("hdnCity").value;document.getElementById("hdnnightlifecat").value=cat;if(cat!=''){document.getElementById("hdnnightlifecat").value=cat;}
if(radius_filter!=''){document.getElementById("hdnnightlifefilter").value=radius_filter;}
if(name!=''){document.getElementById("hdnnightlifename").value=name;}
cat=document.getElementById("hdnnightlifecat").value
radius_filter=document.getElementById("hdnnightlifefilter").value
name=document.getElementById("hdnnightlifename").value;if(typeof radius_filter=='undefined'){radius_filter=0;}
if(typeof page=='undefined'){page=0;}
document.getElementById("displayNightlifeItem").innerHTML='<a href="javascript:;"> '+name+'</a>';document.getElementById("nightlifeList").innerHTML='<div style="padding:150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>';if(name=="Top Recommendations"){topRecommendation=true;getFoursquareCategories(4);recommendsubcat="";openNightRecommendation('4','attractionList');$("#nightbuttonInfo").hide();}else{topRecommendation=false;recommendsubcat="yelp";openNightRecommendation(cat,'attractionList');$("#nightbuttonInfo").show();}
if(!showBelow){$(this).resizepanels(420);$("#scrollDiv").verticalScrollPlus({speed:1000,step:350,upID:"#prevNight",downID:"#nextNight",scrollerID:"#innerWrapper"});$("#nightScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#nightScrollPrev",downID:"#nightScroll",scrollerID:"#nightContent"});}
$("#listNightlifeCategory").slideUp("fast");}
var nightlifeInfoDetails=new Array();function openNightlifeInfo(id){$("li").removeClass('current');$('#lini_'+id).addClass('current');city=document.getElementById("hdnCity").value;document.getElementById("nightlifeInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';tripPartId=document.getElementById("tripPartId").value;url='/html5/plan/buildnightlifeinfo/source/yelp/id/'+id+'/tripPartId/'+tripPartId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){nightlifeInfoDetails[city]=data;arrdata=data.split("|||");document.getElementById("nightlifeInfo").innerHTML=arrdata[0];document.getElementById("nightbuttonInfo").innerHTML=arrdata[3];$("#nightlife .list").show();if(!showBelow){$(this).resizepanels(420);$("#nightPanelScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#nightPanelScrollPrev",downID:"#nightPanelScrollNext",scrollerID:"#nightPanelContent"});}
try{getNightlifeMap(arrdata[1],arrdata[2]);}
catch(err){}});}
var eventTabListDetails=new Array();var eventTabCategory='';function openEventTabCategory(cat,name,date){$("#EventClearFilterLink").hide();$("#eventbuttonInfo").hide();activeExploreTab='Events';$("#searchBar12").val('Keyword');$("#searchBar12").show();$("#eventsInfo").show().html('<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt="" /></div>');$("#eventsDetails").hide();$("#events .list").hide();if(eventFlag==false){eventFlag=true;showBing();}
eventfilterdate='';businessId="E0-001-040467325-4";city=document.getElementById("hdnCity").value;$("#hdneventcat").val(cat);if(cat!=''){$("#hdneventcat").val(cat);}
if(name!=''){$("#hdneventname").val(name);}
$("#displayEventItem").html('<a href="javascript:;" onclick="showEventMenu()">'+name+'</a>');$("#eventList").html('<div style="padding:150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>');if(date){$("#event_datetext").html(date);eventfilterdate=date;}else{$("#pevent_filterbydate").val('Future');$("#event_datetext").html("Future");}
if(eventTabCategoryListing==""){url2='/html5/plan/buildeventcategory/rand/'+parseInt(Math.random()*99999999);$.get(url2,function(data2){eventTabCategoryListing=data2;document.getElementById("eventSubCategory").innerHTML=data2;});}else{document.getElementById("eventSubCategory").innerHTML=eventTabCategoryListing;}
$("#listEventCategory").slideUp("fast");if(name=="Top Recommendations"){$("#hdneventcat").val('');topRecommendation=true;if(document.getElementById("eventcatNamespace")){document.getElementById("eventcatNamespace").innerHTML='<a href="javascript:;">'+name+'</a>';}
openEvents();}else{topRecommendation=false;$("#hdneventcat").val(cat);document.getElementById("eventcatNamespace").innerHTML='<a href="javascript:;">'+name+'</a>';openEvents(cat);}
$(this).resizepanels(420);}
var eventListDetails=new Array();function openEventCategory(cat,name,radius_filter,page){$("#eventsInfo").hide();$("searchBar12").hide();$("#eventsDetails").show().html(preloadDiv);$("#events .list").show().html(preloadDiv);$("#eventsBtnBTR").show();$("#pevent_filter").hide();$("#eventlogo").hide();if(eventFlag==false){eventFlag=true;showBing();}
topRecommendation=false;businessId="E0-001-040467325-4";city=document.getElementById("hdnCity").value;document.getElementById("hdneventcat").value=cat;if(cat!=''){document.getElementById("hdneventcat").value=cat;}
if(radius_filter!=''){document.getElementById("hdneventfilter").value=radius_filter;}
if(name!=''){document.getElementById("hdneventname").value=name;}
cat=document.getElementById("hdneventcat").value
radius_filter=document.getElementById("hdneventfilter").value
name=document.getElementById("hdneventname").value;if(typeof radius_filter=='undefined'){radius_filter=0;}
if(typeof page=='undefined'){page=0;}
document.getElementById("displayEventItem").innerHTML='<a href="javascript:;" onclick="showEventMenu()"> '+name+'</a>';document.getElementById("eventList").innerHTML='<div style="padding:150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>';document.getElementById("eventsDetails").innerHTML='<div style="padding:150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>';url='/html5/plan/buildeventlist/city/'+city+'/cat/'+cat+'/radius_filter/'+radius_filter+'/page/'+page+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){eventListDetails[city]=data;arrdata=data.split("|||");businessId=arrdata[0];document.getElementById("eventList").innerHTML=arrdata[1];if(name=="Top 25 Events"){document.getElementById("eventsInfo").innerHTML=arrdata[2];}else{openEventInfo(businessId);}
if(!showBelow){$(this).resizepanels(420);}});$("#listEventCategory").slideUp("fast");}
var eventInfoDetails=new Array();function openEventInfo(id){global_event_api_id=id;btnFlag=true;$('#eventsDetails').html(preloadDiv);$("#eventlogo").hide();liid=id;liid=liid.replace('@','_')
$("#events .list").show();$("li").removeClass('current');$('#liev_'+liid).addClass('current');city=document.getElementById("hdnCity").value;tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
var recommend=0;if(!(pastTrip&&explorePanelMode=='friend')){if(explorePanelMode=='friend'){recommend=1;}}
url='/html5/plan/buildeventinfo/source/5/id/'+id+'/tripPartId/'+tripPartId+'/recommend/'+recommend+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){eventInfoDetails[city]=data;arrdata=data.split("|||");document.getElementById("eventsDetails").innerHTML=arrdata[0];document.getElementById("eventbuttonInfo").innerHTML=arrdata[3];if(!showBelow){$(this).resizepanels(420);$("#eventsPanelScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#eventsPanelScrollPrev",downID:"#eventsPanelScrollNext",scrollerID:"#eventsPanelContent"});}
try{getEventMap(arrdata[1],arrdata[2]);}
catch(err){}});}
function showEventMenu(){$("#listEventCategory").slideDown("fast");$("#eventsInfo").css('min-height','200px');}
function openActivityShowonMap(){city=document.getElementById("hdnCity").value;cat=document.getElementById("hdnattractcat").value;url='/html5/plan/buildactivityjson/city/'+city+'/cat/'+cat+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){var obj=jQuery.parseJSON(data);for(i=0;i<obj.businesses.length;i++)
{title=obj.businesses[i].name;cat=obj.businesses[i].categories[0][0];lat=obj.businesses[i].location.coordinate.latitude
longitude=obj.businesses[i].location.coordinate.longitude;img_url=obj.businesses[i].image_url;desc=obj.businesses[i].snippet_text;address=obj.businesses[i].location.address[0];phone=obj.businesses[i].phone;id=obj.businesses[i].id;from="yelp";widget="poi";try{showPoiOnMap(title,cat,lat,longitude,img_url,desc,address,phone,id,from,widget)}
catch(err){}}});}
function openAttractionShowonMap()
{city=document.getElementById("hdnCity").value;cat=document.getElementById("hdnattractcat").value;url='/html5/plan/buildattractionjson/city/'+city+'/cat/'+cat+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){var obj=jQuery.parseJSON(data);for(i=0;i<obj.businesses.length;i++)
{title=obj.businesses[i].name;cat=obj.businesses[i].categories[0][0];lat=obj.businesses[i].location.coordinate.latitude
longitude=obj.businesses[i].location.coordinate.longitude;img_url=obj.businesses[i].image_url;desc=obj.businesses[i].snippet_text;address=obj.businesses[i].location.address[0];phone=obj.businesses[i].phone;id=obj.businesses[i].id;from="yelp";widget="poi";try{showPoiOnMap(title,cat,lat,longitude,img_url,desc,address,phone,id,from,widget)}
catch(err){}}});}
function openNightlifeShowonMap()
{city=document.getElementById("hdnCity").value;cat=document.getElementById("hdnnightlifecat").value;url='/html5/plan/buildattractionjson/city/'+city+'/cat/'+cat+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){var obj=jQuery.parseJSON(data);for(i=0;i<obj.businesses.length;i++)
{title=obj.businesses[i].name;cat=obj.businesses[i].categories[0][0];lat=obj.businesses[i].location.coordinate.latitude
longitude=obj.businesses[i].location.coordinate.longitude;img_url=obj.businesses[i].image_url;desc=obj.businesses[i].snippet_text;address=obj.businesses[i].location.address[0];phone=obj.businesses[i].phone;id=obj.businesses[i].id;from="yelp";widget="poi";try{showPoiOnMap(title,cat,lat,longitude,img_url,desc,address,phone,id,from,widget)}
catch(err){alert(err);}}});}
function openRestaurantShowonMap()
{city=document.getElementById("hdnCity").value;cat=document.getElementById("hdnrestaurantcat").value;url='/html5/plan/buildattractionjson/city/'+city+'/cat/'+cat+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){var obj=jQuery.parseJSON(data);for(i=0;i<obj.businesses.length;i++)
{title=obj.businesses[i].name;cat=obj.businesses[i].categories[0][0];lat=obj.businesses[i].location.coordinate.latitude
longitude=obj.businesses[i].location.coordinate.longitude;img_url=obj.businesses[i].image_url;desc=obj.businesses[i].snippet_text;address=obj.businesses[i].location.address[0];phone=obj.businesses[i].phone;id=obj.businesses[i].id;from="yelp";widget="restaurants";try{showPoiOnMap(title,cat,lat,longitude,img_url,desc,address,phone,id,from,widget)}
catch(err){alert(err);}}});}
function openEventShowonMap()
{city=document.getElementById("hdnCity").value;cat=document.getElementById("hdneventcat").value;url='/html5/plan/buildeventjson/city/'+city+'/cat/'+cat+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){var xmlDoc=jQuery.parseXML(data);var events=xmlDoc.getElementsByTagName("event");for(var i=0;i<events.length;i++){id=events[i].getAttribute("id");cat=xmlDoc.getElementsByTagName("owner")[i].firstChild.data;title=xmlDoc.getElementsByTagName("title")[i].firstChild.data;lat=xmlDoc.getElementsByTagName("latitude")[i].firstChild.data;longitude=xmlDoc.getElementsByTagName("longitude")[i].firstChild.data;if(xmlDoc.getElementsByTagName("description")[i].firstChild.data)
desc=xmlDoc.getElementsByTagName("description")[i].firstChild.data;else
desc="";img_url="";address="";phone="";from=xmlDoc.getElementsByTagName("owner")[i].firstChild.data;widget="event";try{showPoiOnMap(title,cat,lat,longitude,img_url,desc,address,phone,id,from,widget)}
catch(err){}}});}
function getAttractionMap(lat,lng){objMap=new Microsoft.Maps.Map(document.getElementById('attractionMap'),{credentials:'AhJQ5JAtgnPi_omSWBrBll1mzwDZTtRktFgfeXNlUiR-i3bRuMc2inL0nAbGkRGE',width:"auto",height:180,enableClickableLogo:false,enableSearchLogo:false,showDashboard:false,showScalebar:false,zoom:16,mapTypeId:'auto',center:new Microsoft.Maps.Location(lat,lng)});var placePin=new Microsoft.Maps.Pushpin(objMap.getCenter(),null);objMap.entities.push(placePin);}
function getActivityMap(lat,lng){objMap=new Microsoft.Maps.Map(document.getElementById('activityMap'),{credentials:'AhJQ5JAtgnPi_omSWBrBll1mzwDZTtRktFgfeXNlUiR-i3bRuMc2inL0nAbGkRGE',width:"auto",height:180,enableClickableLogo:false,enableSearchLogo:false,showDashboard:false,showScalebar:false,zoom:16,mapTypeId:'auto',center:new Microsoft.Maps.Location(lat,lng)});var placePin=new Microsoft.Maps.Pushpin(objMap.getCenter(),null);objMap.entities.push(placePin);}
function getRestaurantMap(lat,lng){objMap=new Microsoft.Maps.Map(document.getElementById('restaurantMap'),{credentials:'AhJQ5JAtgnPi_omSWBrBll1mzwDZTtRktFgfeXNlUiR-i3bRuMc2inL0nAbGkRGE',width:"auto",height:180,enableClickableLogo:false,enableSearchLogo:false,showDashboard:false,showScalebar:false,zoom:16,mapTypeId:'auto',center:new Microsoft.Maps.Location(lat,lng)});var placePin=new Microsoft.Maps.Pushpin(objMap.getCenter(),null);objMap.entities.push(placePin);}
function getNightlifeMap(lat,lng){objMap=new Microsoft.Maps.Map(document.getElementById('nightlifeMap'),{credentials:'AhJQ5JAtgnPi_omSWBrBll1mzwDZTtRktFgfeXNlUiR-i3bRuMc2inL0nAbGkRGE',width:"auto",height:180,enableClickableLogo:false,enableSearchLogo:false,showDashboard:false,showScalebar:false,zoom:16,mapTypeId:'auto',center:new Microsoft.Maps.Location(lat,lng)});var placePin=new Microsoft.Maps.Pushpin(objMap.getCenter(),null);objMap.entities.push(placePin);}
function getEventMap(lat,lng){objMap=new Microsoft.Maps.Map(document.getElementById('eventMap'),{credentials:'AhJQ5JAtgnPi_omSWBrBll1mzwDZTtRktFgfeXNlUiR-i3bRuMc2inL0nAbGkRGE',width:"auto",height:180,enableClickableLogo:false,enableSearchLogo:false,showDashboard:false,showScalebar:false,zoom:16,mapTypeId:'auto',center:new Microsoft.Maps.Location(lat,lng)});var placePin=new Microsoft.Maps.Pushpin(objMap.getCenter(),null);objMap.entities.push(placePin);}
function showNightlifeMenu(){if($("#listNightlifeCategory").is(":visible")==true){$("#listNightlifeCategory").slideUp("fast");return;}else{var list=$("#listNightlifeCategory").html();if(!list||list=='undefined'){}else{$("#listNightlifeCategory").slideDown("fast");}}}
function showActivityMenu(){$("#planlistActivityCategory").slideDown("fast");}
function openNewCityInfo(cityObject){currentCityObject=cityObject;$('#weather').hide();$('#attraction').hide();$('#restaurant').hide();$('#nightlife').hide();$('#events').hide();$('#friends').hide();$('#promo').hide();$('#booking').hide();$("#tripMenu").hide();$("#tripMenuCountry").hide();$("#hostel").hide();if(cityObject.d.length<10){openCityTabsPanel(cityObject.id,"Info");return;}
var img='/media/cities/thumb_'+cityObject.id+'.jpg';document.getElementById("cityinfoImage").innerHTML='<div class="infoImgLoading img88"><img src="'+img+'" class="img88 loading" id="img88" width="130" style="display:none" onload="$(this).show();" /></div>';$('#img88').error(function(){$('#img88').attr("src","/images/default.png");})
document.getElementById("cityinfoDesc").innerHTML='<p>'+cityObject.d+'</p>';document.getElementById("cityinfoButton").innerHTML='<input class="view" type="button" value="View" onclick=\'openCityTabsPanel('+cityObject.id+',"Info")\' />';$("#cityInformation").show();try{$("#cityInformation").offset({top:cityObject.y+20,left:cityObject.x-180})}catch(err){}
tripId=document.getElementById("tripPlaceId").value;url='/html5/trip/gettrippartid/tripId/'+tripId+'/cityId/'+cityObject.id+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){document.getElementById("tripPartId").value=data;global_trip_part_id=data;getTripItem('');});}
function openCityInfo(cityObject){$('#CountryPageComponent').hide();$('#PlanBookComponent').hide();$("#cityInfoScreen").hide();$("#geoInformation").hide();window.setTimeout(function(){openNewCityInfo(cityObject);},250);}
function resetDisplay(attrMode){showhideWelcomePanel('hide');$(".welcomeBox").hide("fade",500);$('#arrowUp').hide();$('#cityInfoScreen .dragHandle ul').hide();$('#goback').hide();$('#fareSearchId').hide();$("#friends").hide();$("#weather").hide();$("#my_trip_wrapper").hide();$("#friend_trip_wrapper").hide();$("#info").hide();$("#cityInfoScreen").hide();$("#cityInformation").hide();$('#PlanBookComponent').hide();$('#CountryPageComponent').hide();$('#liattraction').hide();$('#liactivities').hide();$('#lirestaurant').hide();$('#linightlife').hide();$(".contenPnl").hide();$("#cityInfoPanel").hide();$(".pageOverlay").hide();$("#openPage").hide();$("#topNav li").removeClass("active");$("#explore").addClass("active");if(attrMode=="all"){$('#rootvectormap').vectorMap('set','hideAllPin',1);}
zoomTo100();}
var cityDetails=new Array();function openCityDetails(city,x,y,type,id,tab,cityObject,mode){selectedCityname=city;$('.contenPnl').hide();if($('.rightPanel').is(":visible")==false){$('.rightPanel').show();}
if(welcome_book_panel_city_id!=id&&welcome_book_panel_city_id!=0&&typeof id!='undefined'){unsetPreviousSession();}
if(cityMainTabType!='Book'){activeBookTab='Flight';}
if(typeof cityObject=='undefined'){currentCityObject={n:city,x:x,y:y,id:id};}else{currentCityObject=cityObject;}
cityPanelTabType=$.trim(cityPanelTabType);if($.trim(type).length>0)type=type.substr(0,1).toUpperCase()+type.substr(1);if(mode=='fare'){isFareSearchClicked=true;$('#bookTab').trigger('click');$('#arrowUp').hide();$("#info").hide();$("#cityInfoPanel").hide();$('#cityInfoScreen .dragHandle ul').hide();$("#Drop_Explore").hide();$("#exploter_panel_city").hide();$('#goback').hide();$('#fareSearchId').show();}else{isFareSearchClicked=false;$('#arrowUp').show();$('#cityInfoScreen .dragHandle ul').show();$('#cityInfoScreen .dragHandle ul li').removeClass("ui-state-focus");$('#goback').show();$('#fareSearchId').hide();$("#main-top-nav li a").removeClass("active");$("#exploreAnchorID").addClass("active");if(docTripBottom!=false||dockTripPosition!=false||docBottom!=false||dockPosition!=false){restorPanel();}
if((cityPanelTabType==""||cityPanelTabType=="Info")&&(cityMainTabType=='Plan')){cityPanelTabType="Info";activeExploreTab="Info";if($.trim(hashId)==""){createHashURLTitle(type,cityPanelTabType);hashPushState(hashLocationString,hashPageTitle);}}}
$(".pageOverlay").hide();$("#openPage").hide();$("#friends").hide();$("#weather").hide();$("#my_trip_wrapper").hide();$("#friend_trip_wrapper").hide();$('#cinfo').addClass('current');$('#iconNav ul.nav li a').removeClass('current');$('#cinfo').addClass('current');$("#cityInfoScreen").show();$("#cityInformation").hide();$(".welcomeBox").hide("fade",500);if(tab!='flight'&&fareSearchfromWelcome==true){$('#bflight').removeClass('current');$('#bflight').hide();}
$('#CountryPageComponent').hide();$('#PlanBookComponent').show();$('#liattraction').show();$('#liactivities').show();$('#lirestaurant').show();$('#linightlife').show();$("#PlanBookComponent").offset({top:y+10,left:15});$("#arrowUp").removeClass("arrow-left");$("#arrowUp").removeClass("arrow-right");$("#arrowUp").addClass('arrow-up');$("#arrowUp").offset({top:y+1,left:x-30});$(".geoItinerary").width($(window).width()-30);tripId=document.getElementById("tripPlaceId").value;bChkCityName=city;isPlanBookShareTabAutoClicked=true;if(type=="Book")
$("#tabs").tabs("option","selected",1);else
$("#tabs").tabs("option","selected",0);isPlanBookShareTabAutoClicked=false;if(mode!="fare"){document.getElementById("cityInfoPanel").innerHTML=city;$(".contenPnl").hide();$("#Drop_Explore").hide();$("#exploter_panel_city").hide();$("#cityInfoPanel").show();fillInfoData(id);showVectorMap();cityPanelTabType="";}
if(cityMainTabType=='Book'){isFareSearchClicked=false;$('#bookTab').trigger('click');$('#arrowUp').show();$("#info").hide();$("#Drop_Explore").hide();$("#cityInfoPanel").show();$('#cityInfoScreen .dragHandle ul').show();$('#goback').hide();$('#fareSearchId').hide();}
$("#StaticPageContent").html('');$('#window-8-Application').hide();$(".rightPanel").fadeIn();$('#georama_welcome_overlay').hide();$('#OutrContainer').hide();$(".fixed_footer_wrapper").hide();$("#welcome_close").hide();$('#backWrap').hide();$("#welcome_booking_trip_panel").hide();$("#may_be_wrap").hide();$("#yes_wrap").hide();showhideTopBar('show');if(mode=='fare'){window.scrollTo(0,250);}}
var planInfoTab=null;function fillInfoData(cityId){if(planInfoTab!=null){planInfoTab.abort();planInfoTab=null;}
if(friendTripFlag==true){explorePanelMode='friend';}else{explorePanelMode='my';}
$("#tripPartId").show();$("#info").show();PanelVisited="CityPanel";activeExploreTab='Info';var recommendedDataFound;if(tripId!=''&&tripId!=0){city=cityId+"_"+tripId;}else{city=cityId;}
if(cityDetails[city]){arrdata=cityDetails[city].split('|||');document.getElementById("cityInfoContent").innerHTML=arrdata[0];resizeInfoPanelGrid();document.getElementById("weatherSection").innerHTML=arrdata[1];document.getElementById("tripPartId").value=arrdata[2];if(typeof arrdata[4]!='undefined'){var cityZoomDetail=arrdata[4].split('/');cityZoomLevel[cityId]={'cityZoomLevel':cityZoomDetail[0],'points':cityZoomDetail[1]};}
recommendedDataFound=arrdata[3];$("#info .list").show();if(recommendedDataFound==0){$('#liattraction').hide();$('#liactivities').hide();$('#lirestaurant').hide();$('#linightlife').hide();$('lievents').hide();}
updateInfoTabFriend(cityId);ResetBrowserScrollAfterDataLoaded();if(selectedEntityId!==false)
$("#li_additionalinfo"+selectedEntityId).trigger('click');selectedEntityId=false;return;}
if((cityPanelTabType=="Info")&&(cityMainTabType=='Plan')){document.getElementById("cityInfoContent").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif"/></div>';planInfoTab=$.post("/html5/plan/buildplaninfo",{city:cityId,tripId:tripId},function(data){if(data!=""){arrdata=data.split('|||');cityDetails[city]=data;document.getElementById("cityInfoContent").innerHTML=arrdata[0];resizeInfoPanelGrid();if(arrdata[2]!=0){setTripPartContext(cityId,'',arrdata[2]);document.getElementById("tripPartId").value=arrdata[2];}
if(typeof arrdata[4]!='undefined'){var cityZoomDetail=arrdata[4].split('/');cityZoomLevel[cityId]={'cityZoomLevel':cityZoomDetail[0],'points':cityZoomDetail[1]};}
recommendedDataFound=arrdata[3];$("#info .list").show();if(recommendedDataFound==0){$('#liattraction').hide();$('#liactivities').hide();$('#lirestaurant').hide();$('#linightlife').hide();$('lievents').hide();}
if(typeof selectedEntityId!=='undefined'||selectedEntityId!==false){$("#li_additionalinfo"+selectedEntityId).trigger('click');}
updateInfoTabFriend(cityId);resizeInfoPanelGrid();ResetBrowserScrollAfterDataLoaded();}
$('.figure a img').error(function(){$(this).parent().parent().remove();});});}
if(myTripFlag){$("#goback").html('&laquo; Go back to My Trips');}else if(friendTripFlag){$("#goback").html('&laquo; Go back to Friends Trips');}else{$("#goback").html('Go to My Trips &raquo;');}
$("#goback").show();}
function openSelCityInfo(){cityPanelTabType="Info";city=document.getElementById("hdnCityId").value;fillInfoData(city);}
$.fn.resizepanels=function(d){if(FBAPP!=1&&$(document).width()>=960){$(".pnlScrollCont").css("overflow","hidden");$("#PlanBookComponent .advertise").hide();}};$.fn.scrollPane=function(lnkObj){switch(lnkObj.rel){case"prev":$(lnkObj.target).animate({top:'+=100'},"easeout");break;case"next":$(lnkObj.target).animate({top:'-=100'},"easeout");break;}}
function closeCityInfo(){$('#cityInformation').hide();}
var weatherCeDetails=new Array();function openWeatherCategory(){$("#news").hide();$("#media").hide();$("#weather").show();var currentTime=new Date()
var hours=currentTime.getHours()
var minutes=currentTime.getMinutes()
var suffix="AM";if(hours>=12){suffix="PM";hours=hours-12;}
if(hours==0){hours=12;}
if(minutes<10)
minutes="0"+minutes
cmbTime=hours+":"+minutes+" "+suffix;city=document.getElementById("hdnCity").value;if(weatherCeDetails[city]){arrdata=weatherCeDetails[city].split("|||");document.getElementById("weatherInfo").innerHTML=arrdata[0];document.getElementById("weatherSection").innerHTML=arrdata[1];}
else{document.getElementById("weatherInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif"/></div>';url='/html5/plan/buildweatherinfo/city/'+city+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){weatherCeDetails[city]=data;arrdata=data.split("|||");document.getElementById("weatherInfo").innerHTML=arrdata[0];document.getElementById("weatherSection").innerHTML=arrdata[1];$("#weather .list").show();});}}
var weatherFnDetails=new Array();function openWeatherCategoryFn(){activeExploreTab='Weather';$(".contenPnl").hide();$("#weather").show();var currentTime=new Date()
var hours=currentTime.getHours()
var minutes=currentTime.getMinutes()
var suffix="AM";if(hours>=12){suffix="PM";hours=hours-12;}
if(hours==0){hours=12;}
if(minutes<10){minutes="0"+minutes;}
cmbTime=hours+":"+minutes+" "+suffix;city=document.getElementById("hdnCityId").value;if(weatherFnDetails[city]){arrdata=weatherFnDetails[city].split("|||");document.getElementById("weatherInfo").innerHTML=arrdata[0];document.getElementById("weatherSection").innerHTML=arrdata[1];ResetBrowserScrollAfterDataLoaded();}else{if(weatherXhr!=null){weatherXhr.abort();weatherXhr=null;}
document.getElementById("weatherInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif"/></div>';url='/html5/plan/buildweatherinfofn/city/'+city+'/rand/'+parseInt(Math.random()*99999999);weatherXhr=$.get(url,function(data){if(data!=''){weatherFnDetails[city]=data;arrdata=data.split("|||");document.getElementById("weatherInfo").innerHTML=arrdata[0];document.getElementById("weatherSection").innerHTML=arrdata[1];for(i=0;i<arrdata.length;i++){var key=city+'_'+i;weatherDetailsforPlan[key]=arrdata[i];}
mscroll();ResetBrowserScrollAfterDataLoaded();}else{var message='<article class="info padding align-center font_18">Sorry, we do not currently have any weather information available for this city.</article>';$("#weatherInfo").html(message);}});}}
var friendListDetails=new Array();var showFrdsDashboard=false;function openFriendCategory(name){showFrdsDashboard=false;document.getElementById("friendbuttonInfo").innerHTML='';activeExploreTab='Friends';$(".contenPnl").hide();$("#friends").show();panelFlag='friend';$('#frndsBtnBTR').hide();$('#friendsDetail').html(panelloaderDiv).show();$("#friendlistInfo").hide();$("#friendInfo").hide();document.getElementById("friendlistInfo").innerHTML='<div style="height:100px;padding-top:200px;" align="center">Loading..<br /><img src="/images/preloader.gif"/></div>';document.getElementById("friendInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';city=document.getElementById("hdnCity").value;var cityId=document.getElementById("hdnCityId").value;$("#friendInfo").removeClass("primaryColRight");var cacheKey="fr_"+cityId+"_0";if(FB_LOGIN!='1'){$('#friends .list').hide();$("#friendsDetail").hide();$("#friendInfo").show();$("#searchBar").hide();var htmlStr='<div style="margin-bottom:180px; margin-top:100px; text-align:center"><h6 style="color:rgba(32,87,145,.9); font-size:18px;">Please Sign In to view friends in this city</h6><br /><a id="a_loginFromPlanFriendsTab" class="header-facebook" href="javascript://" onclick="member_login_header();"><img src="/images/facebook-sign-in.gif"></a></div>';$("#friendInfo").html(htmlStr);ResetBrowserScrollAfterDataLoaded();}else{var url='/api/fbfriendsgroup/city/'+city;if(cache[cacheKey]){renderFriend(cache[cacheKey]);ResetBrowserScrollAfterDataLoaded();}else{$.getJSON(url,function(data){if(data.attempt=='fail'){$('#friends .list').hide();$("#friendsDetail").hide();$("#friendInfo").show();$("#searchBar").hide();var htmlStr='<div style="margin-bottom:180px; margin-top:100px; text-align:center"><h6 style="color:rgba(32,87,145,.9); font-size:18px;">Please Sign In to view friends in this city</h6><br /><a id="a_loginFromPlanFriendsTab" class="header-facebook" href="javascript://" onclick="member_login_header();"><img src="/images/facebook-sign-in.gif"></a></div>';$("#friendInfo").html(htmlStr);ResetBrowserScrollAfterDataLoaded();}
else{$("#friendsDetail").show();$('#friends .list').show();$("#searchBar").hide();cache[cacheKey]=data;renderFriend(data);ResetBrowserScrollAfterDataLoaded();}});}}}
function renderFriend(data){var stext="";var fcol=0;var i=0;var colObj=document.getElementById("friendInfo");var fLstObj=document.getElementById("friendlistInfo");var chkFrds=false;var showFrdsUID="";var loadDiv=true;var flistContent="";var cityType='';$.fn.showFriends=function(name){if(loadDiv)
{colObj.innerHTML='<div class="friendList"><h3 style="text-align:center;">'+name+'</h3>'+stext+'</div>';fLstObj.innerHTML='<div class="cityList">'+name+'</div>'+stext;loadDiv=false;}else{colObj.innerHTML+='<div class="friendList"><h3 style="text-align:center;">'+name+'</h3>'+stext+'</div>';fLstObj.innerHTML+='<div class="cityList">'+name+'</div>'+stext;}
fcol++;}
var htmlStr='<div style="margin-bottom:180px; margin-top:100px; text-align:center"><h6 style="color:rgba(32,87,145,.9); font-size:18px;">Please Sign In to view friends in this city</h6><br /><a id="a_loginFromPlanFriendsTab" class="header-facebook" href="javascript://" onclick="member_login_header();"><img src="/images/facebook-sign-in.gif"></a></div>';colObj.innerHTML=htmlStr;var totalFrds=data.current_count+data.home_count+data.checkins_count;if(totalFrds>20)
showFrdsDashboard=true;if(data.current_count>0){chkFrds=true;stext+='<ul class="leftListImage">';$.each(data.current,function(i,record){if(i==0)
{allfriends+=record.uid;showFrdsUID=record.uid;cityType='Current City';}else{allfriends+=','+record.uid;}
i++;stext+='<li id = "fr_'+record.uid+'" class="fDashThumb">';stext+='<a href="javascript://" onclick="openFriendInfo('+record.uid+',\'Current City\')"><img src="'+record.pic_square+'" alt="'+record.name+'" /><br />';stext+=record.name+'</a>';stext+='</li>';});stext+='</ul>';$(this).showFriends('Current City');}
stext="";i=0;if(data.home_count>0){chkFrds=true;stext+='<ul class="leftListImage">';$.each(data.home,function(i,record){if(i==0&&showFrdsUID==''){allfriends+=record.uid;showFrdsUID=record.uid;cityType='Home Town';}
else{allfriends+=','+record.uid;}
i++;stext+='<li id = "fr_'+record.uid+'" class="fDashThumb">';stext+='<a href="javascript://" onclick="openFriendInfo('+record.uid+',\'Home Town\')"><img src="'+record.pic_square+'" alt="'+record.name+'" /><br />';stext+=record.name+'</a>';stext+='</li>';});stext+='</ul>';$(this).showFriends('Home Town');}
stext="";i=0;if(data.checkins_count>0){chkFrds=true;stext+='<ul class="leftListImage">';$.each(data.checkins,function(i,record){if(i==0&&showFrdsUID==''){allfriends+=record.uid;showFrdsUID=record.uid;cityType='Visited';}else{allfriends+=','+record.uid;}
i++;stext+='<li id = "fr_'+record.uid+'" class="fDashThumb">';stext+='<a href="javascript://" onclick="openFriendInfo('+record.uid+',\'Visited\')"><img src="'+record.pic_square+'" alt="'+record.name+'" /><br />';stext+=record.name+'</a>';stext+='</li>';});stext+='</ul>';$(this).showFriends('Visited');}
var frdsColW=98/fcol;if(chkFrds)
$(".friendList").css("width",frdsColW+"%");else
colObj.innerHTML='<article class="info padding align-center font_18" style="margin-top:25px;">Sorry, you do not seem to have any friends in '+city+'!</article>';$("#friendlistInfo li").removeClass("fDashThumb");$("#friendlistInfo li").addClass("leftfDashThumb");$("#friendlistInfo li a br").remove();if(!showFrdsDashboard&&chkFrds&&data.attempt!='fail'){openFriendInfo(showFrdsUID,cityType);$("#friends .list").show();}else{$("#friends .list").hide();$("#friendsDetail").hide();$("#friendInfo").show();$('#frndsBtnBTR').hide();}
fLstObj.innerHTML='<div id="friendScrollDiv" class="pnlScrollCont font_13"><div class="scrollbar_wrapper"><div class="scrollbar"><div class="thumb"></div></div><div class="viewport" style="height:500px;"><div class="overview"><div id="friendInnerWrapper">'+fLstObj.innerHTML+'</div></div></div></div></div>';$("img.lazyloading").lazyload({placeholder:"/images/html5/img-lazy-loading.gif",effect:"fadeIn",threshold:400});}
var friendInfoDetails=new Array();function openFriendInfo(uid,cityType){$('#friendbuttonInfo').hide();$('#friendInfo').hide();$("#friends .list").show();$('#friendsDetail').html(panelloaderDiv).show();city=document.getElementById("hdnCity").value;$("li").removeClass('current');$('#lifrn_'+uid).addClass('current');$('#frndsBtnBTR').click(function(){createHashURLTitle("Plan",activeExploreTab);hashPushState(hashLocationString,hashPageTitle);$(this).hide();$('#friendInfo').show();$('#friendsDetail').hide();$("#friends .list").hide();$('#friendbuttonInfo').hide();$(".leftListImage li").removeClass('current');});if(showFrdsDashboard){$(".fDashboard").show();}else{$(".fDashboard").hide();}
tripPartId=document.getElementById("tripPartId").value;if(typeof tripPartId==''||typeof tripPartId=='undefined'){tripPartId=global_trip_part_id;}
url='/html5/plan/buildfriendinfo/uid/'+uid+'/city/'+city+'/tripPartId/'+tripPartId;$.get(url,function(data){$(".reviewFooter").show()
$('#frndsBtnBTR').show();var tripName=$("#tripPlaceName").attr("title");friendInfoDetails[city]=data;arrdata=data.split("|||");document.getElementById("friendsDetail").innerHTML=arrdata[0];document.getElementById("friendbuttonInfo").innerHTML=arrdata[1];setFrienddetail();var friendName=arrdata[3];$("#friendsDetail").addClass("primaryColRight");$("#friends .list").show();$('#frndsBtnBTR').show();if(arrdata[2]==0){$('#friendlistInfo').hide();$('#frndsBtnBTR').hide();}
else{$('#friendlistInfo').show();$('#frndsBtnBTR').show();}
if(explorePanelMode=='friend'){$('#friendbuttonInfo').hide();$('#add_to_trip_button_friend').hide();}else{if(typeof cityType!='undefined'){if(cityType=='Visited'){$('#friendbuttonInfo').hide();$('.coPlanner').hide();}else{$('.coPlanner').show();$('#friendbuttonInfo').show();$('#frndsBtnBTR').show();$('#add_to_trip_button_friend').show();}}else{$('.coPlanner').show();$('#friendbuttonInfo').show();$('#frndsBtnBTR').hide();$('#add_to_trip_button_friend').show();$(".reviewFooter").hide()}}
$('#friendlistInfo, #friendsDetail .scrollbar_wrapper').tinyscrollbar({sizethumb:25});if(tripName!=''&&typeof(tripName)!='undefined'){$("#selected_trip").html(tripName);}
else{tripName=$("$tripPlaceName").text();$("#selected_trip").html(tripName);}
loadGeoplacesSnippet(friendName,uid);});$(".leftListImage li").removeClass('current');$(".leftListImage li#fr_"+uid).addClass('current');}
function postonFriendWall(){txt=document.getElementById("txtWriteSomething").value;if(document.getElementById("selectfriend")){var friend=document.getElementById("selectfriend").checked;}
if(friend==true&&typeof friend!='undefined'){uid=allfriends;}
else{uid=document.getElementById("hdnpostuid").value;allfriends="";}
var agree=confirm("Are you sure you want to post a message on user's wall?");if(agree)
{if(txt==''||txt=='Write something...')
{('Please write something in textbox.');return false;}
else
{$("#show").show();url='/html5/plan/fbfriendpost/fbuid/'+uid+'/message/'+txt+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){(data);$("#show").hide();return false;});}}}
var newsInfoDetails=new Array();var newsXhr;function abortAjax(){if(typeof newsXhr=="object"){newsXhr.abort();}
$('#mapOverlay').hide();}
function openNewsCategory(){activeExploreTab='News';$(".contenPnl").hide();$("#news").show();city=document.getElementById("hdnCity").value;var cityId=document.getElementById("hdnCityId").value;document.getElementById("newsInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';url='/html5/plan/buildnewsinfo';if(newsCallFromPlan!=null){newsCallFromPlan.abort();newsCallFromPlan=null;}
var cacheKey="nw_"+city+"_0";if(cache[cacheKey]){document.getElementById("newsInfo").innerHTML=cache[cacheKey];if(!showBelow){$(this).resizepanels(300);$("#newsPanelScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#newsPanelScrollPrev",downID:"#newsPanelScrollNext",scrollerID:"#newsPanelContent"});$("#twitterPanelScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#twitterPanelScrollPrev",downID:"#twitterPanelScrollNext",scrollerID:"#twitterPanelContent"});ResetBrowserScrollAfterDataLoaded();}}
else{newsCallFromPlan=$.post(url,{city:city},function(data){cache[cacheKey]=data;document.getElementById("newsInfo").innerHTML=data;if(!showBelow){$(this).resizepanels(300);$("#newsPanelScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#newsPanelScrollPrev",downID:"#newsPanelScrollNext",scrollerID:"#newsPanelContent"});$("#twitterPanelScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#twitterPanelScrollPrev",downID:"#twitterPanelScrollNext",scrollerID:"#twitterPanelContent"});ResetBrowserScrollAfterDataLoaded();}});}}
var mediaInfoDetails=new Array();function openMediaCategory(type,view,mode,imgurl,thumburl,source,title,remove)
{if(type!='')
document.getElementById("hdnMediaType").value=type
if(view!='')
document.getElementById("hdnMediaView").value=view
if(mode!='')
document.getElementById("hdnMediaMode").value=mode
view=document.getElementById("hdnMediaView").value;type=document.getElementById("hdnMediaType").value;mode=document.getElementById("hdnMediaMode").value;if(mode=='')
mode='db';if(type=="photo")
{$("#subitem_all").removeClass("active");$("#subitem_photo").addClass("active");$("#subitem_video").removeClass("active");}
else if(type=="video")
{$("#subitem_all").removeClass("active");$("#subitem_photo").removeClass("active");$("#subitem_video").addClass("active");}
else
{$("#subitem_all").addClass("active");$("#subitem_photo").removeClass("active");$("#subitem_video").removeClass("active");}
if(view=="list")
{$("#sm_list").addClass("slideShowMode active");$("#sm_grid").removeClass("gridMode active");$("#sm_grid").addClass("gridMode");}
else
{$("#sm_grid").addClass("gridMode active");$("#sm_list").removeClass("slideShowMode active");$("#sm_list").addClass("slideShowMode");}
$("#weather").hide();city=document.getElementById("hdnCity").value;tripPartId=document.getElementById("tripPartId").value;document.getElementById("mediaInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';url='/html5/plan/buildmediainfo/city/'+city+'/tripPartId/'+tripPartId+'/mode/'+mode+'/type/'+type+'/view/'+view+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){mediaInfoDetails[city]=data;document.getElementById("mediaInfo").innerHTML=data;if(openMediaId){openMediaCategory('','list','',openMediaId,openMediaId,'photo',title,'0');openMediaId=false;}
else{showMedia(imgurl,thumburl,source,title,remove)}
if(!showBelow){$(this).resizepanels(300);$("#mediaPanelScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#mediaPanelScrollPrev",downID:"#mediaPanelScrollNext",scrollerID:"#mediaPanelContent"});}});}
function cityImages(){$('#MedialogoPhotos').attr({alt:'bing',src:'/images/html5/icons/bingWatermarkSmall.png'});}
var chkCityVideos;function getVideos(){$('#MedialogoPhotos').attr({alt:'youtube',src:'/images/html5/icons/YouTube_logo.png'});if(chkCityVideos!=document.getElementById('hdnCityId').value){chkCityVideos=document.getElementById('hdnCityId').value
var html2='';cityId=document.getElementById("hdnCityId").value;url='/geo/getcityvideosurl/cityId/'+cityId;$.getJSON(url,function(result){$.each(result.data,function(i,item){html2+='<figure class="videoc"><a class="btnPlay" href="javascript://" onclick="launchYoutubeVideo(\''+item.urlId+'\')">&nbsp;</a><a style="background-image:url('+item.thumbUrl+')" class="thumb" href="javascript://" onclick="launchYoutubeVideo(\''+item.urlId+'\')"></a></figure>';});document.getElementById('mediaVideo').innerHTML='<div id="video_thumbs">'+html2+'</div>';});}
$('#mediaInfo').hide();$("#mediaVideo").show();}
function launchYoutubeVideo(code){$('body').append('<div class="welcome_overlay launchOverlay" style="z-index:2001;"></div><div class="liveVideo" onclick="$(\'.liveVideo\').remove();$(\'.launchOverlay\').remove();" style="z-index:2002"><a href="javascript://" class="close"></a><iframe width="560" height="315" src="http://www.youtube.com/embed/'+code+'/?html5=1&autoplay=1" frameborder="0" allowfullscreen></iframe></div>');}
function showMedia(imgurl,thumburl,source,title,remove)
{tripPartId=document.getElementById("tripPartId").value;if(document.getElementById("enlargedPhoto"))
document.getElementById("enlargedPhoto").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>';if(imgurl!='')
{url='/html5/plan/covertimagebase/img/'+imgurl+'/tripPartId/'+tripPartId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){arrdata=data.split("||");document.getElementById("enlargedPhoto").innerHTML='<img src='+arrdata[0]+' height="350" width="550"/>';if(arrdata[1])
remove=arrdata[1];if(remove==1)
{strButton='<a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removetoMedia(\''+source+'\',\''+addslashes(title)+'\',\''+imgurl+'\',\''+thumburl+'\')"> Remove</a>';}
else
{strButton='<a class="btnIconAdd font_13" onclick="addtoMedia(\''+source+'\',\''+addslashes(title)+'\',\''+imgurl+'\',\''+thumburl+'\')"> Add to Trip</a>';}
if(document.getElementById("addToTrip"))
document.getElementById("addToTrip").innerHTML=strButton;});}}
function swapTextValue()
{txt=document.getElementById("txtWriteSomething").value;if(txt=='Write something...')
{document.getElementById("txtWriteSomething").value='';return false;}}
function openNeigbourAttraction()
{$('#nulAttraction').fadeIn();}
function openNeigbourRestaurant()
{$('#nulRestaurant').fadeIn();}
function openNeigbourNightlife()
{$('#nulNightlife').fadeIn();}
function openNeigbourEvent()
{$('#nulEvent').fadeIn();}
function openNeigbourActivity()
{$('#nulActivity').fadeIn();}
var counter=2;function addMoreDestination()
{if(counter>10){return false;}
var newdivPdest=$(document.createElement('div')).attr("id",'divPdest'+counter);newdivPdest.html('<span  class="block formfield">'+'<input type="text" class="text" name="txtPotentialDestinationSearchCity'+counter+'" id="txtPotentialDestinationSearchCity'+counter+'" value="" onchange="autoComplete(\''+counter+'\')">'+'<input type="hidden" class="text" name="hdnPotentialDestinationSearchCity'+counter+'" id="hdnPotentialDestinationSearchCity'+counter+'" value="" >'+'</span><a href="javascript:;" class="cancel" onClick="removeDestination()">Remove</a>');document.getElementById("hdnTotalPotentialDestination").value=counter;newdivPdest.appendTo("#divPdestGroup");counter++;}
function removeDestination(){if(counter==2)
{document.getElementById("hdnTotalPotentialDestination").value=counter-1;return false;}
counter--;document.getElementById("hdnTotalPotentialDestination").value=counter-1;$("#divPdest"+counter).remove();}
function autoComplete(counter){$('#txtPotentialDestinationSearchCity'+counter).addClass('ui-autocomplete-loading');var a=$('#txtPotentialDestinationSearchCity'+counter).autocomplete1({serviceUrl:'/feed/citysuggest/',minChars:2,maxHeight:400,width:200,zIndex:9999,noCache:false,onSelect:function(value,data){$('#txtPotentialDestinationSearchCity'+counter).removeClass('ui-autocomplete-loading');var dataPart=data.split('|');document.getElementById("hdnPotentialDestinationSearchCity"+counter).value=dataPart[3];}});}
function addtoBingMapAttraction(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/self/addpoiplaces/tripPartId/'+tripPartId+'/apiid/'+apiid+'/source/'+source+'/cat/'+selectedCategoryTab+'/title/'+title+'/address/'+address+'/imgurl/'+imgurl+'/phone/'+phone+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){strButton='<input class="view" style="cursor:pointer;" type="button" value="Remove" onclick="removetoBingMapAttraction(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"/>';document.getElementById("bing_map_add_to_trip").innerHTML=strButton;});}
function removetoBingMapAttraction(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/self/removepoiplaces/source/'+source+'/tripPartId/'+tripPartId+'/apiid/'+apiid+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){(data);strButton='<input class="view" style="cursor:pointer;" type="button" value="Add to Trip" onclick="addtoBingMapAttraction(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"/>';document.getElementById("bing_map_add_to_trip").innerHTML=strButton;return false;});}
function addtoAttraction(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/self/addpoiplaces/tripPartId/'+tripPartId+'/apiid/'+apiid+'/source/'+source+'/cat/'+selectedCategoryTab+'/title/'+title+'/address/'+address+'/imgurl/'+imgurl+'/phone/'+phone+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){alert(data);return false;});strButton='<div class="addTrip" ><a class="href="javascript:void(0);" class="btnIconRemove font_13" onclick="removetoAttraction(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"> Remove</a></div>';document.getElementById("attbuttonInfo").innerHTML=strButton;}
function addtoAttractionOnBingMap(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/self/addpoiplaces/tripPartId/'+tripPartId+'/apiid/'+apiid+'/source/'+source+'/cat/'+selectedCategoryTab+'/title/'+title+'/address/'+address+'/imgurl/'+imgurl+'/phone/'+phone+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){return false;});strButton='<a class="btnIconRemove font_13" href="javascript:void(0);" onClick="removetoAttractionFromBingMap(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"> Remove</a>';document.getElementById("bing_map_add_to_trip").innerHTML=strButton;}
function removetoAttractionFromBingMap(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/self/removepoiplaces/source/'+source+'/tripPartId/'+tripPartId+'/apiid/'+apiid+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){alert(data);return false;});strButton='<a class="btnIconAdd font_13" href="javascript:void(0);" onClick="addtoAttractionOnBingMap(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"> Add to Trip</a>'
document.getElementById("bing_map_add_to_trip").innerHTML='';document.getElementById("bing_map_add_to_trip").innerHTML=strButton;}
function removetoAttraction(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/self/removepoiplaces/source/'+source+'/tripPartId/'+tripPartId+'/apiid/'+apiid+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){alert(data);return false;});strButton='<div class="addTrip"><a class="btnIconAdd font_13" onclick="addtoAttraction(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"> Add to Trip</a></div>';document.getElementById("attbuttonInfo").innerHTML=strButton;}
function addtoActivity(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/self/addpoiplaces/tripPartId/'+tripPartId+'/apiid/'+apiid+'/source/'+source+'/cat/'+selectedCategoryTab+'/title/'+title+'/address/'+address+'/imgurl/'+imgurl+'/phone/'+phone+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){alert(data);return false;});strButton='<div class="addTrip" ><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removetoActivity(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"> Remove</a></div>';document.getElementById("activitybuttonInfo").innerHTML=strButton;}
function removetoActivity(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/self/removepoiplaces/source/'+source+'/tripPartId/'+tripPartId+'/apiid/'+apiid+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){alert(data);return false;});strButton='<div class="addTrip"><a class="btnIconAdd font_13" onclick="addtoActivity(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"> Add to Trip</a></div>';document.getElementById("activitybuttonInfo").innerHTML=strButton;}
function addtoRestaurant(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/self/addpoiplaces/tripPartId/'+tripPartId+'/apiid/'+apiid+'/source/'+source+'/cat/'+selectedCategoryTab+'/title/'+title+'/address/'+address+'/imgurl/'+imgurl+'/phone/'+phone+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){alert(data);return false;});strButton='<div class="addTrip" ><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removetoRestaurant(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"> Remove</a></div>';document.getElementById("resbuttonInfo").innerHTML=strButton;}
function removetoRestaurant(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/self/removepoiplaces/source/'+source+'/tripPartId/'+tripPartId+'/apiid/'+apiid+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){alert(data);return false;});strButton='<div class="addTrip" ><a class="btnIconAdd font_13" onclick="addtoRestaurant(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"> Add to Trip</a></div>';document.getElementById("resbuttonInfo").innerHTML=strButton;}
function addtoNightlife(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/self/addpoiplaces/tripPartId/'+tripPartId+'/apiid/'+apiid+'/source/'+source+'/cat/'+selectedCategoryTab+'/title/'+title+'/address/'+address+'/imgurl/'+imgurl+'/phone/'+phone+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){alert(data);return false;});strButton='<div class="addTrip"><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removetoNightlife(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"> Remove</a></div>';document.getElementById("nightbuttonInfo").innerHTML=strButton;}
function removetoNightlife(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/self/removepoiplaces/source/'+source+'/tripPartId/'+tripPartId+'/apiid/'+apiid+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){alert(data);return false;});strButton='<div class="addTrip" ><a class="btnIconAdd font_13" onclick="addtoNightlife(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"> Add to Trip</a></div>';document.getElementById("nightbuttonInfo").innerHTML=strButton;}
function addtoShopping(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/self/addpoiplaces/tripPartId/'+tripPartId+'/apiid/'+apiid+'/source/'+source+'/cat/'+selectedCategoryTab+'/title/'+title+'/address/'+address+'/imgurl/'+imgurl+'/phone/'+phone+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){alert(data);return false;});strButton='<div class="addTrip"><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removetoShopping(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"> Remove</a></div>';document.getElementById("shoppingbuttonInfo").innerHTML=strButton;}
function removetoShopping(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/self/removepoiplaces/source/'+source+'/tripPartId/'+tripPartId+'/apiid/'+apiid+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){alert(data);return false;});strButton='<div class="addTrip" ><a class="btnIconAdd font_13" onclick="addtoShopping(\''+source+'\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"> Add to Trip</a></div>';document.getElementById("shoppingbuttonInfo").innerHTML=strButton;}
function addtoEvent(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/html5/trip/addevent/tripPartId/'+tripPartId+'/apiid/'+apiid+'/source/'+source+'/title/'+title+'/address/'+address+'/imgurl/'+imgurl+'/phone/'+phone+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){alert(data);return false;});strButton='<div class="addTrip" ><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removeToEvent(\'local\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"> Remove</a></div>';document.getElementById("eventbuttonInfo").innerHTML=strButton;}
function removeToEvent(source,apiid,title,address,imgurl,phone){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||tripPartId=="undefined"){tripPartId=global_trip_part_id;}
url='/html5/trip/removeevent/tripPartId/'+tripPartId+'/apiid/'+apiid+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){(data);return false;});strButton='<div class="addTrip" ><a class="btnIconAdd font_13" onclick="addtoEvent(\'local\',\''+apiid+'\',\''+addslashes(title)+'\',\''+address+'\',\''+imgurl+'\',\''+phone+'\')"> Add to Trip</a></div>';document.getElementById("eventbuttonInfo").innerHTML=strButton;}
function addtoFriend(fbuid,title,imgurl){tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||typeof tripPartId=='undefined'){tripPartId=global_trip_part_id;}
url='/html5/trip/addfriend/tripPartId/'+tripPartId+'/fbuid/'+fbuid+'/name/'+title+'/imgurl/'+imgurl+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){notifyme(data,"success");return false;});strButton='<div class="addTrip"><a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removetoFriend(\''+fbuid+'\',\''+addslashes(title)+'\',\''+imgurl+'\')"> Remove</a></div>';var addToTripButton='<a href="javascript://" onclick="removetoFriend(\''+fbuid+'\',\''+addslashes(title)+'\',\''+imgurl+'\')" class="btnIconRemove font_13">Remove</a>';$(".add_to_trip_button").html(addToTripButton);document.getElementById("friendbuttonInfo").innerHTML=strButton;}
function removetoFriend(fbuid,title,imgurl)
{tripPartId=document.getElementById("tripPartId").value;if(tripPartId==''||typeof tripPartId=='undefined'){tripPartId=global_trip_part_id;}
url='/html5/trip/removefriend/tripPartId/'+tripPartId+'/fbuid/'+fbuid+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){notifyme(data,"error");return false;});strButton='<div class="addTrip" ><a class="btnIconAdd font_13" onclick="addtoFriend(\''+fbuid+'\',\''+addslashes(title)+'\',\''+imgurl+'\')"> Add to Trip</a></div>';var addToTripButton='<a href="javascript://" onclick="addtoFriend(\''+fbuid+'\',\''+addslashes(title)+'\',\''+imgurl+'\')" class="btnIconAdd font_13">Add to Trip</a>';$("#add_to_trip_button_friend").html(addToTripButton);document.getElementById("friendbuttonInfo").innerHTML=strButton;}
function addtoMedia(source,title,imgurl,thumburl)
{tripPartId=document.getElementById("tripPartId").value;url='/html5/trip/addmedia/tripPartId/'+tripPartId+'/source/'+source+'/title/'+title+'/url/'+imgurl+'/thumburl/'+thumburl+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){(data);return false;});strButton='<a href="javascript:void(0);" class="btnIconRemove font_13" onclick="removetoMedia(\''+source+'\',\''+addslashes(title)+'\',\''+imgurl+'\',\''+thumburl+'\')"> Remove</a>';document.getElementById("addToTrip").innerHTML=strButton;}
function removetoMedia(source,title,imgurl,thumburl)
{tripPartId=document.getElementById("tripPartId").value;url='/html5/trip/removemedia/tripPartId/'+tripPartId+'/url/'+imgurl+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){(data);return false;});strButton='<a class="btnIconAdd font_13" onclick="addtoMedia(\''+source+'\',\''+addslashes(title)+'\',\''+imgurl+'\',\''+thumburl+'\')"> Add to Trip</a>';document.getElementById("addToTrip").innerHTML=strButton;}
function addslashes(str){return(str+'').replace(/[\\"']/g,'\\$&').replace(/\u0000/g,'\\0');}
function resetView(){}
function openCityTypeCustomPopUp(x,y){$('#weather').hide();$('#attraction').hide();$('#restaurant').hide();$('#nightlife').hide();$('#events').hide();$('#friends').hide();$('#promo').hide();$('#booking').hide();$("#cityInformation").hide();$("#hostel").hide();window.setTimeout(function(){$("#tripMenu").show();},250);try{$("#tripMenu").offset({top:y-15,left:x+250})}catch(err){}}
function hideOriginDestinationPopUp(){$("#tripMenu").hide();$("#tripMenuCountry").hide();}
var mediaPage=0;var mediaList=[];function newMedia(){activeExploreTab='Media';$(".contenPnl").hide();$('#MedialogoPhotos').hide();document.getElementById('mediaVideo').innerHTML='';$("#subitem_photo").addClass("active");cityImages();$("#subitem_video1").removeClass("active");$("#media").show();url="/api/cityimages/city/"+document.getElementById("hdnCityId").value;mediaList=[];var photoItems='';var videoItems='';$.getJSON(url,function(fsdata){var cityVideos=fsdata.videos;if(cityVideos=='Yes'){$("#cityVideos").show();}else{$("#cityVideos").hide();}
if(fsdata.source=='bing'){var flickerData=fsdata.flickrdata;if(flickerData!=null&&flickerData.length>0){$.each(flickerData,function(i,fphoto){mediaPage++;photoItems+='<figure class="photoc"><a class="thumb" onclick="pushOnOverlay(\''+fphoto.largephotourl+'\');"><img src="'+fphoto.largephotourl+'" class="lazyloading curHandPointer" onError="this.src=\''+'/images/noimage.jpg'+'\'" /><span title="'+fphoto.title+'" class="aboutPhotosTitle" style="font-weight:normal"><b>'+fphoto.title.substring(0,52)+'</b><br/> -By '+fphoto.photoownername+' on Flickr<br/><i class="white curHandPointer" onclick="window.open(\''+fphoto.photolicenseurl+'\',\'_blank\');"> available under the '+fphoto.photolicense+'</i></span></a></figure>';mediaList.push({'type':'photo','thumbUrl':fphoto.largephotourl,'mediaUrl':fphoto.largephotourl,'title':fphoto.title});});}
var bingCount=20-parseInt(i);var bingPhoto=fsdata.photos;if(bingPhoto!=null&&bingPhoto.length>0){$('#MedialogoPhotos').show();$.each(bingPhoto,function(j,photo){mediaPage++;photoItems+='<figure class="photoc"><a class="thumb" href="'+photo.MediaUrl+'" target="_blank"><img src="'+photo.MediaUrl+'" class="lazyloading curHandPointer" onError="this.src=\''+'/images/noimage.jpg'+'\'" /><span title="'+photo.Title+'" class="aboutPhotosTitle" style="font-weight:normal">'+photo.Title.substring(0,52)+'<br/> - via Bing</span></a></figure>';mediaList.push({'type':'photo','thumbUrl':photo.MediaUrl,'mediaUrl':photo.MediaUrl,'title':photo.Title});});}}else if(fsdata.source=='flickr'){$.each(fsdata.photos,function(k,photo){mediaPage++;photoItems+='<figure class="photoc"><a class="thumb" onclick="pushOnOverlay(\''+photo.largephotourl+'\');"><img src="'+photo.largephotourl+'" class="lazyloading curHandPointer" onError="this.src=\''+'/images/noimage.jpg'+'\'" /><span title="'+photo.title+'" class="aboutPhotosTitle" style="font-weight:normal"><b>'+photo.title.substring(0,52)+'</b><br/> -By '+photo.photoownername+' on Flickr<br><i class="white curHandPointer" onclick="window.open(\''+photo.photolicenseurl+'\',\'_blank\');"> available under the '+photo.photolicense+'</i></span></a></figure>';mediaList.push({'type':'photo','thumbUrl':photo.largephotourl,'mediaUrl':photo.largephotourl,'title':photo.title});});}
else{$('#MedialogoPhotos').show();$.each(fsdata.photos,function(k,photo){photoItems+='<figure class="photoc"><a class="thumb href="'+photo.urlLarge+'" target="_blank" ><img src="'+photo.MediaUrl+'" class="lazyloading curHandPointer"" onError="this.src=\''+'/images/noimage.jpg'+'\'"/><span title="'+photo.title+'" class="aboutPhotosTitle" style="font-weight:normal">'+photo.title.substring(0,52)+'<br/> - via Bing</span></a></figure>';mediaList.push({'type':'photo','thumbUrl':photo.urlThumb,'mediaUrl':photo.urlLarge,'title':photo.title});});}
var items=photoItems+videoItems;var html='<div id="gridMode">';html+='<div id="mediaPanelContent">';html+=items;html+='</div>';html+='</div>';if(items){document.getElementById("mediaInfo").innerHTML=html;ResetBrowserScrollAfterDataLoaded();}
else{$('#subitem_photo').hide();document.getElementById("mediaInfo").innerHTML='<article class="info padding align-center font_18">Sorry, Currently we do not have any media for this city.</article>';}
$("#bingMoreLink").show();$("img.lazyloading").lazyload({placeholder:"/images/media-load.gif",effect:"fadeIn",threshold:400});});}
function pushOnOverlay(imagePath){$('body').append('<div class="welcome_overlay launchOverlay" style="z-index:2001;" onclick="$(\'#overlayedMedia\').remove();$(\'.launchOverlay\').remove();"></div><div id="overlayedMedia" style="z-index:2002" class="overlayedMedia rounded"><a onclick="$(\'#overlayedMedia\').remove();$(\'.launchOverlay\').remove();" class="close" href="javascript://"></a><img src="'+imagePath+'" height="500" width="700"/></div>');window.scrollTo(0,0);}
$(function(){$('#sm_list').click(function(){document.getElementById("subitem_all").setAttribute("class","active");document.getElementById("subitem_video").setAttribute("class","");document.getElementById("subitem_photo").setAttribute("class","");$('#subitem_video').click(function(){$('#enlargedPhoto').hide();});$('#subitem_all').click(function(){$('#enlargedPhoto').show();});$('#subitem_photo').click(function(){$('#enlargedPhoto').show();});});})
function appendMedia(){url="/api/cityimages/source/bing/city/"+document.getElementById("hdnCity").value+'/page/'+mediaPage;var photoItems='';var videoItems='';var i=0;$.getJSON(url,function(fsdata){$.each(fsdata.photos,function(i,photo){photoItems+='<figure class="photoc"><a style="background-image:url('+photo.MediaUrl+')" class="thumb" onclick="mediaListView(\''+photo.MediaUrl+'\')" href="javascript://"> <span>'+photo.Title+'</span></a></figure>';mediaList.push({'type':'photo','thumbUrl':photo.MediaUrl,'mediaUrl':photo.MediaUrl,'title':photo.Title});});$.each(fsdata.videos,function(i,video){videoItems+='<figure  class="videoc"><a class="btnPlay" href="'+video.PlayUrl+'" target="_blank">&nbsp;</a> <a style="background-image:url('+video.StaticThumbnail.Url+')" class="thumb" href="javascript://"> <span>'+video.Title+'</span></a></figure>';mediaList.push({'type':'video','thumbUrl':video.StaticThumbnail.Url,'mediaUrl':video.PlayUrl,'title':video.Title});});var items=photoItems+videoItems;$("#mediaInfo").append(items);mediaPage++;});}
function sendToMediaTab(){}
function appendInfoMedia(){var preLoader='<center><div style="padding:top:15px;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div></center>';$("#info_media_images").html(preLoader);url="/api/cityimages/source/bing/city/"+document.getElementById("hdnCity").value+'/page/'+mediaPage+'/record/10';var photoItems='';var videoItems='';var i=0;$.getJSON(url,function(fsdata){$.each(fsdata.photos,function(i,photo){photoItems+='<li><a onclick="" style="background-image:url('+photo.Thumbnail.Url+')" class="thumb" href="javascript://"><img height="52" width="79" src="'+photo.Thumbnail.Url+'"></a></li>';mediaList.push({'type':'photo','thumbUrl':photo.Thumbnail.Url,'mediaUrl':photo.MediaUrl,'title':photo.Title});});$.each(fsdata.videos,function(i,video){videoItems+='<li><a href="'+video.PlayUrl+'" target="_blank" class="btnPlay"></a><a style="background-image:url('+video.StaticThumbnail.Url+')" class="thumb" onclick="openPanelWithDetail(\''+i+'\')" href="javascript://"><img height="52" width="79" src="'+video.StaticThumbnail.Url+'"></a></li>';mediaList.push({'type':'video','thumbUrl':video.StaticThumbnail.Url,'mediaUrl':video.PlayUrl,'title':video.Title});});var items=photoItems+videoItems;$("#info_media_images").html(items);mediaPage++;});}
function mediaListView(showPhoto){var html='<div id="switchPhotoMode">';html+='<a class="prev-hr" id="prevPhotoList" href="javscript://"></a>';html+='<div class="list-carousel"> ';html+='<ul id="photoList">';var firstImage='';$('#sm_list').addClass('active');$('#sm_grid').removeClass('active');$.each(mediaList,function(i,item){if(i==0){firstImage=item.mediaUrl}
if(item.type=='photo'){html+='<li class="photoc"><a onclick="$(\'#enlargedPhotoImg\').attr(\'src\', \''+item.mediaUrl+'\')" href="javascript://"><img title= "'+item.title+'" src="'+item.thumbUrl+'"></a></li>';}
else{html+='<li class="videoc"><a class="btnPlay" target="_blank" href="'+item.mediaUrl+'"></a><a onclick="$(\'#enlargedPhotoImg\').attr(\'src\', \''+item.mediaUrl+'\')" href="javascript://"><img title= "'+item.title+'" src="'+item.thumbUrl+'"></a></li>';}});html+='</ul>';html+='</div><!-- list carousel to hold thumbs, ends here -->';html+='<a class="next-hr" id="prevPhotoList" href="javscript://"></a>';html+='<div style="height:5px;"></div>';var bigImageUrl='';if(showPhoto){bigImageUrl=showPhoto;}
else{bigImageUrl=firstImage;}
html+='<div align="center" id="enlargedPhoto"><img id="enlargedPhotoImg" width="550" height="350" src="'+bigImageUrl+'"></div>';html+='</div>';$("#mediaInfo").html(html);$("#bingMoreLink").hide();}
function mediaGridView(showPhoto){var photoItems='';$('#sm_list').removeClass('active');$('#sm_grid').addClass('active');$.each(mediaList,function(i,item){if(item.type=='video'){photoItems+='<figure  class="videoc"><a target="_blank" class="btnPlay" href="'+item.mediaUrl+'">&nbsp;</a> <a style="background-image:url('+item.thumbUrl+')" class="thumb" href="javascript://"><span>'+item.title+'</span></a></figure>';}
else{photoItems+='<figure class="photoc"><a style="background-image:url('+item.thumbUrl+')" class="thumb" onclick="mediaListView(\''+item.mediaUrl+'\')" href="javascript://"><span>'+item.title+'</span></a></figure>';}});$("#mediaInfo").html(photoItems);$("#bingMoreLink").show();}
function notifyme(msg,t){$("#notifyme").html(msg).removeClass().addClass(t).show().delay(5000).fadeOut();$("#notifyme").css("left",Math.round(($(document).width()/2)-($("#notifyme").width()/2)));}
function trim(str){if(str!=null){var i;for(i=0;i<str.length;i++){if(str.charAt(i)!=" "){str=str.substring(i,str.length);break;}}
for(i=str.length-1;i>=0;i--){if(str.charAt(i)!=" "){str=str.substring(0,i+1);break;}}
if(str.charAt(0)==" "){return"";}
else{return str;}}}
function inArrayJS(what,where){var a=false;for(var i=0;i<where.length;i++){if(what==where[i]){a=true;break;}}
return a;}
function saveUserReview(itemId,articleType,sourceId,entityId,mode,categoryId,tab){var rating=new Array();var c=0;for(i=0;i<=4;i++){var radio1=document.getElementsByName("radio"+i);var radioLength=radio1.length;if(typeof radioLength=='undefined'){if(radio1.checked){rating.push(radio1.value);}}else{var k=1;for(var j=radioLength-1;(j>=0)&&k<=5;j--){if(radio1[j].checked){rating.push(radio1[j].value);}
k++;}}}
if(rating.length!=5){notifyme("Please give your rating for all the attributes.","error");return false;}
var reviewText=$("#reviewText_"+categoryId).val();if(reviewText=='All fields are required'||reviewText==''||reviewText.replace(/\s/g,'').length==0){notifyme("Please Add your review","error");return false;}
evaluation=reviewEvaluation;if(selectedTripType==''){notifyme("Please select trip type","error");return false;}else{tripType=selectedTripType;}
$("#"+tab+"_"+itemId+"_review_"+categoryId).html('<div style="padding:50px 0;" align="center"><img src="/images/loading.gif" /><br />Loading...</div>');$.post("/html5/mytrip/saveuserreview",{sourceId:sourceId,sourceType:articleType,evaluation:evaluation,reviewText:reviewText,tripType:tripType,rating:rating.toString(),mode:mode},function(saveddata){var result=jQuery.parseJSON(saveddata);if(result.attempt=='success'){notifyme(result.message,"success");}
$("#"+tab+"_"+itemId+"_reviewForm_"+categoryId).hide();url='/html5/mytrip/getuserreviewratings/articleId/'+sourceId+'/itemId/'+itemId+'/entityId/'+entityId+'/articleType/'+articleType+'/tab/'+tab+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){arrdata=data.split("|||");var userdata=arrdata[0];var putdata=arrdata[1];var evaluation=arrdata[2];var tripType=arrdata[3];flag=arrdata[4];if(flag==1){$("#"+tab+"_"+itemId+"_review_"+categoryId).html(userdata);$("#"+tab+"_"+itemId+"_placeAttributes_"+categoryId).html(putdata);$("#"+tab+"_"+itemId+"_rateuser_"+categoryId).html(evaluation+tripType);}});});}
function getBookingInformation(hosteId,startDate,endDate,numNights){var url='/html5/hostel/bookinginformation/pid/'+hosteId+'/start_date/'+startDate+'/end_date/'+endDate+'/num_nights/'+numNights+'/sid/'+Math.random();$.get(url,function(result){$("#availability_div").html(result);});}
var hostelPersons=0;function selectRoomForBooking(id,persons,tab,hostelId){hostelPersons=persons;var roomCode=$('#'+tab+'hostel_room_type_'+id).val();var oldValue=$('#'+tab+'hostel_booking_rooms').val();var i=1;while(document.getElementById(tab+'guests_'+i)){if(i!=id){$('#'+tab+'guests_'+i).val('0');}
i++;}
var str='';str=roomCode;$('#'+tab+'hostel_booking_rooms').val(str);submitBookingRequest(hostelId,tab,id);}
function submitBookingRequest(hostelId,tab,id){abortAjax();var roomCode=$('#'+tab+'hostel_room_type_'+id).val();var roomPreference=$('#'+tab+'hostel_booking_rooms').val();if(tab=='B'){var panel='book';}else if(tab=='P'){var panel='plan';}else if(tab=='MT'){var panel='MT';}
var currency=$('#'+panel+'hostel_currency_check').val();if(roomCode!=roomPreference){hostelPersons=0;var i=1;while(document.getElementById(tab+'guests_'+i)){if(i!=id){$('#'+tab+'guests_'+i).val('0');}
i++;}}
if(hostelPersons==0){notifyme('Please select no of guests to continue..','error');$("#"+tab+"open_hostel_book_button"+id).show();$("#"+tab+"open_hostel_book_progress"+id).hide();return false;}else{var roomPersons=hostelPersons;}
if(tab=='B'){var fromDate=$("#hotel_availability_start").val();var endDate=$("#hotel_availability_end").val();}
else if(tab=='P'){var fromDate=$("#plan_hostel_availability_start").val();var endDate=$("#plan_hostel_availability_end").val();}else if(tab=='MT'){var fromDate=$("#MThostel_availability_start").val();var endDate=$("#MThostel_availability_end").val();}
var datearray=fromDate.split("-");var newfromdate=datearray[2]+'-'+datearray[0]+'-'+datearray[1];var datearray=endDate.split("-");var newtodate=datearray[2]+'-'+datearray[0]+'-'+datearray[1];var roomNum='1';var url='/html5/hostel/bookrequest/pid/'+hostelId+'/start_date/'+newfromdate+'/end_date/'+newtodate+'/roomnums/'+roomNum+'/roompreference/'+roomPreference+'/persons/'+roomPersons+'/currency/'+currency;$.get(url,function(result){});}
function hostelBookingPageRequest(hostelId,tab,id){var roomCode=$('#'+tab+'hostel_room_type_'+id).val();var roomPreference=$('#'+tab+'hostel_booking_rooms').val();if(roomCode!=roomPreference){hostelPersons=0;var i=1;while(document.getElementById(tab+'guests_'+i)){if(i!=id){$('#'+tab+'guests_'+i).val('0');}
i++;}}
if(hostelPersons==0){notifyme('Please select no of guests to continue..','error');return false;}
if(window.location.hostname=='localhost'){var HTTPS_URL='http://'+window.location.hostname;}else{var HTTPS_URL='https://'+window.location.hostname;}
url=HTTPS_URL+'/html5/hostel/bookingrequest/';var target="hostel_book";window.open(url,target);}
var hostelBookingFromPlan=false;function submitCustomerRequest(){var BSID=$.trim($("#BSID").val());var FirstName=$.trim($("#FirstName").val());var LastName=$.trim($("#LastName").val());var Nationality=$.trim($("#Nationality").val());var Gender=$.trim($("#Gender").val());var EmailAddress=$.trim($("#EmailAddress").val());var PhoneNumber=$.trim($("#PhoneNumber").val());var ArrivalTime=$.trim($("#ArrivalTime").val());var CCName=$.trim($("#CCName").val());var CCNumber=$.trim($("#CCNumber").val());var CCExpiry_Month=$("#expiration_month").val()
var CCExpiry_Year=$("#expiration_year").val();var CCType=$.trim($("#CCType").val());var CVV=$.trim($("#CVV").val());var Currency=$.trim($("#Currency").val());var SettleCurrency=$.trim($("#SettleCurrency").val());var CCExpiry=CCExpiry_Month+'/'+CCExpiry_Year;$.post("/html5/hostel/bookingform",{BSID:BSID,FirstName:FirstName,LastName:LastName,Nationality:Nationality,Gender:Gender,EmailAddress:EmailAddress,PhoneNumber:PhoneNumber,ArrivalTime:ArrivalTime,CCName:CCName,CCNumber:CCNumber,CCExpiry:CCExpiry,CCType:CCType,CVV:CVV,Currency:Currency,SettleCurrency:SettleCurrency,TestMode:1},function(data){if(hostelBookingFromPlan){$("#contHostel").html(data);}
else{$("#hotelDetails").html(data);}});}
function openHotelBookingForm(hostelId){var url='/html5/hostel/bookingform/sid/'+Math.random();$.get(url,function(result){$("#hotelDetails").html('');$("#hostel_book_now_btn").html('');$("#hostel_booking_form").show();});}
function getXYPositionByLatLon(lat,lng){var earth_rad=177.05916741691129205089981312264;var y_earth_rad=179.05916741691129205089981312264;var long_sign=1;var lat_sign=1;if(lng<0){long_sign=-1;}
if(lat<0){lat_sign=-1;}
lng=Math.abs(lng);lat=Math.abs(lat);var pi=3.14159265358979323846264338327950288;var radian=pi/180;lat=lat*radian;lng=lng*radian;x=(3/2)*(1/pi)*lng*Math.sqrt((pi*pi*(1/3))-(lat*lat))*earth_rad*long_sign;y=lat*y_earth_rad*lat_sign;x=x+479;y=315-y;return(x+"|"+y);}
function checkCookie(cookieName,info){var welcomeTrip=getCookie(cookieName);if(welcomeTrip!=null&&welcomeTrip!="")
{}else{setCookie(cookieName,info,2);}}
function requestInvitationCode(){$("#msgs div").hide();var url="/index/request/";var request_code=$("#request_code").val();if(request_code!=''){$.post(url,{request_code:request_code},function(response){if(response=='success'){$('#ShowMsg').fadeIn("slow");$('#ShowForm').hide();}else if(response=="Invalid Email"){$("#ShowEmailErrMsg").fadeIn("slow");}else if(response=="email_exists"){$("#ShowExist").fadeIn("slow");$("#ShowForm").hide();}else{alert('Some Internal Problem');}});}else{$("#request_code").val('');$("#request_code").focus();}}
function getCookie(c_name){var i,x,y,ARRcookies=document.cookie.split(";");for(i=0;i<ARRcookies.length;i++)
{x=ARRcookies[i].substr(0,ARRcookies[i].indexOf("="));y=ARRcookies[i].substr(ARRcookies[i].indexOf("=")+1);x=x.replace(/^\s+|\s+$/g,"");if(x==c_name)
{return unescape(y);}}}
function getFoursquareCategories(bucketId){var url='';if(bucketId==2){$("#listActivityCategory").hide();}
cityId=parseInt(document.getElementById("hdnCityId").value);if(explorePanelMode=='friend'){url='/html5/plan/foursquarecategory/bucketId/'+bucketId+'/cid/'+cityId+'/mode/f/sid/'+Math.random();}
else{url='/html5/plan/foursquarecategory/bucketId/'+bucketId+'/cid/'+cityId+'/sid/'+Math.random();}
$.get(url,function(result){data=result.split("|||");if(data[0]!='undefined'){if(bucketId==1){$("#listAttractionCategory").html(data[0]);}else if(bucketId==2){$("#listActivityCategory").html(data[0]);$("#listActivityCategory").slideDown("fast");}else if(bucketId==3){$("#listRestaurantCategory").html(data[0]);}else if(bucketId==4){$("#listNightlifeCategory").html(data[0]);}else if(bucketId==5){}else if(bucketId==6){$("#listShoppingCategory").html(data[0]);}else if(bucketId==7){}else if(bucketId==8){}}});}
function getPanelHotelLocation(autoid){var a=$('#'+autoid).autocomplete1({serviceUrl:'/feed/hotelcitysuggest/',minChars:2,maxHeight:400,width:200,zIndex:9999,noCache:false,onSelect:function(value,data){var result=data;}});}
function editUserReview(sourceId,articleType,itemId){var reviewText=$("#reviewText").val();if(reviewText==''){return false;}
evaluation=reviewEvaluation;if(articleType==3){$("#"+itemId+"_review").html('<div style="padding:50px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>');}
else{$("#"+itemId+"_hostelreview").html('<div style="padding:50px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>');}
var url='/mytrip/edititemreview/sourceId/'+sourceId+'/articleType/'+articleType+'/evaluation/'+evaluation+'/reviewText/'+reviewText;$.getJSON(url,function(result){alert(result.message);if(articleType==3){$("#"+itemId+"_reviewForm").hide();url='/html5/mytrip/getuserreview/articleId/'+sourceId+'/itemId/'+itemId+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){arrdata=data.split("|||");userdata=arrdata[0];flag=arrdata[1];$("#"+itemId+"_review").html(userdata);});}
else{$("#"+sourceId+"_hostelreviewForm").hide();url='/html5/mytrip/getuserreview/articleId/'+sourceId+'/articleType/'+articleType+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){arrdata=data.split("|||");userdata=arrdata[0];flag=arrdata[1];$("#"+sourceId+"_hostelreview").html(userdata);});}
$("#reviewText").val('')});}
function editRecommendationsReviews(articleId,articleType,evaluation,reviewtext,itemId,entityId,rating,tripType,tab){if(entityId=='5'){var categoryId=1
var articleType='3';}else if(entityId=='3'){var categoryId=3
var articleType='3';}else if(entityId=='4'){var categoryId=4;var articleType='3';}else if(entityId=='9'){var categoryId=6;var articleType='3';}
else if(entityId=='1'){var categoryId=11;var articleType='6';}else if(entityId=='2'){var categoryId=16;var articleType='7';}
var reviewForm='';$("#"+tab+"_"+itemId+"_placeAttributes_"+categoryId).html('');$("#"+tab+"_"+itemId+"_rateuser_"+categoryId).html('');getReviewForm(entityId,articleId,itemId,articleType,categoryId,tab,'edit',rating,reviewtext,evaluation);selectTripTypeofItem(tripType);}
function cvvPictureSwap(ctype)
{if(ctype==''){$("#amex_security_code").hide();$("#other_security_code").hide();}else if(ctype=='AX'){$("#amex_security_code").show();$("#other_security_code").hide();}else{$("#amex_security_code").hide();$("#other_security_code").show();}}
function sendToFriend1(friendId){FB.ui({method:'send',name:'Georama - Plan. Book. Share.',caption:'Georama - the best way to share your travel experiences',display:'popup',to:friendId,picture:'http://www.georama.com/images/facebook-icon.png',link:'http://www.georama.com/',description:'Georama is a one-stop solution that lets travelers plan, book, and share their trips on a one-of-a-kind interactive map. It is visual, immersive, and fun!'});}
function showCarFacility(i){if($("#carFacilities_"+i).show()==true){$("#carFacilities_"+i).hide();}
else{$("#carFacilities_"+i).show();}}
function addChildBoxes(no_of_boxes,LabelText,type,tab,fromAge,toAge,bandId,gradeOption)
{if(tab=='book'){var pre='B';}else if(tab=='plan'){var pre='P';}else{var pre='MT';}
var i,ageHeader,setlableDiv,LabelText,DivID,contDiv,name1,clearDiv,holderDiv,labelTag,select1;DivID=pre+"agebox_"+LabelText;contDiv=document.getElementById(DivID);contDiv.style.display="block";clearDiv=document.createElement("div");clearDiv.className="clearfloat";var str='';if(no_of_boxes>0){document.getElementById(DivID).innerHTML="";ageHeader=document.createElement("h4");ageHeader.innerHTML="Enter "+LabelText+"'s age:";document.getElementById(DivID).appendChild(ageHeader);for(i=0;i<no_of_boxes;i++){holderDiv=document.createElement("div");holderDiv.className="fl marginR10";holderDiv.style.width="60px";setlableDiv=document.createElement("div");setlableDiv.className="stylize-select hotel-rac marginR10 fl";labelTag=document.createElement("label");labelTag.innerHTML=LabelText+" "+(i+1)+": ";select1=document.createElement("select");select1.setAttribute('name','ageBands_'+type+'ages_'+i);select1.setAttribute('id',pre+'ageBands_'+type+'ages_'+i);select1.setAttribute('class','validate[required]');select1.setAttribute('onchange','activityBookingparam(\''+bandId+'\',\''+gradeOption+'\',\''+tab+'\');');select1.style.width="300px";for(j=fromAge;j<=toAge;j++){var option1=document.createElement("option");option1.setAttribute("value",j);option1.innerHTML=j;select1.appendChild(option1);}
setlableDiv.appendChild(select1);holderDiv.appendChild(labelTag).appendChild(setlableDiv);contDiv.appendChild(holderDiv);}
contDiv.appendChild(clearDiv);}
else if(no_of_boxes==0){if(LabelText=='Child'){var textLabel='Children';}else{var textLabel=LabelText+'s';}
document.getElementById(DivID).innerHTML='<p class="align-center padding50 semi-light">Select number of '+textLabel+'</p>';}}
function formatDate(date,dformat){var mydate=new Date(date);if(mydate=='Invalid Date')
return'Invalid Date Format';month=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']
switch(dformat){case'MMdYYY':return month[mydate.getMonth()]+' '+mydate.getDay()+', '+mydate.getFullYear();break;case'mm-dd-yy':return mydate.getDay()+'-'+mydate.getMonth()+'-'+mydate.getYear();break;}}
function searchActivityAvailability(tab){if(typeof tab=='undefined'){var tab='book';var pre='B';}else if(tab=='plan'){var tab='plan';var pre='P';}else{var pre=tab;}
$('#'+pre+'activitiesAvailbilty').html(preloadDiv);var url='/html5/viator/bookingavaildate/tab/'+tab;$.get(url,function(data){$('#'+pre+'activitiesAvailbilty').html(data);});}
function getSelectedMonth(selectedMonthInfo,monthlist,tab){if(tab=='book'){var pre='B';}else if(tab=='plan'){var pre='P';}else{var pre=tab;}
selectedMonthInfo=selectedMonthInfo.split('|');var selectMonth=selectedMonthInfo[0];var selectMName=selectedMonthInfo[1];monthlist=monthlist.split(',');for(counter=0;counter<=monthlist.length;counter=counter+1){if(monthlist[counter]==selectMonth){$('#'+pre+'month_list_'+selectMonth).show();}
else{$('#'+pre+'month_list_'+monthlist[counter]).hide();}}}
function specificActivityAvailability(bookingDate,tab){if(tab=='book'){var pre='B';}else if(tab=='plan'){var pre='P';}else{var pre=tab;}
$('#'+pre+'activitiesAvailbilty').hide();$('#'+pre+'activitiesPriceDetails').html(preloadDiv);$('#'+pre+'activitiesPriceDetails').show()
if(document.getElementById(pre+'tourgrades')==null){gradeCode='DEFAULT';gradeOptions='';}
else{gradeCodeCombo=document.getElementById(pre+'tourgrades').value;gradeCodeCombo=gradeCodeCombo.split('|');gradeCode=gradeCodeCombo[0];gradeOptions=gradeCodeCombo[1];}
$.post("/html5/viator/getpricingmatrix",{bookingDate:bookingDate,tourGradeCode:gradeCode,specialReservation:false,gradeOption:gradeOptions,tab:tab},function(data){ages=[];ageBandId=[];ageBandCount=[];$('#'+pre+'activitiesPriceDetails').html(data);$('#ActivityselectOtherDate').click(function(){$('#'+pre+'activitiesPriceDetails').hide();$('#'+pre+'activitiesAvailbilty').show();});});}
function addToCartActivity(ageBandIds,gradeOption,tab){if(tab=='book'){var pre='B';}else if(tab=='plan'){var pre='P';}else{var pre=tab;}
$(window).resize(function(){$('#'+pre+'AddtoCart').validationEngine('updatePromptsPosition')});var formValid=$('#'+pre+'AddtoCart').validationEngine('validate');if(!formValid)
return;if(typeof gradeOption=='undefined'){gradeOption='';}
var bandId=ageBandIds.split(',');var ageBandId='';var ageBandCount='';var age='';var totalCount=0;for(i=0;i<bandId.length;i++){if(document.getElementById(pre+"viator_agebands_"+bandId[i])!=null&&document.getElementById(pre+"viator_agebands_"+bandId[i]).value!=0){if(ageBandId==''){ageBandCount=document.getElementById(pre+"viator_agebands_"+bandId[i]).value;ageBandId=bandId[i];var count=document.getElementById(pre+"viator_agebands_"+bandId[i]).value;totalCount=totalCount+parseInt(count);for(j=0;j<count;j++){if(document.getElementById(pre+"ageBands_"+bandId[i]+"ages_"+j)){if(age==''){age=document.getElementById(pre+"ageBands_"+bandId[i]+"ages_"+j).value;}
else{age+=','+document.getElementById(pre+"ageBands_"+bandId[i]+"ages_"+j).value;}}}}
else{ageBandCount+=','+document.getElementById(pre+"viator_agebands_"+bandId[i]).value;ageBandId+=','+bandId[i];var count=document.getElementById(pre+"viator_agebands_"+bandId[i]).value;totalCount=totalCount+parseInt(count);for(j=0;j<count;j++){if(document.getElementById(pre+"ageBands_"+bandId[i]+"ages_"+j)){if(age==''){age=document.getElementById(pre+"ageBands_"+bandId[i]+"ages_"+j).value;}
else{age+=','+document.getElementById(pre+"ageBands_"+bandId[i]+"ages_"+j).value;}}}}}}
var ageB=ageBandId.toString();var ageBC=ageBandCount.toString();if(totalCount==0){$("#"+pre+"viatorErrorMessage1").show();$("#"+pre+"viatorErrorMessage2").hide();return;}else if(totalCount>9){$("#"+pre+"viatorErrorMessage2").show();$("#"+pre+"viatorErrorMessage1").hide();return;}
if(window.location.hostname=='localhost'){var HTTPS_URL='http://'+window.location.hostname;}else{var HTTPS_URL='https://'+window.location.hostname;}
url=HTTPS_URL+"/html5/viator/calculateprice/promoCode//aid/null/tBid/"+ageB+"/tBCount/"+ageBC+"/age/"+age+"/gradeOption/"+gradeOption;window.open(url);}
function getRatingBlockByPanelId(entityId,articleId,itemID,rating,categoryId,tab){var hostel=new Array("Location","Comfort & Cleanliness","Value for Money","Security","Fun Factor");var hotel=new Array("Location","Ambiance","Comfort & Cleanliness","Service & Staff","Amenities");var restaurant=new Array("Food Quality","Service","Ambiance","Menu","Value for Money");var nightlife=new Array("Ambiance","Drink Selection","Music","Service","Value for Money");var attraction=new Array("Accessibility","Appeal","Value for Money","Ease of Entry","Originality");var activities=new Array("Accessibility","Appeal","Value for Money","Ease of Entry","Schedule Frequency");var flight=new Array("Punctuality","Comfort and Leg Room","In-Flight Service","In-Flight Amenities","Check-In & Boarding Experience");var car=new Array("Vehicle Choices","Vehicle Condition","Drop-off/Pick-up Flexibility","Value for Money","Service Speed and Quality");var shopping=new Array("Accessibility","Appeal","Value for Money","Ease of Entry","Schedule Frequency");var checked=new Array;var ratingdata='';ratingdata+='<article class="width45 fl font_12">';ratingdata+='<div class="put-review-sum fl width_100" id="write-review-chk"><table>';ratingdata+='<tr><td></td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td></tr>';if(typeof rating!='undefined'){if(rating!=''){rating=rating.split(',');}}else{rating='';}
switch(entityId){case'1':var j=0;for(i=0;i<=4;i++){if(rating!=''&&rating[i]!=0){for(k=1;k<=5;k++){if(rating[i]==k){checked[k]='checked';}else{checked[k]='';}}}else{for(k=1;k<=5;k++){checked[k]='';}}
ratingdata+='<tr><td><label>'+hotel[i]+'</label></td>';ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="1" '+checked[1]+' /></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="2" '+checked[2]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="3" '+checked[3]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="4" '+checked[4]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="5" '+checked[5]+'/></td></tr>';j++;}
break;case'2':var j=0;for(i=0;i<=4;i++){if(rating!=''&&rating[i]!=0){for(k=1;k<=5;k++){if(rating[i]==k){checked[k]='checked';}else{checked[k]='';}}}else{for(k=1;k<=5;k++){checked[k]='';}}
ratingdata+='<tr><td><label>'+hostel[i]+'</label></td>';ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="1" '+checked[1]+' /></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="2" '+checked[2]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="3" '+checked[3]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="4" '+checked[4]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="5" '+checked[5]+'/></td></tr>';j++;}
break;case'3':var j=0;for(i=0;i<=4;i++){if(rating!=''&&rating[i]!=0){for(k=1;k<=5;k++){if(rating[i]==k){checked[k]='checked';}else{checked[k]='';}}}else{for(k=1;k<=5;k++){checked[k]='';}}
ratingdata+='<tr><td><label>'+restaurant[i]+'</label></td>';ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="1" '+checked[1]+' /></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="2" '+checked[2]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="3" '+checked[3]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="4" '+checked[4]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="5" '+checked[5]+'/></td></tr>';j++;}
break;case'4':var j=0;for(i=0;i<=4;i++){if(rating!=''&&rating[i]!=0){for(k=1;k<=5;k++){if(rating[i]==k){checked[k]='checked';}else{checked[k]='';}}}else{for(k=1;k<=5;k++){checked[k]='';}}
ratingdata+='<tr><td><label>'+nightlife[i]+'</label></td>';ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="1" '+checked[1]+' /></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="2" '+checked[2]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="3" '+checked[3]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="4" '+checked[4]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="5" '+checked[5]+'/></td></tr>';j++;}
break;case'5':var j=0;for(i=0;i<=4;i++){if(rating!=''&&rating[i]!=0){for(k=1;k<=5;k++){if(rating[i]==k){checked[k]='checked';}else{checked[k]='';}}}else{for(k=1;k<=5;k++){checked[k]='';}}
ratingdata+='<tr><td><label>'+attraction[i]+'</label></td>';ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="1" '+checked[1]+' /></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="2" '+checked[2]+' /></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="3" '+checked[3]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="4" '+checked[4]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="5" '+checked[5]+'/></td></tr>';j++;}
break;case'6':var j=0;for(i=0;i<=4;i++){if(rating!=''&&rating[i]!=0){for(k=1;k<=5;k++){if(rating[i]==k){checked[k]='checked';}else{checked[k]='';}}}else{for(k=1;k<=5;k++){checked[k]='';}}
ratingdata+='<tr><td><label>'+activities[i]+'</label></td>';ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="1" '+checked[1]+' /></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="2" '+checked[2]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="3" '+checked[3]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="4" '+checked[4]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="5" '+checked[5]+'/></td></tr>';j++;}
break;case'7':var j=0;for(i=0;i<=4;i++){if(rating!=''&&rating[i]!=0){for(k=1;k<=5;k++){if(rating[i]==k){checked[k]='checked';}else{checked[k]='';}}}else{for(k=1;k<=5;k++){checked[k]='';}}
ratingdata+='<tr><td><label>'+flight[i]+'</label></td>';ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="1" '+checked[1]+' /></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="2" '+checked[2]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="3" '+checked[3]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="4" '+checked[4]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="5" '+checked[5]+'/></td></tr>';j++;}
break;case'8':var j=0;for(i=0;i<=4;i++){if(rating!=''&&rating[i]!=0){for(k=1;k<=5;k++){if(rating[i]==k){checked[k]='checked';}else{checked[k]='';}}}else{for(k=1;k<=5;k++){checked[k]='';}}
ratingdata+='<tr><td><label>'+car[i]+'</label></td>';ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="1"  '+checked[1]+' /></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="2" '+checked[2]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="3" '+checked[3]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="4" '+checked[4]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="5" '+checked[5]+'/></td></tr>';j++;}
break;case'9':var j=0;for(i=0;i<=4;i++){if(rating!=''&&rating[i]!=0){for(k=1;k<=5;k++){if(rating[i]==k){checked[k]='checked';}else{checked[k]='';}}}else{for(k=1;k<=5;k++){checked[k]='';}}
ratingdata+='<tr><td><label>'+shopping[i]+'</label></td>';ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="1" '+checked[1]+' /></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="2" '+checked[2]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="3" '+checked[3]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="4" '+checked[4]+'/></td>';j++;ratingdata+='<td><input type="radio" name="radio'+i+'" id="radio'+j+'" value="5" '+checked[5]+'/></td></tr>';j++;}
break;}
ratingdata+='</table>';ratingdata+='</div>';ratingdata+='<div style="color:#555" class="font_11 fl marginL2 marginT5">';ratingdata+='<span class="fl sharp">Rating Score:&nbsp;</span>';ratingdata+='<span class="fl"><span style="background-color:#AFAFAF;width:20px;color:#fff;padding:1px 4px;border-radius:3px"><b>1</b></span> Lowest</span>';ratingdata+='<span class="fl"><span style="background-color:#AFAFAF; width:20px;margin-left:5px;color:#fff;padding:1px 4px;border-radius:3px">';ratingdata+='<b>5</b></span> Highest</span></div>';ratingdata+='</article>';document.getElementById(tab+"_"+itemID+"_rating_"+categoryId).innerHTML=ratingdata;}
function putUserRating(entityId,articleId,articleType,itemID){var rating=new Array();var c=0;for(i=0;i<=4;i++){var radio1=document.getElementsByName("radio"+i);var radioLength=radio1.length;if(typeof radioLength=='undefined'){if(radio1.checked){rating.push(radioObj.value);}else{}}
for(var j=0;j<radioLength;j++){if(radio1[j].checked){if(c==0&&i==1){rating.push(radio1[j].value);c++;}else{rating.push(radio1[j].value);}}}}
if(rating.length!=5){alert("please give your rating for all the attributes");}else{$("#"+itemID+"_rating").html('<div style="padding:50px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>');url='/html5/mytrip/putattributerating/entityId/'+entityId+'/articleId/'+articleId+'/articleType/'+articleType+'/rating/'+rating+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){if(data){filterStatsByFriend(entityId,articleId,articleType,itemID);}});}}
function getReviewByFilter(mode,sourceId,sourceType,itemId){$("#"+itemId+"_friendreview").html('<div style="padding:50px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>');surl='/html5/mytrip/getfriendreview/articleId/'+sourceId+'/articleType/'+sourceType+'/mode/'+mode+'/rand/'+parseInt(Math.random()*99999999);$.get(surl,function(fsdata){$("#"+itemId+"_friendreview").html(fsdata);});}
function filterStatsByFriend(entityId,articleId,articleType,itemId,mode){$("#"+itemId+"_rating").html('<div style="padding:50px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>');rateurl='/html5/mytrip/getattributerating/entityId/'+entityId+'/articleId/'+articleId+'/articleType/'+articleType+'/mode/'+mode+'/itemId/'+itemId+'/rand/'+parseInt(Math.random()*99999999);$.get(rateurl,function(ratedata){var ratingdata=ratedata.split('|||');var putdata=ratingdata[0];var rateflag=ratingdata[1];var familyCount=ratingdata[2];var coupleCount=ratingdata[3];var businessCount=ratingdata[4];var friendsCount=ratingdata[5];var soloCount=ratingdata[6];var likeCount=ratingdata[7];var okCount=ratingdata[8];var dislikeCount=ratingdata[9];$("#"+itemId+"_rating").html(putdata);});}
var shoppingListDetails=new Array();function openShoppingCategory(cat,name,radius_filter,page){$("#add_to_trip_button").html('');$("#shoppingDetails").hide();$("#shopping .list").hide();$("#shoppingInfo").show();$("#shoppingBtnBTR").hide();activeExploreTab='Shopping';showBing();businessId="active";city=document.getElementById("hdnCity").value;if(cat!=''){document.getElementById("hdnshoppingcat").value=cat;}
if(radius_filter!=''){document.getElementById("hdnshoppingfilter").value=radius_filter;}
if(name!=''){document.getElementById("hdnshoppingname").value=name;}
cat=document.getElementById("hdnshoppingcat").value
radius_filter=document.getElementById("hdnshoppingfilter").value
name=document.getElementById("hdnshoppingname").value;if(typeof radius_filter=='undefined'){radius_filter=0;}
if(typeof page=='undefined'){page=0;}
url='/html5/plan/buildshoppinglist/city/'+city+'/cat/'+cat+'/radius_filter/'+radius_filter+'/page/'+page+'/rand/'+parseInt(Math.random()*99999999);$("#weather").hide();document.getElementById("displayShoppingItem").innerHTML='<a href="javascript:;"> '+name+'</a>';document.getElementById("shoppingList").innerHTML='<div style="150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>';if(shoppingListDetails[city]){arrdata=shoppingListDetails[city].split("|||");businessId=arrdata[0];document.getElementById("shoppingList").innerHTML=arrdata[1];if(name=="Top Recommendations"){topRecommendation=true;getFoursquareCategories(6);$("#shoppingbuttonInfo").hide();$("#add_to_trip_button").hide();$("#shopping .list").hide();recommendsubcat="";openShopRecommendation(6,'shoppingList');}else{recommendsubcat="yelp";openShopRecommendation(cat,'shoppingList');}
if(!showBelow){$(this).resizepanels(420);$("#attScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#prevAttract",downID:"#nextAtt",scrollerID:"#attInnerWrapper"});$("#attrScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#attrScrollPrev",downID:"#attrScroll",scrollerID:"#attrContent"});}}else{if(name=="Top Recommendations"){topRecommendation=true;getFoursquareCategories(6);$("#add_to_trip_button").hide();$("#shoppingbuttonInfo").hide();recommendsubcat="";openShopRecommendation(6,'shoppingList');}else{topRecommendation=false;recommendsubcat="yelp";openShopRecommendation(cat,'shoppingList');$("#add_to_trip_button").hide();$("#shoppingbuttonInfo").hide();}
if(!showBelow){$(this).resizepanels(420);$("#actScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#prevShopping",downID:"#nextShopping",scrollerID:"#shopInnerWrapper"});$("#acctScrollDiv").verticalScrollPlus({speed:1000,step:450,upID:"#shoppingScrollDiv",downID:"#shoppingScroll",scrollerID:"#shopContent"});}}
$("#listShoppingCategory").slideUp("fast");}
function openShopRecommendation(bucketId,divName,query,method){var panel_trip_id='';var url='';$("#shoppingbuttonInfo").hide();$("#"+divMap[bucketId]+"BtnBTR").hide();if(global_trip_id!=''){panel_trip_id=global_trip_id;}else{panel_trip_id=$("#tripPlaceId").val();}
$("#listShoppingCategory").slideUp("fast");cityId=document.getElementById("hdnCityId").value;var cacheKey="tr_"+cityId+"_"+bucketId;if(recommendsubcat=="yelp"){url='/html5/plan/places/city/'+cityId+'/bucket/6/catId/'+bucketId;bucketId=6;}else{url='/html5/plan/places/city/'+cityId+'/bucket/'+bucketId;}
if(typeof query!='undefined'){url+='/q/'+query;}
var strReturn='';document.getElementById("shoppingInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';document.getElementById("shoppingList").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>';strReturn+='<a class="scrollup" href="javascript://">&nbsp;</a><div id="shoppingScrollDiv" class="pnlScrollCont"><ul id="lstShop" class="leftList vscroll-item">';if(cache[cacheKey]&&typeof query=='undefined'&&global_city_panel_id!=panel_trip_id){planDataCache=cache[cacheKey];$.each(planDataCache,function(i,record){strReturn+='<li id="liat_'+divMap[bucketId]+i+'" onClick="javascript:openInfoDetail('+i+', '+bucketId+',1 )"><a href="javascript:;" >'+record.name+'</a></li>';});strReturn+='</ul></div><a class="scrolldown" href="javascript://">&nbsp;</a>';document.getElementById('shoppingList').innerHTML=strReturn;openInfo(0,bucketId);}else{$.getJSON(url,function(result){var fsdata=result.panelData;if(typeof fsdata[0]=='undefined'||fsdata==''||typeof fsdata==null){visibleMap='bing';showVectorMap();$("#shoppingList").html('');if(typeof method=='undefined'){$("#shoppingSearchControl").hide();if(recommendsubcat!="yelp"){$("#shoppingCategory").hide();}}
$("#shoppingInfo").html('<article class="info padding align-center font_18">Sorry, we do not currently have any Shopping available for this city.</article>');$("#mapOverlay").hide();}else{$("#shoppingSearchControl").show();$("#shoppingCategory").show();planDataCache=fsdata;if(typeof query=='undefined'){cache[cacheKey]=fsdata;}
$.each(fsdata,function(i,record){strReturn+='<li id="liat_'+divMap[bucketId]+i+'" onClick="javascript:openInfoDetail('+i+', '+bucketId+' ,1)"><a href="javascript:;" >'+record.name+'</a></li>';});strReturn+='</ul></div><a class="scrolldown" href="javascript://">&nbsp;</a>';document.getElementById('shoppingList').innerHTML=strReturn;openInfo(0,bucketId);}});}
ResetBrowserScrollAfterDataLoaded();}
function FreeTextSearch(query){$('#activitySearch').hide();$('#activitySearchResults').html(preloadDiv);$('#activitySearchResults').show();$(".bActivitiesBtnBTR").show();$("#ActivitysortBy").show();$("#searchBarViator").hide();$(".bActivitiesBtnBTR").click(function(){$(".bActivitiesBtnBTR").hide();$("#ActivitysortBy").hide();$('#activitySearchResults').hide();$("#searchBarViator").hide();$('#activitySearch').show();});city=document.getElementById('hdnCity').value;var cityId=document.getElementById('hdnCityId').value;var cacheKey="activity_"+cityId+"_0";$.post("/html5/viator/freetextsearch",{topX:"1-200",destId:viatorActivityDestId,currencyCode:"USD",text:query},function(fsdata){bactivityCacheData=fsdata;cache[cacheKey]=fsdata;renderSearchBookingActivity(fsdata);});}
function renderSearchBookingActivity(result){var sText='';var cCtr=1;var gCtr=1;$.each(result.data,function(i,activity){if(cCtr>ActivitychkHCol){cCtr=1;gCtr++;}
if(toString(activity.data.title).length>22){activityName=activity.data.title.substring(0,22)+'...';}else{activityName=activity.data.title;}
bactivitylist+='<section class="hotelList">';bactivitylist+='<a href="javascript://;" onClick="openBookingActivityDetail(\''+activity.data.code+'\',\''+activity.data.currencyCode+'\', '+i+',\''+activity.title.replace(/[^a-zA-Z0-9-&://_,!@]/g,"")+'\',1)" style="float:left; display:inline-block; margin-right:5px;"><img class="lazyloading" width="70" height="70" src="'+activity.data.thumbnailURL+'"/></a>';bactivitylist+='<p><a href="javascript://;" onClick="openBookingActivityDetail(\''+activity.data.code+'\',\''+activity.data.currencyCode+'\', '+i+',\''+activity.title.replace(/[^a-zA-Z0-9-&://_,!@]/g,"")+'\',1)" ><strong>'+activityName+'</strong></a><br>';bactivitylist+='</p></section>';var detailText='';detailText+='<article class="content">';detailText+='<a class="grid_thumb_link" href="javascript://;" onClick="openBookingActivityDetail(\''+activity.data.code+'\',\''+activity.data.currencyCode+'\', '+i+',\''+activity.title.replace(/[^a-zA-Z0-9-&://_,!@]/g,"")+'\')" >';detailText+='<img class="thumb lazyloading" src="'+activity.data.thumbnailURL+'" style="float:left; border:none; margin-right:10px; height:100%;width:100%;" /></a>';detailText+='<p><strong><span class="attrName"><a href="javascript://;" onClick="openBookingActivityDetail(\''+activity.data.code+'\',\''+activity.data.correncyCode+'\','+i+',\''+activity.title.replace(/[^a-zA-Z0-9-&://_,!@]/g,"")+'\')">'+activityName+'<br /></a></span></strong>';detailText+='<span class="grey_borderbottom">Location:'+activity.data.primaryDestinationName+'</span>';detailText+='<span class="grey_borderbottom">Overall Rating:<br /><strong class="font_14 semi-light">'+activity.data.rating+' of 5</strong></span>';detailText+='<span class="grey_borderbottom">Duration:'+activity.data.duration+'</span></p>';detailText+='</article>';detailText+='<div class="clearfloat"></div>';detailText+='<article class="actionbuttons">';detailText+='<span class="fl"><strong class="priceTag">'+activity.data.priceFormatted+'</strong>USD<br/><small>Starting Price</small></span>';detailText+='<button class="book_now fr marginT10" onClick="openBookingActivityDetail(\''+activity.data.code+'\',\''+activity.data.currencyCode+'\', '+i+',\''+activity.title.replace(/[^a-zA-Z0-9-&://_,!@]/g,"")+'\')" class="book_now">View More</button><div class="clearfloat"/>';detailText+='</article>';sText+='<section class="g'+gCtr+'">'+detailText+'</section>';cCtr++;});$('#activitySearchResults').html('<div class="top25">'+sText+'</div>');for(i=1;i<=gCtr;i++){$('.g'+i).equalizeHeights();}
$("img.lazyloading").lazyload({placeholder:"/images/html5/img-lazy-loading.gif",effect:"fadeIn",threshold:400});}
function openPlanViatorActivity(sortType,category,categoryName,query){activeExploreTab='Activities';$("#activitybuttonInfo").hide();$("#activitiesBtnBTR").hide();$("#activitiesDetails").hide();$("#activities .list").hide();$("#activitiesInfo").show();$("#planActivitysortBy").show();city=document.getElementById('hdnCity').value;cityId=document.getElementById("hdnCityId").value;if((typeof category=='undefined'||category=='')&&(typeof sortType=='undefined'||sortType=='')){var url='/html5/viator/getplancategoriesnew/cityId/'+cityId+'/sid/'+Math.random();$.get(url,function(result){$("#planlistActivityCategory").html(result);});viatorSelectedCategory=0;$("#viator_catname").html('Top Recommendations');}else if(typeof category!='undefined'&&category!=''){viatorSelectedCategory=category;categoryName=categoryName.replace("~","");$("#viator_catname").html(categoryName);$("#planlistActivityCategory").slideUp("fast");}
businessId="active";if(activityFlag==false){activityFlag=true;}
if(sortType=='price'){viatorbookrating_sort_order='0';$("#activity_star_sort_plan").attr('class','');if(viatorbookprice_sort_order=='0'){sortOrder='PRICE_FROM_A';$("#activity_price_sort_plan").attr('class','');$("#activity_price_sort_plan").addClass('active desc');viatorbookprice_sort_order='1';}else{sortOrder='PRICE_FROM_D';$("#activity_price_sort_plan").attr('class','');$("#activity_price_sort_plan").addClass('active asc');viatorbookprice_sort_order='0';}}else if(sortType=='rating'){$("#activity_price_sort_plan").attr('class','');viatorbookprice_sort_order='0';if(viatorbookrating_sort_order=='0'){sortOrder='REVIEW_AVG_RATING_D';$("#activity_star_sort_plan").attr('class','');$("#activity_star_sort_plan").addClass('active asc');viatorbookrating_sort_order='1';}else{sortOrder='REVIEW_AVG_RATING_A';$("#activity_star_sort_plan").attr('class','');$("#activity_star_sort_plan").addClass('active desc');viatorbookrating_sort_order='0';}}else if(typeof sortType=='undefined'||sortType==''){sortOrder='TOP_SELLERS';$("#activity_star_sort_plan").attr('class','');$("#activity_price_sort_plan").attr('class','');viatorbookrating_sort_order='0';viatorbookprice_sort_order='0';}
document.getElementById("activitiesInfo").innerHTML='<div style="padding:40px 0 150px 0;" align="center">Loading..<br /><img src="/images/panel-loader.gif" alt=""/></div>';var cacheKey="activity_plan"+cityId+"_0";if(typeof query=='undefined'){var data={sortOrder:sortOrder,cityId:cityId,categoryId:viatorSelectedCategory}}else{var data={sortOrder:sortOrder,cityId:cityId,categoryId:viatorSelectedCategory,q:query}}
if(sortType=='rating'||sortType=='price'){$("#clearActivityPlanFilterA").addClass('filter_enabled');$("#clearActivityPlanFilterA").removeClass('filter_disabled');}
hotelAlreadyLoad=$.post("/html5/viator/getproductlist",data,function(fsdata){if(fsdata=='0'){$("#planActivitysortBy").hide();$('#planActivitySearchPanel').hide();$('#activityCategory').hide();$("#activitiesBtnBTR").hide();$("#activitiesInfo").html('<article class="info padding align-center font_18">Sorry, we do not currently have any Activities available for this city.</article>');}else{$("#activitiesBtnBTR").hide();$('#planActivitySearchPanel').show();$('#activityCategory').show();pactivityCacheData=fsdata;cache[cacheKey]=fsdata;renderPlanActivity(fsdata);ResetBrowserScrollAfterDataLoaded();if(isLiveServer==true){if(sortType=='rating'||sortType=='price'){pushGAEventTags('Plan','Activity');}}}});}
function renderPlanActivity(result){tripitembycategory(8);var sText='';var cCtr=1;var gCtr=1;var sourceIds=$("#tripItemSourceIds").val();var userSourceIds=$("#userItemSourceIds").val();var sourceIdArray=sourceIds.split(',');var userSourceIdArray=userSourceIds.split(',');var openEntityRequestId=false;var addToTripText=explorePanelMode=='friend'?'Recommend':'Add to Trip';var removeFromTripText=explorePanelMode=='friend'?'Recommended':'Remove';var addToTripFlag=explorePanelMode=='friend'?'friend':'grid';pactivitylist='';$.each(result,function(i,activity){if(cCtr>3){cCtr=1;gCtr++;}
if(selectedEntityId){if(activity.ProductCode==selectedEntityId){openEntityRequestId=i;requestedVenue=activity.ProductCode;requestedTitle=activity.ProductName.replace(/[^a-zA-Z0-9-&://_,.!@]/g,"");selectedEntityId=false;}}
var showTitle=false;activity.ProductName=activity.ProductName.toString();if((activity.ProductName).length>25){showTitle=true;activityName=activity.ProductName.substring(0,25)+'...';}else{showTitle=false;activityName=activity.ProductName;}
var propertyDestination='';if(typeof(activity.City)!='undefined'){propertyDestination+=activity.City;}
if(typeof(activity.Region)!='undefined'&&propertyDestination==''){propertyDestination+=activity.Region;}else{propertyDestination+=', '+activity.Region;}
pactivitylist+='<section id="planActivity'+activity.ProductCode+'" class="hotelList" onClick="openPlanActivityDetail(\''+activity.ProductCode+'\',\'USD\', '+i+',\''+activity.ProductName.replace(/[^a-zA-Z0-9-&://_,.!@]/g,"")+'\',1)">';pactivitylist+='<a href="javascript://;"  style="float:left; display:inline-block; margin-right:5px;"><img class="lazyloading" width="70" height="70" src="'+activity.ProductImageThumb+'" onError="this.src=\''+'/images/activity_default.gif'+'\'" /></a>';pactivitylist+='<p><a href="javascript://;"><strong>'+activity.ProductName+'</strong></a><br>';pactivitylist+='</p></section>';var detailText='';detailText+='<article class="content">';detailText+='<a class="grid_thumb_link" href="javascript://;" onClick="openPlanActivityDetail(\''+activity.ProductCode+'\',\'USD\', '+i+',\''+activity.ProductName.replace(/[^a-zA-Z0-9-&://_,.!@]/g,"")+'\')" >';detailText+='<img class="thumb lazyloading" src="'+activity.ProductImage+'" style="float:left; border:none; margin-right:10px; height:100%;width:100%;" onError="this.src=\''+'/images/activity_default.gif'+'\'" /></a>';if(showTitle){detailText+='<p><strong><span class="attrName"><a href="javascript://;" title="'+activity.ProductName+'" onClick="openPlanActivityDetail(\''+activity.ProductCode+'\',\'USD\','+i+',\''+activity.ProductName.replace(/[^a-zA-Z0-9-&://_,.!@]/g,"")+'\')">'+activityName+'<br /></a></span></strong>';}else{detailText+='<p><strong><span class="attrName"><a href="javascript://;" onClick="openPlanActivityDetail(\''+activity.ProductCode+'\',\'USD\','+i+',\''+activity.ProductName.replace(/[^a-zA-Z0-9-&://_,.!@]/g,"")+'\')">'+activityName+'<br /></a></span></strong>';}
detailText+='<span class="grey_borderbottom"><strong>Location: </strong>'+propertyDestination+'</span>';detailText+='<span class="grey_borderbottom"><strong>Overall Rating: </strong>&nbsp;<strong class="font_14 semi-light">'+activity.AvgRating+' of 5</strong></span>';detailText+='<span class="grey_borderbottom"><strong>Duration: </strong>'+activity.Duration.replace(/<\/?[^>]+(>|$)/g,"")+'</span>';detailText+='<span class="grey_borderbottom"><strong>Starting Price: </strong><b>$'+activity.Price+'&nbsp; USD</b></span></p>';detailText+='</article><div class="clearfloat"/>';detailText+='<article class="actionbuttons">';detailText+='<button class="book_now fr marginT3" onClick="openPlanActivityDetail(\''+activity.ProductCode+'\',\'USD\', '+i+',\''+activity.ProductName.replace(/[^a-zA-Z0-9-&://_,.!@]/g,"")+'\')" class="book_now">View More</button>';var foruserExist=false;if(!(pastTrip&&explorePanelMode=='friend')){if(sourceIdArray!=''||userSourceIdArray!=''){var isExists=inArrayJS(activity.ProductCode+'_8',sourceIdArray);if(isExists==true){if(explorePanelMode=='friend'){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,activity.ProductCode);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_8'){var foruserExist=inArrayJS(activity.ProductCode+'_8',userSourceIdArray);gridId=replaceString(activity.ProductCode);if(foruserExist==true){detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended by friends and You</span>';}
else{detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended by friends</span>';detailText+='<span id="gridBtn_frnd_'+gridId+'" class="fl"><a class="btnIconAdd blue_link" onClick="assignTripItemData(\'viator\', '+i+'); addItemToTrip(\'8\', \'8\', \''+activity.ProductCode+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" href="javascript:void(0);">I Recommend</a></span>';}}else{detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Already added to trip</span>';}}else{gridId=replaceString(activity.ProductCode);detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="removeFromTrip(\'8\', \'8\', \''+activity.ProductCode+'\', \''+addToTripFlag+'\',\''+i+'\')" class="btnIconRemove font_13">'+removeFromTripText+'</a></span></p>';}}else{if(explorePanelMode=='friend'){foruserExist=inArrayJS(activity.ProductCode+'_8',userSourceIdArray);gridId=replaceString(activity.ProductCode);if(foruserExist==true){detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended</span></p>';}
else{detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="assignTripItemData(\'viator\', '+i+'); addItemToTrip(\'8\', \'8\', \''+activity.ProductCode+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link">'+addToTripText+'</a></span></p>';}}else{gridId=replaceString(activity.ProductCode);detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="assignTripItemData(\'viator\', '+i+'); addItemToTrip(\'8\', \'8\', \''+activity.ProductCode+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link">'+addToTripText+'</a></span></p>';}}}else{gridId=replaceString(activity.ProductCode);detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="assignTripItemData(\'viator\', '+i+'); addItemToTrip(\'8\', \'8\', \''+activity.ProductCode+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link">'+addToTripText+'</a></span></p>';}}
detailText+='<div class="clearfloat"/></article>';sText+='<section class="g'+gCtr+'">'+detailText+'</section>';cCtr++;});$('#activitiesInfo').html('<div class="top25">'+sText+'</div>');for(i=1;i<=gCtr;i++){$('.g'+i).equalizeHeights();}
$("img.lazyloading").lazyload({placeholder:"/images/media-load.gif",effect:"fadeIn",threshold:400});if(openEntityRequestId!==false){openPlanActivityDetail(requestedVenue,'USD',openEntityRequestId,requestedTitle);}}
var activityIndex;function openPlanActivityDetail(reference,currencyCode,i,title,calledFrom){activityIndex=i;var detailText='';btnFlag=true;$('#activitiesInfo').hide();$('#activitiesDetails').show();$("#planActivitysortBy").hide();$('#activitiesBtnBTR').show();$('#searchBar8').hide();$('#activitiesBtnBTR').click(function(){$(this).hide();$('#activityCategory').show();$("#activitiesInfo").show();$("#planActivitysortBy").show();$('#activitiesList').hide();$('#activitiesDetails').hide();});hashVenueDetails=i+'/'+reference+'/'+title;createHashURLTitle("8",hashVenueDetails);hashPushState(hashLocationString,hashPageTitle);if(typeof calledFrom=='undefined'){detailText+='<a class="scrollup" href="javascript://">&nbsp;</a>';detailText+='<div class="pnlScrollCont">';detailText+='<div class="leftList vscroll-item">'+pactivitylist+'</div>';detailText+='</div>';detailText+='<a class="scrolldown" href="javascript://">&nbsp;</a>';$('#activitiesList').show().html(detailText);}
$('#activitiesDetails').html(preloadDiv);if($("#activitiesList .vscroll-item").hasClass('scrolling')){}else{$("#activitiesList .vscroll-item").addClass('scrolling');scrollDiv('activitiesList');}
$('#activitiesList section').removeClass('selected');$('#activitiesList #planActivity'+reference).addClass('selected');if(typeof calledFrom=='undefined')
if($('#activitiesList .pnlScrollCont').height()<$('#activitiesList #planActivity'+reference).position().top){if($("#activitiesList .vscroll-item").height()-$('#activitiesList #planActivity'+reference).position().top<$('#activitiesList .pnlScrollCont').height()){$("#activitiesList .vscroll-item").css('top',$('#activitiesList .pnlScrollCont').height()-$('#activitiesList .vscroll-item').height());$('#activitiesList .scrollup').css('visibility','visible');$('#activitiesList .scrolldown').css('visibility','hidden');}else{$("#activitiesList .vscroll-item").css('top',-1*Number($('#activitiesList #planActivity'+reference).position().top));$('#activitiesList .scrollup').css('visibility','visible');}}
if(typeof currencyCode=='undefined'){currencyCode='USD';}
var url='/html5/viator/getcodeproducts/productCodes/'+reference+'/currencyCode/'+currencyCode+'/tab/plan/sid/'+Math.random();$.get(url,function(fsdata){$('#activitiesDetails').html(fsdata);searchActivityAvailability('plan');$('#ActivitybookMap .scrollbar_wrapper').tinyscrollbar({sizethumb:25});});}
function selectTripTypeofItem(tripType){selectedTripType=tripType;$('#trip-types a').removeClass('selected');switch(tripType){case'family':$('#trip-types .fam-trip-bt a').addClass('selected');break;case'solo':$('#trip-types .solo-trip-bt a').addClass('selected');break;case'business':$('#trip-types .busi-trip-bt a').addClass('selected');break;case'couple':$('#trip-types .coup-trip-bt a').addClass('selected');break;case'friends':$('#trip-types .frnd-trip-bt a').addClass('selected');break;}}
function getDateSelectionFlag(chk){if(chk.checked==1)
{$(".activitBookFrom").datepicker('enable');$(".activitBookto").datepicker('enable');}
else{$(".activitBookFrom").datepicker('disable');$(".activitBookto").datepicker('disable');$(".ui-state-default").css({'cursor':'default'});}}
function getDateSelectionChoice(chk){if(chk.checked==1)
{$('#activityDatesCont').show();}
else{$('#activityDatesCont').hide();}}
function PlanFreeTextSearch(query){activeExploreTab='Activities';$("#activitiesDetails").hide();$("#activities .list").hide();$("#activitiesInfo").show();$("#planActivitysortBy").show();city=document.getElementById('hdnCity').value;cityId=document.getElementById("hdnCityId").value;document.getElementById("activitiesInfo").innerHTML='<div style="padding:20px 0 150px 0;" align="center">Loading..<br /> <img src="/images/preloader.gif" alt="" /></div>';var cacheKey="activity_plan"+cityId+"_0";$.post("/html5/viator/freetextsearch",{topX:"1-200",cityId:cityId,currencyCode:"USD",text:query},function(fsdata){if(fsdata=='0'){$("#activitiesInfo").html('<article class="info padding align-center font_18">Sorry, we did not find any results for This city.</article>');$('#planActivitysortBy').hide();}
else{pactivityCacheData=fsdata.data;cache[cacheKey]=fsdata;renderSearchPlanActivity(fsdata);}});}
function renderSearchPlanActivity(result){tripitembycategory(8);var sourceIds=$("#tripItemSourceIds").val();var userSourceIds=$("#userItemSourceIds").val();var sourceIdArray=sourceIds.split(',');var userSourceIdArray=userSourceIds.split(',');var openEntityRequestId=false;var addToTripText=explorePanelMode=='friend'?'Recommend':'Add to Trip';var removeFromTripText=explorePanelMode=='friend'?'Recommended':'Remove';var addToTripFlag=explorePanelMode=='friend'?'friend':'grid';var sText='';var cCtr=1;var gCtr=1;$.each(result.data,function(i,activity){if(cCtr>ActivitychkHCol){cCtr=1;gCtr++;}
if(toString(activity.data.title).length>22)
activityName=activity.data.title.substring(0,22)+'...';else
activityName=activity.data.title;bactivitylist+='<section class="hotelList">';bactivitylist+='<a href="javascript://;" onClick="openPlanActivityDetail(\''+activity.data.code+'\',\''+activity.data.currencyCode+'\', '+i+',\''+activity.data.title.replace(/[^a-zA-Z0-9-&://_,.!@]/g,"")+'\')" style="float:left; display:inline-block; margin-right:5px;"><img class="lazyloading" width="70" height="70" src="'+activity.data.thumbnailURL+'"/></a>';bactivitylist+='<p><a href="javascript://;" onClick="openPlanActivityDetail(\''+activity.data.code+'\',\''+activity.data.currencyCode+'\', '+i+',\''+activity.data.title.replace(/[^a-zA-Z0-9-&://_,.!@]/g,"")+'\')" ><strong>'+activityName+'</strong></a><br>';bactivitylist+='</p></section>';var detailText='';detailText+='<article class="content">';detailText+='<a class="grid_thumb_link" href="javascript://;" onClick="openPlanActivityDetail(\''+activity.data.code+'\',\''+activity.data.currencyCode+'\', '+i+',\''+activity.data.title.replace(/[^a-zA-Z0-9-&://_,.!@]/g,"")+'\')" >';detailText+='<img class="thumb lazyloading" src="'+activity.data.thumbnailURL+'" style="float:left; border:none; margin-right:10px; height:100%;width:100%;" /></a>';detailText+='<p><strong><span class="attrName"><a href="javascript://;" onClick="openPlanActivityDetail(\''+activity.data.code+'\',\''+activity.data.correncyCode+'\','+i+',\''+activity.data.title.replace(/[^a-zA-Z0-9-&://_,.!@]/g,"")+'\')">'+activityName+'<br /></a></span></strong>';detailText+='<span class="grey_borderbottom"><strong>Location: </strong>'+activity.data.primaryDestinationName+'</span>';detailText+='<span class="grey_borderbottom"><strong>Overall Rating: </strong>&nbsp;<strong class="font_14 semi-light">'+activity.data.rating+' of 5</strong></span>';detailText+='<span class="grey_borderbottom"><strong>Duration: </strong>'+activity.data.duration+'</span>';detailText+='<span class="grey_borderbottom"><strong>Starting Price: </strong><b>'+activity.data.priceFormatted+'&nbsp; USD</b></span></p>';detailText+='</article><div class="clearfloat"/>';detailText+='<article class="actionbuttons">';detailText+='<button class="book_now fr marginT3" onClick="openPlanActivityDetail(\''+activity.data.code+'\',\''+activity.data.currencyCode+'\', '+i+',\''+activity.data.title.replace(/[^a-zA-Z0-9-&://_,.!@]/g,"")+'\')" class="book_now">View More</button>';if(!(pastTrip&&explorePanelMode=='friend')){if(sourceIdArray!=''||userSourceIdArray!=''){var isExists=inArrayJS(activity.data.code+'_8',sourceIdArray);if(isExists==true){if(explorePanelMode=='friend')
{var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,activity.data.code);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_8'){var foruserExist=inArrayJS(activity.data.code+'_8',userSourceIdArray);gridId=replaceString(activity.data.code);if(foruserExist==true){detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended by friends and You</span>';}
else{detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended by friends</span>';detailText+='<span id="gridBtn_frnd_'+gridId+'" class="fl"><a class="btnIconAdd blue_link" onClick="assignTripItemData(\'viator\', '+i+'); addItemToTrip(\'8\', \'8\', \''+activity.data.code+'\', \''+addToTripFlag+'\')" href="javascript:void(0);">I Recommend</a></span>';}}else{detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Already added to trip</span>';}}else{gridId=replaceString(activity.data.code);detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="removeFromTrip(\'8\', \'8\', \''+activity.data.code+'\', \''+addToTripFlag+'\')" class="btnIconRemove font_13">'+removeFromTripText+'</a></span></p>';}}else{if(explorePanelMode=='friend'){var foruserExist=inArrayJS(activity.data.code+'_8',userSourceIdArray);gridId=replaceString(activity.data.code);if(foruserExist==true){detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended</span></p>';}
else{detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="assignTripItemData(\'viator\', '+i+'); addItemToTrip(\'8\', \'8\', \''+activity.data.code+'\', \''+addToTripFlag+'\')" class="btnIconAdd blue_link">'+addToTripText+'</a></span></p>';}}
else{gridId=replaceString(activity.data.code);detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="assignTripItemData(\'viator\', '+i+'); addItemToTrip(\'8\', \'8\', \''+activity.data.code+'\', \''+addToTripFlag+'\')" class="btnIconAdd blue_link">'+addToTripText+'</a></span></p>';}}}else{gridId=replaceString(activity.data.code);detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="assignTripItemData(\'viator\', '+i+'); addItemToTrip(\'8\', \'8\', \''+activity.data.code+'\', \''+addToTripFlag+'\')" class="btnIconAdd blue_link">'+addToTripText+'</a></span></p>';}}
detailText+='<div class="clearfloat"/></article>';sText+='<section class="g'+gCtr+'">'+detailText+'</section>';cCtr++;});$('#activitiesInfo').html('<div class="top25">'+sText+'</div>');for(i=1;i<=gCtr;i++)
{$('.g'+i).equalizeHeights();}
$("img.lazyloading").lazyload({placeholder:"/images/html5/img-lazy-loading.gif",effect:"fadeIn",threshold:400});}
function openWeatherInPlan(temp){var cityName=$("#hdnCity").val();var cityId=$("#hdnCityId").val();if(temp=='fahren'){document.getElementById("weatherInfo").innerHTML=weatherDetailsforPlan[cityId+"_"+0];document.getElementById("weatherSection").innerHTML=weatherDetailsforPlan[cityId+"_"+1];$("#wheatherPlanF").show();$("#wheatherPlanC").hide();}else{document.getElementById("weatherInfo").innerHTML=weatherDetailsforPlan[cityId+"_"+2];document.getElementById("weatherSection").innerHTML=weatherDetailsforPlan[cityId+"_"+3];$("#wheatherPlanC").show();$("#wheatherPlanF").hide();}
mscroll();}
function getyelpreviewForPoi(placename,cityId){$.getJSON('/api/yelpupdate/businessName/'+placename+'/businessCity/'+cityId,function(result){if(typeof result.businesses!='undefined'&&typeof result.businesses[0]!='undefined'){$("#yelprating_mytrip").html('<img src="'+result.businesses[0].rating_img_url+'" align="absmiddle" /><a style="color:#72ADDA;font-weight:bold;" target="_blank" href="'+result.businesses[0].url+'" onclick=""> <span style="text-decoration:underline;">('+result.businesses[0].review_count+' reviews</span>)</a> <img width="38" height="22" src="/images/html5/icons/yelp.png">');}else{$("#yelprating_mytrip").html('');}});}
function tripitembycategory(bucketId){cityId=parseInt(document.getElementById("hdnCityId").value);if(explorePanelMode=='friend'){var url='/html5/plan/tripitembycategory/bucketId/'+bucketId+'/cid/'+cityId+'/mode/f/sid/'+Math.random();}else{var url='/html5/plan/tripitembycategory/bucketId/'+bucketId+'/cid/'+cityId+'/sid/'+Math.random();}
$.get(url,function(result){});}
function unsetPreviousSession(){url='/html5/geo/unsetsession/sid/'+Math.random();$.get(url,function(result){});}
function limitReviewText(limitField,limitCount,limitNum){if(document.getElementById(limitField).value.length>limitNum){limitField.value=document.getElementById(limitField).value.substring(0,limitNum);}else{$("#"+limitCount).html(limitNum-document.getElementById(limitField).value.length);}}
function checkHostelAvailability(hostelId,panel){$("#"+panel+"_availability_div").html('<div style="padding:20px 0 150px 0; font-size:14px;" align="center">Please wait while we find you the best rates...<br /><img src="/images/preloader.gif" alt="Loading..." class="marginT5"/></div>');if(panel=='book'){var startDate=$("#hotel_availability_start").val();var endDate=$("#hotel_availability_end").val();}else if(panel=='plan'){var startDate=$("#plan_hostel_availability_start").val();var endDate=$("#plan_hostel_availability_end").val();}else if(panel=='MT'){var startDate=$("#MThostel_availability_start").val();var endDate=$("#MThostel_availability_end").val();}
$("#"+panel+"_hostel_room_selection").hide();if(startDate==''){notifyme('Please select start date!','error');return false;}
if(endDate==''){notifyme('Please select end date!','error');return false;}
var datearray=startDate.split("-");var newfromdate=datearray[2]+'-'+datearray[0]+'-'+datearray[1];var datearray=endDate.split("-");var newtodate=datearray[2]+'-'+datearray[0]+'-'+datearray[1];var currency=$("#"+panel+"hostel_currency_check").val();var url='/html5/hostel/bookinginformation/pid/'+hostelId+'/start_date/'+newfromdate+'/end_date/'+newtodate+'/tab/'+panel+'/currency/'+currency+'/sid/'+Math.random();$.get(url,function(result){$("#"+panel+"_availability_div").html(result);});}
function contains(a,obj){for(var i=0;i<a.length;i++){if(a[i]==obj){return i;}}
return-1;}
function onLoadOneTimeCallData(){if(loadScriptCalledOnceViaWelcome==false){loadScriptCalledOnceViaWelcome=true;if(FB_LOGIN=="1"){getMyTripList();}
if(ipPushPinLoaded==false){window.clearTimeout(ipPushpinTimeOut);}
setTimeout(function(){loadScripts(['//ws.sharethis.com/button/buttons.js'],function(){if(typeof stLight!='undefined')
stLight.options({publisher:'702529a4-dd07-4004-b18e-3367de52cc51',onhover:false,type:'website',embeds:true,headerTitle:'Share this on your favourite Social Network.'});if(typeof stWidget!='undefined')
stWidget.addEntry({"service":"email","url":"http://www.georama.com","title":"Georama - Plan. Book. Share.","type":"large","image":HTTP_ENV+"georama.com/images/facebook-icon.png","summary":"I just created a trip using Georama. Please give me recommendations for my trip!"});});},1000);}}
function showTripDataOnMap(wlcmStatus){if(wlcmStatus!=false){map.showAllPushpins();}
if(tripDataLoadedOnceViaWelcome==false){tripDataLoadedOnceViaWelcome=true;if(typeof tripPushpinResult!='undefined'&&tripPushpinResult!=null){plotPushpinsOnVectorMap(tripPushpinResult);tripPushpinResult=null;}else{if(friendTripFlag==false){map.updateTripNavigationBar("A","");}
map.callCityNameHandling();}}
else{map.callCityNameHandling();}}
ipPushpinTimeOut=window.setTimeout(function(){ipPushPinLoaded=true;getIpPushpin();},3000);function checkisIE(){var browserIs=navigator.userAgent;var varie=false;if((browserIs.indexOf('MSIE')>-1)||(browserIs.indexOf('msie')>-1)||(browserIs.indexOf('Internet Explorer')>-1)||(browserIs.indexOf('IE')>-1)){varie=true;}
return varie;}
function showhideWelcomePanel(show,showTripnav){if(show=='hide'){$('#window-8-Application').hide();var wlcmStatus=$('#welcome_close').is(':visible');if(!independentPages)
{$(".rightPanel").show();}
$('#georama_welcome_overlay').hide();$("#OutrContainer").fadeOut();$('#OutrContainer').hide();$(".fixed_footer_wrapper").hide();$("#welcome_close").hide();$('#backWrap').hide();$("#welcome_booking_trip_panel").hide();$("#may_be_wrap").hide();$("#yes_wrap").hide();if(typeof showTripnav!='undefined'){showhideTopBar(showTripnav);}else{showhideTopBar('show');}
onLoadOneTimeCallData();showTripDataOnMap(wlcmStatus);}else{if(!independentPages){$(".rightPanel").hide();}
$('#georama_welcome_overlay').show();$('#welcome_close').show();$('#OutrContainer').show();$("#welcome_close").show();$('.fixed_footer_wrapper').show();if(typeof showTripnav!='undefined'){showhideTopBar(showTripnav);}else{showhideTopBar('hide');}
map.hideAllCityNames();}}
function showhideTopBar(show){if(show=='hide'||friendTripFlag==true){$("#topbar-wrap").animate({top:0});$("#topbar-wrap").css("visibility","hidden");}else{$("#topbar-wrap").css("visibility","visible");if(checkisIE()==true){$("#topbar-wrap").css("top",42);}else{$("#topbar-wrap").animate({top:42},"slow");}}}
function activityBookingparam(ageBandIds,gradeOption,tab,adultDesc){var pre=tab;if(tab=='book'){pre='B';}else if(tab=='plan'){pre='P';}
$(window).resize(function(){$('#'+pre+'AddtoCart').validationEngine('updatePromptsPosition')});var formValid=$('#'+pre+'AddtoCart').validationEngine('validate');if(!formValid)
return;if(typeof gradeOption=='undefined'){gradeOption='';}
var bandId=ageBandIds.split(',');var ageBandId='';var ageBandCount='';var age='';var totalCount=0;var count=0;for(i=0;i<bandId.length;i++){if(document.getElementById(pre+"viator_agebands_"+bandId[i])!=null&&document.getElementById(pre+"viator_agebands_"+bandId[i]).value!=0){if(ageBandId==''){ageBandCount=document.getElementById(pre+"viator_agebands_"+bandId[i]).value;ageBandId=bandId[i];count=document.getElementById(pre+"viator_agebands_"+bandId[i]).value;totalCount=totalCount+parseInt(count);for(j=0;j<count;j++){if(document.getElementById(pre+"ageBands_"+bandId[i]+"ages_"+j)){if(age==''){age=document.getElementById(pre+"ageBands_"+bandId[i]+"ages_"+j).value;}
else{age+=','+document.getElementById(pre+"ageBands_"+bandId[i]+"ages_"+j).value;}}}}else{ageBandCount+=','+document.getElementById(pre+"viator_agebands_"+bandId[i]).value;ageBandId+=','+bandId[i];count=document.getElementById(pre+"viator_agebands_"+bandId[i]).value;totalCount=totalCount+parseInt(count);for(j=0;j<count;j++){if(document.getElementById(pre+"ageBands_"+bandId[i]+"ages_"+j)){if(age==''){age=document.getElementById(pre+"ageBands_"+bandId[i]+"ages_"+j).value;}
else{age+=','+document.getElementById(pre+"ageBands_"+bandId[i]+"ages_"+j).value;}}}}}}
var ageB=ageBandId.toString();var ageBC=ageBandCount.toString();if(typeof adultDesc!='undefined'){var noOfAdults=$('#'+pre+'viator_agebands_'+ageBandIds).val();var textAdult='';if(noOfAdults==0){textAdult='Select number of Adults';}else if(noOfAdults==1){textAdult=noOfAdults+' Adult selected.';}else{textAdult=noOfAdults+' Adults selected.';}
$("#"+pre+"agebox_Adult").html('<p class="align-center padding50 semi-light">'+textAdult+'</p>');}
if(totalCount==0){$("#"+pre+"viatorErrorMessage1").show();$("#"+pre+"viatorErrorMessage2").hide();$("#activity_book_button").attr("disabled","disabled");return;}
else if(totalCount>9){$("#"+pre+"viatorErrorMessage2").show();$("#"+pre+"viatorErrorMessage1").hide();$("#activity_book_button").attr("disabled","disabled");return;}else{$("#"+pre+"viatorErrorMessage1").hide();$("#"+pre+"viatorErrorMessage2").hide();$("#activity_book_button").removeAttr("disabled");}
var param="promoCode=''&aid=null&tBid="+ageB+"&tBCount="+ageBC+"&age="+age+"&gradeOption="+gradeOption;document.getElementById("activity_param").value=param;return;}
function loadGeoplacesSnippet(friendName,uid){var url='/html5/plan/getfriendsnippet/fid/'+uid+'/fname/'+friendName+'/sid/'+Math.random();$("#GeoSnippet").html('<div style="padding:50px 0;" align="center"><img src="/images/loading.gif" /><br />Loading...</div>');$("#GeoSnippet").show();$.get(url,function(result){$("#GeoSnippet").html(result);$("#friendbuttonInfo").hide();});}
function pushimage(imagepath){$('#aboutInfoDP > img').nextAll('img').remove();var leftWidth=$("#aboutLeftWrap").width();if(leftWidth<=1000)widthLoad=450;else if(leftWidth>1000&&leftWidth<=1180)widthLoad=480;else if(leftWidth>1180&&leftWidth<=1320)widthLoad=550;else if(leftWidth>1320&&leftWidth<=1520)widthLoad=675;$('#aboutInfoDP > img').after('<img id="resize_Loadme" src="/images/html5/loading_100_100.gif" />').hide().attr('src',imagepath).one('load',function(){$(this).fadeIn().next().remove();});}
function getLicenseInfo(LicenseString,title,ownername){if(LicenseString)
$('#aboutInfoDpLicense').html('available under the '+LicenseString);else $('#aboutInfoDpLicense').html('');$('#aboutInfoDpTitlespan').html(title);if(ownername)
$('#aboutInfoDpOwnername').html('- By '+ownername+' on Flickr');else $('#aboutInfoDpOwnername').html('- via Bing');}
function formatEventDate(startTime){var m_names=new Array("January","February","March","April","May","June","July","August","September","October","November","December");var suffix="AM";var datetime='',eventDate,eventTime;if(navigator.userAgent.indexOf('Safari')!=-1&&navigator.userAgent.indexOf('Chrome')==-1){datetime=startTime.substr(0,10);var yeardatetime=datetime.substr(0,4);var monthdatetime=datetime.substr(5,2);var datedatetime=datetime.substr(8,2);var eventtiming=startTime.substr(11,10);var Hrseventtiming=eventtiming.substr(0,2);var mineventtiming=eventtiming.substr(3,2);if(Hrseventtiming>=12){suffix="PM";Hrseventtiming=Hrseventtiming-12;}
if(Hrseventtiming==0){Hrseventtiming=12;}
var eventNewDate=datetime.replace('-','/');eventNewDate=eventNewDate.replace('-','/');var setdate=new Date(eventNewDate);formattedeventdate=m_names[parseInt(monthdatetime)-1]+' '+datedatetime+', '+yeardatetime+' ('+getDayname(setdate.getDay())+')'+'<br/> '+Hrseventtiming+':'+mineventtiming+' '+suffix;return formattedeventdate;}
else{datetime=startTime.split(' ');var eventDate=datetime[0].split('-');var eventTime=datetime[1].split(':');var hours=eventTime[0];var minutes=eventTime[1];if(hours>=12){suffix="PM";hours=hours-12;}
if(hours==0){hours=12;}
var year=eventDate[0];var day=eventDate[2];var month=eventDate[1].replace(/\b0+/g,"");}
var nAgt=navigator.userAgent;if(nAgt.toLowerCase().indexOf('msie')==-1){var setdate=new Date(eventDate);}else{var eventNewDate=datetime[0].replace('-','/');var setdate=new Date(eventNewDate);}
formattedeventdate=m_names[parseInt(month)-1]+' '+day+', '+year+' ('+getDayname(setdate.getDay())+')'+'<br/> '+hours+':'+minutes+' '+suffix;return formattedeventdate;}
function getDayname(Nday)
{var weekday=new Array(7);weekday[0]="Sunday";weekday[1]="Monday";weekday[2]="Tuesday";weekday[3]="Wednesday";weekday[4]="Thursday";weekday[5]="Friday";weekday[6]="Saturday";return weekday[Nday];}
function ddmmyyyyToMonDayYear(date){var formatteddate;var month=date.substr(0,2);var day=date.substr(3,2);var year=date.substr(6,4);formatteddate=monthNamesArray[month-1]+" "+day+", "+year;return formatteddate;}
function getReviewForm(entityId,sourceId,itemID,articleType,categoryId,tab,mode,rating,reviewtext,evaluation){reviewForm='';if(mode=='edit'){reviewForm='<div id="'+tab+'_'+itemID+'_editreviewForm_'+categoryId+'" class="user_review_panel form_wrapper">';}else{selectedTripType='';mode='save';}
reviewForm+='<h4>Write a Review</h4>';reviewForm+='<section class="light-grd-bg fl marginTB10 pading10 rounded padding border width_424">';reviewForm+='<article class="fl marginR20 width50">';reviewForm+='<div class="feel-review">';reviewForm+='<div class="myReviews" style="float:left; margin-top:10px; width:auto; height:auto; background:none; padding:0; margin:0;">';reviewForm+='<ul class="myReviewSmily">';reviewForm+='<li><a href="javascript://" class="smilies active" id="ok" onclick="swapRadioSmiliey(this.id, 1);">&nbsp;</a></li>';reviewForm+='<li><a href="javascript://" class="smilies" id="soso" onclick="swapRadioSmiliey(this.id, 2);">&nbsp;</a></li>';reviewForm+='<li><a href="javascript://" class="smilies" id="notok" onclick="swapRadioSmiliey(this.id, 3);">&nbsp;</a></li>';reviewForm+='<li>Overall<span class="myRev" id="smiledesc">I Like It!</span></li>';reviewForm+='</ul>';reviewForm+='</div></div>';reviewForm+='<div class="clearfloat"></div><div class="marginT20 trip-review">';reviewForm+=' <span class="rightForm fl width_100 gray-title font_10">TYPE OF TRIP:</span><br/>';reviewForm+='   <ul id="trip-types">';reviewForm+='     <li class="fam-trip-bt" onClick="selectTripTypeofItem(\'family\')"><a></a></li>';reviewForm+='      <li class="solo-trip-bt" onClick="selectTripTypeofItem(\'solo\')"><a></a></li>';reviewForm+='      <li class="busi-trip-bt" onClick="selectTripTypeofItem(\'business\')"><a></a></li>';reviewForm+='      <li class="coup-trip-bt" onClick="selectTripTypeofItem(\'couple\')"><a></a></li>';reviewForm+='      <li class="frnd-trip-bt" onClick="selectTripTypeofItem(\'friends\')"><a></a></li>';reviewForm+='    </ul>';reviewForm+='</div>';reviewForm+='</article>';reviewForm+='<div id="'+tab+'_'+itemID+'_rating_'+categoryId+'">Loading..<br /> <img src="/images/preloader.gif" alt=""/></div>';reviewForm+='<div class="clearfloat"></div><div id="'+tab+'_'+itemID+'_reviewForm_'+categoryId+'" class="form_wrapper marginT10" ><h4>Add your Review</h4>';reviewForm+='<textarea maxlength="250" id="reviewText_'+categoryId+'" class="textarea" rows="5" onKeyDown="limitReviewText(\'reviewText_'+categoryId+'\',\'countdown\',250)" onKeyUp="limitReviewText(\'reviewText_'+categoryId+'\',\'countdown\',250)" style="float:left;  width:90% !important; height:80px !important;resize: none;" onchange="$(\'#postReview\').show();"  placeholder="All fields are required"></textarea>';reviewForm+='<div class="clearfloat"></div>';if(mode=='edit'){reviewForm+='<input type="button" class="book_now align-center"  style="margin:0 auto;padding:6px 8px !important" value="Update Review" onclick="saveUserReview(\''+itemID+'\', \''+articleType+'\',\''+sourceId+'\',\''+entityId+'\',\''+mode+'\',\''+categoryId+'\',\''+tab+'\');" /> (Characters left: <span id="countdown" size="3">250</span>)';}else{reviewForm+='<input type="button" class="book_now align-center"  style="margin:0 auto;padding:6px 8px !important" value="Post Review" onclick="saveUserReview(\''+itemID+'\', \''+articleType+'\',\''+sourceId+'\',\''+entityId+'\',\''+mode+'\',\''+categoryId+'\',\''+tab+'\');" /> (Characters left: <span id="countdown" size="3">250</span>)';}
reviewForm+='</div>';reviewForm+='</section>';if(mode=='save'){$("#"+tab+"_"+itemID+"_review_"+categoryId).html(reviewForm);getRatingBlockByPanelId(entityId,sourceId,itemID,'',categoryId,tab);$("#"+tab+"_"+itemID+"_reviewForm_"+categoryId).show();}
else{reviewForm+='</div>';$("#"+tab+"_"+itemID+"_review_"+categoryId).html(reviewForm);$("#reviewText_"+categoryId).val(reviewtext);if(evaluation=='2'){swapRadioSmiliey("soso",'2');}else if(evaluation=='3'){swapRadioSmiliey("notok",'3');}else{swapRadioSmiliey("ok",'1');}
getRatingBlockByPanelId(entityId,sourceId,itemID,rating,categoryId,tab);$("#"+tab+"_"+itemID+"_editreviewForm_"+categoryId).show();limitReviewText('reviewText_'+categoryId,'countdown',250);}}
function fillcountryInfo(country,countryCode){hideAllPanels();$(this).mapOverlay(2);selectedCountry=country;if(!myTripFlag){myTripFlag=true;friendTripFlag=false;showTripPushPin(global_trip_id);}
PanelVisited="CountryPanel";url='/html5/plan/buildcountrypanel/country/'+country+'/ccode/'+countryCode+'/rand/'+parseInt(Math.random()*99999999);$.get(url,function(data){if(data){$('#PlanBookComponent').css('display','none');document.getElementById("CountryPageComponent").innerHTML=data;resize_countrypage();$(this).mapOverlay("delete");$("#CountryPageComponent").show();}
$('.figure a img').error(function(){$(this).parent().parent().remove();});});}
function openCityPanelfromCountry(cityID){var pushpinimage=$("svg").find("#p_"+cityID);if(pushpinimage!=''){pushpinimage=pushpinimage.attr("xlink:href");if(typeof pushpinimage!='undefined'){$('#rootvectormap').vectorMap('set','triggerPinClick',cityID);return;}else{var result="";$.ajax({type:"POST",url:'/geo/getcityattr',data:'ct=&country=&cityId='+cityID+'&mode=OB&sid/'+parseInt(Math.random()*99999999),async:false,success:function(data){result=jQuery.parseJSON(data);}});$('#rootvectormap').vectorMap('set','label',{"n":result.n,"c":result.ccode.toLowerCase(),"d":'',"lat":result.x,"lon":result.y,"pin":1,"pcolor":"white","key":cityID,"l":5,"latVar":0,"lonVar":0});$('#rootvectormap').vectorMap('set','triggerPinClick',cityID);map.updateTripNavigationBar("A","");updateTripInfo(cityID,'potential');setTimeout(function(){map.drawTrajectory();},2000);}}}
function renderEvents(fsdata,openEntityRequestId){var sourceIds=$("#tripItemSourceIds").val();var userSourceIds=$("#userItemSourceIds").val();var sourceIdArray=sourceIds.split(',');var userSourceIdArray=userSourceIds.split(',');var count=0;eventListData='';var addToTripText=explorePanelMode=='friend'?'Recommend':'Add to Trip';var removeFromTripText=explorePanelMode=='friend'?'Recommended':'Remove';var addToTripFlag=explorePanelMode=='friend'?'friend':'grid';var sText='';var gCtr=1;var cCtr=1;var strEventList='<a href="javascript://" class="scrollup">&nbsp;</a><div class="pnlScrollCont"><ul class="leftList vscroll-item">';if(fsdata==null||fsdata.total_items==0||fsdata.events.event==null){abortAjax();visibleMap='bing';showVectorMap();$("#eventSubCategory").hide();$("#pevent_filter").hide();$("#eventsInfo").html('<article class="info padding align-center font_18">Sorry, We do not currently have any Events available for this city.</article>');$("#mapOverlay").hide();}else{showBing();if(fsdata.total_items==1){event=fsdata.events.event;var detailText='';if(cCtr>chkCol){cCtr=1;gCtr++;}
if(selectedEntityId){if(event['@attributes'].id==selectedEntityId){openEntityRequestId=0;selectedEntityId=false;}}
var eventTitle='';var showTitle=false;if(typeof event.title!='undefined'){eventTitle=event.title;var eventLen=eventTitle.length;if(eventLen>25){eventTitle=eventTitle.substring(0,25)+"...";showTitle=true;}else{showTitle=false;}}
if(showTitle){eventListData+='<li id="liev_0" onClick="openEventDetail(\'0\',1)"><a href="javascript://" title="'+event.title+'" >'+eventTitle+'</a></li>';}else{eventListData+='<li id="liev_0" onClick="openEventDetail(\'0\',1)"><a href="javascript://" >'+eventTitle+'</a></li>';}
detailText+='<article class="content">';if(typeof(event.image)!='undefined'){if(typeof(event.image.medium)!='undefined'){detailText+='<a href="javascript://;" onClick="openEventDetail(\'0\')"><img class="thumb lazyloading" src="'+event.image.medium.url+'" style="float:left; margin-right:10px;" onError="this.src=\''+'/images/no-image-event.png'+'\'" /></a>';}
else{detailText+='<a href="javascript://;" onClick="openEventDetail(\'0\')"><img class="thumb lazyloading" src="/images/no-image-event.png" style="float:left; margin-right:10px;" /></a>';}}else{detailText+='<a href="javascript://;" onClick="openEventDetail(\'0\')"><img class="thumb lazyloading" src="/images/no-image-event.png" style="float:left; margin-right:10px;" /></a>';}
detailText+='<p><span class="attrName"><a href="javascript://;" onClick="openEventDetail(\'0\')" title=" '+event.title+' ">'+eventTitle+'</a></span>';detailText+='<strong>'+event.venue_name+'</strong>,<br />';if(event.venue_address!='[object Object]'){detailText+=event.venue_address;}
var d=new Date(toString(event.start_time));if(typeof event.start_time!='undefined'){detailText+='<span class="font_13 dateWrap"><b>Starts at:</b><br/> '+formatEventDate(event.start_time)+'</span></p><br clear="all" />';}
else{detailText+='<span class="font_13 dateWrap"><b>Starts at:</b><br/>-</span></p><br clear="all" />';}
detailText+='</article>';detailText+='<article class="actionbuttons">';var foruserExist=false;if(!(pastTrip&&explorePanelMode=='friend')){if(sourceIdArray!=''||userSourceIdArray!=''){var isExists=inArrayJS(event['@attributes'].id+'_12',sourceIdArray);gridId=replaceString(event['@attributes'].id);if(isExists==true){if(explorePanelMode=='friend'){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,event['@attributes'].id);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_12'){foruserExist=inArrayJS(event['@attributes'].id+'_12',userSourceIdArray);gridId=replaceString(event['@attributes'].id);if(foruserExist==true){detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended by friends and You</span>';}else{detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended by friends</span>';detailText+='<span id="gridBtn_frnd_'+gridId+'" class="fl"><a class="btnIconAdd blue_link" onClick="assignTripItemData(\'event\', \'0\'); addItemToTrip(\'12\', \'5\', \''+event['@attributes'].id+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" href="javascript:void(0);">I Recommend</a></span>';}}else{detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Already added to trip</span>';}}
else{detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="removeFromTrip(\'12\', \'5\', \''+event['@attributes'].id+'\', \''+addToTripFlag+'\',\''+i+'\')" class="btnIconRemove font_13"> '+removeFromTripText+' </a></span>';}}else{if(explorePanelMode=='friend'){foruserExist=inArrayJS(event['@attributes'].id+'_12',userSourceIdArray);gridId=replaceString(event['@attributes'].id);if(foruserExist==true){detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended</span></p>';}
else{detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="assignTripItemData(\'event\', \'0\'); addItemToTrip(\'12\', \'5\', \''+event['@attributes'].id+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link"> '+addToTripText+'</a></span>';}}else{detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="assignTripItemData(\'event\', \'0\'); addItemToTrip(\'12\', \'5\', \''+event['@attributes'].id+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link"> '+addToTripText+'</a></span>';}}}
else{gridId=replaceString(event['@attributes'].id);detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="assignTripItemData(\'event\', \'0\'); addItemToTrip(\'12\', \'5\', \''+event['@attributes'].id+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link"> '+addToTripText+' </a></span>';}}
detailText+='<div class="clearfloat" /></article>';sText+='<section class="event_row'+gCtr+'">'+detailText+'</section>';cCtr++;}else{$.each(fsdata.events.event,function(i,event){var detailText='';if(cCtr>chkCol){cCtr=1;gCtr++;}
if(selectedEntityId){if(event['@attributes'].id==selectedEntityId){openEntityRequestId=i;selectedEntityId=false;}}
var eventTitle='';var showTitle=false;if(typeof event.title!='undefined'){eventTitle=event.title;var eventLen=eventTitle.length;if(eventLen>25){eventTitle=eventTitle.substring(0,25)+"...";showTitle=true;}else{showTitle=false;}}
if(showTitle){eventListData+='<li id="liev_'+i+'" onClick="openEventDetail(\''+i+'\',1)"><a href="javascript://" title="'+event.title+'">'+eventTitle+'</a></li>';}else{eventListData+='<li id="liev_'+i+'" onClick="openEventDetail(\''+i+'\',1)"><a href="javascript://">'+eventTitle+'</a></li>';}
detailText+='<article class="content">';if(typeof(event.image)!='undefined'){if(typeof(event.image.medium)!='undefined'){detailText+='<a href="javascript://;" onClick="openEventDetail(\''+i+'\')"><img class="thumb lazyloading" src="'+event.image.medium.url+'" style="float:left; margin-right:10px;" onError="this.src=\''+'/images/no-image-event.png'+'\'" /></a>';}else{detailText+='<a href="javascript://;" onClick="openEventDetail(\''+i+'\')"><img class="thumb lazyloading" src="/images/no-image-event.png" style="float:left; margin-right:10px;" /></a>';}}else{detailText+='<a href="javascript://;" onClick="openEventDetail(\''+i+'\')"><img class="thumb lazyloading" src="/images/no-image-event.png" style="float:left; margin-right:10px;" /></a>';}
detailText+='<p><span class="attrName"><a href="javascript://;" onClick="openEventDetail(\''+i+'\')" title=" '+event.title+' ">'+eventTitle+'</a></span>';detailText+='<strong>'+event.venue_name+'</strong>,<br />';if(event.venue_address!='[object Object]'){detailText+=event.venue_address;}
var d=new Date(toString(event.start_time));if(typeof event.start_time!='undefined'){detailText+='<span class="font_13 dateWrap"><b>Starts at:</b><br/> '+formatEventDate(event.start_time)+'</span></p><br clear="all" />';}else{detailText+='<span class="font_13 dateWrap"><b>Starts at:</b><br/>-</span></p><br clear="all" />';}
detailText+='</article>';detailText+='<article class="actionbuttons">';var foruserExist=false;if(!(pastTrip&&explorePanelMode=='friend')){if(sourceIdArray!=''||userSourceIdArray!=''){var isExists=inArrayJS(this['@attributes'].id+'_12',sourceIdArray);gridId=replaceString(this['@attributes'].id);if(isExists==true){if(explorePanelMode=='friend'){var itemsStatus=$("#tripItemStatus").val();var itemsStatusArray=itemsStatus.split(',');var allItems=$("#tripItemIds").val();var allItemsArray=allItems.split(',');var itemExist=contains(allItemsArray,this['@attributes'].id);if(itemExist==-1||itemsStatusArray[itemExist]!='yes_12'){foruserExist=inArrayJS(this['@attributes'].id+'_12',userSourceIdArray);gridId=replaceString(this['@attributes'].id);if(foruserExist==true){detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended by friends and You</span>';}
else{detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended by friends</span>';detailText+='<span id="gridBtn_frnd_'+gridId+'" class="fl"><a class="btnIconAdd blue_link" onClick="assignTripItemData(\'event\', '+i+'); addItemToTrip(\'12\', \'5\', \''+this['@attributes'].id+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" href="javascript:void(0);">I Recommend</a></span>';}}else{detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Already added to trip</span>';}}else{detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="removeFromTrip(\'12\', \'5\', \''+this['@attributes'].id+'\', \''+addToTripFlag+'\',\''+i+'\')" class="btnIconRemove font_13"> '+removeFromTripText+' </a></span>';}}else{if(explorePanelMode=='friend'){foruserExist=inArrayJS(this['@attributes'].id+'_12',userSourceIdArray);gridId=replaceString(this['@attributes'].id);if(foruserExist==true){detailText+='<span class="highlight fl" id="gridBtn_'+gridId+'">Recommended</span></p>';}else{detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="assignTripItemData(\'event\', '+i+'); addItemToTrip(\'12\', \'5\', \''+this['@attributes'].id+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link"> '+addToTripText+'</a></span>';}}
else{detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="assignTripItemData(\'event\', '+i+'); addItemToTrip(\'12\', \'5\', \''+this['@attributes'].id+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link"> '+addToTripText+'</a></span>';}}}else{gridId=replaceString(this['@attributes'].id);detailText+='<span id="gridBtn_'+gridId+'"><a href="javascript://" onClick="assignTripItemData(\'event\', '+i+'); addItemToTrip(\'12\', \'5\', \''+this['@attributes'].id+'\', \''+addToTripFlag+'\',\'\',\''+i+'\')" class="btnIconAdd blue_link"> '+addToTripText+' </a></span>';}}
detailText+='<div class="clearfloat" /></article>';sText+='<section class="event_row'+gCtr+'">'+detailText+'</section>';cCtr++;});}
$("img.thumb","#events").each(function(){$(this).load().error(function(){$(this).attr('src','/images/no-image-event.png');})});strEventList+=eventListData;strEventList+='</ul></div><a href="javascript://" class="scrolldown">&nbsp;</a> ';$("#events .list").html(strEventList);document.getElementById('eventsInfo').innerHTML='<div class="top25">'+sText+'</div>';$("#mapOverlay").hide();if(eventfilterdate){eventsPlaces=eventsCacheDatafilter;if($('#cevents').hasClass('current')){plotEventDataOnBingMap(eventsCacheDatafilter);}}else{eventsPlaces=eventsCacheData;if($('#cevents').hasClass('current')){plotEventDataOnBingMap(eventsCacheData);}}
for(i=1;i<=gCtr;i++){$('.event_row'+i).equalizeHeights();if($('.event_row'+i).height()==0){eventsCityId='';}}
if(openEntityRequestId!==false){openEventDetail(openEntityRequestId);}}}
function overlayForVtour(virtualTour){$('body').append('<div class="welcome_overlay launchOverlay" style="z-index:2001;" onclick="$(\'#overlayedVtour\').remove();$(\'.launchOverlay\').remove();"></div><div id="overlayedVtour" class="overlayedMedia rounded" style="z-index:2002"><a onclick="$(\'#overlayedVtour\').remove();$(\'.launchOverlay\').remove();" class="close" href="javascript://"></a><h2 class="details-title-sub">Click on the camera icons to view individual virtual tours:</h2><div id="virtual-tours-content"><iframe id="showskill" scrolling="no" height="450" width ="700" src="'+virtualTour+'"></iframe></div></div>');window.scrollTo(0,0);}
function getIpPushpin(async){if(!async){async=true;}else{async=false;}
$.ajax({'async':async,'url':'/feed/get-ip-pushpin','success':function(data){$('#initial_city_id').val(data.initial_city_id);$('#initial_city_name').val(data.initial_city_name);$('#initial_city_country').val(data.initial_city_country);$('#initial_city_lat').val(data.initial_city_lat);$('#initial_city_lon').val(data.initial_city_lon);$('#initial_city_description').val(data.initial_city_description);$('#initial_currency_code').val(data.initial_currency_code);}});}
function ucfirst(string)
{return string.charAt(0).toUpperCase()+string.slice(1);}
var defaultDiacriticsRemovalMap=[{'base':'A','letters':/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{'base':'AA','letters':/[\uA732]/g},{'base':'AE','letters':/[\u00C6\u01FC\u01E2]/g},{'base':'AO','letters':/[\uA734]/g},{'base':'AU','letters':/[\uA736]/g},{'base':'AV','letters':/[\uA738\uA73A]/g},{'base':'AY','letters':/[\uA73C]/g},{'base':'B','letters':/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{'base':'C','letters':/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{'base':'D','letters':/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{'base':'DZ','letters':/[\u01F1\u01C4]/g},{'base':'Dz','letters':/[\u01F2\u01C5]/g},{'base':'E','letters':/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{'base':'F','letters':/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{'base':'G','letters':/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{'base':'H','letters':/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{'base':'I','letters':/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{'base':'J','letters':/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{'base':'K','letters':/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{'base':'L','letters':/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{'base':'LJ','letters':/[\u01C7]/g},{'base':'Lj','letters':/[\u01C8]/g},{'base':'M','letters':/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{'base':'N','letters':/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{'base':'NJ','letters':/[\u01CA]/g},{'base':'Nj','letters':/[\u01CB]/g},{'base':'O','letters':/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{'base':'OI','letters':/[\u01A2]/g},{'base':'OO','letters':/[\uA74E]/g},{'base':'OU','letters':/[\u0222]/g},{'base':'P','letters':/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{'base':'Q','letters':/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{'base':'R','letters':/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{'base':'S','letters':/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{'base':'T','letters':/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{'base':'TZ','letters':/[\uA728]/g},{'base':'U','letters':/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{'base':'V','letters':/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{'base':'VY','letters':/[\uA760]/g},{'base':'W','letters':/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{'base':'X','letters':/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{'base':'Y','letters':/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{'base':'Z','letters':/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{'base':'a','letters':/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{'base':'aa','letters':/[\uA733]/g},{'base':'ae','letters':/[\u00E6\u01FD\u01E3]/g},{'base':'ao','letters':/[\uA735]/g},{'base':'au','letters':/[\uA737]/g},{'base':'av','letters':/[\uA739\uA73B]/g},{'base':'ay','letters':/[\uA73D]/g},{'base':'b','letters':/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{'base':'c','letters':/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{'base':'d','letters':/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{'base':'dz','letters':/[\u01F3\u01C6]/g},{'base':'e','letters':/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{'base':'f','letters':/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{'base':'g','letters':/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{'base':'h','letters':/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{'base':'hv','letters':/[\u0195]/g},{'base':'i','letters':/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{'base':'j','letters':/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{'base':'k','letters':/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{'base':'l','letters':/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{'base':'lj','letters':/[\u01C9]/g},{'base':'m','letters':/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{'base':'n','letters':/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{'base':'nj','letters':/[\u01CC]/g},{'base':'o','letters':/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{'base':'oi','letters':/[\u01A3]/g},{'base':'ou','letters':/[\u0223]/g},{'base':'oo','letters':/[\uA74F]/g},{'base':'p','letters':/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{'base':'q','letters':/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{'base':'r','letters':/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{'base':'s','letters':/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{'base':'t','letters':/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{'base':'tz','letters':/[\uA729]/g},{'base':'u','letters':/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{'base':'v','letters':/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{'base':'vy','letters':/[\uA761]/g},{'base':'w','letters':/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{'base':'x','letters':/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{'base':'y','letters':/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{'base':'z','letters':/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}];var changes;function removeDiacritics(str){if(!changes){changes=defaultDiacriticsRemovalMap;}
for(var i=0;i<changes.length;i++){str=str.replace(changes[i].letters,changes[i].base);}
return str;}
function changeFilmstripImg(id,imgUrl){var contImage=$('#'+id+' img').attr("src");if(contImage==imgUrl){return;}
$('#'+id).addClass('filmstripLoader');$('#'+id+' img').hide();$('#'+id+' img').attr('src',imgUrl);$('#'+id+' img').load(function(){$('#'+id+' img').show();$('#'+id).removeClass('filmstripLoader');});}
function cleanArray(actual){var newArray=new Array();for(var i=0;i<actual.length;i++){if(actual[i]){newArray.push(actual[i]);}}
return newArray;}
function eliminateDuplicatesFromArray(arr){var i,len=arr.length,out=[],obj={};for(i=0;i<len;i++){obj[arr[i]]=0;}
for(i in obj){out.push(i);}
return out;};(function($){$.organicTabs=function(el,options){var base=this;base.$el=$(el);base.$nav=base.$el.find(".nav");base.init=function(){base.options=$.extend({},$.organicTabs.defaultOptions,options);$(".hide").css({"position":"relative","top":0,"left":0,"display":"none"});base.$nav.delegate("li > a","click",function(){var curList=base.$el.find("a.current").attr("href").substring(1),$newList=$(this),listID=$newList.attr("href").substring(1),clickEvents=$newList.attr("rel"),$allListWrap=base.$el.find(".list-wrap"),curListHeight=$allListWrap.height();if((listID!=curList)){base.$el.find("#"+curList).fadeOut(base.options.speed,function(){base.$el.find(".nav li a").removeClass("current");$newList.addClass("current");$("body").css("cursor","progress");if(surfMode=="Plan"&&eval(listID+"CityId != document.getElementById('hdnCityId').value")){$("#"+listID+"Info").html(panelloaderDiv);}
base.$el.find("#"+listID).fadeIn(base.options.speed,function(){abortAjax();applySwitchTabs(listID,clickEvents);$("body").css("cursor","default");});});}
return false;});};base.init();};$.organicTabs.defaultOptions={"speed":300};$.fn.organicTabs=function(options){return this.each(function(){(new $.organicTabs(this,options));});};})(jQuery);;(function($){$.fn.lazyload=function(options){var settings={threshold:0,failurelimit:0,event:"scroll",effect:"show",container:window,imgonerror:"/images/noimage.jpg"};if(options){$.extend(settings,options);}
var elements=this;if("scroll"==settings.event){$(settings.container).bind("scroll",function(event){var counter=0;elements.each(function(){if($.abovethetop(this,settings)||$.leftofbegin(this,settings)){}else if(!$.belowthefold(this,settings)&&!$.rightoffold(this,settings)){$(this).trigger("appear");}else{if(counter++>settings.failurelimit){return false;}}});var temp=$.grep(elements,function(element){return!element.loaded;});elements=$(temp);});}
this.each(function(){var self=this;if(undefined==$(self).attr("original")){$(self).attr("original",$(self).attr("src"));}
if("scroll"!=settings.event||undefined==$(self).attr("src")||settings.placeholder==$(self).attr("src")||($.abovethetop(self,settings)||$.leftofbegin(self,settings)||$.belowthefold(self,settings)||$.rightoffold(self,settings))){if(settings.placeholder){$(self).attr("src",settings.placeholder);}else{$(self).removeAttr("src");}
self.loaded=false;}else{self.loaded=true;}
$(self).one("appear",function(){if(!this.loaded){$("<img />").bind("load",function(){$(self).hide().attr("src",$(self).attr("original"))
[settings.effect](settings.effectspeed);self.loaded=true;}).attr("src",$(self).attr("original")).error(function(){$(self).attr("src",settings.imgonerror)});};});if("scroll"!=settings.event){$(self).bind(settings.event,function(event){if(!self.loaded){$(self).trigger("appear");}});}});$(settings.container).trigger(settings.event);return this;};$.belowthefold=function(element,settings){if(settings.container===undefined||settings.container===window){var fold=$(window).height()+$(window).scrollTop();}else{var fold=$(settings.container).offset().top+$(settings.container).height();}
return fold<=$(element).offset().top-settings.threshold;};$.rightoffold=function(element,settings){if(settings.container===undefined||settings.container===window){var fold=$(window).width()+$(window).scrollLeft();}else{var fold=$(settings.container).offset().left+$(settings.container).width();}
return fold<=$(element).offset().left-settings.threshold;};$.abovethetop=function(element,settings){if(settings.container===undefined||settings.container===window){var fold=$(window).scrollTop();}else{var fold=$(settings.container).offset().top;}
return fold>=$(element).offset().top+settings.threshold+$(element).height();};$.leftofbegin=function(element,settings){if(settings.container===undefined||settings.container===window){var fold=$(window).scrollLeft();}else{var fold=$(settings.container).offset().left;}
return fold>=$(element).offset().left+settings.threshold+$(element).width();};$.extend($.expr[':'],{"below-the-fold":"$.belowthefold(a, {threshold : 0, container: window})","above-the-fold":"!$.belowthefold(a, {threshold : 0, container: window})","right-of-fold":"$.rightoffold(a, {threshold : 0, container: window})","left-of-fold":"!$.rightoffold(a, {threshold : 0, container: window})"});})(jQuery);
;// ┌────────────────────────────────────────────────────────────────────┐ \\
// │ Raphaël 2.1.0 - JavaScript Vector Library                          │ \\
// ├────────────────────────────────────────────────────────────────────┤ \\
// │ Copyright © 2008-2012 Dmitry Baranovskiy (http://raphaeljs.com)    │ \\
// │ Copyright © 2008-2012 Sencha Labs (http://sencha.com)              │ \\
// ├────────────────────────────────────────────────────────────────────┤ \\
// │ Licensed under the MIT (http://raphaeljs.com/license.html) license.│ \\
// └────────────────────────────────────────────────────────────────────┘ \\
(function(n){var e,t,r="0.4.2",f="hasOwnProperty",i=/[\.\/]/,o="*",u=function(){},l=function(n,e){return n-e},s={n:{}},p=function(n,r){n+="";var f,i=t,o=Array.prototype.slice.call(arguments,2),u=p.listeners(n),s=0,a=[],c={},h=[],d=e;e=n,t=0;for(var g=0,v=u.length;v>g;g++)"zIndex"in u[g]&&(a.push(u[g].zIndex),0>u[g].zIndex&&(c[u[g].zIndex]=u[g]));for(a.sort(l);0>a[s];)if(f=c[a[s++]],h.push(f.apply(r,o)),t)return t=i,h;for(g=0;v>g;g++)if(f=u[g],"zIndex"in f)if(f.zIndex==a[s]){if(h.push(f.apply(r,o)),t)break;do if(s++,f=c[a[s]],f&&h.push(f.apply(r,o)),t)break;while(f)}else c[f.zIndex]=f;else if(h.push(f.apply(r,o)),t)break;return t=i,e=d,h.length?h:null};p._events=s,p.listeners=function(n){var e,t,r,f,u,l,p,a,c=n.split(i),h=s,d=[h],g=[];for(f=0,u=c.length;u>f;f++){for(a=[],l=0,p=d.length;p>l;l++)for(h=d[l].n,t=[h[c[f]],h[o]],r=2;r--;)e=t[r],e&&(a.push(e),g=g.concat(e.f||[]));d=a}return g},p.on=function(n,e){if(n+="","function"!=typeof e)return function(){};for(var t=n.split(i),r=s,f=0,o=t.length;o>f;f++)r=r.n,r=r.hasOwnProperty(t[f])&&r[t[f]]||(r[t[f]]={n:{}});for(r.f=r.f||[],f=0,o=r.f.length;o>f;f++)if(r.f[f]==e)return u;return r.f.push(e),function(n){+n==+n&&(e.zIndex=+n)}},p.f=function(n){var e=[].slice.call(arguments,1);return function(){p.apply(null,[n,null].concat(e).concat([].slice.call(arguments,0)))}},p.stop=function(){t=1},p.nt=function(n){return n?RegExp("(?:\\.|\\/|^)"+n+"(?:\\.|\\/|$)").test(e):e},p.nts=function(){return e.split(i)},p.off=p.unbind=function(n,e){if(!n)return p._events=s={n:{}},void 0;var t,r,u,l,a,c,h,d=n.split(i),g=[s];for(l=0,a=d.length;a>l;l++)for(c=0;g.length>c;c+=u.length-2){if(u=[c,1],t=g[c].n,d[l]!=o)t[d[l]]&&u.push(t[d[l]]);else for(r in t)t[f](r)&&u.push(t[r]);g.splice.apply(g,u)}for(l=0,a=g.length;a>l;l++)for(t=g[l];t.n;){if(e){if(t.f){for(c=0,h=t.f.length;h>c;c++)if(t.f[c]==e){t.f.splice(c,1);break}!t.f.length&&delete t.f}for(r in t.n)if(t.n[f](r)&&t.n[r].f){var v=t.n[r].f;for(c=0,h=v.length;h>c;c++)if(v[c]==e){v.splice(c,1);break}!v.length&&delete t.n[r].f}}else{delete t.f;for(r in t.n)t.n[f](r)&&t.n[r].f&&delete t.n[r].f}t=t.n}},p.once=function(n,e){var t=function(){return p.unbind(n,t),e.apply(this,arguments)};return p.on(n,t)},p.version=r,p.toString=function(){return"You are running Eve "+r},"undefined"!=typeof module&&module.exports?module.exports=p:"undefined"!=typeof define?define("eve",[],function(){return p}):n.eve=p})(this);(function(){function t(e){if(t.is(e,"function"))return m?e():eve.on("raphael.DOMload",e);if(t.is(e,N))return t._engine.create[F](t,e.splice(0,3+t.is(e[0],Y))).add(e);var n=Array.prototype.slice.call(arguments,0);if(t.is(n[n.length-1],"function")){var r=n.pop();return m?r.call(t._engine.create[F](t,n)):eve.on("raphael.DOMload",function(){r.call(t._engine.create[F](t,n))})}return t._engine.create[F](t,arguments)}function e(t){if(Object(t)!==t)return t;var n=new t.constructor;for(var r in t)t[k](r)&&(n[r]=e(t[r]));return n}function n(t,e){for(var n=0,r=t.length;r>n;n++)if(t[n]===e)return t.push(t.splice(n,1)[0])}function r(t,e,r){function i(){var a=Array.prototype.slice.call(arguments,0),s=a.join("␀"),o=i.cache=i.cache||{},u=i.count=i.count||[];return o[k](s)?(n(u,s),r?r(o[s]):o[s]):(u.length>=1e3&&delete o[u.shift()],u.push(s),o[s]=t[F](e,a),r?r(o[s]):o[s])}return i}function i(){return this.hex}function a(t,e){for(var n=[],r=0,i=t.length;i-2*!e>r;r+=2){var a=[{x:+t[r-2],y:+t[r-1]},{x:+t[r],y:+t[r+1]},{x:+t[r+2],y:+t[r+3]},{x:+t[r+4],y:+t[r+5]}];e?r?i-4==r?a[3]={x:+t[0],y:+t[1]}:i-2==r&&(a[2]={x:+t[0],y:+t[1]},a[3]={x:+t[2],y:+t[3]}):a[0]={x:+t[i-2],y:+t[i-1]}:i-4==r?a[3]=a[2]:r||(a[0]={x:+t[r],y:+t[r+1]}),n.push(["C",(-a[0].x+6*a[1].x+a[2].x)/6,(-a[0].y+6*a[1].y+a[2].y)/6,(a[1].x+6*a[2].x-a[3].x)/6,(a[1].y+6*a[2].y-a[3].y)/6,a[2].x,a[2].y])}return n}function s(t,e,n,r,i){var a=-3*e+9*n-9*r+3*i,s=t*a+6*e-12*n+6*r;return t*s-3*e+3*n}function o(t,e,n,r,i,a,o,u,l){null==l&&(l=1),l=l>1?1:0>l?0:l;for(var h=l/2,c=12,f=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],p=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],d=0,g=0;c>g;g++){var x=h*f[g]+h,v=s(x,t,n,i,o),m=s(x,e,r,a,u),y=v*v+m*m;d+=p[g]*j.sqrt(y)}return h*d}function u(t,e,n,r,i,a,s,u,l){if(!(0>l||l>o(t,e,n,r,i,a,s,u))){var h,c=1,f=c/2,p=c-f,d=.01;for(h=o(t,e,n,r,i,a,s,u,p);O(h-l)>d;)f/=2,p+=(l>h?1:-1)*f,h=o(t,e,n,r,i,a,s,u,p);return p}}function l(t,e,n,r,i,a,s,o){if(!(D(t,n)<z(i,s)||z(t,n)>D(i,s)||D(e,r)<z(a,o)||z(e,r)>D(a,o))){var u=(t*r-e*n)*(i-s)-(t-n)*(i*o-a*s),l=(t*r-e*n)*(a-o)-(e-r)*(i*o-a*s),h=(t-n)*(a-o)-(e-r)*(i-s);if(h){var c=u/h,f=l/h,p=+c.toFixed(2),d=+f.toFixed(2);if(!(+z(t,n).toFixed(2)>p||p>+D(t,n).toFixed(2)||+z(i,s).toFixed(2)>p||p>+D(i,s).toFixed(2)||+z(e,r).toFixed(2)>d||d>+D(e,r).toFixed(2)||+z(a,o).toFixed(2)>d||d>+D(a,o).toFixed(2)))return{x:c,y:f}}}}function h(e,n,r){var i=t.bezierBBox(e),a=t.bezierBBox(n);if(!t.isBBoxIntersect(i,a))return r?0:[];for(var s=o.apply(0,e),u=o.apply(0,n),h=~~(s/5),c=~~(u/5),f=[],p=[],d={},g=r?0:[],x=0;h+1>x;x++){var v=t.findDotsAtSegment.apply(t,e.concat(x/h));f.push({x:v.x,y:v.y,t:x/h})}for(x=0;c+1>x;x++)v=t.findDotsAtSegment.apply(t,n.concat(x/c)),p.push({x:v.x,y:v.y,t:x/c});for(x=0;h>x;x++)for(var m=0;c>m;m++){var y=f[x],b=f[x+1],_=p[m],w=p[m+1],k=.001>O(b.x-y.x)?"y":"x",B=.001>O(w.x-_.x)?"y":"x",S=l(y.x,y.y,b.x,b.y,_.x,_.y,w.x,w.y);if(S){if(d[S.x.toFixed(4)]==S.y.toFixed(4))continue;d[S.x.toFixed(4)]=S.y.toFixed(4);var C=y.t+O((S[k]-y[k])/(b[k]-y[k]))*(b.t-y.t),F=_.t+O((S[B]-_[B])/(w[B]-_[B]))*(w.t-_.t);C>=0&&1>=C&&F>=0&&1>=F&&(r?g++:g.push({x:S.x,y:S.y,t1:C,t2:F}))}}return g}function c(e,n,r){e=t._path2curve(e),n=t._path2curve(n);for(var i,a,s,o,u,l,c,f,p,d,g=r?0:[],x=0,v=e.length;v>x;x++){var m=e[x];if("M"==m[0])i=u=m[1],a=l=m[2];else{"C"==m[0]?(p=[i,a].concat(m.slice(1)),i=p[6],a=p[7]):(p=[i,a,i,a,u,l,u,l],i=u,a=l);for(var y=0,b=n.length;b>y;y++){var _=n[y];if("M"==_[0])s=c=_[1],o=f=_[2];else{"C"==_[0]?(d=[s,o].concat(_.slice(1)),s=d[6],o=d[7]):(d=[s,o,s,o,c,f,c,f],s=c,o=f);var w=h(p,d,r);if(r)g+=w;else{for(var k=0,B=w.length;B>k;k++)w[k].segment1=x,w[k].segment2=y,w[k].bez1=p,w[k].bez2=d;g=g.concat(w)}}}}}return g}function f(t,e,n,r,i,a){null!=t?(this.a=+t,this.b=+e,this.c=+n,this.d=+r,this.e=+i,this.f=+a):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function p(){return this.x+P+this.y+P+this.width+" × "+this.height}function d(t,e,n,r,i,a){function s(t){return((c*t+h)*t+l)*t}function o(t,e){var n=u(t,e);return((d*n+p)*n+f)*n}function u(t,e){var n,r,i,a,o,u;for(i=t,u=0;8>u;u++){if(a=s(i)-t,e>O(a))return i;if(o=(3*c*i+2*h)*i+l,1e-6>O(o))break;i-=a/o}if(n=0,r=1,i=t,n>i)return n;if(i>r)return r;for(;r>n;){if(a=s(i),e>O(a-t))return i;t>a?n=i:r=i,i=(r-n)/2+n}return i}var l=3*e,h=3*(r-e)-l,c=1-l-h,f=3*n,p=3*(i-n)-f,d=1-f-p;return o(t,1/(200*a))}function g(t,e){var n=[],r={};if(this.ms=e,this.times=1,t){for(var i in t)t[k](i)&&(r[Q(i)]=t[i],n.push(Q(i)));n.sort(le)}this.anim=r,this.top=n[n.length-1],this.percents=n}function x(e,n,r,i,a,s){r=Q(r);var o,u,l,h,c,p,g=e.ms,x={},v={},m={};if(i)for(_=0,w=sn.length;w>_;_++){var y=sn[_];if(y.el.id==n.id&&y.anim==e){y.percent!=r?(sn.splice(_,1),l=1):u=y,n.attr(y.totalOrigin);break}}else i=+v;for(var _=0,w=e.percents.length;w>_;_++){if(e.percents[_]==r||e.percents[_]>i*e.top){r=e.percents[_],c=e.percents[_-1]||0,g=g/e.top*(r-c),h=e.percents[_+1],o=e.anim[r];break}i&&n.attr(e.anim[e.percents[_]])}if(o){if(u)u.initstatus=i,u.start=new Date-u.ms*i;else{for(var B in o)if(o[k](B)&&(ee[k](B)||n.paper.customAttributes[k](B)))switch(x[B]=n.attr(B),null==x[B]&&(x[B]=te[B]),v[B]=o[B],ee[B]){case Y:m[B]=(v[B]-x[B])/g;break;case"colour":x[B]=t.getRGB(x[B]);var S=t.getRGB(v[B]);m[B]={r:(S.r-x[B].r)/g,g:(S.g-x[B].g)/g,b:(S.b-x[B].b)/g};break;case"path":var C=Ie(x[B],v[B]),F=C[1];for(x[B]=C[0],m[B]=[],_=0,w=x[B].length;w>_;_++){m[B][_]=[0];for(var L=1,A=x[B][_].length;A>L;L++)m[B][_][L]=(F[_][L]-x[B][_][L])/g}break;case"transform":var P=n._,I=ze(P[B],v[B]);if(I)for(x[B]=I.from,v[B]=I.to,m[B]=[],m[B].real=!0,_=0,w=x[B].length;w>_;_++)for(m[B][_]=[x[B][_][0]],L=1,A=x[B][_].length;A>L;L++)m[B][_][L]=(v[B][_][L]-x[B][_][L])/g;else{var R=n.matrix||new f,q={_:{transform:P.transform},getBBox:function(){return n.getBBox(1)}};x[B]=[R.a,R.b,R.c,R.d,R.e,R.f],je(q,v[B]),v[B]=q._.transform,m[B]=[(q.matrix.a-R.a)/g,(q.matrix.b-R.b)/g,(q.matrix.c-R.c)/g,(q.matrix.d-R.d)/g,(q.matrix.e-R.e)/g,(q.matrix.f-R.f)/g]}break;case"csv":var j=E(o[B])[M](b),D=E(x[B])[M](b);if("clip-rect"==B)for(x[B]=D,m[B]=[],_=D.length;_--;)m[B][_]=(j[_]-x[B][_])/g;v[B]=j;break;default:for(j=[][T](o[B]),D=[][T](x[B]),m[B]=[],_=n.paper.customAttributes[B].length;_--;)m[B][_]=((j[_]||0)-(D[_]||0))/g}var z=o.easing,O=t.easing_formulas[z];if(!O)if(O=E(z).match(U),O&&5==O.length){var V=O;O=function(t){return d(t,+V[1],+V[2],+V[3],+V[4],g)}}else O=ce;if(p=o.start||e.start||+new Date,y={anim:e,percent:r,timestamp:p,start:p+(e.del||0),status:0,initstatus:i||0,stop:!1,ms:g,easing:O,from:x,diff:m,to:v,el:n,callback:o.callback,prev:c,next:h,repeat:s||e.times,origin:n.attr(),totalOrigin:a},sn.push(y),i&&!u&&!l&&(y.stop=!0,y.start=new Date-g*i,1==sn.length))return un();l&&(y.start=new Date-y.ms*i),1==sn.length&&on(un)}eve("raphael.anim.start."+n.id,n,e)}}function v(t){for(var e=0;sn.length>e;e++)sn[e].el.paper==t&&sn.splice(e--,1)}t.version="2.1.0",t.eve=eve;var m,y,b=/[, ]+/,_={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},w=/\{(\d+)\}/g,k="hasOwnProperty",B={doc:document,win:window},S={was:Object.prototype[k].call(B.win,"Raphael"),is:B.win.Raphael},C=function(){this.ca=this.customAttributes={}},F="apply",T="concat",L="createTouch"in B.doc,A="",P=" ",E=String,M="split",I="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[M](P),R={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},q=E.prototype.toLowerCase,j=Math,D=j.max,z=j.min,O=j.abs,V=j.pow,X=j.PI,Y="number",G="string",N="array",W=Object.prototype.toString,$=(t._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),H={NaN:1,Infinity:1,"-Infinity":1},U=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,Z=j.round,Q=parseFloat,J=parseInt,K=E.prototype.toUpperCase,te=t._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},ee=t._availableAnimAttrs={blur:Y,"clip-rect":"csv",cx:Y,cy:Y,fill:"colour","fill-opacity":Y,"font-size":Y,height:Y,opacity:Y,path:"path",r:Y,rx:Y,ry:Y,stroke:"colour","stroke-opacity":Y,"stroke-width":Y,transform:"transform",width:Y,x:Y,y:Y},ne=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,re={hs:1,rg:1},ie=/,?([achlmqrstvxz]),?/gi,ae=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,se=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,oe=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,ue=(t._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),le=function(t,e){return Q(t)-Q(e)},he=function(){},ce=function(t){return t},fe=t._rectPath=function(t,e,n,r,i){return i?[["M",t+i,e],["l",n-2*i,0],["a",i,i,0,0,1,i,i],["l",0,r-2*i],["a",i,i,0,0,1,-i,i],["l",2*i-n,0],["a",i,i,0,0,1,-i,-i],["l",0,2*i-r],["a",i,i,0,0,1,i,-i],["z"]]:[["M",t,e],["l",n,0],["l",0,r],["l",-n,0],["z"]]},pe=function(t,e,n,r){return null==r&&(r=n),[["M",t,e],["m",0,-r],["a",n,r,0,1,1,0,2*r],["a",n,r,0,1,1,0,-2*r],["z"]]},de=t._getPath={path:function(t){return t.attr("path")},circle:function(t){var e=t.attrs;return pe(e.cx,e.cy,e.r)},ellipse:function(t){var e=t.attrs;return pe(e.cx,e.cy,e.rx,e.ry)},rect:function(t){var e=t.attrs;return fe(e.x,e.y,e.width,e.height,e.r)},image:function(t){var e=t.attrs;return fe(e.x,e.y,e.width,e.height)},text:function(t){var e=t._getBBox();return fe(e.x,e.y,e.width,e.height)},set:function(t){var e=t._getBBox();return fe(e.x,e.y,e.width,e.height)}},ge=t.mapPath=function(t,e){if(!e)return t;var n,r,i,a,s,o,u;for(t=Ie(t),i=0,s=t.length;s>i;i++)for(u=t[i],a=1,o=u.length;o>a;a+=2)n=e.x(u[a],u[a+1]),r=e.y(u[a],u[a+1]),u[a]=n,u[a+1]=r;return t};if(t._g=B,t.type=B.win.SVGAngle||B.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==t.type){var xe,ve=B.doc.createElement("div");if(ve.innerHTML='<v:shape adj="1"/>',xe=ve.firstChild,xe.style.behavior="url(#default#VML)",!xe||"object"!=typeof xe.adj)return t.type=A;ve=null}t.svg=!(t.vml="VML"==t.type),t._Paper=C,t.fn=y=C.prototype=t.prototype,t._id=0,t._oid=0,t.is=function(t,e){return e=q.call(e),"finite"==e?!H[k](+t):"array"==e?t instanceof Array:"null"==e&&null===t||e==typeof t&&null!==t||"object"==e&&t===Object(t)||"array"==e&&Array.isArray&&Array.isArray(t)||W.call(t).slice(8,-1).toLowerCase()==e},t.angle=function(e,n,r,i,a,s){if(null==a){var o=e-r,u=n-i;return o||u?(180+180*j.atan2(-u,-o)/X+360)%360:0}return t.angle(e,n,a,s)-t.angle(r,i,a,s)},t.rad=function(t){return t%360*X/180},t.deg=function(t){return 180*t/X%360},t.snapTo=function(e,n,r){if(r=t.is(r,"finite")?r:10,t.is(e,N)){for(var i=e.length;i--;)if(r>=O(e[i]-n))return e[i]}else{e=+e;var a=n%e;if(r>a)return n-a;if(a>e-r)return n-a+e}return n},t.createUUID=function(t,e){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(t,e).toUpperCase()}}(/[xy]/g,function(t){var e=0|16*j.random(),n="x"==t?e:8|3&e;return n.toString(16)}),t.setWindow=function(e){eve("raphael.setWindow",t,B.win,e),B.win=e,B.doc=B.win.document,t._engine.initWin&&t._engine.initWin(B.win)};var me=function(e){if(t.vml){var n,i=/^\s+|\s+$/g;try{var a=new ActiveXObject("htmlfile");a.write("<body>"),a.close(),n=a.body}catch(s){n=createPopup().document.body}var o=n.createTextRange();me=r(function(t){try{n.style.color=E(t).replace(i,A);var e=o.queryCommandValue("ForeColor");return e=(255&e)<<16|65280&e|(16711680&e)>>>16,"#"+("000000"+e.toString(16)).slice(-6)}catch(r){return"none"}})}else{var u=B.doc.createElement("i");u.title="Raphaël Colour Picker",u.style.display="none",B.doc.body.appendChild(u),me=r(function(t){return u.style.color=t,B.doc.defaultView.getComputedStyle(u,A).getPropertyValue("color")})}return me(e)},ye=function(){return"hsb("+[this.h,this.s,this.b]+")"},be=function(){return"hsl("+[this.h,this.s,this.l]+")"},_e=function(){return this.hex},we=function(e,n,r){if(null==n&&t.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(r=e.b,n=e.g,e=e.r),null==n&&t.is(e,G)){var i=t.getRGB(e);e=i.r,n=i.g,r=i.b}return(e>1||n>1||r>1)&&(e/=255,n/=255,r/=255),[e,n,r]},ke=function(e,n,r,i){e*=255,n*=255,r*=255;var a={r:e,g:n,b:r,hex:t.rgb(e,n,r),toString:_e};return t.is(i,"finite")&&(a.opacity=i),a};t.color=function(e){var n;return t.is(e,"object")&&"h"in e&&"s"in e&&"b"in e?(n=t.hsb2rgb(e),e.r=n.r,e.g=n.g,e.b=n.b,e.hex=n.hex):t.is(e,"object")&&"h"in e&&"s"in e&&"l"in e?(n=t.hsl2rgb(e),e.r=n.r,e.g=n.g,e.b=n.b,e.hex=n.hex):(t.is(e,"string")&&(e=t.getRGB(e)),t.is(e,"object")&&"r"in e&&"g"in e&&"b"in e?(n=t.rgb2hsl(e),e.h=n.h,e.s=n.s,e.l=n.l,n=t.rgb2hsb(e),e.v=n.b):(e={hex:"none"},e.r=e.g=e.b=e.h=e.s=e.v=e.l=-1)),e.toString=_e,e},t.hsb2rgb=function(t,e,n,r){this.is(t,"object")&&"h"in t&&"s"in t&&"b"in t&&(n=t.b,e=t.s,t=t.h,r=t.o),t*=360;var i,a,s,o,u;return t=t%360/60,u=n*e,o=u*(1-O(t%2-1)),i=a=s=n-u,t=~~t,i+=[u,o,0,0,o,u][t],a+=[o,u,u,o,0,0][t],s+=[0,0,o,u,u,o][t],ke(i,a,s,r)},t.hsl2rgb=function(t,e,n,r){this.is(t,"object")&&"h"in t&&"s"in t&&"l"in t&&(n=t.l,e=t.s,t=t.h),(t>1||e>1||n>1)&&(t/=360,e/=100,n/=100),t*=360;var i,a,s,o,u;return t=t%360/60,u=2*e*(.5>n?n:1-n),o=u*(1-O(t%2-1)),i=a=s=n-u/2,t=~~t,i+=[u,o,0,0,o,u][t],a+=[o,u,u,o,0,0][t],s+=[0,0,o,u,u,o][t],ke(i,a,s,r)},t.rgb2hsb=function(t,e,n){n=we(t,e,n),t=n[0],e=n[1],n=n[2];var r,i,a,s;return a=D(t,e,n),s=a-z(t,e,n),r=0==s?null:a==t?(e-n)/s:a==e?(n-t)/s+2:(t-e)/s+4,r=60*((r+360)%6)/360,i=0==s?0:s/a,{h:r,s:i,b:a,toString:ye}},t.rgb2hsl=function(t,e,n){n=we(t,e,n),t=n[0],e=n[1],n=n[2];var r,i,a,s,o,u;return s=D(t,e,n),o=z(t,e,n),u=s-o,r=0==u?null:s==t?(e-n)/u:s==e?(n-t)/u+2:(t-e)/u+4,r=60*((r+360)%6)/360,a=(s+o)/2,i=0==u?0:.5>a?u/(2*a):u/(2-2*a),{h:r,s:i,l:a,toString:be}},t._path2string=function(){return this.join(",").replace(ie,"$1")},t._preload=function(t,e){var n=B.doc.createElement("img");n.style.cssText="position:absolute;left:-9999em;top:-9999em",n.onload=function(){e.call(this),this.onload=null,B.doc.body.removeChild(this)},n.onerror=function(){B.doc.body.removeChild(this)},B.doc.body.appendChild(n),n.src=t},t.getRGB=r(function(e){if(!e||(e=E(e)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:i};if("none"==e)return{r:-1,g:-1,b:-1,hex:"none",toString:i};!(re[k](e.toLowerCase().substring(0,2))||"#"==e.charAt())&&(e=me(e));var n,r,a,s,o,u,l=e.match($);return l?(l[2]&&(a=J(l[2].substring(5),16),r=J(l[2].substring(3,5),16),n=J(l[2].substring(1,3),16)),l[3]&&(a=J((o=l[3].charAt(3))+o,16),r=J((o=l[3].charAt(2))+o,16),n=J((o=l[3].charAt(1))+o,16)),l[4]&&(u=l[4][M](ne),n=Q(u[0]),"%"==u[0].slice(-1)&&(n*=2.55),r=Q(u[1]),"%"==u[1].slice(-1)&&(r*=2.55),a=Q(u[2]),"%"==u[2].slice(-1)&&(a*=2.55),"rgba"==l[1].toLowerCase().slice(0,4)&&(s=Q(u[3])),u[3]&&"%"==u[3].slice(-1)&&(s/=100)),l[5]?(u=l[5][M](ne),n=Q(u[0]),"%"==u[0].slice(-1)&&(n*=2.55),r=Q(u[1]),"%"==u[1].slice(-1)&&(r*=2.55),a=Q(u[2]),"%"==u[2].slice(-1)&&(a*=2.55),("deg"==u[0].slice(-3)||"°"==u[0].slice(-1))&&(n/=360),"hsba"==l[1].toLowerCase().slice(0,4)&&(s=Q(u[3])),u[3]&&"%"==u[3].slice(-1)&&(s/=100),t.hsb2rgb(n,r,a,s)):l[6]?(u=l[6][M](ne),n=Q(u[0]),"%"==u[0].slice(-1)&&(n*=2.55),r=Q(u[1]),"%"==u[1].slice(-1)&&(r*=2.55),a=Q(u[2]),"%"==u[2].slice(-1)&&(a*=2.55),("deg"==u[0].slice(-3)||"°"==u[0].slice(-1))&&(n/=360),"hsla"==l[1].toLowerCase().slice(0,4)&&(s=Q(u[3])),u[3]&&"%"==u[3].slice(-1)&&(s/=100),t.hsl2rgb(n,r,a,s)):(l={r:n,g:r,b:a,toString:i},l.hex="#"+(16777216|a|r<<8|n<<16).toString(16).slice(1),t.is(s,"finite")&&(l.opacity=s),l)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:i}},t),t.hsb=r(function(e,n,r){return t.hsb2rgb(e,n,r).hex}),t.hsl=r(function(e,n,r){return t.hsl2rgb(e,n,r).hex}),t.rgb=r(function(t,e,n){return"#"+(16777216|n|e<<8|t<<16).toString(16).slice(1)}),t.getColor=function(t){var e=this.getColor.start=this.getColor.start||{h:0,s:1,b:t||.75},n=this.hsb2rgb(e.h,e.s,e.b);return e.h+=.075,e.h>1&&(e.h=0,e.s-=.2,0>=e.s&&(this.getColor.start={h:0,s:1,b:e.b})),n.hex},t.getColor.reset=function(){delete this.start},t.parsePathString=function(e){if(!e)return null;var n=Be(e);if(n.arr)return Ce(n.arr);var r={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},i=[];return t.is(e,N)&&t.is(e[0],N)&&(i=Ce(e)),i.length||E(e).replace(ae,function(t,e,n){var a=[],s=e.toLowerCase();if(n.replace(oe,function(t,e){e&&a.push(+e)}),"m"==s&&a.length>2&&(i.push([e][T](a.splice(0,2))),s="l",e="m"==e?"l":"L"),"r"==s)i.push([e][T](a));else for(;a.length>=r[s]&&(i.push([e][T](a.splice(0,r[s]))),r[s]););}),i.toString=t._path2string,n.arr=Ce(i),i},t.parseTransformString=r(function(e){if(!e)return null;var n=[];return t.is(e,N)&&t.is(e[0],N)&&(n=Ce(e)),n.length||E(e).replace(se,function(t,e,r){var i=[];q.call(e),r.replace(oe,function(t,e){e&&i.push(+e)}),n.push([e][T](i))}),n.toString=t._path2string,n});var Be=function(t){var e=Be.ps=Be.ps||{};return e[t]?e[t].sleep=100:e[t]={sleep:100},setTimeout(function(){for(var n in e)e[k](n)&&n!=t&&(e[n].sleep--,!e[n].sleep&&delete e[n])}),e[t]};t.findDotsAtSegment=function(t,e,n,r,i,a,s,o,u){var l=1-u,h=V(l,3),c=V(l,2),f=u*u,p=f*u,d=h*t+3*c*u*n+3*l*u*u*i+p*s,g=h*e+3*c*u*r+3*l*u*u*a+p*o,x=t+2*u*(n-t)+f*(i-2*n+t),v=e+2*u*(r-e)+f*(a-2*r+e),m=n+2*u*(i-n)+f*(s-2*i+n),y=r+2*u*(a-r)+f*(o-2*a+r),b=l*t+u*n,_=l*e+u*r,w=l*i+u*s,k=l*a+u*o,B=90-180*j.atan2(x-m,v-y)/X;return(x>m||y>v)&&(B+=180),{x:d,y:g,m:{x:x,y:v},n:{x:m,y:y},start:{x:b,y:_},end:{x:w,y:k},alpha:B}},t.bezierBBox=function(e,n,r,i,a,s,o,u){t.is(e,"array")||(e=[e,n,r,i,a,s,o,u]);var l=Me.apply(null,e);return{x:l.min.x,y:l.min.y,x2:l.max.x,y2:l.max.y,width:l.max.x-l.min.x,height:l.max.y-l.min.y}},t.isPointInsideBBox=function(t,e,n){return e>=t.x&&t.x2>=e&&n>=t.y&&t.y2>=n},t.isBBoxIntersect=function(e,n){var r=t.isPointInsideBBox;return r(n,e.x,e.y)||r(n,e.x2,e.y)||r(n,e.x,e.y2)||r(n,e.x2,e.y2)||r(e,n.x,n.y)||r(e,n.x2,n.y)||r(e,n.x,n.y2)||r(e,n.x2,n.y2)||(e.x<n.x2&&e.x>n.x||n.x<e.x2&&n.x>e.x)&&(e.y<n.y2&&e.y>n.y||n.y<e.y2&&n.y>e.y)},t.pathIntersection=function(t,e){return c(t,e)},t.pathIntersectionNumber=function(t,e){return c(t,e,1)},t.isPointInsidePath=function(e,n,r){var i=t.pathBBox(e);return t.isPointInsideBBox(i,n,r)&&1==c(e,[["M",n,r],["H",i.x2+10]],1)%2},t._removedFactory=function(t){return function(){eve("raphael.log",null,"Raphaël: you are calling to method “"+t+"” of removed object",t)}};var Se=t.pathBBox=function(t){var n=Be(t);if(n.bbox)return e(n.bbox);if(!t)return{x:0,y:0,width:0,height:0,x2:0,y2:0};t=Ie(t);for(var r,i=0,a=0,s=[],o=[],u=0,l=t.length;l>u;u++)if(r=t[u],"M"==r[0])i=r[1],a=r[2],s.push(i),o.push(a);else{var h=Me(i,a,r[1],r[2],r[3],r[4],r[5],r[6]);s=s[T](h.min.x,h.max.x),o=o[T](h.min.y,h.max.y),i=r[5],a=r[6]}var c=z[F](0,s),f=z[F](0,o),p=D[F](0,s),d=D[F](0,o),g={x:c,y:f,x2:p,y2:d,width:p-c,height:d-f};return n.bbox=e(g),g},Ce=function(n){var r=e(n);return r.toString=t._path2string,r},Fe=t._pathToRelative=function(e){var n=Be(e);if(n.rel)return Ce(n.rel);t.is(e,N)&&t.is(e&&e[0],N)||(e=t.parsePathString(e));var r=[],i=0,a=0,s=0,o=0,u=0;"M"==e[0][0]&&(i=e[0][1],a=e[0][2],s=i,o=a,u++,r.push(["M",i,a]));for(var l=u,h=e.length;h>l;l++){var c=r[l]=[],f=e[l];if(f[0]!=q.call(f[0]))switch(c[0]=q.call(f[0]),c[0]){case"a":c[1]=f[1],c[2]=f[2],c[3]=f[3],c[4]=f[4],c[5]=f[5],c[6]=+(f[6]-i).toFixed(3),c[7]=+(f[7]-a).toFixed(3);break;case"v":c[1]=+(f[1]-a).toFixed(3);break;case"m":s=f[1],o=f[2];default:for(var p=1,d=f.length;d>p;p++)c[p]=+(f[p]-(p%2?i:a)).toFixed(3)}else{c=r[l]=[],"m"==f[0]&&(s=f[1]+i,o=f[2]+a);for(var g=0,x=f.length;x>g;g++)r[l][g]=f[g]}var v=r[l].length;switch(r[l][0]){case"z":i=s,a=o;break;case"h":i+=+r[l][v-1];break;case"v":a+=+r[l][v-1];break;default:i+=+r[l][v-2],a+=+r[l][v-1]}}return r.toString=t._path2string,n.rel=Ce(r),r},Te=t._pathToAbsolute=function(e){var n=Be(e);if(n.abs)return Ce(n.abs);if(t.is(e,N)&&t.is(e&&e[0],N)||(e=t.parsePathString(e)),!e||!e.length)return[["M",0,0]];var r=[],i=0,s=0,o=0,u=0,l=0;"M"==e[0][0]&&(i=+e[0][1],s=+e[0][2],o=i,u=s,l++,r[0]=["M",i,s]);for(var h,c,f=3==e.length&&"M"==e[0][0]&&"R"==e[1][0].toUpperCase()&&"Z"==e[2][0].toUpperCase(),p=l,d=e.length;d>p;p++){if(r.push(h=[]),c=e[p],c[0]!=K.call(c[0]))switch(h[0]=K.call(c[0]),h[0]){case"A":h[1]=c[1],h[2]=c[2],h[3]=c[3],h[4]=c[4],h[5]=c[5],h[6]=+(c[6]+i),h[7]=+(c[7]+s);break;case"V":h[1]=+c[1]+s;break;case"H":h[1]=+c[1]+i;break;case"R":for(var g=[i,s][T](c.slice(1)),x=2,v=g.length;v>x;x++)g[x]=+g[x]+i,g[++x]=+g[x]+s;r.pop(),r=r[T](a(g,f));break;case"M":o=+c[1]+i,u=+c[2]+s;default:for(x=1,v=c.length;v>x;x++)h[x]=+c[x]+(x%2?i:s)}else if("R"==c[0])g=[i,s][T](c.slice(1)),r.pop(),r=r[T](a(g,f)),h=["R"][T](c.slice(-2));else for(var m=0,y=c.length;y>m;m++)h[m]=c[m];switch(h[0]){case"Z":i=o,s=u;break;case"H":i=h[1];break;case"V":s=h[1];break;case"M":o=h[h.length-2],u=h[h.length-1];default:i=h[h.length-2],s=h[h.length-1]}}return r.toString=t._path2string,n.abs=Ce(r),r},Le=function(t,e,n,r){return[t,e,n,r,n,r]},Ae=function(t,e,n,r,i,a){var s=1/3,o=2/3;return[s*t+o*n,s*e+o*r,s*i+o*n,s*a+o*r,i,a]},Pe=function(t,e,n,i,a,s,o,u,l,h){var c,f=120*X/180,p=X/180*(+a||0),d=[],g=r(function(t,e,n){var r=t*j.cos(n)-e*j.sin(n),i=t*j.sin(n)+e*j.cos(n);return{x:r,y:i}});if(h)B=h[0],S=h[1],w=h[2],k=h[3];else{c=g(t,e,-p),t=c.x,e=c.y,c=g(u,l,-p),u=c.x,l=c.y;var x=(j.cos(X/180*a),j.sin(X/180*a),(t-u)/2),v=(e-l)/2,m=x*x/(n*n)+v*v/(i*i);m>1&&(m=j.sqrt(m),n=m*n,i=m*i);var y=n*n,b=i*i,_=(s==o?-1:1)*j.sqrt(O((y*b-y*v*v-b*x*x)/(y*v*v+b*x*x))),w=_*n*v/i+(t+u)/2,k=_*-i*x/n+(e+l)/2,B=j.asin(((e-k)/i).toFixed(9)),S=j.asin(((l-k)/i).toFixed(9));B=w>t?X-B:B,S=w>u?X-S:S,0>B&&(B=2*X+B),0>S&&(S=2*X+S),o&&B>S&&(B-=2*X),!o&&S>B&&(S-=2*X)}var C=S-B;if(O(C)>f){var F=S,L=u,A=l;S=B+f*(o&&S>B?1:-1),u=w+n*j.cos(S),l=k+i*j.sin(S),d=Pe(u,l,n,i,a,0,o,L,A,[S,F,w,k])}C=S-B;var P=j.cos(B),E=j.sin(B),I=j.cos(S),R=j.sin(S),q=j.tan(C/4),D=4/3*n*q,z=4/3*i*q,V=[t,e],Y=[t+D*E,e-z*P],G=[u+D*R,l-z*I],N=[u,l];if(Y[0]=2*V[0]-Y[0],Y[1]=2*V[1]-Y[1],h)return[Y,G,N][T](d);d=[Y,G,N][T](d).join()[M](",");for(var W=[],$=0,H=d.length;H>$;$++)W[$]=$%2?g(d[$-1],d[$],p).y:g(d[$],d[$+1],p).x;return W},Ee=function(t,e,n,r,i,a,s,o,u){var l=1-u;return{x:V(l,3)*t+3*V(l,2)*u*n+3*l*u*u*i+V(u,3)*s,y:V(l,3)*e+3*V(l,2)*u*r+3*l*u*u*a+V(u,3)*o}},Me=r(function(t,e,n,r,i,a,s,o){var u,l=i-2*n+t-(s-2*i+n),h=2*(n-t)-2*(i-n),c=t-n,f=(-h+j.sqrt(h*h-4*l*c))/2/l,p=(-h-j.sqrt(h*h-4*l*c))/2/l,d=[e,o],g=[t,s];return O(f)>"1e12"&&(f=.5),O(p)>"1e12"&&(p=.5),f>0&&1>f&&(u=Ee(t,e,n,r,i,a,s,o,f),g.push(u.x),d.push(u.y)),p>0&&1>p&&(u=Ee(t,e,n,r,i,a,s,o,p),g.push(u.x),d.push(u.y)),l=a-2*r+e-(o-2*a+r),h=2*(r-e)-2*(a-r),c=e-r,f=(-h+j.sqrt(h*h-4*l*c))/2/l,p=(-h-j.sqrt(h*h-4*l*c))/2/l,O(f)>"1e12"&&(f=.5),O(p)>"1e12"&&(p=.5),f>0&&1>f&&(u=Ee(t,e,n,r,i,a,s,o,f),g.push(u.x),d.push(u.y)),p>0&&1>p&&(u=Ee(t,e,n,r,i,a,s,o,p),g.push(u.x),d.push(u.y)),{min:{x:z[F](0,g),y:z[F](0,d)},max:{x:D[F](0,g),y:D[F](0,d)}}}),Ie=t._path2curve=r(function(t,e){var n=!e&&Be(t);if(!e&&n.curve)return Ce(n.curve);for(var r=Te(t),i=e&&Te(e),a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=(function(t,e){var n,r;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"][T](Pe[F](0,[e.x,e.y][T](t.slice(1))));break;case"S":n=e.x+(e.x-(e.bx||e.x)),r=e.y+(e.y-(e.by||e.y)),t=["C",n,r][T](t.slice(1));break;case"T":e.qx=e.x+(e.x-(e.qx||e.x)),e.qy=e.y+(e.y-(e.qy||e.y)),t=["C"][T](Ae(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"][T](Ae(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"][T](Le(e.x,e.y,t[1],t[2]));break;case"H":t=["C"][T](Le(e.x,e.y,t[1],e.y));break;case"V":t=["C"][T](Le(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"][T](Le(e.x,e.y,e.X,e.Y))}return t}),u=function(t,e){if(t[e].length>7){t[e].shift();for(var n=t[e];n.length;)t.splice(e++,0,["C"][T](n.splice(0,6)));t.splice(e,1),c=D(r.length,i&&i.length||0)}},l=function(t,e,n,a,s){t&&e&&"M"==t[s][0]&&"M"!=e[s][0]&&(e.splice(s,0,["M",a.x,a.y]),n.bx=0,n.by=0,n.x=t[s][1],n.y=t[s][2],c=D(r.length,i&&i.length||0))},h=0,c=D(r.length,i&&i.length||0);c>h;h++){r[h]=o(r[h],a),u(r,h),i&&(i[h]=o(i[h],s)),i&&u(i,h),l(r,i,a,s,h),l(i,r,s,a,h);var f=r[h],p=i&&i[h],d=f.length,g=i&&p.length;a.x=f[d-2],a.y=f[d-1],a.bx=Q(f[d-4])||a.x,a.by=Q(f[d-3])||a.y,s.bx=i&&(Q(p[g-4])||s.x),s.by=i&&(Q(p[g-3])||s.y),s.x=i&&p[g-2],s.y=i&&p[g-1]}return i||(n.curve=Ce(r)),i?[r,i]:r},null,Ce),Re=(t._parseDots=r(function(e){for(var n=[],r=0,i=e.length;i>r;r++){var a={},s=e[r].match(/^([^:]*):?([\d\.]*)/);if(a.color=t.getRGB(s[1]),a.color.error)return null;a.color=a.color.hex,s[2]&&(a.offset=s[2]+"%"),n.push(a)}for(r=1,i=n.length-1;i>r;r++)if(!n[r].offset){for(var o=Q(n[r-1].offset||0),u=0,l=r+1;i>l;l++)if(n[l].offset){u=n[l].offset;break}u||(u=100,l=i),u=Q(u);for(var h=(u-o)/(l-r+1);l>r;r++)o+=h,n[r].offset=o+"%"}return n}),t._tear=function(t,e){t==e.top&&(e.top=t.prev),t==e.bottom&&(e.bottom=t.next),t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next)}),qe=(t._tofront=function(t,e){e.top!==t&&(Re(t,e),t.next=null,t.prev=e.top,e.top.next=t,e.top=t)},t._toback=function(t,e){e.bottom!==t&&(Re(t,e),t.next=e.bottom,t.prev=null,e.bottom.prev=t,e.bottom=t)},t._insertafter=function(t,e,n){Re(t,n),e==n.top&&(n.top=t),e.next&&(e.next.prev=t),t.next=e.next,t.prev=e,e.next=t},t._insertbefore=function(t,e,n){Re(t,n),e==n.bottom&&(n.bottom=t),e.prev&&(e.prev.next=t),t.prev=e.prev,e.prev=t,t.next=e},t.toMatrix=function(t,e){var n=Se(t),r={_:{transform:A},getBBox:function(){return n}};return je(r,e),r.matrix}),je=(t.transformPath=function(t,e){return ge(t,qe(t,e))},t._extractTransform=function(e,n){if(null==n)return e._.transform;n=E(n).replace(/\.{3}|\u2026/g,e._.transform||A);var r=t.parseTransformString(n),i=0,a=0,s=0,o=1,u=1,l=e._,h=new f;if(l.transform=r||[],r)for(var c=0,p=r.length;p>c;c++){var d,g,x,v,m,y=r[c],b=y.length,_=E(y[0]).toLowerCase(),w=y[0]!=_,k=w?h.invert():0;"t"==_&&3==b?w?(d=k.x(0,0),g=k.y(0,0),x=k.x(y[1],y[2]),v=k.y(y[1],y[2]),h.translate(x-d,v-g)):h.translate(y[1],y[2]):"r"==_?2==b?(m=m||e.getBBox(1),h.rotate(y[1],m.x+m.width/2,m.y+m.height/2),i+=y[1]):4==b&&(w?(x=k.x(y[2],y[3]),v=k.y(y[2],y[3]),h.rotate(y[1],x,v)):h.rotate(y[1],y[2],y[3]),i+=y[1]):"s"==_?2==b||3==b?(m=m||e.getBBox(1),h.scale(y[1],y[b-1],m.x+m.width/2,m.y+m.height/2),o*=y[1],u*=y[b-1]):5==b&&(w?(x=k.x(y[3],y[4]),v=k.y(y[3],y[4]),h.scale(y[1],y[2],x,v)):h.scale(y[1],y[2],y[3],y[4]),o*=y[1],u*=y[2]):"m"==_&&7==b&&h.add(y[1],y[2],y[3],y[4],y[5],y[6]),l.dirtyT=1,e.matrix=h}e.matrix=h,l.sx=o,l.sy=u,l.deg=i,l.dx=a=h.e,l.dy=s=h.f,1==o&&1==u&&!i&&l.bbox?(l.bbox.x+=+a,l.bbox.y+=+s):l.dirtyT=1}),De=function(t){var e=t[0];switch(e.toLowerCase()){case"t":return[e,0,0];case"m":return[e,1,0,0,1,0,0];case"r":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"s":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}},ze=t._equaliseTransform=function(e,n){n=E(n).replace(/\.{3}|\u2026/g,e),e=t.parseTransformString(e)||[],n=t.parseTransformString(n)||[];for(var r,i,a,s,o=D(e.length,n.length),u=[],l=[],h=0;o>h;h++){if(a=e[h]||De(n[h]),s=n[h]||De(a),a[0]!=s[0]||"r"==a[0].toLowerCase()&&(a[2]!=s[2]||a[3]!=s[3])||"s"==a[0].toLowerCase()&&(a[3]!=s[3]||a[4]!=s[4]))return;for(u[h]=[],l[h]=[],r=0,i=D(a.length,s.length);i>r;r++)r in a&&(u[h][r]=a[r]),r in s&&(l[h][r]=s[r])}return{from:u,to:l}};t._getContainer=function(e,n,r,i){var a;return a=null!=i||t.is(e,"object")?e:B.doc.getElementById(e),null!=a?a.tagName?null==n?{container:a,width:a.style.pixelWidth||a.offsetWidth,height:a.style.pixelHeight||a.offsetHeight}:{container:a,width:n,height:r}:{container:1,x:e,y:n,width:r,height:i}:void 0},t.pathToRelative=Fe,t._engine={},t.path2curve=Ie,t.matrix=function(t,e,n,r,i,a){return new f(t,e,n,r,i,a)},function(e){function n(t){return t[0]*t[0]+t[1]*t[1]}function r(t){var e=j.sqrt(n(t));t[0]&&(t[0]/=e),t[1]&&(t[1]/=e)}e.add=function(t,e,n,r,i,a){var s,o,u,l,h=[[],[],[]],c=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],p=[[t,n,i],[e,r,a],[0,0,1]];for(t&&t instanceof f&&(p=[[t.a,t.c,t.e],[t.b,t.d,t.f],[0,0,1]]),s=0;3>s;s++)for(o=0;3>o;o++){for(l=0,u=0;3>u;u++)l+=c[s][u]*p[u][o];h[s][o]=l}this.a=h[0][0],this.b=h[1][0],this.c=h[0][1],this.d=h[1][1],this.e=h[0][2],this.f=h[1][2]},e.invert=function(){var t=this,e=t.a*t.d-t.b*t.c;return new f(t.d/e,-t.b/e,-t.c/e,t.a/e,(t.c*t.f-t.d*t.e)/e,(t.b*t.e-t.a*t.f)/e)},e.clone=function(){return new f(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(t,e){this.add(1,0,0,1,t,e)},e.scale=function(t,e,n,r){null==e&&(e=t),(n||r)&&this.add(1,0,0,1,n,r),this.add(t,0,0,e,0,0),(n||r)&&this.add(1,0,0,1,-n,-r)},e.rotate=function(e,n,r){e=t.rad(e),n=n||0,r=r||0;var i=+j.cos(e).toFixed(9),a=+j.sin(e).toFixed(9);this.add(i,a,-a,i,n,r),this.add(1,0,0,1,-n,-r)},e.x=function(t,e){return t*this.a+e*this.c+this.e},e.y=function(t,e){return t*this.b+e*this.d+this.f},e.get=function(t){return+this[E.fromCharCode(97+t)].toFixed(4)},e.toString=function(){return t.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},e.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.split=function(){var e={};e.dx=this.e,e.dy=this.f;var i=[[this.a,this.c],[this.b,this.d]];e.scalex=j.sqrt(n(i[0])),r(i[0]),e.shear=i[0][0]*i[1][0]+i[0][1]*i[1][1],i[1]=[i[1][0]-i[0][0]*e.shear,i[1][1]-i[0][1]*e.shear],e.scaley=j.sqrt(n(i[1])),r(i[1]),e.shear/=e.scaley;var a=-i[0][1],s=i[1][1];return 0>s?(e.rotate=t.deg(j.acos(s)),0>a&&(e.rotate=360-e.rotate)):e.rotate=t.deg(j.asin(a)),e.isSimple=!(+e.shear.toFixed(9)||e.scalex.toFixed(9)!=e.scaley.toFixed(9)&&e.rotate),e.isSuperSimple=!+e.shear.toFixed(9)&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate,e.noRotation=!+e.shear.toFixed(9)&&!e.rotate,e
},e.toTransformString=function(t){var e=t||this[M]();return e.isSimple?(e.scalex=+e.scalex.toFixed(4),e.scaley=+e.scaley.toFixed(4),e.rotate=+e.rotate.toFixed(4),(e.dx||e.dy?"t"+[e.dx,e.dy]:A)+(1!=e.scalex||1!=e.scaley?"s"+[e.scalex,e.scaley,0,0]:A)+(e.rotate?"r"+[e.rotate,0,0]:A)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(f.prototype);var Oe=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);y.safari="Apple Computer, Inc."==navigator.vendor&&(Oe&&4>Oe[1]||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&Oe&&8>Oe[1]?function(){var t=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){t.remove()})}:he;for(var Ve=function(){this.returnValue=!1},Xe=function(){return this.originalEvent.preventDefault()},Ye=function(){this.cancelBubble=!0},Ge=function(){return this.originalEvent.stopPropagation()},Ne=function(){return B.doc.addEventListener?function(t,e,n,r){var i=L&&R[e]?R[e]:e,a=function(i){var a=B.doc.documentElement.scrollTop||B.doc.body.scrollTop,s=B.doc.documentElement.scrollLeft||B.doc.body.scrollLeft,o=i.clientX+s,u=i.clientY+a;if(L&&R[k](e))for(var l=0,h=i.targetTouches&&i.targetTouches.length;h>l;l++)if(i.targetTouches[l].target==t){var c=i;i=i.targetTouches[l],i.originalEvent=c,i.preventDefault=Xe,i.stopPropagation=Ge;break}return n.call(r,i,o,u)};return t.addEventListener(i,a,!1),function(){return t.removeEventListener(i,a,!1),!0}}:B.doc.attachEvent?function(t,e,n,r){var i=function(t){t=t||B.win.event;var e=B.doc.documentElement.scrollTop||B.doc.body.scrollTop,i=B.doc.documentElement.scrollLeft||B.doc.body.scrollLeft,a=t.clientX+i,s=t.clientY+e;return t.preventDefault=t.preventDefault||Ve,t.stopPropagation=t.stopPropagation||Ye,n.call(r,t,a,s)};t.attachEvent("on"+e,i);var a=function(){return t.detachEvent("on"+e,i),!0};return a}:void 0}(),We=[],$e=function(t){for(var e,n=t.clientX,r=t.clientY,i=B.doc.documentElement.scrollTop||B.doc.body.scrollTop,a=B.doc.documentElement.scrollLeft||B.doc.body.scrollLeft,s=We.length;s--;){if(e=We[s],L){for(var o,u=t.touches.length;u--;)if(o=t.touches[u],o.identifier==e.el._drag.id){n=o.clientX,r=o.clientY,(t.originalEvent?t.originalEvent:t).preventDefault();break}}else t.preventDefault();var l,h=e.el.node,c=h.nextSibling,f=h.parentNode,p=h.style.display;B.win.opera&&f.removeChild(h),h.style.display="none",l=e.el.paper.getElementByPoint(n,r),h.style.display=p,B.win.opera&&(c?f.insertBefore(h,c):f.appendChild(h)),l&&eve("raphael.drag.over."+e.el.id,e.el,l),n+=a,r+=i,eve("raphael.drag.move."+e.el.id,e.move_scope||e.el,n-e.el._drag.x,r-e.el._drag.y,n,r,t)}},He=function(e){t.unmousemove($e).unmouseup(He);for(var n,r=We.length;r--;)n=We[r],n.el._drag={},eve("raphael.drag.end."+n.el.id,n.end_scope||n.start_scope||n.move_scope||n.el,e);We=[]},Ue=t.el={},Ze=I.length;Ze--;)(function(e){t[e]=Ue[e]=function(n,r){return t.is(n,"function")&&(this.events=this.events||[],this.events.push({name:e,f:n,unbind:Ne(this.shape||this.node||B.doc,e,n,r||this)})),this},t["un"+e]=Ue["un"+e]=function(t){for(var n=this.events||[],r=n.length;r--;)if(n[r].name==e&&n[r].f==t)return n[r].unbind(),n.splice(r,1),!n.length&&delete this.events,this;return this}})(I[Ze]);Ue.data=function(e,n){var r=ue[this.id]=ue[this.id]||{};if(1==arguments.length){if(t.is(e,"object")){for(var i in e)e[k](i)&&this.data(i,e[i]);return this}return eve("raphael.data.get."+this.id,this,r[e],e),r[e]}return r[e]=n,eve("raphael.data.set."+this.id,this,n,e),this},Ue.removeData=function(t){return null==t?ue[this.id]={}:ue[this.id]&&delete ue[this.id][t],this},Ue.getData=function(){return ue[this.id]||{}},Ue.hover=function(t,e,n,r){return this.mouseover(t,n).mouseout(e,r||n)},Ue.unhover=function(t,e){return this.unmouseover(t).unmouseout(e)};var Qe=[];Ue.drag=function(e,n,r,i,a,s){function o(o){(o.originalEvent||o).preventDefault();var u=B.doc.documentElement.scrollTop||B.doc.body.scrollTop,l=B.doc.documentElement.scrollLeft||B.doc.body.scrollLeft;this._drag.x=o.clientX+l,this._drag.y=o.clientY+u,this._drag.id=o.identifier,!We.length&&t.mousemove($e).mouseup(He),We.push({el:this,move_scope:i,start_scope:a,end_scope:s}),n&&eve.on("raphael.drag.start."+this.id,n),e&&eve.on("raphael.drag.move."+this.id,e),r&&eve.on("raphael.drag.end."+this.id,r),eve("raphael.drag.start."+this.id,a||i||this,o.clientX+l,o.clientY+u,o)}return this._drag={},Qe.push({el:this,start:o}),this.mousedown(o),this},Ue.onDragOver=function(t){t?eve.on("raphael.drag.over."+this.id,t):eve.unbind("raphael.drag.over."+this.id)},Ue.undrag=function(){for(var e=Qe.length;e--;)Qe[e].el==this&&(this.unmousedown(Qe[e].start),Qe.splice(e,1),eve.unbind("raphael.drag.*."+this.id));!Qe.length&&t.unmousemove($e).unmouseup(He),We=[]},y.circle=function(e,n,r){var i=t._engine.circle(this,e||0,n||0,r||0);return this.__set__&&this.__set__.push(i),i},y.rect=function(e,n,r,i,a){var s=t._engine.rect(this,e||0,n||0,r||0,i||0,a||0);return this.__set__&&this.__set__.push(s),s},y.ellipse=function(e,n,r,i){var a=t._engine.ellipse(this,e||0,n||0,r||0,i||0);return this.__set__&&this.__set__.push(a),a},y.path=function(e){e&&!t.is(e,G)&&!t.is(e[0],N)&&(e+=A);var n=t._engine.path(t.format[F](t,arguments),this);return this.__set__&&this.__set__.push(n),n},y.image=function(e,n,r,i,a){var s=t._engine.image(this,e||"about:blank",n||0,r||0,i||0,a||0);return this.__set__&&this.__set__.push(s),s},y.text=function(e,n,r){var i=t._engine.text(this,e||0,n||0,E(r));return this.__set__&&this.__set__.push(i),i},y.set=function(e){!t.is(e,"array")&&(e=Array.prototype.splice.call(arguments,0,arguments.length));var n=new hn(e);return this.__set__&&this.__set__.push(n),n.paper=this,n.type="set",n},y.setStart=function(t){this.__set__=t||this.set()},y.setFinish=function(){var t=this.__set__;return delete this.__set__,t},y.setSize=function(e,n){return t._engine.setSize.call(this,e,n)},y.setViewBox=function(e,n,r,i,a){return t._engine.setViewBox.call(this,e,n,r,i,a)},y.top=y.bottom=null,y.raphael=t;var Je=function(t){var e=t.getBoundingClientRect(),n=t.ownerDocument,r=n.body,i=n.documentElement,a=i.clientTop||r.clientTop||0,s=i.clientLeft||r.clientLeft||0,o=e.top+(B.win.pageYOffset||i.scrollTop||r.scrollTop)-a,u=e.left+(B.win.pageXOffset||i.scrollLeft||r.scrollLeft)-s;return{y:o,x:u}};y.getElementByPoint=function(t,e){var n=this,r=n.canvas,i=B.doc.elementFromPoint(t,e);if(B.win.opera&&"svg"==i.tagName){var a=Je(r),s=r.createSVGRect();s.x=t-a.x,s.y=e-a.y,s.width=s.height=1;var o=r.getIntersectionList(s,null);o.length&&(i=o[o.length-1])}if(!i)return null;for(;i.parentNode&&i!=r.parentNode&&!i.raphael;)i=i.parentNode;return i==n.canvas.parentNode&&(i=r),i=i&&i.raphael?n.getById(i.raphaelid):null},y.getElementsByBBox=function(t){var e=this.set();return this.forEach(function(n){Raphael.isBBoxIntersect(n.getBBox(),t)&&e.push(n)}),e},y.getById=function(t){for(var e=this.bottom;e;){if(e.id==t)return e;e=e.next}return null},y.forEach=function(t,e){for(var n=this.bottom;n;){if(t.call(e,n)===!1)return this;n=n.next}return this},y.getElementsByPoint=function(t,e){var n=this.set();return this.forEach(function(r){r.isPointInside(t,e)&&n.push(r)}),n},Ue.isPointInside=function(e,n){var r=this.realPath=this.realPath||de[this.type](this);return t.isPointInsidePath(r,e,n)},Ue.getBBox=function(t){if(this.removed)return{};var e=this._;return t?((e.dirty||!e.bboxwt)&&(this.realPath=de[this.type](this),e.bboxwt=Se(this.realPath),e.bboxwt.toString=p,e.dirty=0),e.bboxwt):((e.dirty||e.dirtyT||!e.bbox)&&((e.dirty||!this.realPath)&&(e.bboxwt=0,this.realPath=de[this.type](this)),e.bbox=Se(ge(this.realPath,this.matrix)),e.bbox.toString=p,e.dirty=e.dirtyT=0),e.bbox)},Ue.clone=function(){if(this.removed)return null;var t=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(t),t},Ue.glow=function(t){if("text"==this.type)return null;t=t||{};var e={width:(t.width||10)+(+this.attr("stroke-width")||1),fill:t.fill||!1,opacity:t.opacity||.5,offsetx:t.offsetx||0,offsety:t.offsety||0,color:t.color||"#000"},n=e.width/2,r=this.paper,i=r.set(),a=this.realPath||de[this.type](this);a=this.matrix?ge(a,this.matrix):a;for(var s=1;n+1>s;s++)i.push(r.path(a).attr({stroke:e.color,fill:e.fill?e.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(e.width/n*s).toFixed(3),opacity:+(e.opacity/n).toFixed(3)}));return i.insertBefore(this).translate(e.offsetx,e.offsety)};var Ke=function(e,n,r,i,a,s,l,h,c){return null==c?o(e,n,r,i,a,s,l,h):t.findDotsAtSegment(e,n,r,i,a,s,l,h,u(e,n,r,i,a,s,l,h,c))},tn=function(e,n){return function(r,i,a){r=Ie(r);for(var s,o,u,l,h,c="",f={},p=0,d=0,g=r.length;g>d;d++){if(u=r[d],"M"==u[0])s=+u[1],o=+u[2];else{if(l=Ke(s,o,u[1],u[2],u[3],u[4],u[5],u[6]),p+l>i){if(n&&!f.start){if(h=Ke(s,o,u[1],u[2],u[3],u[4],u[5],u[6],i-p),c+=["C"+h.start.x,h.start.y,h.m.x,h.m.y,h.x,h.y],a)return c;f.start=c,c=["M"+h.x,h.y+"C"+h.n.x,h.n.y,h.end.x,h.end.y,u[5],u[6]].join(),p+=l,s=+u[5],o=+u[6];continue}if(!e&&!n)return h=Ke(s,o,u[1],u[2],u[3],u[4],u[5],u[6],i-p),{x:h.x,y:h.y,alpha:h.alpha}}p+=l,s=+u[5],o=+u[6]}c+=u.shift()+u}return f.end=c,h=e?p:n?f:t.findDotsAtSegment(s,o,u[0],u[1],u[2],u[3],u[4],u[5],1),h.alpha&&(h={x:h.x,y:h.y,alpha:h.alpha}),h}},en=tn(1),nn=tn(),rn=tn(0,1);t.getTotalLength=en,t.getPointAtLength=nn,t.getSubpath=function(t,e,n){if(1e-6>this.getTotalLength(t)-n)return rn(t,e).end;var r=rn(t,n,1);return e?rn(r,e).end:r},Ue.getTotalLength=function(){return"path"==this.type?this.node.getTotalLength?this.node.getTotalLength():en(this.attrs.path):void 0},Ue.getPointAtLength=function(t){return"path"==this.type?nn(this.attrs.path,t):void 0},Ue.getSubpath=function(e,n){return"path"==this.type?t.getSubpath(this.attrs.path,e,n):void 0};var an=t.easing_formulas={linear:function(t){return t},"<":function(t){return V(t,1.7)},">":function(t){return V(t,.48)},"<>":function(t){var e=.48-t/1.04,n=j.sqrt(.1734+e*e),r=n-e,i=V(O(r),1/3)*(0>r?-1:1),a=-n-e,s=V(O(a),1/3)*(0>a?-1:1),o=i+s+.5;return 3*(1-o)*o*o+o*o*o},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){t-=1;var e=1.70158;return t*t*((e+1)*t+e)+1},elastic:function(t){return t==!!t?t:V(2,-10*t)*j.sin((t-.075)*2*X/.3)+1},bounce:function(t){var e,n=7.5625,r=2.75;return 1/r>t?e=n*t*t:2/r>t?(t-=1.5/r,e=n*t*t+.75):2.5/r>t?(t-=2.25/r,e=n*t*t+.9375):(t-=2.625/r,e=n*t*t+.984375),e}};an.easeIn=an["ease-in"]=an["<"],an.easeOut=an["ease-out"]=an[">"],an.easeInOut=an["ease-in-out"]=an["<>"],an["back-in"]=an.backIn,an["back-out"]=an.backOut;var sn=[],on=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,16)},un=function(){for(var e=+new Date,n=0;sn.length>n;n++){var r=sn[n];if(!r.el.removed&&!r.paused){var i,a,s=e-r.start,o=r.ms,u=r.easing,l=r.from,h=r.diff,c=r.to,f=(r.t,r.el),p={},d={};if(r.initstatus?(s=(r.initstatus*r.anim.top-r.prev)/(r.percent-r.prev)*o,r.status=r.initstatus,delete r.initstatus,r.stop&&sn.splice(n--,1)):r.status=(r.prev+(r.percent-r.prev)*(s/o))/r.anim.top,!(0>s))if(o>s){var g=u(s/o);for(var v in l)if(l[k](v)){switch(ee[v]){case Y:i=+l[v]+g*o*h[v];break;case"colour":i="rgb("+[ln(Z(l[v].r+g*o*h[v].r)),ln(Z(l[v].g+g*o*h[v].g)),ln(Z(l[v].b+g*o*h[v].b))].join(",")+")";break;case"path":i=[];for(var m=0,y=l[v].length;y>m;m++){i[m]=[l[v][m][0]];for(var b=1,_=l[v][m].length;_>b;b++)i[m][b]=+l[v][m][b]+g*o*h[v][m][b];i[m]=i[m].join(P)}i=i.join(P);break;case"transform":if(h[v].real)for(i=[],m=0,y=l[v].length;y>m;m++)for(i[m]=[l[v][m][0]],b=1,_=l[v][m].length;_>b;b++)i[m][b]=l[v][m][b]+g*o*h[v][m][b];else{var w=function(t){return+l[v][t]+g*o*h[v][t]};i=[["m",w(0),w(1),w(2),w(3),w(4),w(5)]]}break;case"csv":if("clip-rect"==v)for(i=[],m=4;m--;)i[m]=+l[v][m]+g*o*h[v][m];break;default:var B=[][T](l[v]);for(i=[],m=f.paper.customAttributes[v].length;m--;)i[m]=+B[m]+g*o*h[v][m]}p[v]=i}f.attr(p),function(t,e,n){setTimeout(function(){eve("raphael.anim.frame."+t,e,n)})}(f.id,f,r.anim)}else{if(function(e,n,r){setTimeout(function(){eve("raphael.anim.frame."+n.id,n,r),eve("raphael.anim.finish."+n.id,n,r),t.is(e,"function")&&e.call(n)})}(r.callback,f,r.anim),f.attr(c),sn.splice(n--,1),r.repeat>1&&!r.next){for(a in c)c[k](a)&&(d[a]=r.totalOrigin[a]);r.el.attr(d),x(r.anim,r.el,r.anim.percents[0],null,r.totalOrigin,r.repeat-1)}r.next&&!r.stop&&x(r.anim,r.el,r.next,null,r.totalOrigin,r.repeat)}}}t.svg&&f&&f.paper&&f.paper.safari(),sn.length&&on(un)},ln=function(t){return t>255?255:0>t?0:t};Ue.animateWith=function(e,n,r,i,a,s){var o=this;if(o.removed)return s&&s.call(o),o;var u=r instanceof g?r:t.animation(r,i,a,s);x(u,o,u.percents[0],null,o.attr());for(var l=0,h=sn.length;h>l;l++)if(sn[l].anim==n&&sn[l].el==e){sn[h-1].start=sn[l].start;break}return o},Ue.onAnimation=function(t){return t?eve.on("raphael.anim.frame."+this.id,t):eve.unbind("raphael.anim.frame."+this.id),this},g.prototype.delay=function(t){var e=new g(this.anim,this.ms);return e.times=this.times,e.del=+t||0,e},g.prototype.repeat=function(t){var e=new g(this.anim,this.ms);return e.del=this.del,e.times=j.floor(D(t,0))||1,e},t.animation=function(e,n,r,i){if(e instanceof g)return e;(t.is(r,"function")||!r)&&(i=i||r||null,r=null),e=Object(e),n=+n||0;var a,s,o={};for(s in e)e[k](s)&&Q(s)!=s&&Q(s)+"%"!=s&&(a=!0,o[s]=e[s]);return a?(r&&(o.easing=r),i&&(o.callback=i),new g({100:o},n)):new g(e,n)},Ue.animate=function(e,n,r,i){var a=this;if(a.removed)return i&&i.call(a),a;var s=e instanceof g?e:t.animation(e,n,r,i);return x(s,a,s.percents[0],null,a.attr()),a},Ue.setTime=function(t,e){return t&&null!=e&&this.status(t,z(e,t.ms)/t.ms),this},Ue.status=function(t,e){var n,r,i=[],a=0;if(null!=e)return x(t,this,-1,z(e,1)),this;for(n=sn.length;n>a;a++)if(r=sn[a],r.el.id==this.id&&(!t||r.anim==t)){if(t)return r.status;i.push({anim:r.anim,status:r.status})}return t?0:i},Ue.pause=function(t){for(var e=0;sn.length>e;e++)sn[e].el.id!=this.id||t&&sn[e].anim!=t||eve("raphael.anim.pause."+this.id,this,sn[e].anim)!==!1&&(sn[e].paused=!0);return this},Ue.resume=function(t){for(var e=0;sn.length>e;e++)if(sn[e].el.id==this.id&&(!t||sn[e].anim==t)){var n=sn[e];eve("raphael.anim.resume."+this.id,this,n.anim)!==!1&&(delete n.paused,this.status(n.anim,n.status))}return this},Ue.stop=function(t){for(var e=0;sn.length>e;e++)sn[e].el.id!=this.id||t&&sn[e].anim!=t||eve("raphael.anim.stop."+this.id,this,sn[e].anim)!==!1&&sn.splice(e--,1);return this},eve.on("raphael.remove",v),eve.on("raphael.clear",v),Ue.toString=function(){return"Raphaël’s object"};var hn=function(t){if(this.items=[],this.length=0,this.type="set",t)for(var e=0,n=t.length;n>e;e++)!t[e]||t[e].constructor!=Ue.constructor&&t[e].constructor!=hn||(this[this.items.length]=this.items[this.items.length]=t[e],this.length++)},cn=hn.prototype;cn.push=function(){for(var t,e,n=0,r=arguments.length;r>n;n++)t=arguments[n],!t||t.constructor!=Ue.constructor&&t.constructor!=hn||(e=this.items.length,this[e]=this.items[e]=t,this.length++);return this},cn.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},cn.forEach=function(t,e){for(var n=0,r=this.items.length;r>n;n++)if(t.call(e,this.items[n],n)===!1)return this;return this};for(var fn in Ue)Ue[k](fn)&&(cn[fn]=function(t){return function(){var e=arguments;return this.forEach(function(n){n[t][F](n,e)})}}(fn));cn.attr=function(e,n){if(e&&t.is(e,N)&&t.is(e[0],"object"))for(var r=0,i=e.length;i>r;r++)this.items[r].attr(e[r]);else for(var a=0,s=this.items.length;s>a;a++)this.items[a].attr(e,n);return this},cn.clear=function(){for(;this.length;)this.pop()},cn.splice=function(t,e){t=0>t?D(this.length+t,0):t,e=D(0,z(this.length-t,e));var n,r=[],i=[],a=[];for(n=2;arguments.length>n;n++)a.push(arguments[n]);for(n=0;e>n;n++)i.push(this[t+n]);for(;this.length-t>n;n++)r.push(this[t+n]);var s=a.length;for(n=0;s+r.length>n;n++)this.items[t+n]=this[t+n]=s>n?a[n]:r[n-s];for(n=this.items.length=this.length-=e-s;this[n];)delete this[n++];return new hn(i)},cn.exclude=function(t){for(var e=0,n=this.length;n>e;e++)if(this[e]==t)return this.splice(e,1),!0},cn.animate=function(e,n,r,i){(t.is(r,"function")||!r)&&(i=r||null);var a,s,o=this.items.length,u=o,l=this;if(!o)return this;i&&(s=function(){!--o&&i.call(l)}),r=t.is(r,G)?r:s;var h=t.animation(e,n,r,s);for(a=this.items[--u].animate(h);u--;)this.items[u]&&!this.items[u].removed&&this.items[u].animateWith(a,h,h);return this},cn.insertAfter=function(t){for(var e=this.items.length;e--;)this.items[e].insertAfter(t);return this},cn.getBBox=function(){for(var t=[],e=[],n=[],r=[],i=this.items.length;i--;)if(!this.items[i].removed){var a=this.items[i].getBBox();t.push(a.x),e.push(a.y),n.push(a.x+a.width),r.push(a.y+a.height)}return t=z[F](0,t),e=z[F](0,e),n=D[F](0,n),r=D[F](0,r),{x:t,y:e,x2:n,y2:r,width:n-t,height:r-e}},cn.clone=function(t){t=this.paper.set();for(var e=0,n=this.items.length;n>e;e++)t.push(this.items[e].clone());return t},cn.toString=function(){return"Raphaël‘s set"},cn.glow=function(t){var e=this.paper.set();return this.forEach(function(n){var r=n.glow(t);null!=r&&r.forEach(function(t){e.push(t)})}),e},t.registerFont=function(t){if(!t.face)return t;this.fonts=this.fonts||{};var e={w:t.w,face:{},glyphs:{}},n=t.face["font-family"];for(var r in t.face)t.face[k](r)&&(e.face[r]=t.face[r]);if(this.fonts[n]?this.fonts[n].push(e):this.fonts[n]=[e],!t.svg){e.face["units-per-em"]=J(t.face["units-per-em"],10);for(var i in t.glyphs)if(t.glyphs[k](i)){var a=t.glyphs[i];if(e.glyphs[i]={w:a.w,k:{},d:a.d&&"M"+a.d.replace(/[mlcxtrv]/g,function(t){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[t]||"M"})+"z"},a.k)for(var s in a.k)a[k](s)&&(e.glyphs[i].k[s]=a.k[s])}}return t},y.getFont=function(e,n,r,i){if(i=i||"normal",r=r||"normal",n=+n||{normal:400,bold:700,lighter:300,bolder:800}[n]||400,t.fonts){var a=t.fonts[e];if(!a){var s=RegExp("(^|\\s)"+e.replace(/[^\w\d\s+!~.:_-]/g,A)+"(\\s|$)","i");for(var o in t.fonts)if(t.fonts[k](o)&&s.test(o)){a=t.fonts[o];break}}var u;if(a)for(var l=0,h=a.length;h>l&&(u=a[l],u.face["font-weight"]!=n||u.face["font-style"]!=r&&u.face["font-style"]||u.face["font-stretch"]!=i);l++);return u}},y.print=function(e,n,r,i,a,s,o){s=s||"middle",o=D(z(o||0,1),-1);var u,l=E(r)[M](A),h=0,c=0,f=A;if(t.is(i,r)&&(i=this.getFont(i)),i){u=(a||16)/i.face["units-per-em"];for(var p=i.face.bbox[M](b),d=+p[0],g=p[3]-p[1],x=0,v=+p[1]+("baseline"==s?g+ +i.face.descent:g/2),m=0,y=l.length;y>m;m++){if("\n"==l[m])h=0,w=0,c=0,x+=g;else{var _=c&&i.glyphs[l[m-1]]||{},w=i.glyphs[l[m]];h+=c?(_.w||i.w)+(_.k&&_.k[l[m]]||0)+i.w*o:0,c=1}w&&w.d&&(f+=t.transformPath(w.d,["t",h*u,x*u,"s",u,u,d,v,"t",(e-d)/u,(n-v)/u]))}}return this.path(f).attr({fill:"#000",stroke:"none"})},y.add=function(e){if(t.is(e,"array"))for(var n,r=this.set(),i=0,a=e.length;a>i;i++)n=e[i]||{},_[k](n.type)&&r.push(this[n.type]().attr(n));return r},t.format=function(e,n){var r=t.is(n,N)?[0][T](n):arguments;return e&&t.is(e,G)&&r.length-1&&(e=e.replace(w,function(t,e){return null==r[++e]?A:r[e]})),e||A},t.fullfill=function(){var t=/\{([^\}]+)\}/g,e=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,n=function(t,n,r){var i=r;return n.replace(e,function(t,e,n,r,a){e=e||r,i&&(e in i&&(i=i[e]),"function"==typeof i&&a&&(i=i()))}),i=(null==i||i==r?t:i)+""};return function(e,r){return(e+"").replace(t,function(t,e){return n(t,e,r)})}}(),t.ninja=function(){return S.was?B.win.Raphael=S.is:delete Raphael,t},t.st=cn,function(e,n,r){function i(){/in/.test(e.readyState)?setTimeout(i,9):t.eve("raphael.DOMload")}null==e.readyState&&e.addEventListener&&(e.addEventListener(n,r=function(){e.removeEventListener(n,r,!1),e.readyState="complete"},!1),e.readyState="loading"),i()}(document,"DOMContentLoaded"),S.was?B.win.Raphael=t:Raphael=t,eve.on("raphael.DOMload",function(){m=!0})})();window.Raphael&&window.Raphael.svg&&function(t){var e="hasOwnProperty",r=String,n=parseFloat,i=parseInt,a=Math,s=a.max,o=a.abs,u=a.pow,h=/[, ]+/,l=t.eve,c="",f=" ",p="http://www.w3.org/1999/xlink",d={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},g={};t.toString=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};var v=function(n,i){if(i){"string"==typeof n&&(n=v(n));for(var a in i)i[e](a)&&("xlink:"==a.substring(0,6)?n.setAttributeNS(p,a.substring(6),r(i[a])):n.setAttribute(a,r(i[a])))}else n=t._g.doc.createElementNS("http://www.w3.org/2000/svg",n),n.style&&(n.style.webkitTapHighlightColor="rgba(0,0,0,0)");return n},x=function(e,i){var h="linear",l=e.id+i,f=.5,p=.5,d=e.node,g=e.paper,x=d.style,y=t._g.doc.getElementById(l);if(!y){if(i=r(i).replace(t._radial_gradient,function(t,e,r){if(h="radial",e&&r){f=n(e),p=n(r);var i=2*(p>.5)-1;u(f-.5,2)+u(p-.5,2)>.25&&(p=a.sqrt(.25-u(f-.5,2))*i+.5)&&.5!=p&&(p=p.toFixed(5)-1e-5*i)}return c}),i=i.split(/\s*\-\s*/),"linear"==h){var m=i.shift();if(m=-n(m),isNaN(m))return null;var b=[0,0,a.cos(t.rad(m)),a.sin(t.rad(m))],_=1/(s(o(b[2]),o(b[3]))||1);b[2]*=_,b[3]*=_,0>b[2]&&(b[0]=-b[2],b[2]=0),0>b[3]&&(b[1]=-b[3],b[3]=0)}var w=t._parseDots(i);if(!w)return null;if(l=l.replace(/[\(\)\s,\xb0#]/g,"_"),e.gradient&&l!=e.gradient.id&&(g.defs.removeChild(e.gradient),delete e.gradient),!e.gradient){y=v(h+"Gradient",{id:l}),e.gradient=y,v(y,"radial"==h?{fx:f,fy:p}:{x1:b[0],y1:b[1],x2:b[2],y2:b[3],gradientTransform:e.matrix.invert()}),g.defs.appendChild(y);for(var k=0,C=w.length;C>k;k++)y.appendChild(v("stop",{offset:w[k].offset?w[k].offset:k?"100%":"0%","stop-color":w[k].color||"#fff"}))}}return v(d,{fill:"url(#"+l+")",opacity:1,"fill-opacity":1}),x.fill=c,x.opacity=1,x.fillOpacity=1,1},y=function(t){var e=t.getBBox(1);v(t.pattern,{patternTransform:t.matrix.invert()+" translate("+e.x+","+e.y+")"})},m=function(n,i,a){if("path"==n.type){for(var s,o,u,h,l,f=r(i).toLowerCase().split("-"),p=n.paper,x=a?"end":"start",y=n.node,m=n.attrs,b=m["stroke-width"],_=f.length,w="classic",k=3,C=3,B=5;_--;)switch(f[_]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":w=f[_];break;case"wide":C=5;break;case"narrow":C=2;break;case"long":k=5;break;case"short":k=2}if("open"==w?(k+=2,C+=2,B+=2,u=1,h=a?4:1,l={fill:"none",stroke:m.stroke}):(h=u=k/2,l={fill:m.stroke,stroke:"none"}),n._.arrows?a?(n._.arrows.endPath&&g[n._.arrows.endPath]--,n._.arrows.endMarker&&g[n._.arrows.endMarker]--):(n._.arrows.startPath&&g[n._.arrows.startPath]--,n._.arrows.startMarker&&g[n._.arrows.startMarker]--):n._.arrows={},"none"!=w){var S="raphael-marker-"+w,A="raphael-marker-"+x+w+k+C;t._g.doc.getElementById(S)?g[S]++:(p.defs.appendChild(v(v("path"),{"stroke-linecap":"round",d:d[w],id:S})),g[S]=1);var T,M=t._g.doc.getElementById(A);M?(g[A]++,T=M.getElementsByTagName("use")[0]):(M=v(v("marker"),{id:A,markerHeight:C,markerWidth:k,orient:"auto",refX:h,refY:C/2}),T=v(v("use"),{"xlink:href":"#"+S,transform:(a?"rotate(180 "+k/2+" "+C/2+") ":c)+"scale("+k/B+","+C/B+")","stroke-width":(1/((k/B+C/B)/2)).toFixed(4)}),M.appendChild(T),p.defs.appendChild(M),g[A]=1),v(T,l);var F=u*("diamond"!=w&&"oval"!=w);a?(s=n._.arrows.startdx*b||0,o=t.getTotalLength(m.path)-F*b):(s=F*b,o=t.getTotalLength(m.path)-(n._.arrows.enddx*b||0)),l={},l["marker-"+x]="url(#"+A+")",(o||s)&&(l.d=Raphael.getSubpath(m.path,s,o)),v(y,l),n._.arrows[x+"Path"]=S,n._.arrows[x+"Marker"]=A,n._.arrows[x+"dx"]=F,n._.arrows[x+"Type"]=w,n._.arrows[x+"String"]=i}else a?(s=n._.arrows.startdx*b||0,o=t.getTotalLength(m.path)-s):(s=0,o=t.getTotalLength(m.path)-(n._.arrows.enddx*b||0)),n._.arrows[x+"Path"]&&v(y,{d:Raphael.getSubpath(m.path,s,o)}),delete n._.arrows[x+"Path"],delete n._.arrows[x+"Marker"],delete n._.arrows[x+"dx"],delete n._.arrows[x+"Type"],delete n._.arrows[x+"String"];for(l in g)if(g[e](l)&&!g[l]){var L=t._g.doc.getElementById(l);L&&L.parentNode.removeChild(L)}}},b={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},_=function(t,e,n){if(e=b[r(e).toLowerCase()]){for(var i=t.attrs["stroke-width"]||"1",a={round:i,square:i,butt:0}[t.attrs["stroke-linecap"]||n["stroke-linecap"]]||0,s=[],o=e.length;o--;)s[o]=e[o]*i+(o%2?1:-1)*a;v(t.node,{"stroke-dasharray":s.join(",")})}},w=function(n,a){var u=n.node,l=n.attrs,f=u.style.visibility;u.style.visibility="hidden";for(var d in a)if(a[e](d)){if(!t._availableAttrs[e](d))continue;var g=a[d];switch(l[d]=g,d){case"blur":n.blur(g);break;case"href":case"title":case"target":var b=u.parentNode;if("a"!=b.tagName.toLowerCase()){var w=v("a");b.insertBefore(w,u),w.appendChild(u),b=w}"target"==d?b.setAttributeNS(p,"show","blank"==g?"new":g):b.setAttributeNS(p,d,g);break;case"cursor":u.style.cursor=g;break;case"transform":n.transform(g);break;case"arrow-start":m(n,g);break;case"arrow-end":m(n,g,1);break;case"clip-rect":var k=r(g).split(h);if(4==k.length){n.clip&&n.clip.parentNode.parentNode.removeChild(n.clip.parentNode);var B=v("clipPath"),S=v("rect");B.id=t.createUUID(),v(S,{x:k[0],y:k[1],width:k[2],height:k[3]}),B.appendChild(S),n.paper.defs.appendChild(B),v(u,{"clip-path":"url(#"+B.id+")"}),n.clip=S}if(!g){var A=u.getAttribute("clip-path");if(A){var T=t._g.doc.getElementById(A.replace(/(^url\(#|\)$)/g,c));T&&T.parentNode.removeChild(T),v(u,{"clip-path":c}),delete n.clip}}break;case"path":"path"==n.type&&(v(u,{d:g?l.path=t._pathToAbsolute(g):"M0,0"}),n._.dirty=1,n._.arrows&&("startString"in n._.arrows&&m(n,n._.arrows.startString),"endString"in n._.arrows&&m(n,n._.arrows.endString,1)));break;case"width":if(u.setAttribute(d,g),n._.dirty=1,!l.fx)break;d="x",g=l.x;case"x":l.fx&&(g=-l.x-(l.width||0));case"rx":if("rx"==d&&"rect"==n.type)break;case"cx":u.setAttribute(d,g),n.pattern&&y(n),n._.dirty=1;break;case"height":if(u.setAttribute(d,g),n._.dirty=1,!l.fy)break;d="y",g=l.y;case"y":l.fy&&(g=-l.y-(l.height||0));case"ry":if("ry"==d&&"rect"==n.type)break;case"cy":u.setAttribute(d,g),n.pattern&&y(n),n._.dirty=1;break;case"r":"rect"==n.type?v(u,{rx:g,ry:g}):u.setAttribute(d,g),n._.dirty=1;break;case"src":"image"==n.type&&u.setAttributeNS(p,"href",g);break;case"stroke-width":(1!=n._.sx||1!=n._.sy)&&(g/=s(o(n._.sx),o(n._.sy))||1),n.paper._vbSize&&(g*=n.paper._vbSize),u.setAttribute(d,g),l["stroke-dasharray"]&&_(n,l["stroke-dasharray"],a),n._.arrows&&("startString"in n._.arrows&&m(n,n._.arrows.startString),"endString"in n._.arrows&&m(n,n._.arrows.endString,1));break;case"stroke-dasharray":_(n,g,a);break;case"fill":var M=r(g).match(t._ISURL);if(M){B=v("pattern");var F=v("image");B.id=t.createUUID(),v(B,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),v(F,{x:0,y:0,"xlink:href":M[1]}),B.appendChild(F),function(e){t._preload(M[1],function(){var t=this.offsetWidth,r=this.offsetHeight;v(e,{width:t,height:r}),v(F,{width:t,height:r}),n.paper.safari()})}(B),n.paper.defs.appendChild(B),v(u,{fill:"url(#"+B.id+")"}),n.pattern=B,n.pattern&&y(n);break}var L=t.getRGB(g);if(L.error){if(("circle"==n.type||"ellipse"==n.type||"r"!=r(g).charAt())&&x(n,g)){if("opacity"in l||"fill-opacity"in l){var N=t._g.doc.getElementById(u.getAttribute("fill").replace(/^url\(#|\)$/g,c));if(N){var P=N.getElementsByTagName("stop");v(P[P.length-1],{"stop-opacity":("opacity"in l?l.opacity:1)*("fill-opacity"in l?l["fill-opacity"]:1)})}}l.gradient=g,l.fill="none";break}}else delete a.gradient,delete l.gradient,!t.is(l.opacity,"undefined")&&t.is(a.opacity,"undefined")&&v(u,{opacity:l.opacity}),!t.is(l["fill-opacity"],"undefined")&&t.is(a["fill-opacity"],"undefined")&&v(u,{"fill-opacity":l["fill-opacity"]});L[e]("opacity")&&v(u,{"fill-opacity":L.opacity>1?L.opacity/100:L.opacity});case"stroke":L=t.getRGB(g),u.setAttribute(d,L.hex),"stroke"==d&&L[e]("opacity")&&v(u,{"stroke-opacity":L.opacity>1?L.opacity/100:L.opacity}),"stroke"==d&&n._.arrows&&("startString"in n._.arrows&&m(n,n._.arrows.startString),"endString"in n._.arrows&&m(n,n._.arrows.endString,1));break;case"gradient":("circle"==n.type||"ellipse"==n.type||"r"!=r(g).charAt())&&x(n,g);break;case"opacity":l.gradient&&!l[e]("stroke-opacity")&&v(u,{"stroke-opacity":g>1?g/100:g});case"fill-opacity":if(l.gradient){N=t._g.doc.getElementById(u.getAttribute("fill").replace(/^url\(#|\)$/g,c)),N&&(P=N.getElementsByTagName("stop"),v(P[P.length-1],{"stop-opacity":g}));break}default:"font-size"==d&&(g=i(g,10)+"px");var E=d.replace(/(\-.)/g,function(t){return t.substring(1).toUpperCase()});u.style[E]=g,n._.dirty=1,u.setAttribute(d,g)}}C(n,a),u.style.visibility=f},k=1.2,C=function(n,a){if("text"==n.type&&(a[e]("text")||a[e]("font")||a[e]("font-size")||a[e]("x")||a[e]("y"))){var s=n.attrs,o=n.node,u=o.firstChild?i(t._g.doc.defaultView.getComputedStyle(o.firstChild,c).getPropertyValue("font-size"),10):10;if(a[e]("text")){for(s.text=a.text;o.firstChild;)o.removeChild(o.firstChild);for(var h,l=r(a.text).split("\n"),f=[],p=0,d=l.length;d>p;p++)h=v("tspan"),p&&v(h,{dy:u*k,x:s.x}),h.appendChild(t._g.doc.createTextNode(l[p])),o.appendChild(h),f[p]=h}else for(f=o.getElementsByTagName("tspan"),p=0,d=f.length;d>p;p++)p?v(f[p],{dy:u*k,x:s.x}):v(f[0],{dy:0});v(o,{x:s.x,y:s.y}),n._.dirty=1;var g=n._getBBox(),x=s.y-(g.y+g.height/2);x&&t.is(x,"finite")&&v(f[0],{dy:x})}},B=function(e,r){this[0]=this.node=e,e.raphael=!0,this.id=t._oid++,e.raphaelid=this.id,this.matrix=t.matrix(),this.realPath=null,this.paper=r,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!r.bottom&&(r.bottom=this),this.prev=r.top,r.top&&(r.top.next=this),r.top=this,this.next=null},S=t.el;B.prototype=S,S.constructor=B,t._engine.path=function(t,e){var r=v("path");e.canvas&&e.canvas.appendChild(r);var n=new B(r,e);return n.type="path",w(n,{fill:"none",stroke:"#000",path:t}),n},S.rotate=function(t,e,i){if(this.removed)return this;if(t=r(t).split(h),t.length-1&&(e=n(t[1]),i=n(t[2])),t=n(t[0]),null==i&&(e=i),null==e||null==i){var a=this.getBBox(1);e=a.x+a.width/2,i=a.y+a.height/2}return this.transform(this._.transform.concat([["r",t,e,i]])),this},S.scale=function(t,e,i,a){if(this.removed)return this;if(t=r(t).split(h),t.length-1&&(e=n(t[1]),i=n(t[2]),a=n(t[3])),t=n(t[0]),null==e&&(e=t),null==a&&(i=a),null==i||null==a)var s=this.getBBox(1);return i=null==i?s.x+s.width/2:i,a=null==a?s.y+s.height/2:a,this.transform(this._.transform.concat([["s",t,e,i,a]])),this},S.translate=function(t,e){return this.removed?this:(t=r(t).split(h),t.length-1&&(e=n(t[1])),t=n(t[0])||0,e=+e||0,this.transform(this._.transform.concat([["t",t,e]])),this)},S.transform=function(r){var n=this._;if(null==r)return n.transform;if(t._extractTransform(this,r),this.clip&&v(this.clip,{transform:this.matrix.invert()}),this.pattern&&y(this),this.node&&v(this.node,{transform:this.matrix}),1!=n.sx||1!=n.sy){var i=this.attrs[e]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":i})}return this},S.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this},S.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},S.remove=function(){if(!this.removed&&this.node.parentNode){var e=this.paper;e.__set__&&e.__set__.exclude(this),l.unbind("raphael.*.*."+this.id),this.gradient&&e.defs.removeChild(this.gradient),t._tear(this,e),"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var r in this)this[r]="function"==typeof this[r]?t._removedFactory(r):null;this.removed=!0}},S._getBBox=function(){if("none"==this.node.style.display){this.show();var t=!0}var e={};try{e=this.node.getBBox()}catch(r){}finally{e=e||{}}return t&&this.hide(),e},S.attr=function(r,n){if(this.removed)return this;if(null==r){var i={};for(var a in this.attrs)this.attrs[e](a)&&(i[a]=this.attrs[a]);return i.gradient&&"none"==i.fill&&(i.fill=i.gradient)&&delete i.gradient,i.transform=this._.transform,i}if(null==n&&t.is(r,"string")){if("fill"==r&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==r)return this._.transform;for(var s=r.split(h),o={},u=0,c=s.length;c>u;u++)r=s[u],o[r]=r in this.attrs?this.attrs[r]:t.is(this.paper.customAttributes[r],"function")?this.paper.customAttributes[r].def:t._availableAttrs[r];return c-1?o:o[s[0]]}if(null==n&&t.is(r,"array")){for(o={},u=0,c=r.length;c>u;u++)o[r[u]]=this.attr(r[u]);return o}if(null!=n){var f={};f[r]=n}else null!=r&&t.is(r,"object")&&(f=r);for(var p in f)l("raphael.attr."+p+"."+this.id,this,f[p]);for(p in this.paper.customAttributes)if(this.paper.customAttributes[e](p)&&f[e](p)&&t.is(this.paper.customAttributes[p],"function")){var d=this.paper.customAttributes[p].apply(this,[].concat(f[p]));this.attrs[p]=f[p];for(var g in d)d[e](g)&&(f[g]=d[g])}return w(this,f),this},S.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var e=this.paper;return e.top!=this&&t._tofront(this,e),this},S.toBack=function(){if(this.removed)return this;var e=this.node.parentNode;return"a"==e.tagName.toLowerCase()?e.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):e.firstChild!=this.node&&e.insertBefore(this.node,this.node.parentNode.firstChild),t._toback(this,this.paper),this.paper,this},S.insertAfter=function(e){if(this.removed)return this;var r=e.node||e[e.length-1].node;return r.nextSibling?r.parentNode.insertBefore(this.node,r.nextSibling):r.parentNode.appendChild(this.node),t._insertafter(this,e,this.paper),this},S.insertBefore=function(e){if(this.removed)return this;var r=e.node||e[0].node;return r.parentNode.insertBefore(this.node,r),t._insertbefore(this,e,this.paper),this},S.blur=function(e){var r=this;if(0!==+e){var n=v("filter"),i=v("feGaussianBlur");r.attrs.blur=e,n.id=t.createUUID(),v(i,{stdDeviation:+e||1.5}),n.appendChild(i),r.paper.defs.appendChild(n),r._blur=n,v(r.node,{filter:"url(#"+n.id+")"})}else r._blur&&(r._blur.parentNode.removeChild(r._blur),delete r._blur,delete r.attrs.blur),r.node.removeAttribute("filter")},t._engine.circle=function(t,e,r,n){var i=v("circle");t.canvas&&t.canvas.appendChild(i);var a=new B(i,t);return a.attrs={cx:e,cy:r,r:n,fill:"none",stroke:"#000"},a.type="circle",v(i,a.attrs),a},t._engine.rect=function(t,e,r,n,i,a){var s=v("rect");t.canvas&&t.canvas.appendChild(s);var o=new B(s,t);return o.attrs={x:e,y:r,width:n,height:i,r:a||0,rx:a||0,ry:a||0,fill:"none",stroke:"#000"},o.type="rect",v(s,o.attrs),o},t._engine.ellipse=function(t,e,r,n,i){var a=v("ellipse");t.canvas&&t.canvas.appendChild(a);var s=new B(a,t);return s.attrs={cx:e,cy:r,rx:n,ry:i,fill:"none",stroke:"#000"},s.type="ellipse",v(a,s.attrs),s},t._engine.image=function(t,e,r,n,i,a){var s=v("image");v(s,{x:r,y:n,width:i,height:a,preserveAspectRatio:"none"}),s.setAttributeNS(p,"href",e),t.canvas&&t.canvas.appendChild(s);var o=new B(s,t);return o.attrs={x:r,y:n,width:i,height:a,src:e},o.type="image",o},t._engine.text=function(e,r,n,i){var a=v("text");e.canvas&&e.canvas.appendChild(a);var s=new B(a,e);return s.attrs={x:r,y:n,"text-anchor":"middle",text:i,font:t._availableAttrs.font,stroke:"none",fill:"#000"},s.type="text",w(s,s.attrs),s},t._engine.setSize=function(t,e){return this.width=t||this.width,this.height=e||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},t._engine.create=function(){var e=t._getContainer.apply(0,arguments),r=e&&e.container,n=e.x,i=e.y,a=e.width,s=e.height;if(!r)throw Error("SVG container not found.");var o,u=v("svg"),h="overflow:hidden;";return n=n||0,i=i||0,a=a||512,s=s||342,v(u,{height:s,version:1.1,width:a,xmlns:"http://www.w3.org/2000/svg"}),1==r?(u.style.cssText=h+"position:absolute;left:"+n+"px;top:"+i+"px",t._g.doc.body.appendChild(u),o=1):(u.style.cssText=h+"position:relative",r.firstChild?r.insertBefore(u,r.firstChild):r.appendChild(u)),r=new t._Paper,r.width=a,r.height=s,r.canvas=u,r.clear(),r._left=r._top=0,o&&(r.renderfix=function(){}),r.renderfix(),r},t._engine.setViewBox=function(t,e,r,n,i){l("raphael.setViewBox",this,this._viewBox,[t,e,r,n,i]);var a,o,u=s(r/this.width,n/this.height),h=this.top,c=i?"meet":"xMinYMin";for(null==t?(this._vbSize&&(u=1),delete this._vbSize,a="0 0 "+this.width+f+this.height):(this._vbSize=u,a=t+f+e+f+r+f+n),v(this.canvas,{viewBox:a,preserveAspectRatio:c});u&&h;)o="stroke-width"in h.attrs?h.attrs["stroke-width"]:1,h.attr({"stroke-width":o}),h._.dirty=1,h._.dirtyT=1,h=h.prev;return this._viewBox=[t,e,r,n,!!i],this},t.prototype.renderfix=function(){var t,e=this.canvas,r=e.style;try{t=e.getScreenCTM()||e.createSVGMatrix()}catch(n){t=e.createSVGMatrix()}var i=-t.e%1,a=-t.f%1;(i||a)&&(i&&(this._left=(this._left+i)%1,r.left=this._left+"px"),a&&(this._top=(this._top+a)%1,r.top=this._top+"px"))},t.prototype.clear=function(){t.eve("raphael.clear",this);for(var e=this.canvas;e.firstChild;)e.removeChild(e.firstChild);this.bottom=this.top=null,(this.desc=v("desc")).appendChild(t._g.doc.createTextNode("Created with Raphaël "+t.version)),e.appendChild(this.desc),e.appendChild(this.defs=v("defs"))},t.prototype.remove=function(){l("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var e in this)this[e]="function"==typeof this[e]?t._removedFactory(e):null};var A=t.st;for(var T in S)S[e](T)&&!A[e](T)&&(A[T]=function(t){return function(){var e=arguments;return this.forEach(function(r){r[t].apply(r,e)})}}(T))}(window.Raphael);window.Raphael&&window.Raphael.vml&&function(t){var e="hasOwnProperty",r=String,i=parseFloat,n=Math,a=n.round,s=n.max,o=n.min,l=n.abs,h="fill",u=/[, ]+/,c=t.eve,f=" progid:DXImageTransform.Microsoft",p=" ",d="",g={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},v=/([clmz]),?([^clmz]*)/gi,x=/ progid:\S+Blur\([^\)]+\)/g,y=/-?[^,\s-]+/g,m="position:absolute;left:0;top:0;width:1px;height:1px",b=21600,_={path:1,rect:1,image:1},w={circle:1,ellipse:1},k=function(e){var i=/[ahqstv]/gi,n=t._pathToAbsolute;if(r(e).match(i)&&(n=t._path2curve),i=/[clmz]/g,n==t._pathToAbsolute&&!r(e).match(i)){var s=r(e).replace(v,function(t,e,r){var i=[],n="m"==e.toLowerCase(),s=g[e];return r.replace(y,function(t){n&&2==i.length&&(s+=i+g["m"==e?"l":"L"],i=[]),i.push(a(t*b))}),s+i});return s}var o,l,h=n(e);s=[];for(var u=0,c=h.length;c>u;u++){o=h[u],l=h[u][0].toLowerCase(),"z"==l&&(l="x");for(var f=1,x=o.length;x>f;f++)l+=a(o[f]*b)+(f!=x-1?",":d);s.push(l)}return s.join(p)},C=function(e,r,i){var n=t.matrix();return n.rotate(-e,.5,.5),{dx:n.x(r,i),dy:n.y(r,i)}},B=function(t,e,r,i,n,a){var s=t._,o=t.matrix,u=s.fillpos,c=t.node,f=c.style,d=1,g="",v=b/e,x=b/r;if(f.visibility="hidden",e&&r){if(c.coordsize=l(v)+p+l(x),f.rotation=a*(0>e*r?-1:1),a){var y=C(a,i,n);i=y.dx,n=y.dy}if(0>e&&(g+="x"),0>r&&(g+=" y")&&(d=-1),f.flip=g,c.coordorigin=i*-v+p+n*-x,u||s.fillsize){var m=c.getElementsByTagName(h);m=m&&m[0],c.removeChild(m),u&&(y=C(a,o.x(u[0],u[1]),o.y(u[0],u[1])),m.position=y.dx*d+p+y.dy*d),s.fillsize&&(m.size=s.fillsize[0]*l(e)+p+s.fillsize[1]*l(r)),c.appendChild(m)}f.visibility="visible"}};t.toString=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version};var S=function(t,e,i){for(var n=r(e).toLowerCase().split("-"),a=i?"end":"start",s=n.length,o="classic",l="medium",h="medium";s--;)switch(n[s]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":o=n[s];break;case"wide":case"narrow":h=n[s];break;case"long":case"short":l=n[s]}var u=t.node.getElementsByTagName("stroke")[0];u[a+"arrow"]=o,u[a+"arrowlength"]=l,u[a+"arrowwidth"]=h},A=function(n,l){n.attrs=n.attrs||{};var c=n.node,f=n.attrs,g=c.style,v=_[n.type]&&(l.x!=f.x||l.y!=f.y||l.width!=f.width||l.height!=f.height||l.cx!=f.cx||l.cy!=f.cy||l.rx!=f.rx||l.ry!=f.ry||l.r!=f.r),x=w[n.type]&&(f.cx!=l.cx||f.cy!=l.cy||f.r!=l.r||f.rx!=l.rx||f.ry!=l.ry),y=n;for(var m in l)l[e](m)&&(f[m]=l[m]);if(v&&(f.path=t._getPath[n.type](n),n._.dirty=1),l.href&&(c.href=l.href),l.title&&(c.title=l.title),l.target&&(c.target=l.target),l.cursor&&(g.cursor=l.cursor),"blur"in l&&n.blur(l.blur),(l.path&&"path"==n.type||v)&&(c.path=k(~r(f.path).toLowerCase().indexOf("r")?t._pathToAbsolute(f.path):f.path),"image"==n.type&&(n._.fillpos=[f.x,f.y],n._.fillsize=[f.width,f.height],B(n,1,1,0,0,0))),"transform"in l&&n.transform(l.transform),x){var C=+f.cx,A=+f.cy,N=+f.rx||+f.r||0,E=+f.ry||+f.r||0;c.path=t.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",a((C-N)*b),a((A-E)*b),a((C+N)*b),a((A+E)*b),a(C*b))}if("clip-rect"in l){var M=r(l["clip-rect"]).split(u);if(4==M.length){M[2]=+M[2]+ +M[0],M[3]=+M[3]+ +M[1];var z=c.clipRect||t._g.doc.createElement("div"),F=z.style;F.clip=t.format("rect({1}px {2}px {3}px {0}px)",M),c.clipRect||(F.position="absolute",F.top=0,F.left=0,F.width=n.paper.width+"px",F.height=n.paper.height+"px",c.parentNode.insertBefore(z,c),z.appendChild(c),c.clipRect=z)}l["clip-rect"]||c.clipRect&&(c.clipRect.style.clip="auto")}if(n.textpath){var R=n.textpath.style;l.font&&(R.font=l.font),l["font-family"]&&(R.fontFamily='"'+l["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,d)+'"'),l["font-size"]&&(R.fontSize=l["font-size"]),l["font-weight"]&&(R.fontWeight=l["font-weight"]),l["font-style"]&&(R.fontStyle=l["font-style"])}if("arrow-start"in l&&S(y,l["arrow-start"]),"arrow-end"in l&&S(y,l["arrow-end"],1),null!=l.opacity||null!=l["stroke-width"]||null!=l.fill||null!=l.src||null!=l.stroke||null!=l["stroke-width"]||null!=l["stroke-opacity"]||null!=l["fill-opacity"]||null!=l["stroke-dasharray"]||null!=l["stroke-miterlimit"]||null!=l["stroke-linejoin"]||null!=l["stroke-linecap"]){var P=c.getElementsByTagName(h),I=!1;if(P=P&&P[0],!P&&(I=P=L(h)),"image"==n.type&&l.src&&(P.src=l.src),l.fill&&(P.on=!0),(null==P.on||"none"==l.fill||null===l.fill)&&(P.on=!1),P.on&&l.fill){var j=r(l.fill).match(t._ISURL);if(j){P.parentNode==c&&c.removeChild(P),P.rotate=!0,P.src=j[1],P.type="tile";var q=n.getBBox(1);P.position=q.x+p+q.y,n._.fillpos=[q.x,q.y],t._preload(j[1],function(){n._.fillsize=[this.offsetWidth,this.offsetHeight]})}else P.color=t.getRGB(l.fill).hex,P.src=d,P.type="solid",t.getRGB(l.fill).error&&(y.type in{circle:1,ellipse:1}||"r"!=r(l.fill).charAt())&&T(y,l.fill,P)&&(f.fill="none",f.gradient=l.fill,P.rotate=!1)}if("fill-opacity"in l||"opacity"in l){var D=((+f["fill-opacity"]+1||2)-1)*((+f.opacity+1||2)-1)*((+t.getRGB(l.fill).o+1||2)-1);D=o(s(D,0),1),P.opacity=D,P.src&&(P.color="none")}c.appendChild(P);var O=c.getElementsByTagName("stroke")&&c.getElementsByTagName("stroke")[0],V=!1;!O&&(V=O=L("stroke")),(l.stroke&&"none"!=l.stroke||l["stroke-width"]||null!=l["stroke-opacity"]||l["stroke-dasharray"]||l["stroke-miterlimit"]||l["stroke-linejoin"]||l["stroke-linecap"])&&(O.on=!0),("none"==l.stroke||null===l.stroke||null==O.on||0==l.stroke||0==l["stroke-width"])&&(O.on=!1);var Y=t.getRGB(l.stroke);O.on&&l.stroke&&(O.color=Y.hex),D=((+f["stroke-opacity"]+1||2)-1)*((+f.opacity+1||2)-1)*((+Y.o+1||2)-1);var G=.75*(i(l["stroke-width"])||1);if(D=o(s(D,0),1),null==l["stroke-width"]&&(G=f["stroke-width"]),l["stroke-width"]&&(O.weight=G),G&&1>G&&(D*=G)&&(O.weight=1),O.opacity=D,l["stroke-linejoin"]&&(O.joinstyle=l["stroke-linejoin"]||"miter"),O.miterlimit=l["stroke-miterlimit"]||8,l["stroke-linecap"]&&(O.endcap="butt"==l["stroke-linecap"]?"flat":"square"==l["stroke-linecap"]?"square":"round"),l["stroke-dasharray"]){var W={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};O.dashstyle=W[e](l["stroke-dasharray"])?W[l["stroke-dasharray"]]:d}V&&c.appendChild(O)}if("text"==y.type){y.paper.canvas.style.display=d;var X=y.paper.span,H=100,U=f.font&&f.font.match(/\d+(?:\.\d*)?(?=px)/);g=X.style,f.font&&(g.font=f.font),f["font-family"]&&(g.fontFamily=f["font-family"]),f["font-weight"]&&(g.fontWeight=f["font-weight"]),f["font-style"]&&(g.fontStyle=f["font-style"]),U=i(f["font-size"]||U&&U[0])||10,g.fontSize=U*H+"px",y.textpath.string&&(X.innerHTML=r(y.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var $=X.getBoundingClientRect();y.W=f.w=($.right-$.left)/H,y.H=f.h=($.bottom-$.top)/H,y.X=f.x,y.Y=f.y+y.H/2,("x"in l||"y"in l)&&(y.path.v=t.format("m{0},{1}l{2},{1}",a(f.x*b),a(f.y*b),a(f.x*b)+1));for(var Z=["x","y","text","font","font-family","font-weight","font-style","font-size"],Q=0,J=Z.length;J>Q;Q++)if(Z[Q]in l){y._.dirty=1;break}switch(f["text-anchor"]){case"start":y.textpath.style["v-text-align"]="left",y.bbx=y.W/2;break;case"end":y.textpath.style["v-text-align"]="right",y.bbx=-y.W/2;break;default:y.textpath.style["v-text-align"]="center",y.bbx=0}y.textpath.style["v-text-kern"]=!0}},T=function(e,a,s){e.attrs=e.attrs||{};var o=(e.attrs,Math.pow),l="linear",h=".5 .5";if(e.attrs.gradient=a,a=r(a).replace(t._radial_gradient,function(t,e,r){return l="radial",e&&r&&(e=i(e),r=i(r),o(e-.5,2)+o(r-.5,2)>.25&&(r=n.sqrt(.25-o(e-.5,2))*(2*(r>.5)-1)+.5),h=e+p+r),d}),a=a.split(/\s*\-\s*/),"linear"==l){var u=a.shift();if(u=-i(u),isNaN(u))return null}var c=t._parseDots(a);if(!c)return null;if(e=e.shape||e.node,c.length){e.removeChild(s),s.on=!0,s.method="none",s.color=c[0].color,s.color2=c[c.length-1].color;for(var f=[],g=0,v=c.length;v>g;g++)c[g].offset&&f.push(c[g].offset+p+c[g].color);s.colors=f.length?f.join():"0% "+s.color,"radial"==l?(s.type="gradientTitle",s.focus="100%",s.focussize="0 0",s.focusposition=h,s.angle=0):(s.type="gradient",s.angle=(270-u)%360),e.appendChild(s)}return 1},N=function(e,r){this[0]=this.node=e,e.raphael=!0,this.id=t._oid++,e.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=r,this.matrix=t.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!r.bottom&&(r.bottom=this),this.prev=r.top,r.top&&(r.top.next=this),r.top=this,this.next=null},E=t.el;N.prototype=E,E.constructor=N,E.transform=function(e){if(null==e)return this._.transform;var i,n=this.paper._viewBoxShift,a=n?"s"+[n.scale,n.scale]+"-1-1t"+[n.dx,n.dy]:d;n&&(i=e=r(e).replace(/\.{3}|\u2026/g,this._.transform||d)),t._extractTransform(this,a+e);var s,o=this.matrix.clone(),l=this.skew,h=this.node,u=~r(this.attrs.fill).indexOf("-"),c=!r(this.attrs.fill).indexOf("url(");if(o.translate(-.5,-.5),c||u||"image"==this.type)if(l.matrix="1 0 0 1",l.offset="0 0",s=o.split(),u&&s.noRotation||!s.isSimple){h.style.filter=o.toFilter();var f=this.getBBox(),g=this.getBBox(1),v=f.x-g.x,x=f.y-g.y;h.coordorigin=v*-b+p+x*-b,B(this,1,1,v,x,0)}else h.style.filter=d,B(this,s.scalex,s.scaley,s.dx,s.dy,s.rotate);else h.style.filter=d,l.matrix=r(o),l.offset=o.offset();return i&&(this._.transform=i),this},E.rotate=function(t,e,n){if(this.removed)return this;if(null!=t){if(t=r(t).split(u),t.length-1&&(e=i(t[1]),n=i(t[2])),t=i(t[0]),null==n&&(e=n),null==e||null==n){var a=this.getBBox(1);e=a.x+a.width/2,n=a.y+a.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",t,e,n]])),this}},E.translate=function(t,e){return this.removed?this:(t=r(t).split(u),t.length-1&&(e=i(t[1])),t=i(t[0])||0,e=+e||0,this._.bbox&&(this._.bbox.x+=t,this._.bbox.y+=e),this.transform(this._.transform.concat([["t",t,e]])),this)},E.scale=function(t,e,n,a){if(this.removed)return this;if(t=r(t).split(u),t.length-1&&(e=i(t[1]),n=i(t[2]),a=i(t[3]),isNaN(n)&&(n=null),isNaN(a)&&(a=null)),t=i(t[0]),null==e&&(e=t),null==a&&(n=a),null==n||null==a)var s=this.getBBox(1);return n=null==n?s.x+s.width/2:n,a=null==a?s.y+s.height/2:a,this.transform(this._.transform.concat([["s",t,e,n,a]])),this._.dirtyT=1,this},E.hide=function(){return!this.removed&&(this.node.style.display="none"),this},E.show=function(){return!this.removed&&(this.node.style.display=d),this},E._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},E.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),t.eve.unbind("raphael.*.*."+this.id),t._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var e in this)this[e]="function"==typeof this[e]?t._removedFactory(e):null;this.removed=!0}},E.attr=function(r,i){if(this.removed)return this;if(null==r){var n={};for(var a in this.attrs)this.attrs[e](a)&&(n[a]=this.attrs[a]);return n.gradient&&"none"==n.fill&&(n.fill=n.gradient)&&delete n.gradient,n.transform=this._.transform,n}if(null==i&&t.is(r,"string")){if(r==h&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var s=r.split(u),o={},l=0,f=s.length;f>l;l++)r=s[l],o[r]=r in this.attrs?this.attrs[r]:t.is(this.paper.customAttributes[r],"function")?this.paper.customAttributes[r].def:t._availableAttrs[r];return f-1?o:o[s[0]]}if(this.attrs&&null==i&&t.is(r,"array")){for(o={},l=0,f=r.length;f>l;l++)o[r[l]]=this.attr(r[l]);return o}var p;null!=i&&(p={},p[r]=i),null==i&&t.is(r,"object")&&(p=r);for(var d in p)c("raphael.attr."+d+"."+this.id,this,p[d]);if(p){for(d in this.paper.customAttributes)if(this.paper.customAttributes[e](d)&&p[e](d)&&t.is(this.paper.customAttributes[d],"function")){var g=this.paper.customAttributes[d].apply(this,[].concat(p[d]));this.attrs[d]=p[d];for(var v in g)g[e](v)&&(p[v]=g[v])}p.text&&"text"==this.type&&(this.textpath.string=p.text),A(this,p)}return this},E.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&t._tofront(this,this.paper),this},E.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),t._toback(this,this.paper)),this)},E.insertAfter=function(e){return this.removed?this:(e.constructor==t.st.constructor&&(e=e[e.length-1]),e.node.nextSibling?e.node.parentNode.insertBefore(this.node,e.node.nextSibling):e.node.parentNode.appendChild(this.node),t._insertafter(this,e,this.paper),this)},E.insertBefore=function(e){return this.removed?this:(e.constructor==t.st.constructor&&(e=e[0]),e.node.parentNode.insertBefore(this.node,e.node),t._insertbefore(this,e,this.paper),this)},E.blur=function(e){var r=this.node.runtimeStyle,i=r.filter;i=i.replace(x,d),0!==+e?(this.attrs.blur=e,r.filter=i+p+f+".Blur(pixelradius="+(+e||1.5)+")",r.margin=t.format("-{0}px 0 0 -{0}px",a(+e||1.5))):(r.filter=i,r.margin=0,delete this.attrs.blur)},t._engine.path=function(t,e){var r=L("shape");r.style.cssText=m,r.coordsize=b+p+b,r.coordorigin=e.coordorigin;var i=new N(r,e),n={fill:"none",stroke:"#000"};t&&(n.path=t),i.type="path",i.path=[],i.Path=d,A(i,n),e.canvas.appendChild(r);var a=L("skew");return a.on=!0,r.appendChild(a),i.skew=a,i.transform(d),i},t._engine.rect=function(e,r,i,n,a,s){var o=t._rectPath(r,i,n,a,s),l=e.path(o),h=l.attrs;return l.X=h.x=r,l.Y=h.y=i,l.W=h.width=n,l.H=h.height=a,h.r=s,h.path=o,l.type="rect",l},t._engine.ellipse=function(t,e,r,i,n){var a=t.path();return a.attrs,a.X=e-i,a.Y=r-n,a.W=2*i,a.H=2*n,a.type="ellipse",A(a,{cx:e,cy:r,rx:i,ry:n}),a},t._engine.circle=function(t,e,r,i){var n=t.path();return n.attrs,n.X=e-i,n.Y=r-i,n.W=n.H=2*i,n.type="circle",A(n,{cx:e,cy:r,r:i}),n},t._engine.image=function(e,r,i,n,a,s){var o=t._rectPath(i,n,a,s),l=e.path(o).attr({stroke:"none"}),u=l.attrs,c=l.node,f=c.getElementsByTagName(h)[0];return u.src=r,l.X=u.x=i,l.Y=u.y=n,l.W=u.width=a,l.H=u.height=s,u.path=o,l.type="image",f.parentNode==c&&c.removeChild(f),f.rotate=!0,f.src=r,f.type="tile",l._.fillpos=[i,n],l._.fillsize=[a,s],c.appendChild(f),B(l,1,1,0,0,0),l},t._engine.text=function(e,i,n,s){var o=L("shape"),l=L("path"),h=L("textpath");i=i||0,n=n||0,s=s||"",l.v=t.format("m{0},{1}l{2},{1}",a(i*b),a(n*b),a(i*b)+1),l.textpathok=!0,h.string=r(s),h.on=!0,o.style.cssText=m,o.coordsize=b+p+b,o.coordorigin="0 0";var u=new N(o,e),c={fill:"#000",stroke:"none",font:t._availableAttrs.font,text:s};u.shape=o,u.path=l,u.textpath=h,u.type="text",u.attrs.text=r(s),u.attrs.x=i,u.attrs.y=n,u.attrs.w=1,u.attrs.h=1,A(u,c),o.appendChild(h),o.appendChild(l),e.canvas.appendChild(o);var f=L("skew");return f.on=!0,o.appendChild(f),u.skew=f,u.transform(d),u},t._engine.setSize=function(e,r){var i=this.canvas.style;return this.width=e,this.height=r,e==+e&&(e+="px"),r==+r&&(r+="px"),i.width=e,i.height=r,i.clip="rect(0 "+e+" "+r+" 0)",this._viewBox&&t._engine.setViewBox.apply(this,this._viewBox),this},t._engine.setViewBox=function(e,r,i,n,a){t.eve("raphael.setViewBox",this,this._viewBox,[e,r,i,n,a]);var o,l,h=this.width,u=this.height,c=1/s(i/h,n/u);return a&&(o=u/n,l=h/i,h>i*o&&(e-=(h-i*o)/2/o),u>n*l&&(r-=(u-n*l)/2/l)),this._viewBox=[e,r,i,n,!!a],this._viewBoxShift={dx:-e,dy:-r,scale:c},this.forEach(function(t){t.transform("...")}),this};var L;t._engine.initWin=function(t){var e=t.document;e.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!e.namespaces.rvml&&e.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),L=function(t){return e.createElement("<rvml:"+t+' class="rvml">')}}catch(r){L=function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},t._engine.initWin(t._g.win),t._engine.create=function(){var e=t._getContainer.apply(0,arguments),r=e.container,i=e.height,n=e.width,a=e.x,s=e.y;if(!r)throw Error("VML container not found.");var o=new t._Paper,l=o.canvas=t._g.doc.createElement("div"),h=l.style;return a=a||0,s=s||0,n=n||512,i=i||342,o.width=n,o.height=i,n==+n&&(n+="px"),i==+i&&(i+="px"),o.coordsize=1e3*b+p+1e3*b,o.coordorigin="0 0",o.span=t._g.doc.createElement("span"),o.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",l.appendChild(o.span),h.cssText=t.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",n,i),1==r?(t._g.doc.body.appendChild(l),h.left=a+"px",h.top=s+"px",h.position="absolute"):r.firstChild?r.insertBefore(l,r.firstChild):r.appendChild(l),o.renderfix=function(){},o},t.prototype.clear=function(){t.eve("raphael.clear",this),this.canvas.innerHTML=d,this.span=t._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},t.prototype.remove=function(){t.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var e in this)this[e]="function"==typeof this[e]?t._removedFactory(e):null;return!0};var M=t.st;for(var z in E)E[e](z)&&!M[e](z)&&(M[z]=function(t){return function(){var e=arguments;return this.forEach(function(r){r[t].apply(r,e)})}}(z))}(window.Raphael);